(function(d){d.fn.suggest=function(){this.each(function(){var c=d(this),k=c.closest("form"),b=d("\x3cdiv/\x3e").addClass("search-suggestions"),f,r=c.data("threshold")||2,t=c.data("wait")||500,u=c.data("suggest"),m={q:null},n={},e,p;b.setPosition=function(){var a=c.offset();b.css({top:a.top+c.outerHeight()+-1,left:a.left,width:c.outerWidth()});return b};b.reset=function(){b.empty();f=null;return b};var v=function(){b.find("li").removeClass("active");d(this).addClass("active");f=d(this)},w=function(){d(this).removeClass("active");
f=null},q=function(a){b.reset();if(a.suggestions.length){for(var c=d("\x3cul/\x3e"),g=0;g<a.suggestions.length;g++){var h=a.suggestions[g],f=d("\x3cli/\x3e"),e=d("\x3cspan/\x3e"),h=h.display||h.text,h=h.replace(/<(\/?)b>/g,"\x3c$1mark\x3e");f.hover(v,w);e.html(h).appendTo(f.appendTo(c))}b.append(c).setPosition().show()}else b.hide()},x=function(){if(n[e])q(n[e]);else{var a=k.serializeArray(),b;for(b in a){var c=a[b];m[c.name]=c.value}d.ajax({method:"GET",url:u,data:m,dataType:"json",complete:function(a){n[e]=
a.responseJSON;q(a.responseJSON)}});return k}},l;for(l in this.dataset)l.match(/^suggest[A-Z]\w+/)&&(m[l.replace(/^suggest/,"").toLowerCase()]=this.dataset[l]);c.attr("autocomplete","off");b.appendTo("body").hide();c.on("keyup",function(a){a=a.which;var d=String.fromCharCode(a);if(8===a||46===a||27===a||d.match(/\w/))e=c.val().replace(/\s+$/,""),p&&clearTimeout(p),e.length>=r?p=setTimeout(x,t):b.reset().hide()});d(window).on("keydown",function(a){if(d(document.activeElement).is(c)&&b.is(":visible")){var e=
38===a.which,g=40===a.which;if(13===a.which&&f)return c.val(f.text()),b.hide(),k.submit(),!1;if(e||g)g=e?"li:last-child":"li:first-child",e=f?f[e?"prev":"next"]():b.find(g),e.length&&(b.find("li").removeClass("active"),f=e.addClass("active")),a.preventDefault()}});d(window).on("resize",b.setPosition);b.on("click",function(a){a=d(a.target).closest("li").text();c.val(a);k.submit()});c.on("blur",function(){setTimeout(function(){b.reset().hide()},125)})});return this};d("input[data-suggest]").suggest()})(jQuery);