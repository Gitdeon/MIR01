/*!
Waypoints - 3.1.1
Copyright © 2011-2015 Caleb Troughton
Licensed under the MIT license.
https://github.com/imakewebthings/waypoints/blog/master/licenses.txt
*/

/*!
* jQuery throttle / debounce - v1.1 - 3/7/2010
* http://benalman.com/projects/jquery-throttle-debounce-plugin/
*
* Copyright (c) 2010 "Cowboy" Ben Alman
* Dual licensed under the MIT and GPL licenses.
* http://benalman.com/about/license/
*/

// Script: jQuery throttle / debounce: Sometimes, less is more!
//
// *Version: 1.1, Last updated: 3/7/2010*
//
// Project Home - http://benalman.com/projects/jquery-throttle-debounce-plugin/
// GitHub - http://github.com/cowboy/jquery-throttle-debounce/
// Source - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.js
// (Minified) - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.min.js (0.7kb)
//
// About: License
//
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
//
// About: Examples
//
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
//
// Throttle - http://benalman.com/code/projects/jquery-throttle-debounce/examples/throttle/
// Debounce - http://benalman.com/code/projects/jquery-throttle-debounce/examples/debounce/
//
// About: Support and Testing
//
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
//
// jQuery Versions - none, 1.3.2, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-3.6, Safari 3-4, Chrome 4-5, Opera 9.6-10.1.
// Unit Tests - http://benalman.com/code/projects/jquery-throttle-debounce/unit/
//
// About: Release History
//
// 1.1 - (3/7/2010) Fixed a bug in <jQuery.throttle> where trailing callbacks
// executed later than they should. Reworked a fair amount of internal
// logic as well.
// 1.0 - (3/6/2010) Initial release as a stand-alone project. Migrated over
// from jquery-misc repo v0.4 to jquery-throttle repo v1.0, added the
// no_trailing throttle parameter and debounce functionality.
//
// Topic: Note for non-jQuery users
//
// jQuery isn't actually required for this plugin, because nothing internal
// uses any jQuery methods or properties. jQuery is just used as a namespace
// under which these methods can exist.
//
// Since jQuery isn't actually required for this plugin, if jQuery doesn't exist
// when this plugin is loaded, the method described below will be created in
// the `Cowboy` namespace. Usage will be exactly the same, but instead of
// $.method() or jQuery.method(), you'll need to use Cowboy.method().

/*
* jQuery Mobile v1.4.0-alpha.1
* http://jquerymobile.com
*
* Copyright 2010, 2013 jQuery Foundation, Inc. and other contributors
* Released under the MIT license.
* http://jquery.org/license
*
*/

/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2013 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.9.3
 *
 */

/*!
Waypoints Inview Shortcut - 3.1.1
Copyright © 2011-2015 Caleb Troughton
Licensed under the MIT license.
https://github.com/imakewebthings/waypoints/blog/master/licenses.txt
*/

//     uuid.js
//
//     Copyright (c) 2010-2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php

/**
 * jQuery iframe click tracking plugin
 *
 * @author Vincent Paré (www.finalclap.com)
 * @copyright © 2013-2015 Vincent Paré
 * @license http://opensource.org/licenses/Apache-2.0
 * @version 1.1.0
 */

/**
     * @license
     * Lodash (Custom Build) <https://lodash.com/>
     * Build: `lodash include="noConflict,compact,drop,indexOf,pull,sortBy,without,every,find,forEach,includes,map,some,debounce,throttle,clone,cloneDeep,isArray,isBoolean,isDate,isEmpty,isFunction,isNull,isNumber,isNaN,isUndefined,isObject,isPlainObject,isString,indexOf,assign,extend,get,forOwn,omitBy,capitalize,endsWith,has,inRange,min,padStart,round,startsWith,template,toJSON" --development --source-map --output lib/lodash.js`
     * Copyright JS Foundation and other contributors <https://js.foundation/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     */

/* utf.js - UTF-8 <=> UTF-16 convertion
                         *
                         * Copyright (C) 1999 Masanao Izumo <iz@onicos.co.jp>
                         * Version: 1.0
                         * LastModified: Dec 25 1999
                         * This library is free.  You can redistribute it and/or modify it.
                         */

// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

/**
                     * Copyright 2013 vtt.js Contributors
                     *
                     * Licensed under the Apache License, Version 2.0 (the "License");
                     * you may not use this file except in compliance with the License.
                     * You may obtain a copy of the License at
                     *
                     *   http://www.apache.org/licenses/LICENSE-2.0
                     *
                     * Unless required by applicable law or agreed to in writing, software
                     * distributed under the License is distributed on an "AS IS" BASIS,
                     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                     * See the License for the specific language governing permissions and
                     * limitations under the License.
                     */

/**
                     *
                     * This code was ported from the dash.js project at:
                     *   https://github.com/Dash-Industry-Forum/dash.js/blob/development/externals/cea608-parser.js
                     *   https://github.com/Dash-Industry-Forum/dash.js/commit/8269b26a761e0853bb21d78780ed945144ecdd4d#diff-71bc295a2d6b6b7093a1d3290d53a4b2
                     *
                     * The original copyright appears below:
                     *
                     * The copyright in this software is being made available under the BSD License,
                     * included below. This software may be subject to other third party and contributor
                     * rights, including patent rights, and no such rights are granted under this license.
                     *
                     * Copyright (c) 2015-2016, DASH Industry Forum.
                     * All rights reserved.
                     *
                     * Redistribution and use in source and binary forms, with or without modification,
                     * are permitted provided that the following conditions are met:
                     *  1. Redistributions of source code must retain the above copyright notice, this
                     *  list of conditions and the following disclaimer.
                     *  * Redistributions in binary form must reproduce the above copyright notice,
                     *  this list of conditions and the following disclaimer in the documentation and/or
                     *  other materials provided with the distribution.
                     *  2. Neither the name of Dash Industry Forum nor the names of its
                     *  contributors may be used to endorse or promote products derived from this software
                     *  without specific prior written permission.
                     *
                     *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY
                     *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
                     *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
                     *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
                     *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
                     *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
                     *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
                     *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
                     *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
                     *  POSSIBILITY OF SUCH DAMAGE.
                     */

// copyright sign

// if licenseXhrSetup did not yet call open, let's do it now

/**
                         * @param {object} keysListItem
                         * @param {ArrayBuffer} keyMessage
                         * @returns {ArrayBuffer} Challenge data posted to license server
                         */

/*
                                 if (this.licenseType !== this.LICENSE_TYPE_WIDEVINE) {
                                 // For PlayReady CDMs, we need to dig the Challenge out of the XML.
                                 var keyMessageXml = new DOMParser().parseFromString(String.fromCharCode.apply(null, new Uint16Array(keyMessage)), 'application/xml');
                                 if (keyMessageXml.getElementsByTagName('Challenge')[0]) {
                                 challenge = atob(keyMessageXml.getElementsByTagName('Challenge')[0].childNodes[0].nodeValue);
                                 } else {
                                 throw 'Cannot find <Challenge> in key message';
                                 }
                                 var headerNames = keyMessageXml.getElementsByTagName('name');
                                 var headerValues = keyMessageXml.getElementsByTagName('value');
                                 if (headerNames.length !== headerValues.length) {
                                 throw 'Mismatched header <name>/<value> pair in key message';
                                 }
                                 for (var i = 0; i < headerNames.length; i++) {
                                 xhr.setRequestHeader(headerNames[i].childNodes[0].nodeValue, headerValues[i].childNodes[0].nodeValue);
                                 }
                                 }
                                 */

/*! http://mths.be/endswith v0.2.0 by @mathias */

/**
             * Object containing the current content video metadata.
             * @typedef {Object} contentVideoState
             * @property {Array} abrInfo - Contains an array of objects with nominal info about how many levels there are.
             * @property {String} assetURL - URL of the video asset.
             * @property {String} audioPreviewImageUrl - URL of the audio preview image.
             * @property {String} category - From the Platform metadata of RCO.
             * @property {String} cdn - The Content Distribution Network for the current video, typically 'akamai' or 'akamai_hd'.
             * @property {Array} chapterStartTimes - array of chapter start times in seconds.
             * @property {String} closedCaptionDivName - element ID of the closed Captions div
             * @property {String} closedCaptionPath - URL of the closed captions sidecar file.
             * @property {String} closedCaptionType - tbd
             * @property {String} cms - Current Content Management Server.
             * @property {String} cmsRefGuid - platfrom 'guid' prop or RCO cmsRefGuid property.
             * @property {String} contentType - BU-specific label
             * @property {Object} contextMetadata - arbitrary set of name/value pairs supplied by user (in resource cfg)
             * @property {String} contPlayState - Continuous Play State from previdus video, '', 'endcard' or 'endcard_click'.
             * @property {String} copyright - from Platform metadata or RCO
             * @property {Number} defaultBitrate - 0,
             * @property {String} deliveryType - uvpjs.mediaCapabilities.PROGRESSIVE or uvpjs.mediaCapabilities.STREAMING
             * @property {String} dfpMediaId - the content video id to be used for ad calls
             * @property {Number} duration - Video duration in seconds.
             * @property {Number} endTime - Video end time in seconds.
             * @property {String} episodeAbstract - from Platform metadata or RCO.
             * @property {Boolean} episodeFlag - from Platform metadata or RCO.
             * @property {String} episodeNumber - from Platform metadata or RCO.
             * @property {String} episodeTitle - from Platform metadata or RCO.
             * @property {String} excludeNielsenTracking - from Platform; default false
             * @property {String} fileType - 'm3u', 'mp4', .
             * @property {Boolean} isAffiliateFeed - false,
             * @property {Boolean} isEmbedable - false,
             * @property {Boolean} isGeoRestricted - false,
             * @property {Boolean} isLive - false,
             * @property {Boolean} isPaidContent - false,
             * @property {Boolean} isResumed - false,
             * @property {Boolean} isFlash - false Set to TRUE if using UVP Flash
             * @property {String} keywords - from Platform metadata.
             * @property {String} mediaId - from Platform metadata.
             * @property {String} overrideAssetURL - Override asset URL used for dynamic variant playlists.
             * @property {String} ozTamMediaId - Media Id specific to OzTam Tracking
             * @property {Boolean} ozTamOptOut - Flag to opt out of OzTam Tracking
             * @property {String} pid - Platform Public ID.
             * @property {String} restrictionCheckResult.
             * @property {Boolean} sendResumeEvent used in local and global resume cases.
             * @property {Number} elapsedTime - Integer seconds. If not available default to zero.
             * @property {Boolean} showPreroll: false - Boolean. Never show preroll in global resume case. Default true.
             * @property {Number} playedChapterTime - Integer seconds. Derive this from Platform Chapter times or IMA cue points.
             * @property {String} previousSessionId - String, MD5 hash session ID.
             * @property {String} seasonNumber - from Platform metadata.
             * @property {String} seriesTitle - from Platform metadata.
             * @property {Number} sourceHeight - 0.
             * @property {String} sourceOwner.
             * @property {Number} sourceWidth - 0.
             * @property {Number} startTime - 0.
             * @property {Boolean} useWatermark - false.
             * @property {String} videoTitle
             * @property {Boolean} is360 - false.
             * @public
             */

// Sent when Safari has proccessed an HLS manifest using FairPlay and needs to acquire a license key

/*
         SWFObject v2.3.20130521 http://github.com/swfobject/swfobject
         Released under the MIT License http://www.opensource.org/licenses/mit-license
         */

/**
             * Extracts/builds license server URL & content id.
             * Registers WebKitMediaKeys with correct Key System(com.apple.fps.1_0)
             * Creates webkitKeys sessions and pass in the combined initData(initData, contentId, appCertData)
             * Registers event handlers on the keySession
             *
             * @memberof uvpjs.FairPlayDRM#
             */

/**
             * When FairPlay CDM is ready, build the SPC payload and send it to license server to get CKC for playback
             *
             * @memberof uvpjs.FairPlayDRM#
             * @param {String} url URL of license server to send SPC to, for Irdecto, usually at the /getckc path
             * @param {Object} event Event object
             */

/**
             * Parses the FairPlay initData and constructs a license server URL.  If there is a value set for this.drm.fairplay.licenseURL - we override what is in the initData and LA URL in manifest!!
             * skd:// is swapped to https://
             * If sessionID or ticket are set on the contentVideoState.drm they are appened to the URL
             *
             * @memberof uvpjs.FairPlayDRM#
             * @param {Uint16Array} initData Inititialization data from webkitneedkey, usually contains the URI from HLS manifest
             * @returns {String} URL for the license server, this is usually a /getckc URL for Irdeto
             */

/**
             * Extracts the ContentId value from a license server URL
             *
             * @memberof uvpjs.FairPlayDRM#
             * @param {String} licenseServerUrl License server URL
             * @returns {String} Content Id value for Irdeto || assetId for DRMToday
             */

/*	
 *	jQuery dotdotdot 1.6.1
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */

define("managers/tealium",["jquery","version!fly/managers/debug","managers/page-vars","managers/client-storage","managers/tracking","optional!"+(window.CnetPageVars.services.tealium&&window.CnetPageVars.services.tealium.enabled?"tealium":"feature-disabled")],function(t,e,i,s,n){var a=e.get("tealium"),r={comscore:{fireCount:0,maxFireCount:1,requestPrefix:"https://sb.scorecardresearch.com/b?",timerName:"track_comscore"}},o={timeThreshold:4e3,requestThreshold:10,requestCount:0},l={_getCollectionId:function(){var t="";return"object"==typeof i.tracking.data.collectionId?t=i.tracking.data.collectionId[0]:"string"==typeof i.tracking.data.collectionId&&(t=i.tracking.data.collectionId),t},getDwTag:function(t,e){var i=[];e=e||3;do{t=t.parents("[section],[id]"),t.attr("section")?i.push(t.attr("section")):t.attr("id")&&i.push(t.attr("id"))}while(i.length<e&&0<t.length);return i.reverse().join("|")},getHbParams:function(e){utag_data.videoAutoPlay="off"===s.read("autoplayEnabled")?"off":"on";var n=new Array("bm_name","bm_type","brand","siteEdition","siteSection","siteType","articleId","articleType","articleTitle","mediaAutoPlay","mfr","pageType","pageTypeId","pageOntologyId","pageViewGuid","productId","productName","productSeriesId","productSeriesName","productSlug","productType","showId","showTitle","showEpisodeId","showEpisodeTitle","userState","userId","userType","userRegId","deviceType","dwAnonId","videoAutoPlay"),a=new Array,r={};e=e||{};for(var o=0;o<n.length;o++)utag_data[n[o]]&&(a[n[o]]=utag_data[n[o]]);return t.extend(r,a,{siteRsids:utag_data._scAccount,siteCode:utag_data._siteCode,pageUrl:utag_data._pageUrl,sitePrimaryRsid:utag_data._sitePrimaryRsid,userStatus:utag_data.userType,siteHier:utag_data._siteCode&&utag_data.siteHier&&utag_data.siteHier.length>0?utag_data._siteCode+":"+utag_data.siteHier.join("|"):"",topicPrimaryId:utag_data._topicPrimaryId,authorList:utag_data._authorList,test:i.tracking.data.testName?i.tracking.data.testName+"|"+i.tracking.data.testVersion+"|"+i.tracking.data.testGroup:""},e),r},_getUdoStockData:function(){var t=i.tracking.data;return{siteEdition:t.siteEdition,pageViewGuid:t.pageViewGuid,pageType:t.pageType,siteHier:t.siteHier,siteType:t.siteType,deviceType:t.deviceType,articleId:t.articleId,articleTitle:t.articleTitle,articleType:t.articleType,articlePubDate:t.articlePubDate,articleAuthorId:t.articleAuthorId,articleAuthorName:t.articleAuthorName,topicId:t.topicId,topicName:t.topicName}},_initRequestTracking:function(){if("article"===i.tracking.data.pageType){var t=0,e=this;window.setInterval(function(){try{var i=window.performance.getEntriesByType("resource");for(t=t>=i.length?0:t;t<i.length;){var s=i[t];e._trackServiceRequest(s),t++}}catch(t){a.error("Failed to monitor tracking requests:",t)}},500)}},_initSourcePointTracking:function(){var e=this;if(i.sourcepoint&&i.sourcepoint.data)this._trackSourcePoint();else{var e=this;a.info("SourcePoint data was NOT available on page load"),t("body").on("sp_object_available",function(){e._trackSourcePoint()})}},_trackClickViaUtag:function(e,s,r,o,l){try{if(!0===i.tracking.enabled){l="object"!=typeof l?{}:l;var d={_test:i.tracking.data.testName?i.tracking.data.testName+"|"+i.tracking.data.testVersion+"|"+i.tracking.data.testGroup:"",userState:i.tracking.data.userState,userType:i.tracking.data.userType};if(o="object"!=typeof o?{}:o,o=t.extend({},l,d,o,n.getServiceVars()),t.inArray(e,["om","omnitureMgr","utag"])>=0){a.info(r+" ping: ",o);var u=a.enabled?t.extend({},o):{};if("view"===s?n.trackPageView({path:window.location.pathname,data:o}):n.trackPageEvent({path:window.location.pathname,data:o}),o.dwLinkTag?window.dwTag=o.dwLinkTag:window.dwTag&&(o.dwLinkTag=window.dwTag),window[e][s](o),delete window.dwTag,"object"==typeof window.s&&(window.s.events="",window.s.eVar21="",window.s.eVar37="",window.s.eVar38=""),a.enabled){for(var h in u)o[h]!==u[h]&&a.warn("Tealium overrode our data: "+h+' was changed from "'+u[h]+'" to "'+o[h]+'"');var c={};for(var h in o)void 0===u[h]&&(c[h]=o[h]);0!==c.length&&a.log("Tealium added the following data to the tracking call: ",c)}}else a.error("Invalid tracking object",e)}else a.info(r+" aborted; tracking is not enabled!")}catch(t){a.error(r+" failed:",t)}},trackComment:function(e,s,n){var a={link_text:e,_clickAction:n||e,socialService:"cnet",brand:i.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:s.sharebarSection};this._trackClickViaUtag("utag","link",e,s,t.extend({},this._getUdoStockData(),a))},trackCustomEvent:function(t,e,i){var s={link_text:t,_clickAction:i||"trackClick"};this._trackClickViaUtag("utag","link",t,e,s)},trackExternalLink:function(t){this._trackClickViaUtag("om","trackClick","trackExternalLink",t)},trackForum:function(t,e){this._trackClickViaUtag("om","trackForum",t,e)},trackLead:function(t){var e=jQuery.extend({},i.tracking.data,{_merchantId:t.merid,_leadType:t.ltype,_destCat:t.destcat,leadCpc:t.leadcpc,productName:t.productTitle,_videoAction:"",videoSegments:"",_leadProdPrice:t.productPrice,videoTime:0,_clickAction:"leadClick",link_text:"clickLead"},t);this._trackClickViaUtag("utag","link","trackLeadClick",t,e)},trackPageLoad:function(e){this._trackClickViaUtag("utag","view","Track view",e,i.tracking.data),t(window).trigger("dynamicloadcomplete"),n.trackChartbeatPageView()},trackPodcast:function(t){this._trackClickViaUtag("om","trackPodcast","trackPodcast",t)},_trackServiceRequest:function(e){for(var s in this.monitoredServices){var n=this.monitoredServices[s];n.fireCount<n.maxFireCount&&-1!==e.name.indexOf(n.requestPrefix)&&(a.info("Tracking the request: "+n.timerName,e.fetchStart),this.trackCustomEvent(n.timerName,t.extend({},i.tracking.data)),n.fireCount++)}},_trackSlaRequest:function(e){if(o.timeThreshold<=e.duration&&o.requestThreshold>o.requestCount){var s=document.createElement("a");if(s.href=e.name,"".endsWith&&!s.host.endsWith(".cnet.com")&&!s.pathname.endsWith(".mp4")){o.requestCount++;var n=Math.round(e.duration/1e3);a.info("slow request ("+n+" seconds)",e.name),this.trackCustomEvent("trackSlaEnforcement",t.extend({serviceWorkerDomain:s.host,serviceWorkerRequestTime:n,serviceWorkerConnection:window.navigator.connection?window.navigator.connection.effectiveType:"unsupported"},i.tracking.data))}}},trackSocial:function(t){var e={brand:i.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:t.sharebarSection};this._trackClickViaUtag("om","trackSocialClick","trackSocialClick",t,e)},_trackSourcePoint:function(){if(i.sourcepoint.beaconFired=!0,i.sourcepoint.data&&i.sourcepoint.data.info&&i.sourcepoint.data.info.prtn_uuid){var e=n.getSourcePointData(i.sourcepoint.data.info.prtn_uuid);a.info("SourcePoint data now available",e),this.trackCustomEvent("trackSourcePointResult",t.extend({},i.tracking.data,e))}},trackSuggestedSearch:function(t){this._trackClickViaUtag("om","trackSuggestedSearchClick","trackSuggestedSearchClick",t)},trackVideo:function(t,e,s){var n=t.charAt(0).toUpperCase()+t.slice(1),a=0===e?"Start":100===e?"Complete":e+"Percent",r="pause"===t?"videoTime":"video"+n+a,o=i.tracking.data,l={_videoAction:r,link_text:r,siteHier:o.siteHier,siteSection:o.siteSection,siteEdition:o.siteEdition,brand:o.brand,siteType:o.siteType,deviceType:o.deviceType,pageType:o.pageType,pageNum:null!=o.pageNum?o.pageNum:1,topicId:o.topicId,pageViewGuid:o.pageViewGuid,articleAuthorId:o.articleAuthorId,articleAuthorName:o.articleAuthorName,articleId:o.articleId,articleTitle:o.articleTitle,articleType:o.articleType,productId:o.productId,productName:o.productName};this._trackClickViaUtag("utag","link",r,s,l)}};return l._initSourcePointTracking(),l._initRequestTracking(),l}),define("translations/form-validate",["managers/edition"],function(t){var e={en:{required:{field:"This field is required",radio:"One of these fields is required"},availableEmail:"This e-mail address is already in use. Please choose another.",availableUsername:"That username is already taken. Try another.",validPassword:"Your password needs at least 6 characters, and 3 of these 4: special characters, numbers, or upper or lowercase letters.",minlength:"This field must be at least {minlength} characters",maxlength:"This field must be no more than {maxlength} characters",email:"That’s not a valid email address. Try another.",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Please use only alphanumeric characters, underscores "_", and dashes "-"',usernameCharacterLength:"Your username must be between 3 and 25 characters.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"Oops! Something went wrong, try again.","invalid.loginpassword":"Oops! That’s not the password for this account, try again.","locked.account":"Too many attempts. Wait 5 minutes and try again, or reset your password.","invalid.email":"That’s not a valid email address. Try another.","inuse.userName":"That username is already taken. Try another.","required.email":"We're sorry that you do not wish to create a CNET account."},es:{required:{field:"Campo requerido",radio:"One of these fields is required"},availableEmail:"Este email esta en uso.  Elige otro.",availableUsername:"Ese nombre de usuario ya existe. Inténtalo de nuevo.",validPassword:"Tu contraseña debe incluir al menos seis caracteres sin espacios y contar con un número, un símbolo especial y una mayúscula.",minlength:"Este campo debe tener al menos {minlength} caracteres",maxlength:"This field must be no more than {maxlength} characters",email:"Tu cuenta de e-mail no es válida, inténtalo de nuevo.",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Por favor, usa solamente caracteres alfanuméricos, guiones bajos "_", y guiones "-"',usernameCharacterLength:"Tu nombre de usuario debe contener entre 3 y 23 letras.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"¡Lo sentimos! Algo no está funcionando, inténtalo más tarde.","invalid.loginpassword":"¡Lo sentimos! Esa no es la contraseña correcta. Inténtalo de nuevo.","locked.account":"Ingresaste una contraseña equivocada demasiadas veces. Espera 5 minutos para intentarlo de nuevo o restablece tu contraseña.","invalid.email":"Tu cuenta de e-mail no es válida, inténtalo de nuevo.","inuse.userName":"Ese nombre de usuario ya existe. Inténtalo de nuevo.","required.email":"Sentimos mucho que no quieras crear una cuenta con CNET en este momento. ¡Gracias por visitarnos!"}};return t.getTranslation(e)}),define("utils/urs-helper",["jquery","version!fly/managers/debug","managers/page-vars","optional!urs"],function(t,e,i){e=e.init("ursHelper");var s={16:257,103:259,222:263,225:265,242:266,256:268,295:298,358:359,363:361,364:362,368:365,369:366,370:367,372:371,403:401,404:402,9:269,36:270,74:278,305:304,27:280,374:373,376:375,202:394,393:394,395:396,397:398};return{getSocialAppId:function(t){return s[t]},getUrs:function(t,e){var s={};return"object"==typeof window.URS&&"function"==typeof URS.getInstance&&"function"==typeof URS.newInstance&&((s=URS.getInstance(t,"v2.2"))||(s=URS.newInstance({appId:t,clientToken:"12d6d06e118e4a90",environment:i.environment.indexOf("prod")>-1?URS.ursEnvironments.LIVE:URS.ursEnvironments.QA,version:"v2.2"}),e&&e(s))),s}}}),define("fly/utils/string-vars-1.0",["jquery"],function(t){return{compile:function(e,i,s){var n=this;return"string"!=typeof e?"":(s=t.makeArray(s),e=e.replace(/\{([^}]+)\}/g,function(e){var a=s,r="";return e=e.replace(/\|[^\}|]+/g,function(t){return a.push(t.substr(1)),""}),r=i[e.replace(/[{}]+/g,"")]||"",t.each(a,function(t,e){r=n.modify(e,r)}),r}))},modify:function(t,e){switch(t){case"lower":e=e.toLowerCase();break;case"upper":e=e.toUpperCase();break;case"urlencode":e=encodeURIComponent(e)}return e}}}),define("fly/components/form-validate-1.0",["jquery","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/managers/debug","version!fly/components/base"],function(t,e,i,s){var n=t.support.touch?"vclick":"click",a=s.init("formValidate");t.widget("fly.formValidate",t.fly.base,{options:{inlineErrorTemplate:'<label for="{id}" class="validate-{type}">{message}</label>',globalErrorTemplate:'<div class="alert alert-{type}">{message}</div>',classFieldStatus:"validate-{type}",animation:"slide",fieldSelector:'[data-item="field"]',ignoreHidden:!0,ignoreSelector:null,validateOnChange:!0,scrollToErrors:!1,attributes:["required","maxlength","minlength"],rules:{},success:function(t,e){e.$form.submit()},failure:function(t,e){},placeError:function(t,e){e.is(":checkbox, :radio")&&e.parent("label").length?t.insertAfter(e.parent("label")):t.insertAfter(e)}},rules:{required:{message:function(t){return t.is(":radio")?"One of these fields is required":"This field is required"},test:function(t){var e,i;return t.is(":radio")?(e=t.closest("form").find(':radio[name="'+t.attr("name")+'"]'),e.is(":checked")):!!(i=t.is(":checkbox")?t.is(":checked"):t.val())}},mailcheck:{type:"warning",message:null,test:function(t,e){var i=this,s=t.closest("form");return require(["fly/libs/mailcheck-1.1"],function(){t.mailcheck({suggested:function(a,r){i.message='Did you mean <a class="mailcheck" data-_insert="mailcheck">'+r.domain+"</a>?",s.on(n+".mailcheck",'[data-_insert="mailcheck"]',function(){t.val(r.full).trigger("change")}),e.reject("mailcheck")},empty:function(t){s.off(".mailcheck"),e.resolve()}})}),e.promise()}},availableEmail:{remote:!0,message:"Email is already in use"},availableUsername:{remote:!0,message:"User Name is already in use"},minlength:{message:function(t){return"This field must be at least "+t.attr("minlength")+" characters"},test:function(t){return t.val().length>=t.attr("minlength")}},maxlength:{message:function(t){return"This field must be no more than "+t.attr("maxlength")+" characters"},test:function(t){return t.val().length<=t.attr("maxlength")}},email:{message:"Please enter a valid email",test:function(t){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4}$/i.test(t.val())}},noUrl:{message:"A url is not allowed in this field",test:function(t){return!/http:\/\//i.test(t.val())}},noSpecialCharacters:{message:"The special characters @, &, and % are not allowed in this field",test:function(t){return/^[^@&%]+$/i.test(t.val())}},equalTo:{message:"Fields do not match",test:function(e){var i=t('input[name="'+e.data("validate-equal-to")+'"]');return i.length&&e.val()===i.val()}}},wasSubmitted:!1,isWorking:!1,isFormValid:!1,_create:function(){var t=this.options,e,i={};this._setup(),this.$form=this.$element,this.$form.attr("novalidate","novalidate"),this.globalErrors=[],this.ignoreSelector=":submit, :reset, :image, [disabled]",t.ignoreHidden&&(this.ignoreSelector+=", :hidden"),t.ignoreSelector&&(this.ignoreSelector+=", "+t.ignoreSelector),this.addRules(t.rules),this._on(this.$form,{submit:"_handleSubmit"}),t.validateOnChange&&(i["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",i["keyup :input:not("+this.ignoreSelector+", [readonly])"]="_handleChange",i["change :input:not("+this.ignoreSelector+")"]="_handleChange",this._on(this.$form,i))},_handleSubmit:function(t){this._off(this.$form,"focusout"),this.wasSubmitted=!0,this.isFormValid||(t.preventDefault(),t.stopImmediatePropagation(),this.validate())},_handleFocusOut:function(e){t(e.target).attr("data-_enabled","true"),this._handleChange(e)},_handleChange:function(e){var i=t(e.target);this.isFormValid=!1,(this.wasSubmitted||i.data("_enabled"))&&(i.data("_passed",!1),this.testField(i))},getRule:function(t){return void 0!==this.rules[t]&&this.rules[t]},getRulesToValidate:function(e){var i=this,s=e.data("validate")||[],n=t.isArray(s)?s:s.split(" ");return t.each(this.options.attributes,function(t,i){e.attr(i)&&n.unshift(i)}),t.grep(n,function(t,e){return i.getRule(t)})},addRules:function(e){t.isPlainObject(e)&&t.extend(this.rules,e)},removeRule:function(t){!1!==this.getRule(t)&&delete this.rules[t]},setFieldDelegate:function(t){var e=null;return t.is(":radio")&&(e=this.$form.find(':radio[name="'+t.attr("name")+'"]').first()),t.data("_field_delegate",e),t},testField:function(e){var i=this,s=[],n,r=e.data()||{},o=r.error||{},l=t.Deferred();return r._passed?(l.resolve(),l.promise()):(this.setFieldDelegate(e),r.remoteRequest&&r.remoteRequest.abort(),n=this.getRulesToValidate(e),a.log("test field: ",e," w/ rules:",n),t.each(n,function(n,r){var l=i.getRule(r),d=!0,u=!!l.remote,h=null,c;if(u&&(h=l.remoteUrl||e.data("remoteUrl"),i.removeError(e)),c=function(){var s=t.Deferred(),n=null;return n=u?i.requestRemote(h,e,r,s):l.test(e,s),!1===n?(d=!1,s.reject(r)):!0===n&&s.resolve(r),s.promise()},c=c(),s.push(c),t.when(c).fail(function(){a.log("rule failed: ",r,e)}).then(function(){o.name===r&&i.removeError(e),a.log("rule passed: ",r,e)}),!d)return!1}),t.when.apply(null,s).fail(function(t){var s=i.getRule(t),n=s.type?s.type:"error",r=e.data(),o=r.error||{};r.remoteTimeout&&clearTimeout(r.remoteTimeout),r.remoteRequest&&r.remoteRequest.abort(),o.message!=i.getMessage(t,e)&&(i.removeError(e),i.addInlineError(e,t)),"error"!==n?(l.resolve(),a.log("field passed: ",e," type: ",n)):(l.reject(),a.log("field failed: ",e))}).then(function(){e.data("_passed",!0),i.removeError(e),l.resolve(),a.log("field passed: ",e)}),l.promise())},requestRemote:function(e,i,s,n){var a={},r=null,o=null,l=i.data()||{};l.remoteTimeout&&(clearTimeout(l.remoteTimeout),l.remoteQueue.resolve(s)),a[i.attr("name")]=i.val(),o=setTimeout(function(){r=t.ajax({type:"POST",dataType:"json",url:e,data:a,timeout:5e3,success:function(e){switch(e){case!0:n.resolve(s);break;case!1:n.reject(s);break;default:t.isPlainObject(e)&&e.status?"success"===e.status?n.resolve(s):n.reject(s):n.resolve(s)}},complete:function(){i.data("remoteRequest",null)},error:function(t,e){n.resolve(s),i.data("_passed",!1)}}),i.data({remoteRequest:r,remoteQueue:null,remoteTimeout:null})},300),i.data({remoteQueue:n,remoteTimeout:o})},validate:function(){var e=this.options,i=this,s=[];this.isWorking||!1!==this._trigger("validate")&&(this.isWorking=!0,this.removeGlobalErrors(),this.$form.find(":input").not(this.ignoreSelector).each(function(){var e=t(this);s.push(i.testField(e))}),t.when.apply(null,s).fail(function(){a.log("validate failed"),i._trigger("failure",null,{$form:i.$form}),e.scrollToErrors&&i.scrollToErrors()}).then(function(){a.log("validate success"),i.isFormValid=!0,i._trigger("success",null,{$form:i.$form}),i.isFormValid=!1}).always(function(){i._trigger("validated"),i.isWorking=!1}))},scrollToErrors:function(){var e=this.options,i=this.$form.find("[data-validate-error]").first(),s=i.closest(e.fieldSelector),n=(s.length?s:i).offset().top;!1!==this._trigger("scroll",null,{offset:n})&&(n-=this.$window.height()/6,t("html, body").animate({scrollTop:n},"fast"))},removeError:function(e){e=e.data("_field_delegate")||e;var i=this,s=this.options,n=e.data("error");n&&("slide"===s.animation?n.$error.slideUp("fast",function(){t(this).remove(),i._completeRemoveError(n,e)}):(e.remove(),this._completeRemoveError(n,e)),e.removeClass(n.fieldClass).removeData("error"))},getMessage:function(e,i){var s=this.getRule(e),n=i.data("validate-message-"+e)||i.data("validate-message-"+e.toLowerCase());return n||!1===n||(n=t.isFunction(s.message)?s.message(i):s.message),n},addInlineError:function(e,s){e=e.data("_field_delegate")||e;var n=this,a=this.options,r=e.data("error")||{},o,l,d,u,h={name:s,position:"inline"};"error"!==r.type&&(d=this.getMessage(s,e),o=this.getRule(s),l=o.type||"error",u=i.compile(a.inlineErrorTemplate,{type:l,id:e.attr("id"),message:d}),t.extend(h,{type:l,message:d,$error:t(u).attr("data-validate-error",!0),fieldClass:i.compile(this.options.classFieldStatus,{type:l})}),e.addClass(h.fieldClass).data("error",h),!1!==d&&("slide"===a.animation?(h.$error=t("<div />").wrapInner(h.$error),h.$error.hide(),a.placeError.call(this,h.$error,e),h.$error.slideDown("fast",function(){n._completeAddError(h,e)})):(a.placeError.call(this,h.$error,e),this._completeAddError(h,e))))},addGlobalError:function(e,s){s=s||"error";var n=this,a=this.options,r,o={position:"global",type:s,message:e};r=i.compile(a.globalErrorTemplate,{type:s,message:e}),t.extend(o,{$error:t(r).attr("data-validate-error",!0)}),"slide"===a.animation?(o.$error=t("<div />").wrapInner(o.$error),o.$error.hide().prependTo(this.$form).slideDown("fast",function(){n._completeAddError(o)})):(this.$form.prepend(o.$error),this._completeAddError(o)),this.globalErrors.push(o)},removeGlobalErrors:function(){var e=this;t.each(this.globalErrors,function(t,i){i.$error.remove(),e._completeRemoveError(i)})},removeInlineErrors:function(){var e=this;this.$form.find("[data-validate-error]").each(function(){var i=t(this),s=i.data();s.error&&e.removeError(i),s.remoteRequest&&s.remoteRequest.abort()})},_completeAddError:function(e,i){this._trigger("errorAdded",null,t.extend(e,{$field:i})),this.$document.trigger("displayChange",{type:"errorAdded"})},_completeRemoveError:function(e,i){this._trigger("errorRemoved",null,t.extend(e,{$field:i})),this.$document.trigger("displayChange",{type:"errorRemoved"})},_disable:function(){this.removeGlobalErrors(),this.removeInlineErrors()},_destroy:function(){this._disable()}})}),define("components/form-validate",["jquery","version!fly/managers/debug","translations/form-validate","version!fly/utils/string-vars","version!fly/components/form-validate"],function(t,e,i,s){e.init("formValidate"),t.widget("cnet.formValidate",t.fly.formValidate,{options:{validateOnBlur:!1},rules:{required:{message:function(t){return t.is(":radio")?i.required.radio:i.required.field}},mailcheck:{message:null},availableEmail:{message:i.availableEmail},availableUsername:{message:i.availableUsername},validPassword:{message:i.validPassword,test:function(t){var e=t.val(),i=0;return/[0-9]+/.test(e)&&i++,/[a-z]+/.test(e)&&i++,/[A-Z]+/.test(e)&&i++,/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,\/\{\}\|":<>\?~_]+/.test(e)&&i++,i>=3&&e.length>=6&&-1==e.indexOf(" ")}},minlength:{message:function(t){return s.compile(i.minlength,{minlength:t.attr("minlength")})}},maxlength:{message:function(t){return s.compile(i.maxlength,{maxlength:t.attr("maxlength")})}},email:{message:i.email,test:function(t){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}$/i.test(t.val())}},noUrl:{message:i.noUrl},noSpecialCharacters:{message:i.noSpecialCharacters},equalTo:{message:i.equalTo},usernameSpecialCharacters:{message:i.usernameSpecialCharacters,test:function(t){return/^[a-z0-9\-_]*$/i.test(t.val())}},usernameCharacterLength:{message:i.usernameCharacterLength,test:function(t){var e=t.val().length;return e>=3&&e<=25}},atLeastOneAlphanumeric:{message:i.atLeastOneAlphanumeric,test:function(t){return/.*[a-z0-9]+.*/i.test(t.val())}}},_create:function(){var t=this.options,e={};this._super(),t.validateOnBlur&&(e["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",e["blur :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleChange",this._on(this.$form,e))},getMessage:function(t,e){return this._super(t,e)||i[t||"generic"]||i.generic},addInlineError:function(e,i){e=e.data("_field_delegate")||e;var n=this,a=this.options,r=e.data("error")||{},o,l,d,u,h={name:i,position:"inline"};"error"!==r.type&&(d=this.getMessage(i,e),o=this.getRule(i),l=o.type||"error",u=s.compile(a.inlineErrorTemplate,{type:l,id:e.attr("id"),message:d}),t.extend(h,{type:l,message:d,$error:t(u).attr("data-validate-error",!0),fieldClass:s.compile(this.options.classFieldStatus,{type:l})}),e.addClass(h.fieldClass).data("error",h),e.attr("aria-invalid","true"),!1!==d&&("slide"===a.animation?(h.$error=t("<div />").wrapInner(h.$error),a.placeError.call(this,h.$error,e),this._completeAddError(h,e)):(a.placeError.call(this,h.$error,e),this._completeAddError(h,e))))},removeError:function(t){t=t.data("_field_delegate")||t;var e=this,i=this.options,s=t.data("error");s&&("slide"===i.animation?s.$error.remove():(t.remove(),this._completeRemoveError(s,t)),t.removeClass(s.fieldClass).removeData("error"),t.attr("aria-invalid","false"),this._completeRemoveError(s,t))}})}),define("translations/loading",["managers/edition"],function(t){var e={en:{loading:"Loading",end:"The End",error:"Error Encountered"},es:{loading:"Cargando",end:"Fin",error:"Error Encontrado"}};return t.getTranslation(e)}),define("fly/components/loading-1.0",["jquery","version!fly/utils/string-vars","version!fly/components/base"],function(t,e){t.widget("fly.loading",t.fly.base,{options:{disabled:!1,delay:100,timeout:25e3,initState:"",template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loading",end:"load-end",error:"load-error"},text:{idle:"",loading:"Loading",end:"The End",error:"Error Encountered :("}},_create:function(){this._setup(),this._state=null,this._timeoutId=null},_init:function(){var t=this.options;!t.disabled&&t.initState&&(this._setContent(t.initState),this._state=t.initState)},_setContent:function(i,s){var n=this.options,a;if("remove"===i)return void this.$element.empty();a=e.compile(n.template,t.extend({state:i,baseClass:n.classes.base,stateClass:n.classes[i],text:n.text[i]},s)),this.$element.html(a)},add:function(){var e=this.options;!1!==this._trigger("add")&&(this.update("loading"),"number"==typeof e.timeout&&e.timeout>0&&(this._timeoutId=setTimeout(t.proxy(this.remove,this),e.timeout)),this._trigger("added"))},remove:function(){!1!==this._trigger("remove")&&(this.update("remove"),this._trigger("removed"))},update:function(t,e){var i=this.options,s={state:t};!1!==this._trigger("update",null,s)&&(this._state=t,i.disabled||(clearTimeout(this._timeoutId),this._setContent(t,e),this._trigger("updated",null,s)))},isLoading:function(){return"loading"===this._state},getState:function(){return this._state},_setOption:function(t,e){var i=this.options;"data"===t?this.$element.data("data",e):"disabled"===t&&(!0===e?this.$element.empty():this._setContent(i.initState)),this._super(t,e)},_destroy:function(){this.$element.remove()}})}),define("components/loading",["jquery","version!fly/managers/debug","translations/loading","version!fly/components/loading"],function(t,e,i){e=e.init("loading"),t.widget("cnet.loading",t.fly.loading,{options:{template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loadingCircle",end:"load-end",error:"load-error"},text:i},add:function(){this._super(),this.$element.parent().addClass("loadingArea")},remove:function(){this._super(),this.$element.parent().removeClass("loadingArea")}})}),define("components/authentication",["jquery","version!fly/managers/debug","version!fly/managers/components","utils/cookie","managers/edition","managers/page-vars","managers/tealium","translations/form-validate","utils/urs-helper","version!fly/utils/url-helper","version!fly/components/base","components/form-validate","components/loading"],function(t,e,i,s,n,a,r,o,l,d){e=e.init("authentication"),t.widget("cnet.authentication",t.fly.base,{options:{classSelected:"selected",classShow:"show",classActive:"active",classFade:"fade"},appId:376,entryPoints:{375:"brand_nav",270:"comments",280:"forums",265:"polls",263:"my_list",367:"brand_nav",359:"my_list",394:"brand_nav",398:"comments",376:"brand_nav",36:"comments",27:"forums",225:"polls",222:"my_list",361:"sweepstakes",370:"brand_nav",358:"my_list",368:"sweepstakes",393:"brand_nav",397:"comments",386:"sweepstakes"},$form:null,$modal:null,loading:!1,nextAction:null,refresh:!1,socialRegistration:!1,step:"start",regService:"",steps:["facebookRegister","forgot","interests","login","loginOrRegister","register","start","username"],userData:null,_baseTrackingData:{_pageTitle:a.tracking.data._pageTitle,siteSection:a.tracking.data.siteSection,pageType:a.tracking.data.pageType,siteEdition:a.tracking.data.siteEdition,siteType:a.tracking.data.siteType,siteHier:a.tracking.data.siteHier,brand:a.tracking.data.brand,_pageChannelType:a.tracking.data._pageChannelType,audienceManagerBlob:a.tracking.data.guid,pageViewGuid:a.guid},_create:function(){this._setup(),this._setupPageEvents(),this._loadUserData(),this._checkForOpenLoginOnLoad()},_close:function(){this.$modal.removeClass(this.options.classShow),t("body").removeClass("noScroll")},_completeLogin:function(){var e=this,i=a.tracking.data;this.getUserData(function(t){"function"==typeof e.nextAction&&(e.refresh=e.nextAction(t),e.nextAction=null),!0===e.refresh&&window.location.reload()}),r.trackCustomEvent("trackLogin",t.extend(!0,{},this._baseTrackingData,{userId:i.userId,userState:"authenticated",userType:"registered",regService:e.regService,regDriver:e.entryPoints[e.appId]}),"login")},_displayError:function(t){var e=this.$form.find('[data-global-errors*="'+t+'"]'),i=this.$form.data("formValidate");0===e.length?i.addGlobalError(o[t||"generic"]||o.generic,"error"):i.addInlineError(e,t)},getUserData:function(t){this.userData?t(null,this.userData):this.$element.one("userdataloaded",t)},hasAccess:function(e){var i=this;e=t.extend(!0,{nextAction:null,requireUsername:!1},e),e.appId&&(i.appId=e.appId),this.getUserData(function(t,s){s.isLoggedIn?e.requireUsername&&!s.userName?(i.nextAction=e.nextAction,i._show("username")):"function"==typeof e.nextAction&&e.nextAction(s):(i.nextAction=e.nextAction,i._show("start"),i._trackCustomEvent("tap","start_authentication"))})},_loadUserData:function(){var e=this;this.userData=null,s.read("purs_1")?t.ajax({dataType:"json",url:a.user.urls.userData}).done(function(i){e.userData=t.extend(!0,i.user,{isLoggedIn:i.isLoggedIn}),window._cbq.push(["_acct","lgdin"]),e._updateDisplay(),e.$element.trigger("userdataloaded",[e.userData])}):(this.userData={isLoggedIn:!1},window._cbq.push(["_acct","anon"]))},logout:function(){var e=this,i=a.tracking.data;t.ajax({dataType:"json",url:t('[data-user-action="logout"]').attr("href")}).done(function(i){e.userData={isLoggedIn:!1},r.trackCustomEvent("trackLogout",t.extend(!0,{},e._baseTrackingData,{userId:"",userState:"not authenticated",userType:"anon",regService:e.regService,regDriver:e.entryPoints[e.appId]}),"logout"),window._cbq.push(["_acct","anon"]),e._updateDisplay(),e.$element.trigger("userhasloggedout")})},_setStep:function(e){var i=this;if(this.$modal){var s=this.$modal.find("._"+this.step+" input[type=email]").val();this.$modal.find("._"+e+" input[type=email]").val(s)}this.step=e,this.$modal&&(this.$modal.removeClass(this.steps.join(" ")).addClass(this.step).addClass(this.options.classShow),this.$modal.find("._"+this.step).addClass(this.options.classActive),this.$modal.find("input:not([type=hidden])").attr("disabled","disabled"),this.$modal.find("._"+this.step+" input").removeAttr("disabled"),this.$modal.find("[data-app-ids]").each(function(e,s){var n=t(s);n.data("appIds").indexOf(i.appId)<0&&n.attr("disabled","disabled")}),this.$modal.find('[data-focus="'+this.step+'"]').trigger("focus"),t("body").addClass("noScroll"))},_fadeOutStep:function(){var e=this;e.$modal.find(".fade").removeClass(this.options.classFade);var i=e.$modal.find(".active");i&&(t(i).removeClass(e.options.classActive),t(i).addClass(e.options.classFade))},_setupModalEvents:function(){var i=this;this.$modal&&(this.$modal.find('[data-action="close"]').on("click",function(t){i._close()}),this.$modal.find('[data-action="urs"]').on("tap",function(t){i.regService="urs",i._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="facebook"]').on("tap",function(t){l.getUrs(l.getSocialAppId(i.appId),i._setupSocialEvents.bind(i)).social.authenticate("facebook"),i.regService="facebook",i._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="forgot"]').on("tap",function(e){var s=i.$form.data("formValidate"),n=i.$form.find("#authentication_login_email");s.testField(n)&&t.ajax({
data:{email:n.val(),csrf:i.$form.find("#authentication_csrf").val()},dataType:"json",type:"POST",url:a.user.urls.forgot}).done(function(t){i._show("forgot")})}),this.$modal.find("[data-interest]").on("tap",function(e){var s=t(this),n=s.data("interest");t(this).toggleClass(i.options.classSelected),i._trackCustomEvent("tap","mark_interest|"+n.tracking)}),this.$form.formValidate({validateOnBlur:!0,validateOnChange:!1,success:function(s){s.preventDefault();var o=i.$form.serializeArray(),d={appId:i.appId},u=0===o.length?d:o.reduce(function(t,e){return t[e.name]=e.value,t},d),h=i.$form.find('[data-component="loading"]').data("cnetLoading");switch(i.step){case"start":i._show("loginOrRegister");break;case"facebookRegister":l.getUrs(l.getSocialAppId(i.appId),i._setupSocialEvents.bind(i)).social.authenticate("facebook",!0,{userName:i.$form.find("#authentication_facebook_username").val()});break;case"loginOrRegister":h.add(),t.ajax({data:u,dataType:"json",type:"POST",url:a.user.urls.checkEmail}).done(function(t){if(t.success){var e=t.taken?"signin_started":"registration_started";i._trackCustomEvent("enterData","email|"+e),i._show(t.taken?"login":"register")}else i._displayError(t.error);i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()});break;case"register":h.add(),t.ajax({data:u,dataType:"json",type:"POST",url:a.user.urls.register}).done(function(e){e.success?(i._loadUserData(),n.isEspanol()?(i._close(),i._completeLogin()):i._show("interests"),r.trackCustomEvent("trackRegistration",t.extend(!0,{},i._baseTrackingData,{userid:a.tracking.data.userId,regService:i.regService,regDriver:i.entryPoints[i.appId],userState:"authenticated",userType:"registered"}),"confirmRegistration")):(i._displayError(e.error),"inuse.userName"===e.error?i._trackCustomEvent("enterData","username|taken"):"invalid.email"===e.error&&i._trackCustomEvent("enterData","email|invalid")),i.$modal.find("#authentication_csrf").val(e.csrf),h.remove()});break;case"interests":h.add();var c=i.$form.find("[data-interest]."+i.options.classSelected).get().reduce(function(e,i){var s=t(i).data("interest");return e.interests.push(s.interest),e.newsletters.push(s.newsletter),e},{interests:[],newsletters:[]});i._trackCustomEvent("tap","submit_interest|"+c.interests.length),i.getUserData(function(e,s){t.ajax({data:{interests:c.interests.join(","),newsletters:c.newsletters.join(","),regId:s.registrationId},dataType:"json",type:"POST",url:a.user.urls.interests}).done(function(t){t.success?(i._close(),i._completeLogin()):i._displayError(t.error),i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()})});break;case"login":h.add(),t.ajax({data:u,dataType:"json",type:"POST",url:a.user.urls.login}).done(function(t){t.success?(i._close(),i._loadUserData(),i._completeLogin()):(i._displayError(t.error),"invalid.loginpassword"===t.error&&i._trackCustomEvent("enterData","password|wrong")),i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()});break;case"forgot":i._close();break;case"username":h.add(),t.ajax({data:u,dataType:"json",type:"POST",url:a.user.urls.username}).done(function(t){t.success?(i._close(),i._loadUserData(),i._completeLogin()):(i._displayError(t.error),"inuse.userName"===t.error&&i._trackCustomEvent("enterData","username|taken")),h.remove()});break;default:e.log("Current step not recognized.")}},placeError:function(t,e){e.is(":checkbox, :radio")&&e.parent("label").length?t.insertBefore(e.parent("label")):t.insertBefore(e)},errorAdded:function(t,e){"email"===e.name?i._trackCustomEvent("enterData","email|invalid"):"validPassword"===e.name?i._trackCustomEvent("enterData","password|invalid"):"usernameSpecialCharacters"!==e.name&&"usernameCharacterLength"!==e.name||i._trackCustomEvent("enterData","username|invalid")}}))},_setupPageEvents:function(){var e=this;this.$document.on("tap","[data-authentication]",function(i){var s=t(this).data("authentication");s.appId&&(e.appId=s.appId),"boolean"==typeof s.refresh&&(e.refresh=s.refresh),e.socialRegistration=!1,e._trackCustomEvent("tap","start_authentication"),e.getUserData(function(t,i){i.isLoggedIn&&s.requireUsername&&!i.userName?e._show("username"):e._show("start")})}),"true"==t('[data-user-action="logout"]').attr("data-user-suppress-refresh")&&this.$document.on("tap",'[data-user-action="logout"]',function(t){t.preventDefault(),e.logout()})},_setupSocialEvents:function(e){var i=this;e.common.addEventListener(URS.events.AUTH_COMPLETE,function(e,o){if(o.response.status.errors&&o.response.status.errors.length>0){var l=t.map(o.response.status.errors,function(t,e){return t.applicationCode});l.indexOf("invalid.noLink")>=0?(i.socialRegistration=!0,i._show("facebookRegister"),i._trackCustomEvent("enterData","facebook_credentials|registration_started")):(i._displayError(l[0]),l.indexOf("required.email")>=0&&i.$modal.find("._facebookRegister").addClass("failed"),l.indexOf("inuse.userName")>=0&&i._trackCustomEvent("enterData","username|taken"))}else s.write(i.options.cookieUserRecognized,JSON.stringify({username:o.response.receipt.account.displayName,socialSite:o.response.socialSite}),{expires:365}),t.post("/user/social-login/",{email:o.response.receipt.account.emailAddress},function(e){"success"===e.status&&(i.socialRegistration&&!n.isEspanol()?(r.trackCustomEvent("trackRegistration",t.extend(!0,{},i._baseTrackingData,{userid:a.tracking.data.userId,regService:"facebook",regDriver:i.entryPoints[i.appId],userState:"authenticated",userType:"registered"}),"confirmRegistration"),i._show("interests")):(i._close(),i._completeLogin()),i._loadUserData())},"json")})},_show:function(e){var s=this;if(!this.loading)if(["start","username"].indexOf(e)>=0)this.loading=!0,this.$modal&&this.$modal.remove(),t.ajax({url:a.user.urls.modal}).done(function(n){s.$modal=t(n.html).addClass("appId"+s.appId).appendTo(t("body")),s._setStep(e),s.$form=s.$modal.find("form"),i.process(s.$modal),s._setupModalEvents(),s.loading=!1,t(window).trigger("authenticationLoaded")});else{this.$form.data("formValidate").removeGlobalErrors();var n=this.$modal.find("._"+this.step),r=100*(3*n[0].children.length+5);setTimeout(function(){s._setStep(e)},r),s._fadeOutStep()}},_updateDisplay:function(){var e=this,i=t("body");this.userData.isLoggedIn?(t("[data-user-var]").each(function(){var i=t(this),s=i.data("userVar"),n=i.data("userVarAttr"),r=e.userData[s];"userName"===s?(r||(r=e.userData.displayName),r.length>13&&"mobile"==a.device&&(r=r.substr(0,13)+"...")):"profileLink"===s&&(n="href",r=i.attr("data-template").replace("__username__",e.userData.userName?e.userData.userName.replace(/ /g,"+").toLowerCase():e.userData.registrationId)),r&&(n?i.attr(n,r):"avatar"===s?(i.html('<img src="'+r+'" />'),i.addClass("profilePic")):i.text(r))}),i.addClass("is-logged-in").removeClass("not-logged-in")):(t("[data-user-var]").each(function(){var i=t(this),s=i.data("userVar"),n=i.data("userVarAttr"),a=e.userData[s];"userName"===s?a=" ":"profileLink"===s&&(n="href",a="#"),a&&(n?i.attr(n,a):"avatar"===s?(i.find("img").remove(),i.removeClass("profilePic")):i.text(a))}),i.removeClass("is-logged-in").addClass("not-logged-in"),t("#loginTab").removeClass("selected"),t("#rbHeader").removeClass("menuOpen"))},_checkForOpenLoginOnLoad:function(){"1"==d.getParam("openLogin")&&t("[data-authentication]").first().trigger("tap")},_trackCustomEvent:function(i,s){e.log("Track custom event: "+i);var n=a.tracking.data;r.trackCustomEvent(i,t.extend(!0,{},this._baseTrackingData,{clickGenericText:s,regService:this.regService,regDriver:this.entryPoints[this.appId]}),"trackClick")}})}),define("fly/utils/data-selector-1.0",["jquery"],function(t){t.extend(t.expr[":"],{data:t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}})})}),define("components/tabs-modal",["jquery","managers/tealium","managers/page-vars","version!fly/components/base","version!fly/utils/data-selector"],function(t,e,i){var s="click";t.widget("cnet.tabsModal",t.fly.base,{options:{classOverlay:"loadingArea",classSelected:"selected",classOpen:"modalopen",closeModalSelector:'[data-item="close"]',enableDeselect:!1,enableEsc:!1,idOverlay:"bodyWrapper",notRoadshow:!1,selectorFocus:'[data-item="focus"]',tabSelector:'[data-item="trigger"]',closeOnScroll:!1},$currentTab:null,_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var t=this.options,e={},i=this;this._setup(),e["click "+t.tabSelector]="_handleClick",this._on(this.$element,e),this.$element.on("click",this.options.closeModalSelector,function(){i._hide(i.$currentTab)}),this.options.enableEsc&&this.$element.on("keydown",function(t){27===t.keyCode&&(t.preventDefault(),i._hide(i.$currentTab))})},_handleClick:function(e){var i=this.options,s=t(e.target).closest(i.tabSelector);e.preventDefault(),this.change(s)},_handleScroll:function(){this.$window.off("scroll.tabsModal"),this._hide(this.$currentTab)},_getContent:function(e){var i=e.data()||{},s=i.$content||[],n;return s.length?s:(n=i.target||e.attr("href"),s=t(n),e.data("$content",s),s)},_show:function(i){var s=this.options,n,a=this;if(!1!==this._trigger("show",null,{$tab:i})){this.$currentTab=i,n=this._getContent(i),t("html").addClass("scrollDisabled"),i.addClass(s.classSelected),n.addClass(s.classSelected),this._trigger("shown",null,{$tab:i,$content:n});var r="false"===i.attr("aria-expanded");i.attr("aria-expanded",r),n.attr("aria-hidden",!r),this.showOverlay();var o=t.extend(a._baseTrackingData,{clickGenericText:a.$currentTab.data("clicktracking")+"|open"});e.trackCustomEvent(a.$currentTab.data("eventName"),o,"trackClick"),setTimeout(function(){n.find(a.options.selectorFocus).focus()},300),s.closeOnScroll&&this.$window.on("scroll.tabsModal",this._handleScroll.bind(this))}},_hide:function(i){var s=this.options,n,a=this;if(!1!==this._trigger("hide",null,{$tab:i})){n=this._getContent(i),i.removeClass(s.classSelected),n.removeClass(s.classSelected),t("html").removeClass("scrollDisabled"),this._trigger("hidden",null,{$tab:i,$content:n});var r="false"===i.attr("aria-expanded");if(i.attr("aria-expanded",r),n.attr("aria-hidden",!r),this.hideOverlay(),a.$currentTab){var o=t.extend(a._baseTrackingData,{clickGenericText:a.$currentTab.data("clicktracking")+"|close"});e.trackCustomEvent(a.$currentTab.data("eventName"),o,"trackClick")}this.$currentTab=null}},change:function(t){var e=this.options,i,s;if(i=this.$element.find(e.tabSelector+"."+e.classSelected),s=t.data(),t.hasClass(e.classSelected))return void(e.enableDeselect&&this._hide(i));this._hide(i),this._show(t)},showOverlay:function(){var e=t("<div>",{id:this.options.idOverlay,class:this.options.classOverlay});this.options.notRoadshow?t("#rbHeader").addClass(this.options.classOpen):t(".autoHeader").addClass(this.options.classOpen),t("body").append(e);var i=this;e.on("click",function(){i.change(t(i.options.tabSelector+"."+i.options.classSelected,i.$element))})},hideOverlay:function(){t(".autoHeader").removeClass(this.options.classOpen),t("#rbHeader").removeClass(this.options.classOpen),t("#"+this.options.idOverlay).remove()}})}),define("components/site-header",["jquery","version!fly/managers/debug","version!fly/components/base"],function(t,e){e=e.init("siteHeader"),t.widget("cnet.siteHeader",t.fly.base,{options:{},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var e=this,i=t("#searchMenu");i.click(function(){i.find("input").focus()});var s=this.$element.find(".menu");s.on("focusout",function(i){t.contains(i.currentTarget,i.relatedTarget)||(s.not(t(i.currentTarget)).removeClass("hover"),e.$element.removeClass("passthru intentionalHover"))}),s.on("keydown",function(i){switch(i.which){case 38:i.preventDefault(),s.removeClass("hover"),e.$element.removeClass("passthru intentionalHover");break;case 32:case 40:i.preventDefault(),"searchMenu"===i.currentTarget.id?t(i.currentTarget).trigger("click"):(s.removeClass("hover"),e.$element.addClass("passthru intentionalHover"),t(this).addClass("hover"))}})}})}),define("components/auto-suggest",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(t,e,i,s){e=e.init("autoSuggest"),t.widget("cnet.autoSuggest",t.fly.base,{options:{limit:null,classMenuShow:"active",classOpen:"open",classReady:"ready",classSelected:"selected",selectorMenu:".menuWrapper",selectorSuggestions:"li:not(.hed)",url:"/autosuggest/xhr/",showLimit:10,clickable:!1},suggestXhr:null,$searchBox:null,$submitButton:null,_didTrackEnterSubmit:!1,_baseTrackingData:{_pageTitle:s.tracking.data._pageTitle,siteSection:s.tracking.data.siteSection,pageType:s.tracking.data.pageType,siteEdition:s.tracking.data.siteEdition,siteType:s.tracking.data.siteType,siteHier:s.tracking.data.siteHier,brand:s.tracking.data.brand,_pageChannelType:s.tracking.data._pageChannelType},_create:function(){this._setup(),this.$searchBox=this.$element.find("input"),this.$submitButton=this.$element.find('[type="submit"]'),this.$siteHeader=t("#rbHeader"),this._setupEvents(),this._setupTracking()},_setupEvents:function(){var e=this;this.$element.on("submit",function(i){var s=t(e.options.selectorSuggestions,e.$element).filter("."+e.options.classSelected),n=s.text(),a=s.attr("href");a?(i.preventDefault(),window.location.href=a):n&&e.$searchBox.val(n)}),this.$element.on("mousedown",this.options.selectorSuggestions,function(i){var s=t(this).attr("href");if(s)window.location=s;else{var n=t(e.options.selectorSuggestions,e.$element).filter("."+e.options.classSelected);""!==n.text()&&n.removeClass(e.options.classSelected),e._submitAutoSuggest(i)}}),this.$searchBox.on("focusout",function(i){0==t(i.relatedTarget).closest(".menuWrapper").length&&e._hideAutoSuggest()}),this.$searchBox.on("keyup",function(t){t.which>=37&&t.which<=40||e._doAutoSuggest()}),this.$searchBox.on("keydown",function(t){t.which>=37&&t.which<=40&&e._doArrowKey(t)}),t('[data-component="siteHeader"]').on("siteheadersectionchange",function(){e._updateSmartSearchTracking()}),t("#searchMenu [data-searchoverlay]").on("click",function(){e.$siteHeader.hasClass("showSearch")&&e.$siteHeader.removeClass("showSearch")})},_doAutoSuggest:function(){var i=this,s=i.options;if(i.suggestXhr&&4!=i.suggestXhr.readyState&&0!==i.suggestXhr.readyState&&i.suggestXhr.abort(),""!==i.$searchBox.val()){var n=s.url+"?query="+i.$searchBox.val();s.limit&&(n=n+"&limit="+s.limit),s.showLimit&&(n=n+"&showLimit="+s.showLimit),e.log("AutoSuggestXHR: ",n),this.$submitButton.addClass(this.options.classReady),this.$searchBox.addClass(this.options.classReady),!1===this.options.clickable&&(this.$siteHeader.hasClass("showSearch")||this.$siteHeader.addClass("showSearch")),i.suggestXhr=t.ajax({url:n,dataType:"json",context:document.body}).done(function(e){i.$element.addClass(s.classMenuShow);var n=t(t.parseHTML(t.trim(e.html)));t(s.selectorSuggestions,n).length>0?(0===t(s.selectorMenu,i.$element).length?n.appendTo(i.$element):t(s.selectorMenu,i.$element).replaceWith(n),i._setupAdditionalResults()):(i._hideAutoSuggest(),t(s.selectorMenu,i.$element).html(""))}).fail(function(){i._hideAutoSuggest()})}else i._hideAutoSuggest(),t(s.selectorMenu,i.$element).html(""),this.$siteHeader.hasClass("showSearch")&&this.$siteHeader.removeClass("showSearch"),this.$submitButton.removeClass(this.options.classReady),this.$searchBox.removeClass(this.options.classReady)},_doArrowKey:function(e){var i=t(this.options.selectorSuggestions,this.$element),s=i.filter("."+this.options.classSelected),n=i.index(s);if(38===e.which)s.removeClass(this.options.classSelected),n<=0?i.last().addClass(this.options.classSelected):i.eq(n-1).addClass(this.options.classSelected);else if(40===e.which)s.removeClass(this.options.classSelected),n<0||n===i.length-1?i.first().addClass(this.options.classSelected):i.eq(n+1).addClass(this.options.classSelected);else if(37===e.which||39===e.which){var a=s.closest("[data-additional-results]");a.length>0&&this._toggleAdditionalResults(this.$element.find("[data-additional-results]"),a,39===e.which)}},_hideAutoSuggest:function(){var t=this,e=t.options;t.$element.removeClass(e.classMenuShow)},_updateSmartSearchTracking:function(){var e=t("#searchTab [data-searchtracking]");if(e.length>0){var i=t("#rbHeader > nav[section]").attr("section")?t("#rbHeader > nav[section]").attr("section"):"";e.attr("section",i)}},_submitAutoSuggest:function(e){var s=t(e.target),n=s.text();i.trackSuggestedSearch({searchTerm:n,dwLinkTag:"search|suggestedSearch|"+s.prevAll().length}),this.$searchBox.val(n),this.$element.submit()},_setupAdditionalResults:function(){var e=this,i=this.$element.find("[data-additional-results]");i.each(function(s,n){var a=t(n);a.find('[data-auto-suggest-item="trigger"]').on("click",function(){e._toggleAdditionalResults(i,a)})})},_toggleAdditionalResults:function(e,i,s){var n=this,a=i.find('[data-auto-suggest-item="container"]');a.html()?i.toggleClass(function(t,e,i){return i||a.find("."+n.options.classSelected).removeClass(n.options.classSelected),n.options.classOpen},s):!1!==s&&t.ajax({dataType:"json",type:"GET",url:i.data("additionalResults")}).done(function(t){t.html&&(a.html(t.html),i.addClass(n.options.classOpen))}),e.not(i).removeClass(this.options.classOpen)},_setupTracking:function(){e.log("Setting up Smart Search tracking");var i=this,s=i.$element,n=s.find('input[type="search"]'),a=s.find(".submit"),r=t('[data-target="#search"]');n.on("keydown.smartSearchTracking",function(t){13===t.keyCode&&(i._trackSubmit("enter"),i._didTrackEnterSubmit=!0)}),a.on("click.smartSearchTracking",function(){i._didTrackEnterSubmit||i._trackSubmit("button")}),s.on("click",'[data-smartsearch="seeall"]',function(){i._didTrackEnterSubmit||i._trackSubmit("seeall")}),s.on("click.smartSearchTrackingMakeAndModel",".makesAndModels a",function(e){i._trackMakeModelClick(t(this))}),s.on("click.smartSearchTrackingContent",".results a",function(e){i._trackContentLinkClick(t(this))})},_trackSubmit:function(s){e.log("Track submit with "+s);var n=this.$element.find('input[type="search"]').val();e.log("Typed text: "+n);var a="search|submit|"+s;if(this.$element.find("button[data-smartsearch]").attr("data-smartsearch"))var r=this.$siteHeader.hasClass("fixed")?"popup":"top",a="brand_nav|"+r+"|search|typed|"+s;i.trackCustomEvent("searchSubmit",t.extend(this._baseTrackingData,{_searchTerm:n.toLowerCase(),clickGenericText:a}),"trackClick")},_trackMakeModelClick:function(s){e.log("Track make and model click");var n=s.text(),a=t('.autoHeader input[type="search"]').val(),r=s.attr("data-category"),o=s.parent().index()+1,l="search|suggested"+r+"|"+o,d=t.extend(this._baseTrackingData,{searchTerm:n.toLowerCase(),clickGenericText:l});i.trackCustomEvent("searchResultClick",d,"trackClick")},_trackContentLinkClick:function(s){e.log("Track content link click");var n=t('.autoHeader input[type="search"]').val(),a=s.parent().index()+1,r="search|suggestedContent|"+a;i.trackCustomEvent("searchResultClick",t.extend(this._baseTrackingData,{searchTerm:n,clickGenericText:r}),"trackClick")}})}),define("components/lazyload-component",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(t,e,i){e=e.init("lazyloadComponent"),t.widget("cnet.lazyloadComponent",t.fly.base,{options:{endpoint:"",slug:"",view:"",familyName:"",typeName:"",limit:""},_create:function(){this._setup();var i=this.options.endpoint+"?endpoint=%2Fapi%2Fcomponent%2Fcomponent%2F"+this.options.slug+"&view="+this.options.view+"&familyName="+this.options.familyName+"&typeName="+this.options.typeName;""!==this.options.limit&&(i+="&limit="+this.options.limit),e.log("URL: ",i),t.ajax({url:i,dataType:"json",context:{context:this}}).done(this._onSuccess).fail(this._onError)},_onSuccess:function(e){"use strict";var s=this.context.$element,n=t(t.parseHTML(t.trim(e.component.html)));s.append(n),s.removeClass("hide"),s.addClass("show"),i.process(s)},_onError:function(){"use strict"}})}),function(){"use strict";function t(s){if(!s)throw new Error("No options passed to Waypoint constructor");if(!s.element)throw new Error("No element option passed to Waypoint constructor");if(!s.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+e,this.options=t.Adapter.extend({},t.defaults,s),this.element=this.options.element,this.adapter=new t.Adapter(this.element),this.callback=s.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=t.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=t.Context.findOrCreateByElement(this.options.context),t.offsetAliases[this.options.offset]&&(this.options.offset=t.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),i[this.key]=this,e+=1}var e=0,i={};t.prototype.queueTrigger=function(t){this.group.queueTrigger(this,t)},t.prototype.trigger=function(t){this.enabled&&this.callback&&this.callback.apply(this,t)},t.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete i[this.key]},t.prototype.disable=function(){return this.enabled=!1,this},t.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},t.prototype.next=function(){return this.group.next(this)},t.prototype.previous=function(){return this.group.previous(this)},t.invokeAll=function(t){var e=[];for(var s in i)e.push(i[s]);for(var n=0,a=e.length;n<a;n++)e[n][t]()},t.destroyAll=function(){t.invokeAll("destroy")},t.disableAll=function(){t.invokeAll("disable")},t.enableAll=function(){t.invokeAll("enable")},t.refreshAll=function(){t.Context.refreshAll()},t.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},t.viewportWidth=function(){return document.documentElement.clientWidth},t.adapters=[],t.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},t.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},window.Waypoint=t}(),function(){"use strict";function t(t){window.setTimeout(t,1e3/60)}function e(t){this.element=t,this.Adapter=n.Adapter,this.adapter=new this.Adapter(t),this.key="waypoint-context-"+i,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},t.waypointContextKey=this.key,s[t.waypointContextKey]=this,i+=1,this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}var i=0,s={},n=window.Waypoint,a=window.onload;e.prototype.add=function(t){var e=t.options.horizontal?"horizontal":"vertical";this.waypoints[e][t.key]=t,this.refresh()},e.prototype.checkEmpty=function(){var t=this.Adapter.isEmptyObject(this.waypoints.horizontal),e=this.Adapter.isEmptyObject(this.waypoints.vertical);t&&e&&(this.adapter.off(".waypoints"),delete s[this.key])},e.prototype.createThrottledResizeHandler=function(){function t(){e.handleResize(),e.didResize=!1}var e=this;this.adapter.on("resize.waypoints",function(){e.didResize||(e.didResize=!0,n.requestAnimationFrame(t))})},e.prototype.createThrottledScrollHandler=function(){function t(){e.handleScroll(),e.didScroll=!1}var e=this;this.adapter.on("scroll.waypoints",function(){e.didScroll&&!n.isTouch||(e.didScroll=!0,n.requestAnimationFrame(t))})},e.prototype.handleResize=function(){n.Context.refreshAll()},e.prototype.handleScroll=function(){var t={},e={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var i in e){var s=e[i],n=s.newScroll>s.oldScroll,a=n?s.forward:s.backward;for(var r in this.waypoints[i]){var o=this.waypoints[i][r],l=s.oldScroll<o.triggerPoint,d=s.newScroll>=o.triggerPoint,u=l&&d,h=!l&&!d;(u||h)&&(o.queueTrigger(a),t[o.group.id]=o.group)}}for(var c in t)t[c].flushTriggers();this.oldScroll={x:e.horizontal.newScroll,y:e.vertical.newScroll}},e.prototype.innerHeight=function(){return this.element==this.element.window?n.viewportHeight():this.adapter.innerHeight()},e.prototype.remove=function(t){delete this.waypoints[t.axis][t.key],this.checkEmpty()},e.prototype.innerWidth=function(){return this.element==this.element.window?n.viewportWidth():this.adapter.innerWidth()},e.prototype.destroy=function(){var t=[];for(var e in this.waypoints)for(var i in this.waypoints[e])t.push(this.waypoints[e][i]);for(var s=0,n=t.length;s<n;s++)t[s].destroy()},e.prototype.refresh=function(){var t=this.element==this.element.window,e=this.adapter.offset(),i={},s;this.handleScroll(),s={horizontal:{contextOffset:t?0:e.left,contextScroll:t?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:t?0:e.top,contextScroll:t?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}};for(var n in s){var a=s[n];for(var r in this.waypoints[n]){var o=this.waypoints[n][r],l=o.options.offset,d=o.triggerPoint,u=0,h=null==d,c,p,v,g,f;o.element!==o.element.window&&(u=o.adapter.offset()[a.offsetProp]),"function"==typeof l?l=l.apply(o):"string"==typeof l&&(l=parseFloat(l),o.options.offset.indexOf("%")>-1&&(l=Math.ceil(a.contextDimension*l/100))),c=a.contextScroll-a.contextOffset,o.triggerPoint=u+c-l,p=d<a.oldScroll,v=o.triggerPoint>=a.oldScroll,g=p&&v,f=!p&&!v,!h&&g?(o.queueTrigger(a.backward),i[o.group.id]=o.group):!h&&f?(o.queueTrigger(a.forward),i[o.group.id]=o.group):h&&a.oldScroll>=o.triggerPoint&&(o.queueTrigger(a.forward),i[o.group.id]=o.group)}}for(var m in i)i[m].flushTriggers();return this},e.findOrCreateByElement=function(t){return e.findByElement(t)||new e(t)},e.refreshAll=function(){for(var t in s)s[t].refresh()},e.findByElement=function(t){return s[t.waypointContextKey]},window.onload=function(){a&&a(),e.refreshAll()},n.requestAnimationFrame=function(e){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||t).call(window,e)},n.Context=e}(),function(){"use strict";function t(t,e){return t.triggerPoint-e.triggerPoint}function e(t,e){return e.triggerPoint-t.triggerPoint}function i(t){this.name=t.name,this.axis=t.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),s[this.axis][this.name]=this}var s={vertical:{},horizontal:{}},n=window.Waypoint;i.prototype.add=function(t){this.waypoints.push(t)},i.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},i.prototype.flushTriggers=function(){for(var i in this.triggerQueues){var s=this.triggerQueues[i],n="up"===i||"left"===i;s.sort(n?e:t);for(var a=0,r=s.length;a<r;a+=1){var o=s[a];(o.options.continuous||a===s.length-1)&&o.trigger([i])}}this.clearTriggerQueues()},i.prototype.next=function(e){this.waypoints.sort(t);var i=n.Adapter.inArray(e,this.waypoints);return i===this.waypoints.length-1?null:this.waypoints[i+1]},i.prototype.previous=function(e){this.waypoints.sort(t);var i=n.Adapter.inArray(e,this.waypoints);return i?this.waypoints[i-1]:null},i.prototype.queueTrigger=function(t,e){this.triggerQueues[e].push(t)},i.prototype.remove=function(t){var e=n.Adapter.inArray(t,this.waypoints);e>-1&&this.waypoints.splice(e,1)},i.prototype.first=function(){return this.waypoints[0]},i.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},i.findOrCreate=function(t){return s[t.axis][t.name]||new i(t)},n.Group=i}(),function(){"use strict";function t(t){this.$element=e(t)}var e=window.jQuery,i=window.Waypoint;e.each(["innerHeight","innerWidth","off","offset","on","outerHeight","outerWidth","scrollLeft","scrollTop"],function(e,i){t.prototype[i]=function(){var t=Array.prototype.slice.call(arguments);return this.$element[i].apply(this.$element,t)}}),e.each(["extend","inArray","isEmptyObject"],function(i,s){t[s]=e[s]}),i.adapters.push({name:"jquery",Adapter:t}),i.Adapter=t}(),function(){"use strict";function t(t){return function(){var i=[],s=arguments[0];return t.isFunction(arguments[0])&&(s=t.extend({},arguments[1]),s.handler=arguments[0]),this.each(function(){var n=t.extend({},s,{element:this});"string"==typeof n.context&&(n.context=t(this).closest(n.context)[0]),i.push(new e(n))}),i}}var e=window.Waypoint;window.jQuery&&(window.jQuery.fn.waypoint=t(window.jQuery)),window.Zepto&&(window.Zepto.fn.waypoint=t(window.Zepto))}(),define("libs/waypoints/jquery.waypoints-3.1.1",function(){}),define("fly/libs/jquery.throttle-debounce-1.1",["jquery"],function(t){"$:nomunge";var e;t.throttle=e=function(e,i,s,n){function a(){function t(){o=+new Date,s.apply(l,u)}function a(){r=void 0}var l=this,d=+new Date-o,u=arguments;n&&!r&&t(),r&&clearTimeout(r),void 0===n&&d>e?t():!0!==i&&(r=setTimeout(n?a:t,void 0===n?e-d:e))}var r,o=0;return"boolean"!=typeof i&&(n=s,s=i,i=void 0),t.guid&&(a.guid=s.guid=s.guid||t.guid++),a},t.debounce=function(t,i,s){return void 0===s?e(t,i,!1):e(t,s,!1!==i)}}),define("managers/waypoints",["jquery","version!fly/managers/debug","version!libs/waypoints/jquery.waypoints","version!fly/libs/jquery.throttle-debounce"],function(t,e){e=e.init("waypoints");var i=!1;return{init:function(){i||(i=!0,t(window).on("scroll",t.throttle(500,function(){Waypoint.refreshAll()})))}}}),define("components/taboola",["jquery","version!fly/managers/debug","managers/page-vars","managers/global-functions","managers/tealium","version!fly/utils/url-helper","managers/client-storage","managers/edition","managers/waypoints","version!fly/components/base"],function(t,e,i,s,n,a,r,o,l){e=e.init("taboola"),l.init(),i.services.taboola.enabled&&t.widget("cnet.taboola",t.fly.base,{options:{mode:null,container:null,lazyload:!1,lazyloadOffset:0,placement:null,prependPlacement:!0,targetType:"mix",url:null,pushPlacement:null,assetSelector:"[data-item-id]"},_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},initOptions:null,isLoaded:!1,waypoint:null,_create:function(){var s=this;if(this._super(),this.initOptions={},!this.isLoaded){var n=0<t("[data-component=videoPlayer]").length,o="off"===a.getParam("autoplayEnabled")||"off"===r.read("autoplayEnabled"),l="article"===i.pageType&&"desktop"===i.device;this.options.lazyload?this.waypoint=new Waypoint({element:this.$element,handler:function(t){s._loadTaboola(),this.destroy()},offset:this.options.lazyloadOffset}):l&&n&&!o?i.video&&i.video.performance&&(i.video.performance.adstart||i.video.performance.contentstart)?(e.log("Load Taboola; video content already started"),s._loadTaboola()):t(window).on("cnet_video.adstart cnet_video.contentstart cnet_video.error",function(){s.isLoaded||(e.log("Load Taboola on cnet_video.adstart / cnet_video.contentstart"),s._loadTaboola())}):(e.log("Load Taboola regardless of cnet_video"),this._loadTaboola())}},_loadTaboola:function(){this.isLoaded=!0;var t=this;s.gdprConsentCallback("script_taboola",function(){require([o.isEspanol()?"taboola-es":"taboola"],function(s){if(!0===i.ads.enabled){s=window._taboola||[],e.log("Taboola widget created");var n=t.options;pageType=t._getPageType(),e.log("Taboola Page Type: "+pageType),t.initOptions[pageType]="auto",t.initOptions.visibile=!!n.mode,n.url&&(t.initOptions.url=n.url),n.pushPlacement=n.prependPlacement?i.tracking.data.pageType+" "+i.device+" "+n.placement:n.placement,t._pushTaboola(s)}else e.log("Ads disabled")})})},_getPageType:function(){var t={front_door:"home",article:"article",
video_page:"video",image_gallery:"photo",section_door:"category",image_gallery_list:"category",search:"search",search_null:"search"},e="other";return t[i.pageType]&&(e=t[i.pageType]),e},_pushTaboola:function(t){var e=this.options;e.mode&&t.push({mode:e.mode,container:e.container,placement:e.pushPlacement,target_type:e.targetType}),t.push(this.initOptions),t.push({listenTo:"click",handler:this._clickTracking.bind(this)})},_clickTracking:function(i){var s=this.options,a=this;e.log("Taboola Element Clicked, Tracking Now");var r=i.detail.type;"sponsored"==r?r="paid":"organic"==r&&(r="recirc"),n.trackCustomEvent("TaboolaClick",t.extend({},a._baseTrackingData,{dwLinkTag:this._setupDwTag(this.$element)+"|"+r+"["+(i.detail.slot+1)+"]",contentWidget:a.options.container}))}})}),define("components/mobile-footer-link",["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","version!fly/components/base"],function(t,e,i,s){e=e.init("mobileFooterLink"),t.widget("cnet.mobileFooterLink",t.fly.base,{options:{},_create:function(){this._setup();var t=this;i.read("mobileRedirect")&&(t.$element.append('<li><a class="view">Switch to mobile</a></li>'),this._setEvent())},_setEvent:function(){this.$element.find("a.view").on("click",function(){s.write("fly_device","mobile"),i.erase("mobileRedirect"),window.location.reload(!0)})}})}),define("fly/components/modal-1.0",["jquery","version!fly/components/base"],function(t){var e=t.support.touch?"vclick":"click";t.widget("fly.modal",t.fly.base,{options:{content:null,position:"absolute",classModal:"modal",classBackdrop:"modal-backdrop",classShow:"show",classFixed:"fixed",enableKeyEvents:!0,openOnInit:!1,template:null},$modal:null,$backdrop:null,$body:null,isOpen:!1,eventData:{},_create:function(){var i=this.options,s="fixed"===i.position?" "+i.classFixed:"",n={},a={};this._setup(),this.$modal=this.$element.addClass(i.classModal+s),this.$backdrop=t("<div>").addClass(i.classBackdrop+s),this.$body=t(document.body),this.top=parseInt(this.$modal.css("top"),10),i.content&&this.setContent(i.content),this.eventData={$modal:this.$modal,$backdrop:this.$backdrop},n[e]="_handleClose",a[e+' [data-close="modal"]']="_handleClose",this._on(this.$backdrop,n),this._on(this.$modal,a)},_init:function(){this.options.openOnInit&&this.open()},_handleKeyboard:function(t){27==t.keyCode&&this.close()},_handleClose:function(t){t.preventDefault(),this.close()},open:function(){var t=this.options;this.isOpen||!1!==this._trigger("open",null,this.eventData)&&(this.$backdrop.addClass(t.classShow).appendTo(this.$body),this.$modal.addClass(t.classShow).appendTo(this.$body),this.position(),t.enableKeyEvents&&this._on(this.$document,{keyup:"_handleKeyboard"}),this.isOpen=!0,this._trigger("opened",null,this.eventData))},close:function(){var t=this.options;this.isOpen&&!1!==this._trigger("close",null,this.eventData)&&(this.$backdrop.removeClass(t.classShow),this.$modal.removeClass(t.classShow),this._off(this.$document,"keyup"),this.isOpen=!1,this._trigger("closed",null,this.eventData))},setContent:function(e){var i=this.options,s=this,n=t(e),a;n.hasClass(i.classModal)&&(n.removeClass(i.classModal),a=n.prop("attributes"),t.each(a,function(){"class"===this.name?s.$modal.addClass(this.value):s.$modal.attr(this.name,this.value)}),n=n.children()),this.$modal.empty().append(n),this._trigger("contentSet",null,t.extend({},this.eventData,{$modal:this.$modal,$content:n}))},position:function(){var t=this.options,e=this.$window.height(),i=isNaN(this.top)?(e-this.$modal.outerHeight())/3:this.top;i<20&&(i=20),"absolute"==t.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})},_destroy:function(){this.$backdrop.remove()}}),t(document).on(e+".modal-api.data-api",'[data-open="modal"]',function(e){var i=t(this),s=i.data(),n=s.$modal;e.preventDefault(),n||(n=t(s.target||i.attr("href")),i.data("$modal",n)),n.length&&n.modal().modal("open")})}),define("components/global-modal",["jquery","managers/tealium","managers/page-vars","version!fly/managers/components","version!fly/components/modal"],function(t,e,i,s){t.widget("cnet.globalModal",t.fly.modal,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',container:null,setContentOnInit:!0,trackModal:null},_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var i=this,s=null;this.options.setContentOnInit||(s=this.options.content,this.options.content=null),this._super(),this.options.setContentOnInit||(this.options.content=s,this.$element.on("modalopen",function(){if(!i.options.setContentOnInit&&i.options.content&&(i.setContent(i.options.content),i.options.trackModal)){var s=t.extend({},i._baseTrackingData,{clickGenericText:i.options.trackModal+"|open"});e.trackCustomEvent("modalTracking",s,"trackClick")}})),this.$body=this.options.container?t(this.options.container):this.$body},close:function(){if(this._super(),this.options.trackModal){var i=t.extend({},this._baseTrackingData,{clickGenericText:this.options.trackModal+"|close"});e.trackCustomEvent("modalTracking",i,"trackClick")}},setContent:function(e){var i=this.options,n=this,a;if("string"==typeof e){var r=t(e);this.$modal.html(i.modalTemplate.replace("{{content}}",null!=r.context?r.html():e))}else e.hasClass(i.classModal)&&(e.removeClass(i.classModal),a=e.prop("attributes"),t.each(a,function(){"class"===this.name?n.$modal.addClass(this.value):n.$modal.attr(this.name,this.value)}),e=i.modalTemplate.replace("{{content}}",e.html())),this.$modal.empty().append(e),this._trigger("contentSet",null,t.extend({},this.eventData,{$modal:this.$modal,$content:e}));s.process(this.$element)},position:function(){var e=this.options,i=this.$body.is(t(document.body)),s,n,a,r,o,l;i?(s=this.$window.height(),a=this.$window.scrollTop(),o=this.$document.height(),l=this.$window.width()/2,r=this.$window.scrollLeft()):(s=this.$body.height(),a=this.$body.scrollTop(),o=s,l=this.$body.width()/2,r=this.$body.scrollLeft()),n=isNaN(this.top)?(s-this.$modal.outerHeight())/2:this.top,n<20&&(n=20),"absolute"==e.position&&(n+=a,this.$backdrop.css({height:o})),this.$modal.css({top:n}),this._trigger("positioned",null,{$modal:this.$modal}),this.$element.css("left",l+r-this.$element.outerWidth()/2)}})}),define("fly/components/modal-iframe-1.0",["jquery","version!fly/utils/object-helper","version!fly/utils/url-helper","version!fly/components/modal","version!fly/components/loading"],function(t,e,i){var s=t.support.touch?"vclick":"click";t.widget("fly.modalIframe",t.fly.modal,{options:{url:null,requestData:{},messages:{},loader:{disabled:!1}},messenger:null,_create:function(){this._super(),this._setupLoader()},_setupLoader:function(){var e=this;this.loader=t.fly.loading(t.extend(this.options.loader,{shown:function(){e.$element.addClass(e.loader.options.classes.loading)},hidden:function(){e.$element.removeClass(e.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super())},_getUrl:function(){var e=this.options,i=e.url;return e.requestData&&(i=i+(i.indexOf("?")>0?"&":"?")+t.param(e.requestData)),i},loadContent:function(){var e=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:t.extend({},e.messages,{ready:function(){i._trigger("iframeReady"),i.loader.remove()},closeModal:function(){i.close()},scroll:function(e){var s=i.$element.offset().top+e.offset;s-=i.$window.height()/6,t("html, body").animate({scrollTop:s},"fast")}})})}})}),define("components/modal-iframe",["jquery","version!fly/managers/debug","version!fly/components/modal-iframe","components/loading"],function(t,e){e=e.init("modalIframe"),t.widget("fly.modalIframe",t.fly.modalIframe,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',loader:{classes:{loading:"loadingCircle"}}},$body:null,_create:function(){this._super(),this.$body=t(document.body),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){var e=this;this.loader=t.cnet.loading(t.extend(this.options.loader,{shown:function(){e.$element.addClass(e.loader.options.classes.loading)},hidden:function(){e.$element.removeClass(e.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super(),this.centerHorizontally())},loadContent:function(){var e=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:t.extend({},e.messages,{ready:function(){i._trigger("iframeReady"),i.loader.remove(),setTimeout(i.centerHorizontally.bind(i),250)},closeModal:function(){i.close()}})})},centerHorizontally:function(){this.$element.css("margin-left",-this.$element.width()/2)},position:function(){var t=this.options,e=this.$window.height(),i=isNaN(this.top)?(e-this.$modal.outerHeight())/3:this.top;i<20&&(i=20),"absolute"==t.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})}})}),define("managers/user",["jquery","components/authentication"],function(t){return t.cnet.authentication()}),define("translations/modal-email",["managers/edition"],function(t){var e={en:{confirmation:"Your e-mail was sent successfully!",incorrectCaptcha:"The response you entered was incorrect.  Please try again.",notice:"Keep your friends up to date on your wish list.",messageA:"Click the",messageB:"to share the products you want with your friends.",ok:"OK, Got it"},es:{confirmation:"Tu email fue enviado exitosamente!",incorrectCaptcha:"La Captcha no es correcta. Por favor, inténtalo otra vez.",notice:"Mantén a tus amigos informados sobre tu lista.",messageA:"Haz clic en el",messageB:"para que tus amigos vean los productos que quieres.",ok:"De acuerdo"}};return t.getTranslation(e)}),define("components/modal-email",["jquery","version!fly/managers/debug","version!fly/managers/components","managers/edition","managers/user","translations/modal-email","components/global-modal","components/loading","version!fly/components/form-validate"],function(t,e,i,s,n,a){e=e.init("modalEmail"),t.widget("cnet.modalEmail",t.cnet.globalModal,{options:{emailType:"friend",pageTitle:function(){return document.title},pageUrl:function(){return window.location.href},recipientId:null,recipientName:"",messageThankYou:a.confirmation},emailTypes:{friend:{url:{us:"/email/friend/",uk:"/uk/email/friend/",au:"/au/email/friend/",es:"/es/email/friend/"},requireUsername:!1},friendRoadshow:{url:{us:"/email/friend/roadshow/",uk:"/uk/email/friend/roadshow/",au:"/au/email/friend/roadshow/",es:"/es/email/friend/roadshow/"},requireUsername:!1},member:{url:{us:"/email/member/",uk:"/uk/email/member/",au:"/au/email/member/",es:"/es/email/member/"},requireUsername:!0},editor:{url:{us:"/email/editor/",uk:"/uk/email/editor/",au:"/au/email/editor/",es:"/es/email/editor/"},requireUsername:!1},flag:{url:{us:"/email/flag/",uk:"/uk/email/flag/",au:"/au/email/flag/",es:"/es/email/flag/"},requireUsername:!0},video:{url:{us:"/email/video-feedback/",uk:"/uk/email/video-feedback/",au:"/au/email/video-feedback/",es:"/es/email/video-feedback/"},requireUsername:!1}},errorMessages:{"cnet.notsent":"There was an error attempting to send your e-mail.  Please try again.","cnet.nousername":"You must have a valid username to send an e-mail.","cnet.notloggedin":"You must be logged in to send an e-mail.","cnet_recaptcha.incorrect-captcha-sol":a.incorrectCaptcha,"cnet_recaptcha.missing-input-response":a.incorrectCaptcha},_create:function(){this._super(),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){var e=this;this.loader=t.cnet.loading(),this.loader.$element.addClass("modal-content")},open:function(){var t=this,e=this.emailTypes[this.options.emailType];this.isOpen||(e.requireUsername?(n.hasAccess({requireUsername:!0,nextAction:function(i){t._openEmailType(e)}}),t._super()):(this._openEmailType(e),t._super()))},_openEmailType:function(e){var n=this;this.setContent(""),this.loader.$element.appendTo(this.$element),this.loader.add(),t.ajax({url:e.url[s.getEdition()],data:this.options.recipientId?{regId:this.options.recipientId}:null,dataType:"text"}).done(function(e){n.loader.remove(),n.setContent(e),n.position(),n._setupEvents(),t("[data-email-var]",n.$element).each(function(e,i){var s=t(i),a=s.data("emailVar");"pageTitle"===a?s.text(n.options.pageTitle):"recipientName"===a&&s.text(n.options.recipientName)}),t('input[name="emailFriend[pageTitle]"]',n.$element).val(n.options.pageTitle);var s="string"==typeof n.options.pageUrl?n.options.pageUrl:n.options.pageUrl();t('input[name="emailFriend[pageUrl]"]',n.$element).val(s),i.process(n.$element)}).always(function(){n.loader.remove()})},_setupEvents:function(){var e=this,i=t("form",this.$element),s=t('[data-component="recaptcha"], .g-recaptcha',e.$element),n=t('[data-email-var="error"]',i);i.formValidate({success:function(a){a.preventDefault(),t.ajax({dataType:"json",type:"POST",url:i.attr("action"),data:i.serialize()}).done(function(t){"success"===t.status?(i.html(e.options.messageThankYou),e.position()):(t.errors?n.text(t.errors[0]):n.text(e.errorMessages[t.message]),s.recaptcha("reload"))})}})}}),t(document).on("click.modalEmail-api.data-api",'[data-open="modalEmail"]',function(e){var i=t(this),s=i.data(),n=s.$modal,a;e.preventDefault(),n?n.open():(a=i.data("modalEmailOptions")||i.dataPrefix("modalEmail"),i.data("$modal",t.cnet.modalEmail(t.extend(a,{openOnInit:!0,destroy:function(){i.data("$modal",null)}}))))})}),define("managers/components.desktop",["jquery","version!fly/managers/components","version!fly/managers/debug","managers/tealium","managers/page-vars","components/authentication","components/tabs-modal","components/site-header","components/auto-suggest","components/lazyload-component","components/taboola","components/mobile-footer-link","components/global-modal","components/modal-iframe","components/modal-email"],function(t,e,i,s,n){i=i.init("componentManager");var a="uvpjs_upgrade"===n.tracking.data.testName&&"test"===n.tracking.data.testGroup;return e.register({authentication:{},tabsModal:{},siteHeader:{},autoSuggest:{},lazyloadComponent:{},taboola:{},mobileFooterLink:{},globalModal:{},modalIframe:{},modalEmail:{},accordion:{require:"version!fly/components/accordion"},addthisevent:{require:"components/add-this-event"},alert:{require:"version!fly/components/alert"},amazonAd:{require:"components/amazon-ad"},article:{require:"components/article"},audioPlayer:{require:"components/audio-player"},backgroundVideo:{require:"components/background-video"},bestFitVideoPromo:{require:"components/best-fit-video-promo"},bestList:{require:"components/best-list"},bestListing:{require:"components/best-listing"},breakingNews:{require:"components/breaking-news"},carFinder:{require:"components/car-finder"},carousel:{require:"version!fly/components/carousel",options:{slidechanged:function(e){t(window).trigger("scroll")}}},carouselDesktop:{require:"components/carousel.desktop"},carouselFull:{require:"components/carousel-full"},cbsiFeedWidget:{require:"components/cbsi-feed-widget"},clipboard:{require:"components/clipboard"},commands:{require:"components/commands"},commentDownloader:{require:"components/comment-downloader"},connectComponent:{require:"components/connect-es-component"},contactUs:{require:"components/contact-us"},couponsDesktop:{require:"components/coupons-page.desktop"},dropdown:{require:"components/dropdown"},dealsActivator:{require:"components/deals-activator.desktop"},dealsUpdater:{require:"components/deals-updater"},dfllActivator:{require:"components/dfll-activator.desktop"},dfllActivatorV2:{require:"components/dfll-activator-v2.desktop"},dfllUpdater:{require:"components/dfll-updater.desktop"},dfllUpdaterV2:{require:"components/dfll-updater-v2.desktop"},disqusCount:{require:"components/disqus-count"},editorsChoiceToggle:{require:"components/editors-choice-toggle"},ellipsis:{require:"components/ellipsis"},expando:{require:"components/expando"},inlineProductCarousel:{require:"components/inline-product-carousel"},topStories:{require:"components/top-stories"},errorModal:{require:"components/error-modal"},expiredDealModal:{require:"components/expired-deal-modal.desktop"},externalLink:{require:"components/external-link"},autoCalcIframe:{require:"components/auto-calc-iframe"},fixate:{require:"components/fixate"},formAjax:{require:"components/form-ajax"},formTrim:{require:"components/form-trim"},formValidate:{require:"components/form-validate"},forumsBestAnswer:{require:"components/forums-best-answer"},forumsEditPost:{require:"components/forums-edit-post"},forumsMarkAsRead:{require:"components/forums-mark-as-read"},forumsRealtime:{require:"components/forums-realtime"},forumsPostToggle:{require:"components/forums-post-toggle"},forumsPostPreview:{require:"components/forums-post-preview"},forumsPostFlag:{require:"components/forums-post-flag"},forumsPermalink:{require:"components/forums-permalink"},forumsLoadForm:{require:"components/forums-load-form"},forumsSearchUpdater:{require:"components/forums-search-updater"},forumsTools:{require:"components/forums-tools"},forumsTrack:{require:"components/forums-track"},forumsVote:{require:"components/forums-vote"},fullScreenSlides:{require:"components/full-screen-slides"},genericTracker:{require:"components/generic-tracker"},googleCsa:{require:"components/google-csa"},iframeAdTracker:{require:"components/iframe-ad-tracker"},iframeHoverFix:{require:"components/iframe-hover-fix"},imageGallery:{require:"components/image-gallery"},imageGalleryAuto:{require:"components/image-gallery-auto"},imageGalleryModal:{require:"components/image-gallery-modal"},indepthReview:{require:"components/indepth-review"},instagramFetcher:{require:"components/instagram-fetcher"},interactiveFloorPlans:{require:"components/interactive-floor-plans"},interactiveVideoPlayer:{require:"components/interactive-video-player"},inviewElement:{require:"quantum/inviewElement"},joinCnet:{require:"components/join-cnet"},lazyloadImages:{require:"components/lazyload-images"},lazyloadElement:{require:"components/lazyload-element"},leadsTracker:{require:"components/leads-tracker"},linkTracker:{require:"components/link-tracker"},loading:{require:"components/loading"},loadMore:{require:"components/load-more"},loadNewest:{require:"components/load-newest",options:{clickGenericText:"refresh-river"}},longform:{require:"components/longform"},magnet:{require:"components/magnet"},modal:{require:"version!fly/components/modal"},modalEnlargeImage:{require:"components/modal-enlarge-image"},modalNewsletter:{require:"components/modal-newsletter"},moduleAssetTracker:{require:"components/module-asset-tracker"},mostPopularDeal:{require:"components/most-popular-deal.desktop"},mostPopularDealListing:{require:"components/most-popular-deal-listing.desktop",options:{contentSet:function(t){e.process(t.$content)}}},myLists:{require:"components/mylists"},myListsButton:{require:"components/mylists-button"},myListsCount:{require:"components/mylists-count"},myListsEmail:{require:"components/mylists-email"},newsletterSubscription:{require:"components/newsletter-subscription"},newsCarousel:{require:"components/news-carousel"},page:{require:"components/page"},pageHeader:{require:"components/page-header"},parallaxReveal:{require:"components/parallax-reveal"},poll:{require:"components/poll"},pricesByZip:{require:"components/prices-by-zip"},productMediaCarousel:{require:"components/product-media-carousel"},productSeriesModal:{require:"components/product-series",options:{contentSet:function(t,i){e.process(i.$content)}}},productSpecs:{require:"components/product-specs"},productReviewVideo:{require:"components/product-review-video"},profileReauth:{require:"components/profile-reauth"},progressiveAd:{require:"components/progressive-ad"},popOnScroll:{require:"components/pop-on-scroll"},profileSubscriptions:{require:"components/profile-subscriptions",options:{contentSet:function(t){e.process(t.$content)}}},profileModal:{require:"components/profile-modal",options:{contentSet:function(t){e.process(t.$content)}}},profileUpdate:{require:"components/profile-update",options:{contentSet:function(t){e.process(t.$content)}}},profileUgc:{require:"components/profile-ugc",options:{contentSet:function(t){e.process(t.$content)}}},profileDiscussions:{require:"components/profile-discussions"},radio:{require:"components/radio"},readMore:{require:"components/read-more"},realtimeData:{require:"components/realtime-data"},realtimeDrawer:{require:"components/realtime-drawer"},realtimeTicker:{require:"components/realtime-ticker"},recaptcha:{require:"components/recaptcha"},reposition:{require:"components/reposition"},scrollbarArea:{require:"components/scrollbar-area"},scrollTracking:{require:"components/scroll-tracking"},searchBar:{require:"components/search-bar"},searchPagination:{require:"components/search-paginator",options:{contentSet:function(t){e.process(t.$content)}}},searchSort:{require:"components/search-sort"},selfishScroll:{require:"components/selfish-scroll"},sharebar:{require:"components/sharebar"},shortcodeGallery:{require:"components/shortcode-gallery"},shortcodeGalleryController:{require:"components/shortcode-gallery-controller"},showcaseHeroTabs:{require:"components/showcase-hero-tabs"},showcaseRailBody:{require:"components/showcase-rail-body"},showcaseVideos:{require:"components/showcase-videos"},sideNav:{require:"components/side-nav"},sideqik:{require:"components/sideqik"},slider:{require:"components/slider"},slidingElement:{require:"components/sliding-element"},snappyCarousel:{require:"quantum/snappyCarousel"},stacklaEvents:{require:"components/stackla-events"},uiSlider:{require:"version!libs/jquery/ui/jquery.ui.slider"},socialButton:{require:"version!fly/components/social-button"},socialCounts:{require:"components/social-counts"},socialMenu:{require:"components/social-menu"},socialTracking:{require:"components/social-tracking"},stickyColumn:{require:"components/sticky-column"},stickyElement:{require:"components/sticky-element"},stickyLeader:{require:"components/sticky-leader"},subratingModalToggle:{require:"components/subrating-modal-toggle"},swipeAway:{require:"quantum/swipeAway"},tableSorter:{require:"components/table-sorter"},tabs:{require:"version!fly/components/tabs"},tabsAsync:{require:"components/tabs-async",options:{contentSet:function(t){e.process(t.$content)}}},tabsRefresh:{require:"components/tabs-refresh"},tagLetterSorter:{require:"components/tag-letter-sorter"},textCounter:{require:"components/text-counter"},tileSpecialNav:{require:"components/tile-special-nav"},tocNav:{require:"components/toc-nav"},toggle:{require:"components/toggle"},tooltip:{require:"components/tooltip"},touchMenuHover:{require:"components/touch-menu-hover"},trackDownload:{require:"components/track-download"},trackImpression:{require:"components/track-impression"},tvFeature:{require:"components/tv-feature"},twitterFetcher:{require:"components/twitter-fetcher"},updateArea:{require:"components/update-area"},versusModelSwitcher:{require:"components/versus-model-switcher"},videoPlaceholder:{require:"components/video-placeholder"},videoPlayer:{require:a?"quantum/videoPlayer_upgrade":"quantum/videoPlayer"},videoListing:{require:"components/video-listing"},videoPlaylistConnector:{require:"components/video-playlist-connector"},videoShowGallery:{require:"components/video-show-gallery"},waypointPromo:{require:"component/waypoint-promo"},zipCode:{require:"components/zip-code"},zoom:{require:"quantum/zoom"},profileNewsletterSubscription:{require:"components/profile-newsletter-subscription"},bandwidthMeterBar:{require:"components/bandwidth-meter-bar"}}),e}),define("managers/edition-notifications",["jquery","version!fly/managers/debug","managers/device","components/global-modal"],function(t,e,i,s){return e=e.init("editionNotifications"),{init:function(){if(i.isDesktop()){var e=t("body").data("edition-redirect-alert");e&&e.length>0&&t.cnet.globalModal({content:e,openOnInit:!0})}}}}),define("managers/promotionals.desktop",["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","managers/edition","managers/page-vars","managers/user","version!libs/modernizr.custom"],function(t,e,i,s,n,a,r){e=e.init("promotionals"),e.log("promos here");var o=null,l={cookiesNotification:{limit:3,isActive:function(){return n.isUnitedKingdom()&&!i.read("suppressCookiesNotification",!0)&&o.cookiesNotification<l.cookiesNotification.limit},init:function(){require(["components/cookies-notification.desktop"],function(){t.cnet.cookiesNotification(),o.cookiesNotification++,i.write("promotionalSettings",o),i.write("suppressCookiesNotification",!0,!0)})}},espanolPromo:{limit:2,isActive:function(){var t=(window.navigator.userLanguage||window.navigator.language).indexOf("es")>=0;return t||(t="es"===s.read("fly_default_edition")),!n.isEspanol()&&t&&!i.read("suppressEspanolPromo",!0)&&o.espanolPromo<l.espanolPromo.limit},init:function(){require(["components/espanol-promo.desktop"],function(){t.cnet.espanolPromo(),o.espanolPromo++,i.write("promotionalSettings",o),i.write("suppressEspanolPromo",!0,!0)})}},espanolMatch:{limit:1,isActive:function(){var t=(window.navigator.userLanguage||window.navigator.language).indexOf("es")>=0;t||(t="es"===s.read("fly_default_edition"));var e=s.read("fly_geo")?JSON.parse(s.read("fly_geo")):"",a=!!s.read("fly_esMatchShown");return!n.isEspanol()&&t&&"us"==e.countryCode&&!a&&!i.read("suppressEspanolMatch",!0)},init:function(){require(["components/espanol-match"],function(){var e=t("[data-espanol-match-options]");e.espanolMatch(e.data("espanolMatchOptions")),o.espanolMatch++,i.write("promotionalSettings",o),s.write("fly_esMatchShown","true",{expires:1})})}},autoSocialPromo:{limit:4,isActive:function(){var t="front_door"==a.tracking.data._pageType&&"auto"==a.tracking.data.slug,e=o.autoSocialPromo<l.autoSocialPromo.limit;return t&&e},init:function(){require(["components/waypoint-promo"],function(){t.cnet.waypointPromo()})}},urbanAirshipPromo:{isActive:function(){return!0},init:function(){require(["components/urban-airship"],function(){try{t.cnet.urbanAirship()}catch(t){e.log("UrbanAirship component not available")}})}}};return{init:function(){var e=function(){!1===t.cnet.breakingNewsActive&&(l.cookiesNotification.isActive()?l.cookiesNotification.init():l.espanolPromo.isActive()&&l.espanolPromo.init())};o=i.read("promotionalSettings")||{};for(var s in l)l.hasOwnProperty(s)&&(o[s]=o[s]||0);l.autoSocialPromo.isActive()&&l.autoSocialPromo.init(),l.urbanAirshipPromo.isActive()&&l.urbanAirshipPromo.init(),l.espanolMatch.isActive()&&l.espanolMatch.init(),void 0===t.cnet.breakingNewsActive?t(window).on("breakingNewsComplete",function(){e()}):e()},suppress:function(t){o[t]=l[t].limit,i.write("promotionalSettings",o)},increment:function(t){o[t]++,i.write("promotionalSettings",o)}}}),define("managers/third-party/social",["version!fly/managers/debug","managers/page-vars","managers/global-functions"],function(t,e,i){function s(t){"string"==typeof n[t]&&i.gdprConsentCallback("script_"+t,function(){require([n[t]],function(e){n[t]=e,e.init()})})}t=t.init("social");var n={linkedIn:"managers/third-party/linked-in",pinterest:"managers/third-party/pinterest",twitter:"managers/third-party/twitter",disqus:"managers/third-party/disqus"};return{init:function(){e.services.linkedin.enabled&&$('[data-social="linkedIn"]').length>0&&s("linkedIn"),e.services.pinterest.enabled&&$('[data-social="pinterest"]').length>0&&s("pinterest"),e.services.twitterwidget.enabled&&$('[data-social="twitter"]').length>0&&s("twitter"),e.services.disqus.enabled&&$('[data-social="disqus"]').length>0&&"comments_permalink"==e.pageType&&s("disqus")},parse:function(t){t=t||null,e.services.linkedin.enabled&&$('[data-social="linkedIn"]',t).length>0&&("string"==typeof n.linkedIn?s("linkedIn"):n.linkedIn.parse(t)),e.services.pinterest.enabled&&$('[data-social="pinterest"]',t).length>0&&"string"==typeof n.pinterest&&s("pinterest"),e.services.twitterwidget.enabled&&$('[data-social="twitter"]',t).length>0&&("string"==typeof n.twitter?s("twitter"):n.twitter.parse()),e.services.disqus.enabled&&$('[data-social="disqus"]',t).length>0&&("string"==typeof n.disqus?s("disqus"):n.disqus.parse(t))}}}),function(t,e,i){"function"==typeof define&&define.amd?define("libs/jquery/mobile-1.4.0a1",["jquery"],function(s){return i(s,t,e),s.mobile}):i(t.jQuery,t,e)}(this,document,function(t,e,i,s){!function(t,e,i,s){function n(t){for(;t&&void 0!==t.originalEvent;)t=t.originalEvent;return t}function a(e,i){var a=e.type,r,o,l,d,u,h,c,p,v;if(e=t.Event(e),e.type=i,r=e.originalEvent,o=t.event.props,a.search(/^(mouse|click)/)>-1&&(o=R),r)for(c=o.length,d;c;)d=o[--c],e[d]=r[d];if(a.search(/mouse(down|up)|click/)>-1&&!e.which&&(e.which=1),-1!==a.search(/^touch/)&&(l=n(r),a=l.touches,u=l.changedTouches,h=a&&a.length?a[0]:u&&u.length?u[0]:s))for(p=0,v=D.length;p<v;p++)d=D[p],e[d]=h[d];return e}function r(e){for(var i={},s,n;e;){s=t.data(e,b);for(n in s)s[n]&&(i[n]=i.hasVirtualBinding=!0);e=e.parentNode}return i}function o(e,i){for(var s;e;){if((s=t.data(e,b))&&(!i||s[i]))return e;e=e.parentNode}return null}function l(){U=!1}function d(){U=!0}function u(){G=0,w.length=0,N=!1,d()}function h(){l()}function c(){p(),M=setTimeout(function(){M=0,u()},t.vmouse.resetTimerDuration)}function p(){M&&(clearTimeout(M),M=0)}function v(e,i,s){var n;return(s&&s[e]||!s&&o(i.target,e))&&(n=a(i,e),t(i.target).trigger(n)),n}function g(e){var i=t.data(e.target,T),s;N||G&&G===i||(s=v("v"+e.type,e))&&(s.isDefaultPrevented()&&e.preventDefault(),s.isPropagationStopped()&&e.stopPropagation(),s.isImmediatePropagationStopped()&&e.stopImmediatePropagation())}function f(e){var i=n(e).touches,s,a,o;i&&1===i.length&&(s=e.target,a=r(s),a.hasVirtualBinding&&(G=F++,t.data(s,T,G),p(),h(),k=!1,o=n(e).touches[0],O=o.pageX,L=o.pageY,v("vmouseover",e,a),v("vmousedown",e,a)))}function m(t){U||(k||v("vmousecancel",t,r(t.target)),k=!0,c())}function _(e){if(!U){var i=n(e).touches[0],s=k,a=t.vmouse.moveDistanceThreshold,o=r(e.target);k=k||Math.abs(i.pageX-O)>a||Math.abs(i.pageY-L)>a,k&&!s&&v("vmousecancel",e,o),v("vmousemove",e,o),c()}}function E(t){if(!U){d();var e=r(t.target),i,s;v("vmouseup",t,e),k||(i=v("vclick",t,e))&&i.isDefaultPrevented()&&(s=n(t).changedTouches[0],w.push({touchID:G,x:s.clientX,y:s.clientY}),N=!0),v("vmouseout",t,e),k=!1,c()}}function A(e){var i=t.data(e,b),s;if(i)for(s in i)if(i[s])return!0;return!1}function y(){}function S(e){var i=e.substr(1);return{setup:function(){A(this)||t.data(this,b,{}),t.data(this,b)[e]=!0,P[e]=(P[e]||0)+1,1===P[e]&&j.bind(i,g),t(this).bind(i,y),B&&(P.touchstart=(P.touchstart||0)+1,1===P.touchstart&&j.bind("touchstart",f).bind("touchend",E).bind("touchmove",_).bind("scroll",m))},teardown:function(){--P[e],P[e]||j.unbind(i,g),B&&(--P.touchstart||j.unbind("touchstart",f).unbind("touchmove",_).unbind("touchend",E).unbind("scroll",m));var s=t(this),n=t.data(this,b);n&&(n[e]=!1),s.unbind(i,y),A(this)||s.removeData(b)}}}var b="virtualMouseBindings",T="virtualTouchID",C="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),D="clientX clientY pageX pageY screenX screenY".split(" "),I=t.event.mouseHooks?t.event.mouseHooks.props:[],R=t.event.props.concat(I),P={},M=0,O=0,L=0,k=!1,w=[],N=!1,U=!1,B="addEventListener"in i,j=t(i),F=1,G=0,V,x;for(t.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,
resetTimerDuration:1500},x=0;x<C.length;x++)t.event.special[C[x]]=S(C[x]);B&&i.addEventListener("click",function(e){var i=w.length,s=e.target,n,a,r,o,l,d;if(i)for(n=e.clientX,a=e.clientY,V=t.vmouse.clickDistanceThreshold,r=s;r;){for(o=0;o<i;o++)if(l=w[o],d=0,r===s&&Math.abs(l.x-n)<V&&Math.abs(l.y-a)<V||t.data(r,T)===l.touchID)return e.preventDefault(),void e.stopPropagation();r=r.parentNode}},!0)}(t,e,i),function(t){t.mobile={}}(t),function(t,e){var s={touch:"ontouchend"in i};t.mobile.support=t.mobile.support||{},t.extend(t.support,s),t.extend(t.mobile.support,s)}(t),function(t,e,s){function n(e,i,s){var n=s.type;s.type=i,t.event.dispatch.call(e,s),s.type=n}var a=t(i),r=t.mobile.support.touch,o="touchmove scroll",l=r?"touchstart":"mousedown",d=r?"touchend":"mouseup",u=r?"touchmove":"mousemove";t.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(e,i){t.fn[i]=function(t){return t?this.bind(i,t):this.trigger(i)},t.attrFn&&(t.attrFn[i]=!0)}),t.event.special.scrollstart={enabled:!0,setup:function(){function e(t,e){a=e,n(i,a?"scrollstart":"scrollstop",t)}var i=this,s=t(i),a,r;s.bind(o,function(i){t.event.special.scrollstart.enabled&&(a||e(i,!0),clearTimeout(r),r=setTimeout(function(){e(i,!1)},50))})},teardown:function(){t(this).unbind(o)}},t.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var e=this,i=t(e),s=!1;i.bind("vmousedown",function(r){function o(){clearTimeout(h)}function l(){o(),i.unbind("vclick",d).unbind("vmouseup",o),a.unbind("vmousecancel",l)}function d(t){l(),s||u!==t.target?s&&t.stopPropagation():n(e,"tap",t)}if(s=!1,r.which&&1!==r.which)return!1;var u=r.target,h;i.bind("vmouseup",o).bind("vclick",d),a.bind("vmousecancel",l),h=setTimeout(function(){t.event.special.tap.emitTapOnTaphold&&(s=!0),n(e,"taphold",t.Event("taphold",{target:u}))},t.event.special.tap.tapholdThreshold)})},teardown:function(){t(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),a.unbind("vmousecancel")}},t.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:10,verticalDistanceThreshold:75,start:function(e){var i=e.originalEvent.touches?e.originalEvent.touches[0]:e;return{time:(new Date).getTime(),coords:[i.pageX,i.pageY],origin:t(e.target)}},stop:function(t){var e=t.originalEvent.touches?t.originalEvent.touches[0]:t;return{time:(new Date).getTime(),coords:[e.pageX,e.pageY]}},handleSwipe:function(e,i,s,a){if(i.time-e.time<t.event.special.swipe.durationThreshold&&Math.abs(e.coords[0]-i.coords[0])>t.event.special.swipe.horizontalDistanceThreshold&&Math.abs(e.coords[1]-i.coords[1])<t.event.special.swipe.verticalDistanceThreshold){var r=e.coords[0]>i.coords[0]?"swipeleft":"swiperight";return n(s,"swipe",t.Event("swipe",{target:a,swipestart:e,swipestop:i})),n(s,r,t.Event(r,{target:a,swipestart:e,swipestop:i})),!0}return!1},setup:function(){var e=this,i=t(e);i.bind(l,function(s){function n(i){r&&(a=t.event.special.swipe.stop(i),l||(l=t.event.special.swipe.handleSwipe(r,a,e,o)),Math.abs(r.coords[0]-a.coords[0])>t.event.special.swipe.scrollSupressionThreshold&&i.preventDefault())}var a,r=t.event.special.swipe.start(s),o=s.target,l=!1;i.bind(u,n).one(d,function(){l=!0})})},teardown:function(){t(this).unbind(l).unbind(u).unbind(d)}},t.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(e,i){t.event.special[e]={setup:function(){t(this).bind(i,t.noop)},teardown:function(){t(this).unbind(i)}}})}(t,this)}),define("main.desktop",["jquery","managers/client-storage","managers/components.desktop","managers/device","managers/edition-notifications","managers/page-vars","managers/promotionals.desktop","managers/third-party/social","managers/tracking","managers/tealium","version!libs/modernizr.custom","version!fly/utils/data-prefix","utils/function-natives","version!libs/jquery/mobile","managers/user"],function(t,e,i,s,n,a,r,o,l){t(document).ready(function(){l.resetTrackingData(a.tracking.data),s.init(a.device),e.init(),i.process(t("body")),r.init(),n.init(),o.init()})}),define("components/form-trim",["jquery","version!fly/managers/debug","version!fly/components/base"],function(t,e){e=e.init("formTrim"),t.widget("cnet.formTrim",t.fly.base,{options:{},_create:function(){var e=this;e._setup(),e.$element.on("submit",t.proxy(function(i){t("input[type=text]",e.$element).each(function(){t(this).val(t(this).val().replace(/\s+/g," ").trim())})},this))}})}),function(t,e,i,s){var n=t(e);t.fn.lazyload=function(s){function a(){var e=0;r.each(function(){var i=t(this);if(!l.skip_invisible||i.is(":visible"))if(t.abovethetop(this,l)||t.leftofbegin(this,l));else if(t.belowthefold(this,l)||t.rightoffold(this,l)){if(++e>l.failure_limit)return!1}else i.trigger("appear"),e=0})}var r=this,o,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:e,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return s&&(void 0!==s.failurelimit&&(s.failure_limit=s.failurelimit,delete s.failurelimit),void 0!==s.effectspeed&&(s.effect_speed=s.effectspeed,delete s.effectspeed),t.extend(l,s)),o=void 0===l.container||l.container===e?n:t(l.container),0===l.event.indexOf("scroll")&&o.bind(l.event,function(){return a()}),this.each(function(){var e=this,i=t(e);e.loaded=!1,void 0!==i.attr("src")&&!1!==i.attr("src")||i.is("img")&&i.attr("src",l.placeholder),i.one("appear",function(){if(!this.loaded){if(l.appear){var s=r.length;l.appear.call(e,s,l)}t("<img />").bind("load",function(){var s=i.attr("data-"+l.data_attribute);i.hide(),i.is("img")?i.attr("src",s):i.css("background-image","url('"+s+"')"),i[l.effect](l.effect_speed),e.loaded=!0;var n=t.grep(r,function(t){return!t.loaded});if(r=t(n),l.load){var a=r.length;l.load.call(e,a,l)}}).attr("src",i.attr("data-"+l.data_attribute))}}),0!==l.event.indexOf("scroll")&&i.bind(l.event,function(){e.loaded||i.trigger("appear")})}),n.bind("resize",function(){a()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&n.bind("pageshow",function(e){e.originalEvent&&e.originalEvent.persisted&&r.each(function(){t(this).trigger("appear")})}),t(i).ready(function(){a()}),this},t.belowthefold=function(i,s){var a;return(a=void 0===s.container||s.container===e?(e.innerHeight?e.innerHeight:n.height())+n.scrollTop():t(s.container).offset().top+t(s.container).height())<=t(i).offset().top-s.threshold},t.rightoffold=function(i,s){var a;return(a=void 0===s.container||s.container===e?n.width()+n.scrollLeft():t(s.container).offset().left+t(s.container).width())<=t(i).offset().left-s.threshold},t.abovethetop=function(i,s){var a;return(a=void 0===s.container||s.container===e?n.scrollTop():t(s.container).offset().top)>=t(i).offset().top+s.threshold+t(i).height()},t.leftofbegin=function(i,s){var a;return(a=void 0===s.container||s.container===e?n.scrollLeft():t(s.container).offset().left)>=t(i).offset().left+s.threshold+t(i).width()},t.inviewport=function(e,i){return!(t.rightoffold(e,i)||t.leftofbegin(e,i)||t.belowthefold(e,i)||t.abovethetop(e,i))},t.extend(t.expr[":"],{"below-the-fold":function(e){return t.belowthefold(e,{threshold:0})},"above-the-top":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-screen":function(e){return t.rightoffold(e,{threshold:0})},"left-of-screen":function(e){return!t.rightoffold(e,{threshold:0})},"in-viewport":function(e){return t.inviewport(e,{threshold:0})},"above-the-fold":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-fold":function(e){return t.rightoffold(e,{threshold:0})},"left-of-fold":function(e){return!t.rightoffold(e,{threshold:0})}})}(jQuery,window,document),define("libs/jquery/lazyload-1.9.3",function(){}),define("components/lazyload-images",["jquery","version!fly/components/base","version!libs/jquery/lazyload"],function(t){t.widget("cnet.lazyloadImages",t.fly.base,{options:{threshold:200,skip_invisible:!1},_create:function(){this._super(),this._setupEvents(),this._lazyLoadImages()},_setupEvents:function(){this._on(this.$element,{ajaxStop:this._lazyLoadImages})},_lazyLoadImages:function(){this.$element.find("img.lazy").lazyload(this.options).removeClass("lazy")}})}),define("components/touch-menu-hover",["jquery","version!fly/managers/debug","managers/device","managers/page-vars","version!fly/components/base"],function(t,e,i,s){e=e.init("touchMenuHover"),t.widget("cnet.touchMenuHover",t.fly.base,{options:{hoverClass:"hover",moreButton:"moreButton",header:!1},_create:function(){this._setup(),"mobile"!=s.tracking.data.deviceType&&!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&t(".social-login").css("display","none"),Modernizr.touch&&this._setupEvents()},_setupEvents:function(){var s=this,n=s.$element,a=t('[data-trigger="menu"]',n);0===a.length&&(a=n),a.on(i.getImmediateClickType(),function(a){t(":cnet-touchMenuHover").not(n).removeClass(s.options.hoverClass),s.options.header&&(t("#rbHeader").removeClass("passthru intentionalHover"),t("#rbHeader").addClass("fadeOut")),n.hasClass(s.options.hoverClass)?n.hasClass(s.options.moreButton)?(e.log("Link click on active more share menu : leaving hover class"),t(document).on(i.getImmediateClickType(),null,{self:s},s._handleClickOutsideMenu)):(n.removeClass(s.options.hoverClass),e.log("Link click on active : removing hover class"),s.options.header&&(t("#rbHeader").removeClass("passthru intentionalHover"),t("#rbHeader").addClass("fadeOut")),t(document).off(i.getImmediateClickType(),null,s._handleClickOutsideMenu)):(a.preventDefault(),n.addClass(s.options.hoverClass),s.options.header&&(t("#rbHeader").removeClass("fadeOut"),t("#rbHeader").addClass("passthru intentionalHover")),e.log("Link click on non-active : preventing link and adding hover class"),t(document).on(i.getImmediateClickType(),null,{self:s},s._handleClickOutsideMenu))})},_handleClickOutsideMenu:function(s){var n=s.data.self;0===t(s.target).parents(":cnet-touchMenuHover").length&&(e.log("Body click : removing hover class"),n.$element.removeClass(n.options.hoverClass),n.options.header&&(t("#rbHeader").removeClass("passthru intentionalHover"),t("#rbHeader").addClass("fadeOut")),t(document).off(i.getImmediateClickType(),null,n._handleClickOutsideMenu))}})}),define("libs/waypoints/inview-3.1.1",["version!libs/waypoints/jquery.waypoints"],function(){"use strict";function t(){}function e(t){this.options=i.Adapter.extend({},e.defaults,t),this.axis=this.options.horizontal?"horizontal":"vertical",this.waypoints=[],this.createWaypoints()}var i=window.Waypoint;e.prototype.createWaypoints=function(){for(var t={vertical:[{down:"enter",up:"exited",offset:"100%"},{down:"entered",up:"exit",offset:"bottom-in-view"},{down:"exit",up:"entered",offset:-1},{down:"exited",up:"enter",offset:function(){return-this.adapter.outerHeight()}}],horizontal:[{right:"enter",left:"exited",offset:"100%"},{right:"entered",left:"exit",offset:"right-in-view"},{right:"exit",left:"entered",offset:0},{right:"exited",left:"enter",offset:function(){return-this.adapter.outerWidth()}}]},e=0,i=t[this.axis].length;e<i;e++){var s=t[this.axis][e];this.createWaypoint(s)}},e.prototype.createWaypoint=function(t){var e=this;this.waypoints.push(new i({element:this.options.element,handler:function(t){return function(i){e.options[t[i]].call(this,i)}}(t),offset:t.offset,horizontal:this.options.horizontal}))},e.prototype.destroy=function(){for(var t=0,e=this.waypoints.length;t<e;t++)this.waypoints[t].destroy();this.waypoints=[]},e.defaults={enter:t,entered:t,exit:t,exited:t},i.Inview=e}),function(){function t(t,e,i){var s=e&&i||0,n=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){n<16&&(e[s+n++]=h[t])});n<16;)e[s+n++]=0;return e}function e(t,e){var i=e||0,s=u;return s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]}function i(t,i,s){var n=i&&s||0,a=i||[];t=t||{};var r=null!=t.clockseq?t.clockseq:g,o=null!=t.msecs?t.msecs:(new Date).getTime(),l=null!=t.nsecs?t.nsecs:m+1,d=o-f+(l-m)/1e4;if(d<0&&null==t.clockseq&&(r=r+1&16383),(d<0||o>f)&&null==t.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=o,m=l,g=r,o+=122192928e5;var u=(1e4*(268435455&o)+l)%4294967296;a[n++]=u>>>24&255,a[n++]=u>>>16&255,a[n++]=u>>>8&255,a[n++]=255&u;var h=o/4294967296*1e4&268435455;a[n++]=h>>>8&255,a[n++]=255&h,a[n++]=h>>>24&15|16,a[n++]=h>>>16&255,a[n++]=r>>>8|128,a[n++]=255&r;for(var c=t.node||v,p=0;p<6;p++)a[n+p]=c[p];return i||e(a)}function s(t,i,s){var n=i&&s||0;"string"==typeof t&&(i="binary"==t?new d(16):null,t=null),t=t||{};var r=t.random||(t.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,i)for(var o=0;o<16;o++)i[n+o]=r[o];return i||e(r)}var n=this,a;if("function"==typeof n.require)try{var r=n.require("crypto").randomBytes;a=r&&function(){return r(16)}}catch(t){}if(!a&&n.crypto&&crypto.getRandomValues){var o=new Uint8Array(16);a=function t(){return crypto.getRandomValues(o),o}}if(!a){var l=new Array(16);a=function(){for(var t=0,e;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),l[t]=e>>>((3&t)<<3)&255;return l}}for(var d="function"==typeof n.Buffer?n.Buffer:Array,u=[],h={},c=0;c<256;c++)u[c]=(c+256).toString(16).substr(1),h[u[c]]=c;var p=a(),v=[1|p[0],p[1],p[2],p[3],p[4],p[5]],g=16383&(p[6]<<8|p[7]),f=0,m=0,_=s;_.v1=i,_.v4=s,_.parse=t,_.unparse=e,_.BufferClass=d;var E=n.uuid;_.noConflict=function(){return n.uuid=E,_},n.uuid=_}.call(this),define("fly/libs/guid-1.0",function(){}),define("managers/recommendation",["jquery","managers/page-vars","managers/global-functions","managers/tealium","version!fly/managers/debug","version!fly/libs/guid","version!fly/libs/jquery.throttle-debounce"],function(t,e,i,s,n){function a(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}}function r(t){for(;t.length>=I;)t.shift();if(t.length>0)for(var e=t[0],i=Date.now();e.date_created+R<i&&(t.shift(),t.length>0);)e=t[0];for(var s=[],n=t.length-1;n>=0;n--)s.some(function(e){return e.content_entity_id===t[n].content_entity_id&&e.content_type===t[n].content_type})||s.push(t[n]);return s.reverse()}function o(){var t=e.tracking.data;return{content_entity_id:t.contentId,content_type:"content_"+t.contentType,site:t.brand,dev:t.isDev,view_guid:t.pageViewGuid,page_type:t.pageType,user_id:t.userId,anon_id:l(),deviceType:t.deviceType,date_created:Date.now(),interest:t.interest?t.interest:E(),annotations:t.annotations||[],edition:t.siteEdition}}function l(){var t=localStorage.getItem(C);t||(t=window.uuid.v4());try{localStorage.setItem(C,t)}catch(e){n.error("Writing to localStorage for anon failed."),t="00000000-0000-0000-0000-000000000000"}return t}function d(t){var e={},i=Date.now()-2592e6;return t.forEach(function(t){t=_(t),!t.interest||"none"===t.interest.id||!t.date_created||i>t.date_created||(e[t.interest.type]||(e[t.interest.type]={}),e[t.interest.type][t.interest.name]?e[t.interest.type][t.interest.name]++:e[t.interest.type][t.interest.name]=1)}),e}function u(e,s){var n=d(e);"none"!==s.interest.id&&n[s.interest.type][s.interest.name]>=P&&i.gdprConsentCallback("UAInterestAdd",function(){window.UA?p(s):t(window).on("urban-airship-loaded",function(){p(s)})})}function h(t){var e=!1;try{localStorage.setItem(S,JSON.stringify(t)),e=!0}catch(s){n.error("Writing to localStorage failed, attempting to prune view data...");for(var i=0;i<t.length/10;i++)t.shift();try{localStorage.setItem(S,JSON.stringify(t)),e=!0}catch(t){n.error("Writing to localStorage failed, even after pruning 10% of view data."),e=!1}}return e}function c(t){var e=localStorage.getItem(T);e=e?JSON.parse(e):[];for(var i=!1,s=0;s<e.length;s++)if(t.interest_name&&e[s].interest_name&&t.interest_name===e[s].interest_name&&t.type&&e[s].type&&t.type===e[s].type){e[s]=t,i=!0;break}return i||e.push(t),localStorage.setItem(T,JSON.stringify(e)),{all:e,new:t}}function p(t){window.UA.then(function(i){var a=JSON.parse(localStorage.getItem(b));a&&(a.forEach(function(t){c(g(t))}),localStorage.removeItem(b));var r=JSON.parse(localStorage.getItem(T));if(r&&r.length)for(var o=0;o<r.length;o++)if(r[o].type===t.interest.type&&r[o].interest_name===t.interest.name.toUpperCase()&&"unfollow"===r[o].action)return n.log("Did not add tag "+r[o].interest_name+" due to being explicitly unfollowed"),void A(r[o],function(e){n.log("Successfully created explicit interest "+t.interest.name+" in DB with action "+r[o].action)});if(i.channel){var l="Interest_"+t.interest.name.toUpperCase(),d=O[t.interest.type];if(!i.channel.tags.has(l,d)){n.log("Adding interests in UA API: "+l),i.channel.tags.add(l,d);var u=e.tracking.data;s.trackCustomEvent("background",{pageViewGuid:u.pageViewGuid,_dwAnonId:u._dwAnonId,articleId:u.articleId,clickGenericText:"add_interest|"+t.interest.type+"_interest|"+t.interest.name.toUpperCase(),pageType:u.pageType,siteEdition:u.siteEdition,siteHier:u.siteHier,siteSection:u.siteSection},"trackClick")}t.ua_channel_id=i.channel.id}}),A(f(t))}function v(t,e){var i=o();return i=_(i),e&&e.id&&(i.interest=e),{anon_id:i.anon_id,implicit:!1,date_created:i.date_created,type:i.interest?i.interest.type:"none",interest_name:i.interest?i.interest.name.toUpperCase():"none",interest_id:i.interest?i.interest.id:"none",site:i.site,edition:i.edition,action:t}}function g(t){var e=o();return{anon_id:e.anon_id,implicit:!1,date_created:e.date_created,type:"broad",interest_name:t,interest_id:M[t]?M[t]:"interest_id",site:e.site,edition:e.edition,action:"unfollow"}}function f(t){return t||(t=o()),t=_(t),{anon_id:t.anon_id,implicit:!0,date_created:t.date_created,type:t.interest.type,interest_name:t.interest.name.toUpperCase(),interest_id:t.interest.id,site:t.site,edition:t.edition,action:"follow"}}function m(t,i,n){var a=e.tracking.data;s.trackCustomEvent("tap",{pageViewGuid:a.pageViewGuid,_dwAnonId:a._dwAnonId,articleId:a.articleId,clickGenericText:(n?"add":"remove")+"_interest|"+i+"_interest|"+t,pageType:a.pageType,siteEdition:a.siteEdition,siteHier:a.siteHier,siteSection:a.siteSection},"trackClick")}function _(t){return t.broad_interest?t.interest={id:M[t.broad_interest]?M[t.broad_interest]:"interest_id",type:"broad",name:t.broad_interest}:t.interest||(t.interest=E()),t}function E(){return{id:"none",type:"none",name:"none"}}function A(e,i){"video"===e.type&&(e.type="specific"),e.interest_id=e.interest_id.replace("cnet_tag","CNET_TAG"),e.interest_id=e.interest_id.replace("cnet_cat_topic","CNET_CAT_TOPIC"),t.post(D,e,i)}var y="recommendationManager",S="CnetViewList",b="CnetUnfollowList",T="CnetExplicitList",C="CnetAnon",D="www.cnet.com"===window.location.host?"https://us-central1-i-cnet-prod.cloudfunctions.net/userInterestsStore":"https://us-central1-i-cnet-dev.cloudfunctions.net/userInterestsStore",I=2e3,R=158112e5,P=2,M={APPLE:"17cf639e-36ce-4e2e-8ea8-a093af98d566",CARS:"b122d23f-29eb-493e-83e6-e9fbfeaf79c8",DEALS:"cc98b5a4-d3a9-4e35-b6d7-625e8289a152",GOOGLE:"303efe12-c4e2-4abd-af02-f99b9d1b2828","HOW TO":"787724c6-2b1e-4f6a-90d9-afa0eebd1abb",MOBILE:"d1753851-e519-4744-897e-9b6ea3b1c04b","SMART HOME":"5787016e-17a5-438f-8690-70ca531844fb","TV & AUDIO":"a13a6b57-a74a-4eaf-be94-c72b9dc931c2"},O={broad:"device",specific:"specific-interest",video:"video-interest"};return n=n.init(y),{registerPageView:function(){if(a()&&"us"===e.tracking.data.siteEdition){var t=JSON.parse(localStorage.getItem(S));t||(t=[]);var i=o();t.push(i),t=r(t,i),u(t,i),h(t)}},registerOnScroll:function(e){var i=this;e||(e=window);var s=t(e);s.on("scroll."+y,t.throttle(500,function(){i.registerPageView(),s.off("scroll."+y)}))},addExplicitInterest:function(t,e){var i=v("follow",e);if(t.channel){var s=O[i.type];n.log("Adding "+i.interest_name+" to UA"),t.channel.tags.add("Interest_"+i.interest_name.toUpperCase(),s),m(i.interest_name.toUpperCase(),i.type,!0)}return c(i),A(i,function(t){n.log("Successfully added follow interest "+i.interest_name+" to DB")}),i},removeExplicitInterest:function(t,e){var i=v("unfollow",e);if(t.channel){var s=O[i.type];n.log("Removing UA interest "+i.interest_name.toUpperCase()),t.channel.tags.remove("Interest_"+i.interest_name.toUpperCase(),s),m(i.interest_name.toUpperCase(),i.type,!1)}return c(i),A(i,function(t){n.log("Successfully added unfollow interest "+i.interest_name+" to DB")}),i},getTagGroupByInterest:function(t){return O[t]?O[t]:"device"}}}),define("components/image-gallery-modal",["jquery","managers/components.desktop","version!fly/managers/debug","managers/page-vars","managers/tracking","managers/tealium","managers/guid","managers/ad","managers/recommendation","version!fly/components/base"],function(t,e,i,s,n,a,r,o,l){i=i.init("imageGalleryModal"),t.widget("cnet.imageGalleryModal",t.fly.base,{options:{cssPath:"",trackUrl:"",url:"",index:1},cssLoadPath:"",latestDwLinkTag:"",url:"",hostUrl:"",hostState:{},hostScrollTop:0,hostAdData:{},hostGuid:0,isHostGallery:!1,_create:function(){var e=this;this._setup(),this.$video=t(".videoPlayer"),"www.theroadshow.com"!==window.location.hostname&&this.$element.on("click",function(i){e.cssLoadPath=e.options.cssPath,i.preventDefault(),e._clickControl(),e.latestDwLinkTag=a.getDwTag(t(i.target))})},_storeHostPageData:function(){this.hostUrl=window.location.href,this.hostState=window.history.state,this.hostScrollTop=t(window).scrollTop(),this.hostAdData=t.extend(!0,{},s.ads.data),this.hostTracking=t.extend(!0,{},s.tracking),this.hostImage=t('meta[property="og:image"]').attr("content").trim(),this.hostGuid=r.getViewGuid(),this.url=""!==this.options.url?this.options.url:this.$element.attr("href")},_clickControl:function(){var d=this,u=t("body");if($htmlTag=t("html"),t("#bodyWrapper").length>0){i.log("IGM: replacing gallery modal"),t("#bodyWrapper").data("persist","true"),t("#bodyWrapper .closeModal").trigger("click"),$htmlTag.removeClass("overflow");var h=t("<div id='bodyWrapper' class='loadingArea'></div>");u.append(h)}else{i.log("IGM: setting up gallery modal");var h=t("<div id='bodyWrapper' class='loadingArea'></div>");u.append(h),u.addClass("galleryModal image-gallery"),this._loadCss(this.cssLoadPath,"galleryCSS")}if(this.$video.length)if(i.log("video is present. pause it for the gallery modal"),"videoPlayer"==this.$video.attr("data-component"))try{this.$video.videoPlayer("pause")}catch(t){i.log("Failed to pause video player.")}else i.warn("Video not ready"),this.$video.on("onVideoPlayerReady",function(t){"videoPlayer"==this.$video.attr("data-component")&&this.$video.videoPlayer("pause")});"image_gallery"==s.tracking.data.pageType&&(d.isHostGallery=!0),d._storeHostPageData();var c=window.location.search,p=/ab=.*&/,v=/ab=.*/;p.test(c)?c=c.replace(p,""):v.test(c)&&(c=c.replace(v,"")),t.ajax({url:this.url+c,dataType:"json",context:document.body}).done(function(h){i.log("Gallery loaded");var c=document.createElement("a");c.href=d.options.trackUrl;var p=c.pathname;n.resetTrackingData(h.trackingData,p),r.resetViewGuid(),a.trackPageLoad(t.extend(!0,h.trackingData,{viewguid:r.getViewGuid(),title:h.trackingData.photoGalleryTitle,_pageViewGuid:r.getViewGuid(),_topicPrimaryId:h.trackingData.topicId[0],_pageUrl:d.options.trackUrl,pageUrl:d.options.trackUrl,photoGalleryTitle:h.trackingData.photoGalleryTitle,photoGalleryId:h.trackingData.photoGalleryId,photoGalleryType:h.trackingData.articleType,pageName:""!=d.options.trackUrl?d.options.trackUrl:s.tracking.data._pageName,dwLinkTag:d.latestDwLinkTag}));var v=t(h.template);t("#bodyWrapper").append(v),t("#bodyWrapper").removeClass("loadingArea"),e.process(t("#bodyWrapper"));try{o.loadImproved({adData:h.adData}),i.log("test loadAds")}catch(t){i.log("adMgr.loadImproved() had trouble: ",t)}l.registerOnScroll("#bodyWrapper"),this.$close=t('[data-item="modal-close"]'),this.$close.on("click",function(){d._closeModal(u,h.trackingData)}),t("#bodyWrapper").on("click",function(t){t.target===this&&d._closeModal(u,h.trackingData)})}).fail(function(){u.removeClass("galleryModal"),t("#bodyWrapper").remove(),window.location=d.$element.attr("href")})},_closeModal:function(e,i){a.trackCustomEvent("trackCloseGallery",t.extend({},s.tracking.data,{_articleTitle:i.photoGalleryTitle,_articleId:i.photoGalleryId,_authorPrimaryName:i.articleAuthorName,_articleType:i.articleType,_pageType:i.pageType,siteSection:i.siteSection,siteEdition:i._siteEdition,_siteTypeDevice:i._siteTypeDevice,_siteHier:i.siteHier,_pageViewGuid:i._pageViewGuid,clickGenericText:"close-gallery"}),"trackClick");var o=document.createElement("a");o.href=this.hostUrl;var l=o.pathname;n.resetTrackingData(this.hostTracking,l),s.ads.data=this.hostAdData,window.history.replaceState&&window.history.replaceState(this.hostState,"",this.hostUrl),t('meta[property="og:image"]').attr("content",this.hostImage),t("title").text(this.hostTracking.data._pageTitle),r.resetViewGuid(this.hostGuid),this.isHostGallery||$htmlTag.removeClass("overflow"),"true"===t("#bodyWrapper").data("persist")?(t("#bodyWrapper").remove(),t("#bodyWrapper").data("persist",null)):(t("#bodyWrapper").remove(),e.removeClass("galleryModal image-gallery"),t(window).resize(),t(window).scrollTop(this.hostScrollTop))},_loadCss:function(e,i){var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("id",i),s.setAttribute("href",e),void 0!==s&&0==t("#"+i).length&&document.getElementsByTagName("head")[0].appendChild(s)},open:function(){this.cssLoadPath=this.options.cssPath,this._clickControl()}})}),define("fly/managers/history-2.0",["jquery","version!fly/utils/string-vars"],function(t,e){"use strict";var i=window.history,s=t(window),n,a=0,r,o="pushState"in i&&"replaceState"in i&&!(window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window),l=function(t,e){t=t||{},a+=1,this.id="history-"+a,this.title=t.title,this.route=t.route,this.originalTitle=document.title,e&&this.navigate(e,{replace:!0})};return l.prototype={constructor:l,navigate:function(s,n){if(!o)return!1;t.extend(!0,s,{historyId:this.id}),n=n||{};var a=n.title||this.title,r=n.url||this.route;a=e.compile(t.isFunction(a)?a(s):a,t.extend({title:this.originalTitle},s)),r=e.compile(t.isFunction(r)?r(s):r,s),i[n.replace?"replaceState":"pushState"](s,a,r),a&&(document.title=a)},stateChange:function(e){if(!o)return!1;var n=this;s.on("popstate."+this.id,function(){var s=i.state||{};s.historyId===n.id&&t.isFunction(e)&&e(s)})},stop:function(){if(!o)return!1;s.off("popstate."+this.id)}},{init:function(t,e){return new l(t,e)}}}),define("translations/load-more",["managers/edition"],function(t){var e={en:{loadMore:"Show More",page:"Page"},es:{page:"Pagina",loadMore:"Cargar más"}};return t.getTranslation(e)}),define("fly/components/load-more-1.0",["jquery","version!fly/utils/object-helper","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/managers/debug","version!fly/managers/history","version!fly/components/base","version!fly/components/loading"],function(t,e,i,s,n,a){var r=t.mobile?"vclick":"click",o=n.init("loadMore");t.widget("fly.loadMore",t.fly.base,{options:{url:null,data:{},responseKey:"loadMore",pushState:{enabled:!1,route:"./{page}",title:function(t){return"{title}"+(t.page>1?" - Page {page}":"")}},loader:{disabled:!1,initState:"idle",template:'<a class="{baseClass} {stateClass}"><span class="text">{text}</span></a>',classes:{base:"load-more"},text:{idle:"Load More"}}},isLoading:!1,id:null,data:{},loader:null,_create:function(){var t=this.options;this._setup(),this.id=this.$element.attr("id"),this.id||(this.id="uid-"+Math.floor(1e5*Math.random()),this.$element.attr("id",this.id)),this._setupLoader(),this._setupEvents(),t.pushState.enabled&&this._setupPushState()},_setupPushState:function(){var t=this,e=this.options;this.history=a.init(e.pushState),this._on({loadmoreloaded:function(e,i){var s=i.response||{},n=s.state||{};t.history.navigate(n,{replace:!0})}})},_setupEvents:function(){var t={};t[r+' [data-load="'+this.id+'"]']="_handleLoadClick",this._on(this.$document,t)},_setupLoader:function(){this.loader=t.fly.loading(this.options.loader),this.loader.$element.attr("data-load",this.id).insertAfter(this.$element)},_handleLoadClick:function(t){t.preventDefault(),this.isLoading||this.load()},load:function(){var e=this,i=this.options;this.isLoading||!1!==this._trigger("load")&&(o.log("load initiated ",{data:i.data,url:i.url}),this.isLoading=!0,this.loader.update("loading"),t.ajax({type:"GET",dataType:"json",url:i.url,data:i.data}).done(t.proxy(this._handleResponse,this)).fail(t.proxy(this._handleResponseFailure,this)))},_handleResponse:function(s){var n=this.options,a={};if(s=e.deepFind(s,n.responseKey)||{},!s.html)return void this._handleResponseFailure(s);o.log("response success: ",s),this.loader.update("idle"),this.$element.append(s.html),s.data&&(s.data=t.extend({},n.data,s.data),this._setOption("data",s.data)),this._trigger("loaded",null,{response:s}),i.toBool(s.hasMore)||(this.loader.update("end"),this.destroy()),this.isLoading=!1},_handleResponseFailure:function(t){o.log("response failure: ",t),this.loader.update("error"),this.destroy()},_destroy:function(){this.loader.destroy(),this.history&&this.history.stop()},_setOption:function(t,e){"data"===t&&this.$element.data("data",e),this._super(t,e)}})}),define("fly/components/load-more-scroll-1.0",["jquery","version!fly/components/load-more","version!fly/libs/jquery.throttle-debounce"],function(t){t.widget("fly.loadMoreScroll",t.fly.loadMore,{widgetEventPrefix:"loadMore",options:{disabled:!1,threshold:"300",loader:{initState:null,text:{loading:"Please Wait"}}},_create:function(){this._super("_create")},_setupEvents:function(){var e=this;t.support.touch?this._on(this.$document,{scrollstop:"_checkScroll"}):this._on(this.$document,{scroll:t.throttle(100,this._checkScroll)}),this._on({loadmorescrolloaded:this.loader.remove})},_checkScroll:function(){var t=this.options,e,i;t.disabled||this.isLoading||this.$element.is(":hidden")||(e=this.$window.scrollTop()+this.$window.height(),(i=this.$element.offset().top+this.$element.outerHeight())-e<t.threshold&&this.load())}})}),define("components/load-more",["jquery","managers/page-vars","version!fly/utils/object-helper","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/managers/debug","version!fly/managers/history","translations/load-more","version!fly/managers/components","managers/ad","managers/tealium","components/loading","version!libs/jquery/lazyload","version!fly/components/load-more-scroll"],function(t,e,i,s,n,a,r,o,l,d,u){var h=t.mobile?"vclick":"click",c=a.init("loadMore");t.widget("fly.loadMore",t.fly.loadMore,{options:{threshold:null,pushState:{currentPage:1,title:function(t){return"{title}"+(t.page>1?" - "+o.page+" {page}":"")},description:t('meta[name="description"]').attr("content")},loader:{classes:{loading:"loadingCircle"},text:{idle:o.loadMore}},selector:{appendContentTo:null,scrollContainer:null,loadMoreButtonLocation:null},loadMoreTrackingSection:null,trackThresholdLoad:!0,clickGenericText:"load-more",trackCustomEventName:"loadMore",appendClass:null},_handleResponse:function(n){var a=this.options,r={},o=i.deepFind(n,a.responseKey)||{};if(!o.html)return void this._handleResponseFailure(o);if(c.log("response success: ",o),this.loader.update("idle"),null!=this.options.selector.appendContentTo&&t(this.options.selector.appendContentTo).length>0?t(this.options.selector.appendContentTo).first().append(o.html):this.$element.append(o.html),o.data&&(o.data=t.extend({},a.data,o.data),this._setOption("data",o.data)),this._trigger("loaded",null,{response:o}),s.toBool(o.hasMore)||(this.loader.update("end"),this.destroy()),this.isLoading=!1,l.setConfig({includeContext:!1}),l.process(this.$element),l.setConfig({includeContext:!0}),this.options.data.lastAssetId=n.lastAssetId,this._lazyLoadImages(),a.trackThresholdLoad){var h={dwLinkTag:"load-more",siteSection:e.tracking.data.siteSection,
siteEdition:e.tracking.data.siteEdition,siteType:e.tracking.data.siteType,deviceType:e.tracking.data.deviceType,pageType:e.tracking.data.pageType,brand:e.tracking.data.brand,_articleType:e.tracking.data.articleType,_siteHier:e.tracking.data._siteHier,_pageNumber:e.tracking.data.pageNum,articleType:e.tracking.data.articleType};!1!==a.pushState.enabled?u.trackPageLoad(h):u.trackCustomEvent("load-more",h,"trackClick")}var p=o.adData||n.adData;p&&p.gpt&&(e.ads.data=t.extend(!0,p,{gpt:{targeting:e.ads.data.gpt.targeting,slotVars:e.ads.data.gpt.slotVars}}),d.loadImproved())},_create:function(){if(void 0===this.options.data.totalPages||this.options.pushState.currentPage<this.options.data.totalPages){!1!==this.options.pushState.enabled&&this.options.pushState.currentPage>1&&this._removePageFromTitleAndDescription(),this._super();var e=this;!1!==this.options.pushState.enabled&&this.options.pushState.currentPage>1&&(this._changeTitleForPage(this.options.pushState.currentPage),e._changeDescriptionForPage(this.options.pushState.currentPage)),null!=this.options.selector.appendContentTo&&null!=this.options.loadMoreTrackingSection&&t(this.options.selector.appendContentTo).first().attr("section",this.options.loadMoreTrackingSection)}else t("[data-load]").length>0&&t("[data-load]").remove()},_removePageFromTitleAndDescription:function(){var e=new RegExp("(.*) - "+o.page+" \\d+$","i"),i=document.title.match(e);if(null!==i&&2==i.length&&(document.title=i[1]),this.options.pushState.description){var s=this.options.pushState.description.match(e);null!==s&&2==s.length&&(this.options.pushState.description=s[1],t('meta[name="description"]').attr("content",this.options.pushState.description))}},_changeTitleForPage:function(t){document.title=document.title+" - "+o.page+" "+t},_changeDescriptionForPage:function(e){t('meta[name="description"]').attr("content",this.options.pushState.description+" - "+o.page+" "+e)},_changeLoaderHref:function(t){this.loader.$element.children("."+this.options.loader.classes.base).attr("href",t)},_setupLoader:function(){this.loader=t.cnet.loading(this.options.loader);var e="loadMoreButton";null!=this.options.appendClass&&(e=e+" "+this.options.appendClass),this.$element.next("[data-no-js]").remove();var i=this.$element;null!=this.options.selector.loadMoreButtonLocation&&t(this.options.selector.loadMoreButtonLocation).length>0&&(i=this.options.selector.loadMoreButtonLocation),this.loader.$element.attr({"data-load":this.id,class:e}).insertAfter(i),this._lazyLoadImages()},_setupEvents:function(){if(null===this.options.threshold){var e={};e[h+' [data-load="'+this.id+'"]']="_handleLoadClick",this._on(this.$document,e)}else{var i=null==this.options.selector.scrollContainer?this.$document:t(this.options.selector.scrollContainer);t.support.touch?this._on(i,{scrollstop:"_checkScroll"}):this._on(i,{scroll:t.throttle(100,this._checkScroll)}),this._on({loadmorescrolloaded:this.loader.remove})}},load:function(){this.options.data&&this.options.data.url&&(this.options.url=this.options.data.url,this.options.data=window.location.search.replace(/^\?/,"")),this._super()},_checkScroll:function(){var e=this.options,i,s;if(!(e.disabled||this.isLoading||this.$element.is(":hidden"))){var n=e.selector.scrollContainer;i=null!==n&&t(n).length>0?t(n).offset().top+t(n).outerHeight():this.$window.scrollTop()+this.$window.height();var a=e.selector.appendContentTo;(s=null!==a&&t(a).length>0?t(a).offset().top+t(a).outerHeight():this.$element.offset().top+this.$element.outerHeight())-i<e.threshold&&(c.log("Load more event"),this.load())}},_destroy:function(){this.loader.destroy(),this.loader.$element.remove(),this.history&&this.history.stop()},_lazyLoadImages:function(){c.log("lazyLoadImages"),this.$element.find("img.lazy").lazyload({failure_limit:2e3,skip_invisible:!1,threshold:200}).removeClass("lazy")}})}),define("components/selfish-scroll",["jquery","version!fly/managers/debug","version!fly/components/base"],function(t,e){e=e.init("selfishScroll"),t.widget("cnet.selfishScroll",t.fly.base,{options:{threshold:5},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var t=this;this.$element.on("wheel",function(e){var i=e.currentTarget,s=e.originalEvent.deltaY<=0&&Math.floor(i.scrollTop)<=t.options.threshold,n=e.originalEvent.deltaY>=0&&Math.ceil(i.scrollTop+i.clientHeight)>=i.scrollHeight-t.options.threshold;(s||n)&&e.preventDefault()})}})}),function(t){t.fn.iframeTracker=function(e){var i=this.get();if(null===e||!1===e)t.iframeTracker.untrack(i);else{if("object"!=typeof e)throw new Error("Wrong handler type (must be an object, or null|false to untrack)");t.iframeTracker.track(i,e)}},t.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{1==t.browser.msie&&t.browser.version<9&&(this.isIE8AndOlder=!0)}catch(t){try{var e=navigator.userAgent.match(/(msie) ([\w.]+)/i);e[2]<9&&(this.isIE8AndOlder=!0)}catch(t){}}if(t(window).focus(),t(window).blur(function(e){t.iframeTracker.windowLoseFocus(e)}),t("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;" aria-hidden="true"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>'),this.focusRetriever=t("#focus_retriever"),this.focusRetrieved=!1,t(document).mousemove(function(e){document.activeElement&&"IFRAME"==document.activeElement.tagName&&(t.iframeTracker.focusRetriever.focus(),t.iframeTracker.focusRetrieved=!0)}),this.isIE8AndOlder){this.focusRetriever.blur(function(e){e.stopPropagation(),e.preventDefault(),t.iframeTracker.windowLoseFocus(e)}),t("body").click(function(e){t(window).focus()}),t("form").click(function(t){t.stopPropagation()});try{t("body").on("click","form",function(t){t.stopPropagation()})}catch(t){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+t.message+")")}}},track:function(e,i){i.target=e,t.iframeTracker.handlersList.push(i),t(e).bind("mouseover",{handler:i},t.iframeTracker.mouseoverListener).bind("mouseout",{handler:i},t.iframeTracker.mouseoutListener)},untrack:function(e){if("function"!=typeof Array.prototype.filter)return void console.log("Your browser doesn't support Array filter, untrack disabled");t(e).each(function(e){t(this).unbind("mouseover",t.iframeTracker.mouseoverListener).unbind("mouseout",t.iframeTracker.mouseoutListener)});var i=function(t){return null!==t};for(var s in this.handlersList){for(var n in this.handlersList[s].target)-1!==t.inArray(this.handlersList[s].target[n],e)&&(this.handlersList[s].target[n]=null);this.handlersList[s].target=this.handlersList[s].target.filter(i),0==this.handlersList[s].target.length&&(this.handlersList[s]=null)}this.handlersList=this.handlersList.filter(i)},mouseoverListener:function(t){t.data.handler.over=!0;try{t.data.handler.overCallback(this)}catch(t){}},mouseoutListener:function(e){e.data.handler.over=!1,t.iframeTracker.focusRetriever.focus();try{e.data.handler.outCallback(this)}catch(t){}},windowLoseFocus:function(t){for(var e in this.handlersList)if(1==this.handlersList[e].over)try{this.handlersList[e].blurCallback()}catch(t){}}},t(document).ready(function(){t.iframeTracker.init()})}(jQuery),define("libs/jquery/iframetracker-1.1.0",function(){}),define("components/iframe-ad-tracker",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!libs/jquery/iframetracker","version!fly/components/base"],function(t,e,i,s,n){e=e.init("iframeAdTracker"),t.widget("cnet.iframeAdTracker",t.fly.base,{options:{},_baseTrackingData:{_pageTitle:s.tracking.data._pageTitle,siteSection:s.tracking.data.siteSection,pageType:s.tracking.data.pageType,siteEdition:s.tracking.data.siteEdition,siteType:s.tracking.data.siteType,siteHier:s.tracking.data.siteHier,brand:s.tracking.data.brand,_pageChannelType:s.tracking.data._pageChannelType},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var s=this;s.$element.find("iframe").iframeTracker({blurCallback:function(n){e.log("iframe click: ",this._overId),i.trackCustomEvent("adClick",t.extend({},s._baseTrackingData,{dwLinkTag:this._overId,clickGenericText:this._overId}),"trackClick")},overCallback:function(e){this._overId=t(e).parents("[data-ad]").attr("data-ad")},outCallback:function(t){this._overId=null},_overId:null})}})}),define("components/leads-tracker",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(t,e,i,s){e=e.init("leadsTracker"),t.widget("cnet.leadsTracker",t.fly.base,{options:{appendViewguid:!0,fireTrackingPing:!0,numNodes:3,trackingData:{},dwLinktag:null},viewguid:null,_create:function(){this._setup(),this.viewguid=s.guid,this.options.appendViewguid&&this.viewguid&&this.$element.attr("href",this.$element.attr("href").replace("___VIEW_GUID___",this.viewguid)),this.options.fireTrackingPing&&this._setupEvents()},_setupEvents:function(){var n=this,a={pdguid:"productId",assetguid:"articleId",assettitle:"articleTitle",ttag:"qp.ttag",topicguid:"_topicPrimaryId",promoHed:"productName"};this.$element.on("click",function(r){try{var o=n.options.trackingData?n.options.trackingData:n.options,l={_topicPrimaryId:o.topic?o.topic:"",articleType:s.tracking.data.articleType?s.tracking.data.articleType:"deal",articleId:o.articleId?o.articleId:o.assetguid,_campaign:o.ttag?"ttag:"+o.ttag:null,_leadcpc:o.leadcpc,dwLinkTag:o.dwLinkTag||i.getDwTag(t(r.target),n.options.numNodes)},d=this.href.split("?"),u=d.length>1?d[1].split("&"):{};t.each(u,function(t,e){var i="string"==typeof e?e.split("="):e,s=a[i[0]]||i[0];l[s]=i[1]});var h=t.extend(l,o);i.trackLead(h)}catch(t){e.log("Unable to parse tracking url",t)}})}})}),define("components/module-asset-tracker",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","managers/waypoints","version!libs/waypoints/inview","version!fly/components/base"],function(t,e,i,s,n){var a=e.init("moduleAssetTracker");n.init(),t.widget("cnet.moduleAssetTracker",t.fly.base,{options:{assetSelector:"[data-tracking]",tagSelector:"[class|='tag']"},_baseTrackingData:{_pageTitle:s.tracking.data._pageTitle,siteSection:s.tracking.data.siteSection,pageType:s.tracking.data.pageType,siteEdition:s.tracking.data.siteEdition,siteType:s.tracking.data.siteType,siteHier:s.tracking.data.siteHier,brand:s.tracking.data.brand,_pageChannelType:s.tracking.data._pageChannelType},_moduleName:"",_create:function(){this._setup(),this._moduleName=this.$element.attr("section"),this._setupEvents()},_setupEvents:function(){var e=this;e.$element.find(e.options.assetSelector).each(function(){"use strict";new Waypoint.Inview({element:t(this),entered:function(){var s=e._moduleName+"|"+t(this.element).attr("section");a.log(s);var n=t.extend({},e._baseTrackingData,{clickGenericText:s});i.trackCustomEvent("trackAssetView",n,"assetView"),this.destroy()},exit:function(){this.destroy()}})})}})}),define("components/track-download",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(t,e,i,s){e=e.init("trackDownload"),t.widget("cnet.trackDownload",t.fly.base,{options:{},_create:function(){this._super(),this.$element.on("click",function(){i.trackCustomEvent("trackDownload",{clickGenericText:"HeadertoDL",_siteSection:s.tracking.data.siteSection,siteEdition:s.tracking.data.siteEdition,_siteTypeDevice:s.tracking.data.deviceType,_pageType:s.tracking.data.pageType},"trackClick")})}})}),define("components/social-tracking",["jquery","version!fly/managers/debug","managers/tealium","version!fly/components/base"],function(t,e,i){e=e.init("socialTracking"),t.widget("cnet.socialTracking",t.fly.base,{options:{socialSite:"notSet"},_create:function(){this._setup(),this._setupTracking()},_setupTracking:function(){e.log("Setting up social tracking");var s=this.options,n=this;t(this.$element).on("click",function(n){e.log("Social Element Clicked, Tracking Now");var a=s.socialSite,r={facebooksend:1,facebook:2,googlePlus:3,linkedin:21,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,email:10,delicious:12,tumblr:14},o=i.getDwTag(t(n.target));i.trackSocial({socialService:a,event:"share",eventt:"socialsite",socialId:r[a],wd:"sharelink",dwLinkTag:o,sharebarSection:o}),e.log("Social Element Tracked")})}})}),define("translations/video",["managers/edition"],function(t){var e={en:{resume:"Your video will resume in ",resumeShortly:"Your video will resume shortly",seconds:" seconds",adBlock:{title:"Sorry about that",message:"It looks like you're using an ad blocker. We know you don't love ads. But they allow us to pay the writers, editors and producers who work to make your favorite CNET videos. To watch this video, please disable your ad blocker and refresh the page. Thanks for tuning in. You're the best."},firefoxUpgrade:{title:"Your version of Firefox is no longer supported.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Click here to download the latest version.</a>'},videoNotAvailable:{title:"We're sorry, but this video is no longer available.",message:"Please watch this next video instead."},upnext:"up next",autoplay:"Autoplay",on:"on",off:"off",cannotPlay:"This device is unable to play the requested video.",by:"by",playSound:"Play Sound"},es:{resume:"El vídeo se reanudará en ",resumeShortly:"El vídeo se reanudará en breve",seconds:" segundos",adBlock:{title:"Lo sentimos",message:"Parece que estás usando un software para bloquear anuncios. Sabemos que a mucha gente no lo encantan los anuncios, pero nos ayudan a pagarle a nuestro equipo de profesionales que hacen tus videos favoritos. Para ver este video, por favor desactiva el software y vuelve a cargar la página. ¡Mil gracias!"},firefoxUpgrade:{title:"La versión de Firefox que usas no está actualizada.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Por favor descarga la versión más reciente.</a>'},videoNotAvailable:{title:"Lo sentimos, pero este video ya no está disponible.",message:"Por favor, vea el siguiente video en su lugar."},upnext:"Siguiente",autoplay:"Autoplay",on:"Sí",off:"No",cannotPlay:"Este dispositivo no puede reproducir el video solicitado.",by:"por",playSound:"¿Reproducir sonido?"}};return t.getTranslation(e)}),define("managers/events",["jquery","version!fly/managers/debug"],function(t,e){e=e.init("events");var i={};return{publish:function(t,e){for(var s=0;s<t.length;s++)if(i[t[s]]&&i[t[s]][e])for(var n=0;n<i[t[s]][e].length;n++)i[t[s]][e][n]()},subscribe:function(t,e){for(var s in e)if(e.hasOwnProperty(s)){i[s]=i[s]||{};for(var n in e[s])e[s].hasOwnProperty(n)&&(i[s][n]=i[s][n]||[],i[s][n].push(t[e[s][n]].bind(t)))}}}}),function(){var t,e;(function(){function e(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function i(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}function s(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(!e(t[i],i,t))return!1;return!0}function n(t,e){for(var i=-1,s=null==t?0:t.length,n=0,a=[];++i<s;){var r=t[i];e(r,i,t)&&(a[n++]=r)}return a}function a(t,e){return!!(null==t?0:t.length)&&p(t,e,0)>-1}function r(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}function o(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}function l(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}function d(t,e,i,s){var n=-1,a=null==t?0:t.length;for(s&&a&&(i=t[++n]);++n<a;)i=e(i,t[n],n,t);return i}function u(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}function h(t){return t.split("")}function c(t,e,i,s){for(var n=t.length,a=i+(s?1:-1);s?a--:++a<n;)if(e(t[a],a,t))return a;return-1}function p(t,e,i){return e===e?L(t,e,i):c(t,g,i)}function v(t,e,i,s){for(var n=i-1,a=t.length;++n<a;)if(s(t[n],e))return n;return-1}function g(t){return t!==t}function f(t){return function(e){return null==e?Xs:e[t]}}function m(t){return function(e){return null==t?Xs:t[e]}}function _(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}function E(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}function A(t){return function(e){return t(e)}}function y(t,e){return o(e,function(e){return t[e]})}function S(t,e){return t.has(e)}function b(t,e){for(var i=t.length,s=0;i--;)t[i]===e&&++s;return s}function T(t){return"\\"+ar[t]}function C(t,e){return null==t?Xs:t[e]}function D(t){return tr.test(t)}function I(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}function R(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}function P(t,e){return function(i){return t(e(i))}}function M(t,e){for(var i=-1,s=t.length,n=0,a=[];++i<s;){var r=t[i];r!==e&&r!==sn||(t[i]=sn,a[n++]=i)}return a}function O(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function L(t,e,i){for(var s=i-1,n=t.length;++s<n;)if(t[s]===e)return s;return-1}function k(t){return D(t)?N(t):Er(t)}function w(t){return D(t)?U(t):h(t)}function N(t){for(var e=Za.lastIndex=0;Za.test(t);)++e;return e}function U(t){return t.match(Za)||[]}function B(t){if(hs(t)&&!No(t)&&!(t instanceof G)){if(t instanceof F)return t;if(Dr.call(t,"__wrapped__"))return Di(t)}return new F(t)}function j(){}function F(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=Xs}function G(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Rn,this.__views__=[]}function V(){var t=new G(this.__wrapped__);return t.__actions__=Te(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Te(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Te(this.__views__),t}function x(){if(this.__filtered__){var t=new G(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function H(){var t=this.__wrapped__.value(),e=this.__dir__,i=No(t),s=e<0,n=i?t.length:0,a=Je(0,n,this.__views__),r=a.start,o=a.end,l=o-r,d=s?o:r-1,u=this.__iteratees__,h=u.length,c=0,p=Xr(l,this.__takeCount__);if(!i||!s&&n==l&&p==l)return he(t,this.__actions__);var v=[];t:for(;l--&&c<p;){d+=e;for(var g=-1,f=t[d];++g<h;){var m=u[g],_=m.iteratee,E=m.type,A=_(f);if(E==Sn)f=A;else if(!A){if(E==yn)continue t;break t}}v[c++]=f}return v}function K(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function q(){this.__data__=no?no(null):{},this.size=0}function W(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Y(t){var e=this.__data__;if(no){var i=e[t];return i===tn?Xs:i}return Dr.call(e,t)?e[t]:Xs}function z(t){var e=this.__data__;return no?e[t]!==Xs:Dr.call(e,t)}function $(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=no&&e===Xs?tn:e,this}function X(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function Q(){this.__data__=[],this.size=0}function J(t){var e=this.__data__,i=Et(e,t);return!(i<0||(i==e.length-1?e.pop():Fr.call(e,i,1),--this.size,0))}function Z(t){var e=this.__data__,i=Et(e,t);return i<0?Xs:e[i][1]}function tt(t){return Et(this.__data__,t)>-1}function et(t,e){var i=this.__data__,s=Et(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this}function it(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function st(){this.size=0,this.__data__={hash:new K,map:new(to||X),string:new K}}function nt(t){var e=ze(this,t).delete(t);return this.size-=e?1:0,e}function at(t){return ze(this,t).get(t)}function rt(t){return ze(this,t).has(t)}function ot(t,e){var i=ze(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this}function lt(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new it;++e<i;)this.add(t[e])}function dt(t){return this.__data__.set(t,tn),this}function ut(t){return this.__data__.has(t)}function ht(t){var e=this.__data__=new X(t);this.size=e.size}function ct(){this.__data__=new X,this.size=0}function pt(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function vt(t){return this.__data__.get(t)}function gt(t){return this.__data__.has(t)}function ft(t,e){var i=this.__data__;if(i instanceof X){var s=i.__data__;if(!to||s.length<Js-1)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new it(s)}return i.set(t,e),this.size=i.size,this}function mt(t,e){var i=No(t),s=!i&&wo(t),n=!i&&!s&&Uo(t),a=!i&&!s&&!n&&Go(t),r=i||s||n||a,o=r?E(t.length,String):[],l=o.length;for(var d in t)!e&&!Dr.call(t,d)||r&&("length"==d||n&&("offset"==d||"parent"==d)||a&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||ri(d,l))||o.push(d);return o}function _t(t,e,i){var s=t[e];Dr.call(t,e)&&is(s,i)&&(i!==Xs||e in t)||St(t,e,i)}function Et(t,e){for(var i=t.length;i--;)if(is(t[i][0],e))return i;return-1}function At(t,e){return t&&Ce(e,Rs(e),t)}function yt(t,e){return t&&Ce(e,Ps(e),t)}function St(t,e,i){"__proto__"==e&&Hr?Hr(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function bt(t,e){for(var i=-1,s=e.length,n=Array(s),a=null==t;++i<s;)n[i]=a?Xs:Cs(t,e[i]);return n}function Tt(t,e,i){return t===t&&(i!==Xs&&(t=t<=i?t:i),e!==Xs&&(t=t>=e?t:e)),t}function Ct(t,e,s,n,a,r){var o,l=e&nn,d=e&an,u=e&rn;if(s&&(o=a?s(t,n,a,r):s(t)),o!==Xs)return o;if(!us(t))return t;var h=No(t);if(h){if(o=ei(t),!l)return Te(t,o)}else{var c=To(t),p=c==Bn||c==jn;if(Uo(t))return ve(t,l);if(c==xn||c==Mn||p&&!a){if(o=d||p?{}:ii(t),!l)return d?Ie(t,yt(o,t)):De(t,At(o,t))}else{if(!sr[c])return a?t:{};o=si(t,c,l)}}r||(r=new ht);var v=r.get(t);if(v)return v;if(r.set(t,o),Fo(t))return t.forEach(function(i){o.add(Ct(i,e,s,i,t,r))}),o;if(jo(t))return t.forEach(function(i,n){o.set(n,Ct(i,e,s,n,t,r))}),o;var g=u?d?Ke:He:d?Ps:Rs,f=h?Xs:g(t);return i(f||t,function(i,n){f&&(n=i,i=t[n]),_t(o,n,Ct(i,e,s,n,t,r))}),o}function Dt(t,e,i,s){var n=-1,l=a,d=!0,u=t.length,h=[],c=e.length;if(!u)return h;i&&(e=o(e,A(i))),s?(l=r,d=!1):e.length>=Js&&(l=S,d=!1,e=new lt(e));t:for(;++n<u;){var p=t[n],v=null==i?p:i(p);if(p=s||0!==p?p:0,d&&v===v){for(var g=c;g--;)if(e[g]===v)continue t;h.push(p)}else l(e,v,s)||h.push(p)}return h}function It(t,e){var i=!0;return mo(t,function(t,s,n){return i=!!e(t,s,n)}),i}function Rt(t,e,i){for(var s=-1,n=t.length;++s<n;){var a=t[s],r=e(a);if(null!=r&&(o===Xs?r===r&&!ms(r):i(r,o)))var o=r,l=a}return l}function Pt(t,e,i,s,n){var a=-1,r=t.length;for(i||(i=ai),n||(n=[]);++a<r;){var o=t[a];e>0&&i(o)?e>1?Pt(o,e-1,i,s,n):l(n,o):s||(n[n.length]=o)}return n}function Mt(t,e){return t&&_o(t,e,Rs)}function Ot(t,e){return n(e,function(e){return ls(t[e])})}function Lt(t,e){e=ce(e,t);for(var i=0,s=e.length;null!=t&&i<s;)t=t[bi(e[i++])];return i&&i==s?t:Xs}function kt(t,e,i){var s=e(t);return No(t)?s:l(s,i(t))}function wt(t){return null==t?t===Xs?$n:Vn:xr&&xr in Object(t)?Qe(t):mi(t)}function Nt(t,e){return null!=t&&Dr.call(t,e)}function Ut(t,e){return null!=t&&e in Object(t)}function Bt(t,e,i){return t>=Xr(e,i)&&t<$r(e,i)}function jt(t,i,s){i=ce(i,t),t=Ei(t,i);var n=null==t?t:t[bi(Li(i))];return null==n?Xs:e(n,t,s)}function Ft(t){return hs(t)&&wt(t)==Mn}function Gt(t){return hs(t)&&wt(t)==wn}function Vt(t,e,i,s,n){return t===e||(null==t||null==e||!hs(t)&&!hs(e)?t!==t&&e!==e:xt(t,e,i,s,Vt,n))}function xt(t,e,i,s,n,a){var r=No(t),o=No(e),l=r?On:To(t),d=o?On:To(e);l=l==Mn?xn:l,d=d==Mn?xn:d;var u=l==xn,h=d==xn,c=l==d;if(c&&Uo(t)){if(!Uo(e))return!1;r=!0,u=!1}if(c&&!u)return a||(a=new ht),r||Go(t)?Fe(t,e,i,s,n,a):Ge(t,e,l,i,s,n,a);if(!(i&on)){var p=u&&Dr.call(t,"__wrapped__"),v=h&&Dr.call(e,"__wrapped__");if(p||v){var g=p?t.value():t,f=v?e.value():e;return a||(a=new ht),n(g,f,i,s,a)}}return!!c&&(a||(a=new ht),Ve(t,e,i,s,n,a))}function Ht(t){return hs(t)&&To(t)==Fn}function Kt(t,e,i,s){var n=i.length,a=n,r=!s;if(null==t)return!a;for(t=Object(t);n--;){var o=i[n];if(r&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<a;){o=i[n];var l=o[0],d=t[l],u=o[1];if(r&&o[2]){if(d===Xs&&!(l in t))return!1}else{var h=new ht;if(s)var c=s(d,u,l,t,e,h);if(!(c===Xs?Vt(u,d,on|ln,s,h):c))return!1}}return!0}function qt(t){return!(!us(t)||hi(t))&&(ls(t)?Or:Pa).test(Ti(t))}function Wt(t){return hs(t)&&To(t)==Wn}function Yt(t){return hs(t)&&ds(t.length)&&!!ir[wt(t)]}function zt(t){return"function"==typeof t?t:null==t?Vs:"object"==typeof t?No(t)?te(t[0],t[1]):Zt(t):Ws(t)}function $t(t){if(!ci(t))return zr(t);var e=[];for(var i in Object(t))Dr.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Xt(t){if(!us(t))return fi(t);var e=ci(t),i=[];for(var s in t)("constructor"!=s||!e&&Dr.call(t,s))&&i.push(s);return i}function Qt(t,e){return t<e}function Jt(t,e){var i=-1,s=ss(t)?Array(t.length):[];return mo(t,function(t,n,a){s[++i]=e(t,n,a)}),s}function Zt(t){var e=$e(t);return 1==e.length&&e[0][2]?vi(e[0][0],e[0][1]):function(i){return i===t||Kt(i,t,e)}}function te(t,e){return li(t)&&pi(e)?vi(bi(t),e):function(i){var s=Cs(i,t);return s===Xs&&s===e?Is(i,t):Vt(e,s,on|ln)}}function ee(t,e,i){var s=-1;return e=o(e.length?e:[Vs],A(Ye())),_(Jt(t,function(t,i,n){return{criteria:o(e,function(e){return e(t)}),index:++s,value:t}}),function(t,e){return ye(t,e,i)})}function ie(t,e,i){for(var s=-1,n=e.length,a={};++s<n;){var r=e[s],o=Lt(t,r);i(o,r)&&oe(a,ce(r,t),o)}return a}function se(t){return function(e){return Lt(e,t)}}function ne(t,e,i,s){var n=s?v:p,a=-1,r=e.length,l=t;for(t===e&&(e=Te(e)),i&&(l=o(t,A(i)));++a<r;)for(var d=0,u=e[a],h=i?i(u):u;(d=n(l,h,d,s))>-1;)l!==t&&Fr.call(l,d,1),Fr.call(t,d,1);return t}function ae(t,e){var i="";if(!t||e<1||e>Cn)return i;do{e%2&&(i+=t),(e=qr(e/2))&&(t+=t)}while(e);return i}function re(t,e){return Do(_i(t,e,Vs),t+"")}function oe(t,e,i,s){if(!us(t))return t;e=ce(e,t);for(var n=-1,a=e.length,r=a-1,o=t;null!=o&&++n<a;){var l=bi(e[n]),d=i;if(n!=r){var u=o[l];(d=s?s(u,l,o):Xs)===Xs&&(d=us(u)?u:ri(e[n+1])?[]:{})}_t(o,l,d),o=o[l]}return t}function le(t,e,i){var s=-1,n=t.length;e<0&&(e=-e>n?0:n+e),i=i>n?n:i,i<0&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var a=Array(n);++s<n;)a[s]=t[s+e];return a}function de(t,e){var i;return mo(t,function(t,s,n){return!(i=e(t,s,n))}),!!i}function ue(t){if("string"==typeof t)return t;if(No(t))return o(t,ue)+"";if(ms(t))return go?go.call(t):"";var e=t+"";return"0"==e&&1/t==-Tn?"-0":e}function he(t,e){var i=t;return i instanceof G&&(i=i.value()),d(e,function(t,e){return e.func.apply(e.thisArg,l([t],e.args))},i)}function ce(t,e){return No(t)?t:li(t,e)?[t]:Io(bs(t))}function pe(t,e,i){var s=t.length;return i=i===Xs?s:i,!e&&i>=s?t:le(t,e,i)}function ve(t,e){if(e)return t.slice();var i=t.length,s=Nr?Nr(i):new t.constructor(i);return t.copy(s),s}function ge(t){var e=new t.constructor(t.byteLength);return new wr(e).set(new wr(t)),e}function fe(t,e){var i=e?ge(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function me(t){var e=new t.constructor(t.source,Da.exec(t));return e.lastIndex=t.lastIndex,e}function _e(t){return vo?Object(vo.call(t)):{}}function Ee(t,e){var i=e?ge(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function Ae(t,e){if(t!==e){var i=t!==Xs,s=null===t,n=t===t,a=ms(t),r=e!==Xs,o=null===e,l=e===e,d=ms(e);if(!o&&!d&&!a&&t>e||a&&r&&l&&!o&&!d||s&&r&&l||!i&&l||!n)return 1;if(!s&&!a&&!d&&t<e||d&&i&&n&&!s&&!a||o&&i&&n||!r&&n||!l)return-1}return 0}function ye(t,e,i){for(var s=-1,n=t.criteria,a=e.criteria,r=n.length,o=i.length;++s<r;){var l=Ae(n[s],a[s]);if(l)return s>=o?l:l*("desc"==i[s]?-1:1)}return t.index-e.index}function Se(t,e,i,s){for(var n=-1,a=t.length,r=i.length,o=-1,l=e.length,d=$r(a-r,0),u=Array(l+d),h=!s;++o<l;)u[o]=e[o];for(;++n<r;)(h||n<a)&&(u[i[n]]=t[n]);for(;d--;)u[o++]=t[n++];return u}function be(t,e,i,s){for(var n=-1,a=t.length,r=-1,o=i.length,l=-1,d=e.length,u=$r(a-o,0),h=Array(u+d),c=!s;++n<u;)h[n]=t[n];for(var p=n;++l<d;)h[p+l]=e[l];for(;++r<o;)(c||n<a)&&(h[p+i[r]]=t[n++]);return h}function Te(t,e){var i=-1,s=t.length;for(e||(e=Array(s));++i<s;)e[i]=t[i];return e}function Ce(t,e,i,s){var n=!i;i||(i={});for(var a=-1,r=e.length;++a<r;){var o=e[a],l=s?s(i[o],t[o],o,i,t):Xs;l===Xs&&(l=t[o]),n?St(i,o,l):_t(i,o,l)}return i}function De(t,e){return Ce(t,So(t),e)}function Ie(t,e){return Ce(t,bo(t),e)}function Re(t){return re(function(e,i){var s=-1,n=i.length,a=n>1?i[n-1]:Xs,r=n>2?i[2]:Xs;for(a=t.length>3&&"function"==typeof a?(n--,a):Xs,r&&oi(i[0],i[1],r)&&(a=n<3?Xs:a,n=1),e=Object(e);++s<n;){var o=i[s];o&&t(e,o,s,a)}return e})}function Pe(t,e){return function(i,s){if(null==i)return i;if(!ss(i))return t(i,s);for(var n=i.length,a=e?n:-1,r=Object(i);(e?a--:++a<n)&&!1!==s(r[a],a,r););return i}}function Me(t){return function(e,i,s){for(var n=-1,a=Object(e),r=s(e),o=r.length;o--;){var l=r[t?o:++n];if(!1===i(a[l],l,a))break}return e}}function Oe(t){return function(e){e=bs(e);var i=D(e)?w(e):Xs,s=i?i[0]:e.charAt(0),n=i?pe(i,1).join(""):e.slice(1);return s[t]()+n}}function Le(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=fo(t.prototype),s=t.apply(i,e);return us(s)?s:i}}function ke(t){return function(e,i,s){var n=Object(e);if(!ss(e)){var a=Ye(i,3);e=Rs(e),i=function(t){return a(n[t],t,n)}}var r=t(e,i,s);return r>-1?n[a?e[r]:r]:Xs}}function we(t,e,i,s,n,a,r,o,l,d){function u(){for(var m=arguments.length,_=Array(m),E=m;E--;)_[E]=arguments[E];if(v)var A=We(u),y=b(_,A);if(s&&(_=Se(_,s,n,v)),a&&(_=be(_,a,r,v)),m-=y,v&&m<d){var S=M(_,A);return Ue(t,e,we,u.placeholder,i,_,S,o,l,d-m)}var T=c?i:this,C=p?T[t]:t;return m=_.length,o?_=Ai(_,o):g&&m>1&&_.reverse(),h&&l<m&&(_.length=l),this&&this!==dr&&this instanceof u&&(C=f||Le(C)),C.apply(T,_)}var h=e&fn,c=e&dn,p=e&un,v=e&(cn|pn),g=e&_n,f=p?Xs:Le(t);return u}function Ne(t,e){e=e===Xs?" ":ue(e);var i=e.length;if(i<2)return i?ae(e,t):e;var s=ae(e,Kr(t/k(e)));return D(e)?pe(w(s),0,t).join(""):s.slice(0,t)}function Ue(t,e,i,s,n,a,r,o,l,d){var u=e&cn,h=u?r:Xs,c=u?Xs:r,p=u?a:Xs,v=u?Xs:a;e|=u?vn:gn,(e&=~(u?gn:vn))&hn||(e&=~(dn|un));var g=[t,e,n,p,h,v,c,o,l,d],f=i.apply(Xs,g);return ui(t)&&Co(f,g),f.placeholder=s,yi(f,t,e)}function Be(t){var e=Math[t];return function(t,i){if(t=Ss(t),i=null==i?0:Xr(ys(i),292)){var s=(bs(t)+"e").split("e");return s=(bs(e(s[0]+"e"+(+s[1]+i)))+"e").split("e"),+(s[0]+"e"+(+s[1]-i))}return e(t)}}function je(t,e,i,s){return t===Xs||is(t,br[i])&&!Dr.call(s,i)?e:t}function Fe(t,e,i,s,n,a){var r=i&on,o=t.length,l=e.length;if(o!=l&&!(r&&l>o))return!1;var d=a.get(t);if(d&&a.get(e))return d==e;var h=-1,c=!0,p=i&ln?new lt:Xs;for(a.set(t,e),a.set(e,t);++h<o;){var v=t[h],g=e[h];if(s)var f=r?s(g,v,h,e,t,a):s(v,g,h,t,e,a);if(f!==Xs){if(f)continue;c=!1;break}if(p){if(!u(e,function(t,e){if(!S(p,e)&&(v===t||n(v,t,i,s,a)))return p.push(e)})){c=!1;break}}else if(v!==g&&!n(v,g,i,s,a)){c=!1;break}}return a.delete(t),a.delete(e),c}function Ge(t,e,i,s,n,a,r){switch(i){case Jn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Qn:return!(t.byteLength!=e.byteLength||!a(new wr(t),new wr(e)));case kn:case wn:case Gn:return is(+t,+e);case Un:return t.name==e.name&&t.message==e.message;case qn:case Yn:return t==e+"";case Fn:var o=R;case Wn:var l=s&on;if(o||(o=O),t.size!=e.size&&!l)return!1;var d=r.get(t);if(d)return d==e;s|=ln,r.set(t,e);var u=Fe(o(t),o(e),s,n,a,r);return r.delete(t),u;case zn:if(vo)return vo.call(t)==vo.call(e)}return!1}function Ve(t,e,i,s,n,a){var r=i&on,o=He(t),l=o.length;if(l!=He(e).length&&!r)return!1;for(var d=l;d--;){var u=o[d];if(!(r?u in e:Dr.call(e,u)))return!1}var h=a.get(t);if(h&&a.get(e))return h==e;var c=!0;a.set(t,e),a.set(e,t);for(var p=r;++d<l;){u=o[d];var v=t[u],g=e[u];if(s)var f=r?s(g,v,u,e,t,a):s(v,g,u,t,e,a);if(!(f===Xs?v===g||n(v,g,i,s,a):f)){c=!1;break}p||(p="constructor"==u)}if(c&&!p){
var m=t.constructor,_=e.constructor;m!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof _&&_ instanceof _)&&(c=!1)}return a.delete(t),a.delete(e),c}function xe(t){return Do(_i(t,Xs,Mi),t+"")}function He(t){return kt(t,Rs,So)}function Ke(t){return kt(t,Ps,bo)}function qe(t){for(var e=t.name+"",i=ro[e],s=Dr.call(ro,e)?i.length:0;s--;){var n=i[s],a=n.func;if(null==a||a==t)return n.name}return e}function We(t){return(Dr.call(B,"placeholder")?B:t).placeholder}function Ye(){var t=B.iteratee||xs;return t=t===xs?zt:t,arguments.length?t(arguments[0],arguments[1]):t}function ze(t,e){var i=t.__data__;return di(e)?i["string"==typeof e?"string":"hash"]:i.map}function $e(t){for(var e=Rs(t),i=e.length;i--;){var s=e[i],n=t[s];e[i]=[s,n,pi(n)]}return e}function Xe(t,e){var i=C(t,e);return qt(i)?i:Xs}function Qe(t){var e=Dr.call(t,xr),i=t[xr];try{t[xr]=Xs;var s=!0}catch(t){}var n=Rr.call(t);return s&&(e?t[xr]=i:delete t[xr]),n}function Je(t,e,i){for(var s=-1,n=i.length;++s<n;){var a=i[s],r=a.size;switch(a.type){case"drop":t+=r;break;case"dropRight":e-=r;break;case"take":e=Xr(e,t+r);break;case"takeRight":t=$r(t,e-r)}}return{start:t,end:e}}function Ze(t){var e=t.match(Sa);return e?e[1].split(ba):[]}function ti(t,e,i){e=ce(e,t);for(var s=-1,n=e.length,a=!1;++s<n;){var r=bi(e[s]);if(!(a=null!=t&&i(t,r)))break;t=t[r]}return a||++s!=n?a:!!(n=null==t?0:t.length)&&ds(n)&&ri(r,n)&&(No(t)||wo(t))}function ei(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&Dr.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function ii(t){return"function"!=typeof t.constructor||ci(t)?{}:fo(Ur(t))}function si(t,e,i){var s=t.constructor;switch(e){case Qn:return ge(t);case kn:case wn:return new s(+t);case Jn:return fe(t,i);case Zn:case ta:case ea:case ia:case sa:case na:case aa:case ra:case oa:return Ee(t,i);case Fn:return new s;case Gn:case Yn:return new s(t);case qn:return me(t);case Wn:return new s;case zn:return _e(t)}}function ni(t,e){var i=e.length;if(!i)return t;var s=i-1;return e[s]=(i>1?"& ":"")+e[s],e=e.join(i>2?", ":" "),t.replace(ya,"{\n/* [wrapped with "+e+"] */\n")}function ai(t){return No(t)||wo(t)||!!(Gr&&t&&t[Gr])}function ri(t,e){var i=typeof t;return!!(e=null==e?Cn:e)&&("number"==i||"symbol"!=i&&Oa.test(t))&&t>-1&&t%1==0&&t<e}function oi(t,e,i){if(!us(i))return!1;var s=typeof e;return!!("number"==s?ss(i)&&ri(e,i.length):"string"==s&&e in i)&&is(i[e],t)}function li(t,e){if(No(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!ms(t))||ma.test(t)||!fa.test(t)||null!=e&&t in Object(e)}function di(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function ui(t){var e=qe(t),i=B[e];if("function"!=typeof i||!(e in G.prototype))return!1;if(t===i)return!0;var s=yo(i);return!!s&&t===s[0]}function hi(t){return!!Ir&&Ir in t}function ci(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||br)}function pi(t){return t===t&&!us(t)}function vi(t,e){return function(i){return null!=i&&i[t]===e&&(e!==Xs||t in Object(i))}}function gi(t){var e=Qi(t,function(t){return i.size===en&&i.clear(),t}),i=e.cache;return e}function fi(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}function mi(t){return Rr.call(t)}function _i(t,i,s){return i=$r(i===Xs?t.length-1:i,0),function(){for(var n=arguments,a=-1,r=$r(n.length-i,0),o=Array(r);++a<r;)o[a]=n[i+a];a=-1;for(var l=Array(i+1);++a<i;)l[a]=n[a];return l[i]=s(o),e(t,this,l)}}function Ei(t,e){return e.length<2?t:Lt(t,le(e,0,-1))}function Ai(t,e){for(var i=t.length,s=Xr(e.length,i),n=Te(t);s--;){var a=e[s];t[s]=ri(a,i)?n[a]:Xs}return t}function yi(t,e,i){var s=e+"";return Do(t,ni(s,Ci(Ze(s),i)))}function Si(t){var e=0,i=0;return function(){var s=Qr(),n=An-(s-i);if(i=s,n>0){if(++e>=En)return arguments[0]}else e=0;return t.apply(Xs,arguments)}}function bi(t){if("string"==typeof t||ms(t))return t;var e=t+"";return"0"==e&&1/t==-Tn?"-0":e}function Ti(t){if(null!=t){try{return Cr.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ci(t,e){return i(Pn,function(i){var s="_."+i[0];e&i[1]&&!a(t,s)&&t.push(s)}),t.sort()}function Di(t){if(t instanceof G)return t.clone();var e=new F(t.__wrapped__,t.__chain__);return e.__actions__=Te(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Ii(t){for(var e=-1,i=null==t?0:t.length,s=0,n=[];++e<i;){var a=t[e];a&&(n[s++]=a)}return n}function Ri(t,e,i){var s=null==t?0:t.length;return s?(e=i||e===Xs?1:ys(e),le(t,e<0?0:e,s)):[]}function Pi(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:ys(i);return n<0&&(n=$r(s+n,0)),c(t,Ye(e,3),n)}function Mi(t){return(null==t?0:t.length)?Pt(t,1):[]}function Oi(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:ys(i);return n<0&&(n=$r(s+n,0)),p(t,e,n)}function Li(t){var e=null==t?0:t.length;return e?t[e-1]:Xs}function ki(t,e){return t&&t.length&&e&&e.length?ne(t,e):t}function wi(t){return null==t?t:Jr.call(t)}function Ni(t){var e=B(t);return e.__chain__=!0,e}function Ui(t,e){return e(t),t}function Bi(t,e){return e(t)}function ji(){return Ni(this)}function Fi(){return new F(this.value(),this.__chain__)}function Gi(){this.__values__===Xs&&(this.__values__=Es(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?Xs:this.__values__[this.__index__++]}}function Vi(){return this}function xi(t){for(var e,i=this;i instanceof j;){var s=Di(i);s.__index__=0,s.__values__=Xs,e?n.__wrapped__=s:e=s;var n=s;i=i.__wrapped__}return n.__wrapped__=t,e}function Hi(){var t=this.__wrapped__;if(t instanceof G){var e=t;return this.__actions__.length&&(e=new G(this)),e=e.reverse(),e.__actions__.push({func:Bi,args:[wi],thisArg:Xs}),new F(e,this.__chain__)}return this.thru(wi)}function Ki(){return he(this.__wrapped__,this.__actions__)}function qi(t,e,i){var n=No(t)?s:It;return i&&oi(t,e,i)&&(e=Xs),n(t,Ye(e,3))}function Wi(t,e){return(No(t)?i:mo)(t,Ye(e,3))}function Yi(t,e,i,s){t=ss(t)?t:Ls(t),i=i&&!s?ys(i):0;var n=t.length;return i<0&&(i=$r(n+i,0)),fs(t)?i<=n&&t.indexOf(e,i)>-1:!!n&&p(t,e,i)>-1}function zi(t,e){return(No(t)?o:Jt)(t,Ye(e,3))}function $i(t,e,i){var s=No(t)?u:de;return i&&oi(t,e,i)&&(e=Xs),s(t,Ye(e,3))}function Xi(t,e,i){function s(e){var i=c,s=p;return c=p=Xs,_=e,g=t.apply(s,i)}function n(t){return _=t,f=setTimeout(o,e),E?s(t):g}function a(t){var i=t-m,s=t-_,n=e-i;return A?Xr(n,v-s):n}function r(t){var i=t-m,s=t-_;return m===Xs||i>=e||i<0||A&&s>=v}function o(){var t=ko();if(r(t))return l(t);f=setTimeout(o,a(t))}function l(t){return f=Xs,y&&c?s(t):(c=p=Xs,g)}function d(){f!==Xs&&clearTimeout(f),_=0,c=m=p=f=Xs}function u(){return f===Xs?g:l(ko())}function h(){var t=ko(),i=r(t);if(c=arguments,p=this,m=t,i){if(f===Xs)return n(m);if(A)return f=setTimeout(o,e),s(m)}return f===Xs&&(f=setTimeout(o,e)),g}var c,p,v,g,f,m,_=0,E=!1,A=!1,y=!0;if("function"!=typeof t)throw new TypeError(Zs);return e=Ss(e)||0,us(i)&&(E=!!i.leading,A="maxWait"in i,v=A?$r(Ss(i.maxWait)||0,e):v,y="trailing"in i?!!i.trailing:y),h.cancel=d,h.flush=u,h}function Qi(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Zs);var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],a=i.cache;if(a.has(n))return a.get(n);var r=t.apply(this,s);return i.cache=a.set(n,r)||a,r};return i.cache=new(Qi.Cache||it),i}function Ji(t){if("function"!=typeof t)throw new TypeError(Zs);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Zi(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new TypeError(Zs);return us(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),Xi(t,e,{leading:s,maxWait:e,trailing:n})}function ts(t){return Ct(t,rn)}function es(t){return Ct(t,nn|rn)}function is(t,e){return t===e||t!==t&&e!==e}function ss(t){return null!=t&&ds(t.length)&&!ls(t)}function ns(t){return hs(t)&&ss(t)}function as(t){return!0===t||!1===t||hs(t)&&wt(t)==kn}function rs(t){if(null==t)return!0;if(ss(t)&&(No(t)||"string"==typeof t||"function"==typeof t.splice||Uo(t)||Go(t)||wo(t)))return!t.length;var e=To(t);if(e==Fn||e==Wn)return!t.size;if(ci(t))return!$t(t).length;for(var i in t)if(Dr.call(t,i))return!1;return!0}function os(t){if(!hs(t))return!1;var e=wt(t);return e==Un||e==Nn||"string"==typeof t.message&&"string"==typeof t.name&&!gs(t)}function ls(t){if(!us(t))return!1;var e=wt(t);return e==Bn||e==jn||e==Ln||e==Kn}function ds(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Cn}function us(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function hs(t){return null!=t&&"object"==typeof t}function cs(t){return vs(t)&&t!=+t}function ps(t){return null===t}function vs(t){return"number"==typeof t||hs(t)&&wt(t)==Gn}function gs(t){if(!hs(t)||wt(t)!=xn)return!1;var e=Ur(t);if(null===e)return!0;var i=Dr.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Cr.call(i)==Pr}function fs(t){return"string"==typeof t||!No(t)&&hs(t)&&wt(t)==Yn}function ms(t){return"symbol"==typeof t||hs(t)&&wt(t)==zn}function _s(t){return t===Xs}function Es(t){if(!t)return[];if(ss(t))return fs(t)?w(t):Te(t);if(Vr&&t[Vr])return I(t[Vr]());var e=To(t);return(e==Fn?R:e==Wn?O:Ls)(t)}function As(t){return t?(t=Ss(t))===Tn||t===-Tn?(t<0?-1:1)*Dn:t===t?t:0:0===t?t:0}function ys(t){var e=As(t),i=e%1;return e===e?i?e-i:e:0}function Ss(t){if("number"==typeof t)return t;if(ms(t))return In;if(us(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=us(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Aa,"");var i=Ra.test(t);return i||Ma.test(t)?rr(t.slice(2),i?2:8):Ia.test(t)?In:+t}function bs(t){return null==t?"":ue(t)}function Ts(t,e){return t&&Mt(t,Ye(e,3))}function Cs(t,e,i){var s=null==t?Xs:Lt(t,e);return s===Xs?i:s}function Ds(t,e){return null!=t&&ti(t,e,Nt)}function Is(t,e){return null!=t&&ti(t,e,Ut)}function Rs(t){return ss(t)?mt(t):$t(t)}function Ps(t){return ss(t)?mt(t,!0):Xt(t)}function Ms(t,e){return Os(t,Ji(Ye(e)))}function Os(t,e){if(null==t)return{};var i=o(Ke(t),function(t){return[t]});return e=Ye(e),ie(t,i,function(t,i){return e(t,i[0])})}function Ls(t){return null==t?[]:y(t,Rs(t))}function ks(t,e,i){return e=As(e),i===Xs?(i=e,e=0):i=As(i),t=Ss(t),Bt(t,e,i)}function ws(t){return Ko(bs(t).toLowerCase())}function Ns(t,e,i){t=bs(t),e=ue(e);var s=t.length;i=i===Xs?s:Tt(ys(i),0,s);var n=i;return(i-=e.length)>=0&&t.slice(i,n)==e}function Us(t){return t=bs(t),t&&ca.test(t)?t.replace(ha,Ar):t}function Bs(t,e,i){t=bs(t),e=ys(e);var s=e?k(t):0;return e&&s<e?Ne(e-s,i)+t:t}function js(t,e,i){return t=bs(t),i=null==i?0:Tt(ys(i),0,t.length),e=ue(e),t.slice(i,i+e.length)==e}function Fs(t,e,i){var s=B.templateSettings;i&&oi(t,e,i)&&(e=Xs),t=bs(t),e=Ho({},e,s,je);var n=Ho({},e.imports,s.imports,je),a=Rs(n),r=y(n,a),o,l,d=0,u=e.interpolate||La,h="__p += '",c=RegExp((e.escape||La).source+"|"+u.source+"|"+(u===ga?Ca:La).source+"|"+(e.evaluate||La).source+"|$","g"),p="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++er+"]")+"\n";t.replace(c,function(e,i,s,n,a,r){return s||(s=n),h+=t.slice(d,r).replace(ka,T),i&&(o=!0,h+="' +\n__e("+i+") +\n'"),a&&(l=!0,h+="';\n"+a+";\n__p += '"),s&&(h+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),d=r+e.length,e}),h+="';\n";var v=e.variable;v||(h="with (obj) {\n"+h+"\n}\n"),h=(l?h.replace(la,""):h).replace(da,"$1").replace(ua,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=qo(function(){return Function(a,p+"return "+h).apply(Xs,r)});if(g.source=h,os(g))throw g;return g}function Gs(t){return function(){return t}}function Vs(t){return t}function xs(t){return zt("function"==typeof t?t:Ct(t,nn))}function Hs(t,e,s){var n=Rs(e),a=Ot(e,n);null!=s||us(e)&&(a.length||!n.length)||(s=e,e=t,t=this,a=Ot(e,Rs(e)));var r=!(us(s)&&"chain"in s&&!s.chain),o=ls(t);return i(a,function(i){var s=e[i];t[i]=s,o&&(t.prototype[i]=function(){var e=this.__chain__;if(r||e){var i=t(this.__wrapped__);return(i.__actions__=Te(this.__actions__)).push({func:s,args:arguments,thisArg:t}),i.__chain__=e,i}return s.apply(t,l([this.value()],arguments))})}),t}function Ks(){return dr._===this&&(dr._=Mr),this}function qs(){}function Ws(t){return li(t)?f(bi(t)):se(t)}function Ys(){return[]}function zs(){return!1}function $s(t){return t&&t.length?Rt(t,Vs,Qt):Xs}var Xs,Qs="4.17.5",Js=200,Zs="Expected a function",tn="__lodash_hash_undefined__",en=500,sn="__lodash_placeholder__",nn=1,an=2,rn=4,on=1,ln=2,dn=1,un=2,hn=4,cn=8,pn=16,vn=32,gn=64,fn=128,mn=256,_n=512,En=800,An=16,yn=1,Sn=2,bn=3,Tn=1/0,Cn=9007199254740991,Dn=1.7976931348623157e308,In=NaN,Rn=4294967295,Pn=[["ary",fn],["bind",dn],["bindKey",un],["curry",cn],["curryRight",pn],["flip",_n],["partial",vn],["partialRight",gn],["rearg",256]],Mn="[object Arguments]",On="[object Array]",Ln="[object AsyncFunction]",kn="[object Boolean]",wn="[object Date]",Nn="[object DOMException]",Un="[object Error]",Bn="[object Function]",jn="[object GeneratorFunction]",Fn="[object Map]",Gn="[object Number]",Vn="[object Null]",xn="[object Object]",Hn="[object Promise]",Kn="[object Proxy]",qn="[object RegExp]",Wn="[object Set]",Yn="[object String]",zn="[object Symbol]",$n="[object Undefined]",Xn="[object WeakMap]",Qn="[object ArrayBuffer]",Jn="[object DataView]",Zn="[object Float32Array]",ta="[object Float64Array]",ea="[object Int8Array]",ia="[object Int16Array]",sa="[object Int32Array]",na="[object Uint8Array]",aa="[object Uint8ClampedArray]",ra="[object Uint16Array]",oa="[object Uint32Array]",la=/\b__p \+= '';/g,da=/\b(__p \+=) '' \+/g,ua=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ha=/[&<>"']/g,ca=RegExp(ha.source),pa=/<%-([\s\S]+?)%>/g,va=/<%([\s\S]+?)%>/g,ga=/<%=([\s\S]+?)%>/g,fa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ma=/^\w*$/,_a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ea=/[\\^$.*+?()[\]{}|]/g,Aa=/^\s+|\s+$/g,ya=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Sa=/\{\n\/\* \[wrapped with (.+)\] \*/,ba=/,? & /,Ta=/\\(\\)?/g,Ca=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Da=/\w*$/,Ia=/^[-+]0x[0-9a-f]+$/i,Ra=/^0b[01]+$/i,Pa=/^\[object .+?Constructor\]$/,Ma=/^0o[0-7]+$/i,Oa=/^(?:0|[1-9]\d*)$/,La=/($^)/,ka=/['\n\r\u2028\u2029\\]/g,wa="\\ud800-\\udfff",Na="\\u0300-\\u036f",Ua="\\ufe20-\\ufe2f",Ba="\\u20d0-\\u20ff",ja="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Fa="\\ufe0e\\ufe0f",Ga="[\\ud800-\\udfff]",Va="["+ja+"]",xa="\\ud83c[\\udffb-\\udfff]",Ha="(?:"+Va+"|"+xa+")",Ka="[^\\ud800-\\udfff]",qa="(?:\\ud83c[\\udde6-\\uddff]){2}",Wa="[\\ud800-\\udbff][\\udc00-\\udfff]",Ya="\\u200d",za=Ha+"?",$a="[\\ufe0e\\ufe0f]?",Xa="(?:\\u200d(?:"+[Ka,qa,Wa].join("|")+")"+$a+za+")*",Qa=$a+za+Xa,Ja="(?:"+[Ka+Va+"?",Va,qa,Wa,Ga].join("|")+")",Za=RegExp(xa+"(?="+xa+")|"+Ja+Qa,"g"),tr=RegExp("["+Ya+wa+ja+Fa+"]"),er=-1,ir={};ir[Zn]=ir[ta]=ir[ea]=ir[ia]=ir[sa]=ir[na]=ir[aa]=ir[ra]=ir[oa]=!0,ir[Mn]=ir[On]=ir[Qn]=ir[kn]=ir[Jn]=ir[wn]=ir[Un]=ir[Bn]=ir[Fn]=ir[Gn]=ir[xn]=ir[qn]=ir[Wn]=ir[Yn]=ir[Xn]=!1;var sr={};sr[Mn]=sr[On]=sr[Qn]=sr[Jn]=sr[kn]=sr[wn]=sr[Zn]=sr[ta]=sr[ea]=sr[ia]=sr[sa]=sr[Fn]=sr[Gn]=sr[xn]=sr[qn]=sr[Wn]=sr[Yn]=sr[zn]=sr[na]=sr[aa]=sr[ra]=sr[oa]=!0,sr[Un]=sr[Bn]=sr[Xn]=!1;var nr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ar={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},rr=parseInt,or="object"==typeof global&&global&&global.Object===Object&&global,lr="object"==typeof self&&self&&self.Object===Object&&self,dr=or||lr||Function("return this")(),ur="object"==typeof exports&&exports&&!exports.nodeType&&exports,hr=ur&&"object"==typeof module&&module&&!module.nodeType&&module,cr=hr&&hr.exports===ur,pr=cr&&or.process,vr=function(){try{return pr&&pr.binding&&pr.binding("util")}catch(t){}}(),gr=vr&&vr.isDate,fr=vr&&vr.isMap,mr=vr&&vr.isSet,_r=vr&&vr.isTypedArray,Er=f("length"),Ar=m(nr),yr=Array.prototype,Sr=Function.prototype,br=Object.prototype,Tr=dr["__core-js_shared__"],Cr=Sr.toString,Dr=br.hasOwnProperty,Ir=function(){var t=/[^.]+$/.exec(Tr&&Tr.keys&&Tr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Rr=br.toString,Pr=Cr.call(Object),Mr=dr._,Or=RegExp("^"+Cr.call(Dr).replace(Ea,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lr=cr?dr.Buffer:Xs,kr=dr.Symbol,wr=dr.Uint8Array,Nr=Lr?Lr.allocUnsafe:Xs,Ur=P(Object.getPrototypeOf,Object),Br=Object.create,jr=br.propertyIsEnumerable,Fr=yr.splice,Gr=kr?kr.isConcatSpreadable:Xs,Vr=kr?kr.iterator:Xs,xr=kr?kr.toStringTag:Xs,Hr=function(){try{var t=Xe(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Kr=Math.ceil,qr=Math.floor,Wr=Object.getOwnPropertySymbols,Yr=Lr?Lr.isBuffer:Xs,zr=P(Object.keys,Object),$r=Math.max,Xr=Math.min,Qr=Date.now,Jr=yr.reverse,Zr=Xe(dr,"DataView"),to=Xe(dr,"Map"),eo=Xe(dr,"Promise"),io=Xe(dr,"Set"),so=Xe(dr,"WeakMap"),no=Xe(Object,"create"),ao=so&&new so,ro={},oo=Ti(Zr),lo=Ti(to),uo=Ti(eo),ho=Ti(io),co=Ti(so),po=kr?kr.prototype:Xs,vo=po?po.valueOf:Xs,go=po?po.toString:Xs,fo=function(){function t(){}return function(e){if(!us(e))return{};if(Br)return Br(e);t.prototype=e;var i=new t;return t.prototype=Xs,i}}();B.templateSettings={escape:pa,evaluate:va,interpolate:ga,variable:"",imports:{_:B}},B.prototype=j.prototype,B.prototype.constructor=B,F.prototype=fo(j.prototype),F.prototype.constructor=F,G.prototype=fo(j.prototype),G.prototype.constructor=G,K.prototype.clear=q,K.prototype.delete=W,K.prototype.get=Y,K.prototype.has=z,K.prototype.set=$,X.prototype.clear=Q,X.prototype.delete=J,X.prototype.get=Z,X.prototype.has=tt,X.prototype.set=et,it.prototype.clear=st,it.prototype.delete=nt,it.prototype.get=at,it.prototype.has=rt,it.prototype.set=ot,lt.prototype.add=lt.prototype.push=dt,lt.prototype.has=ut,ht.prototype.clear=ct,ht.prototype.delete=pt,ht.prototype.get=vt,ht.prototype.has=gt,ht.prototype.set=ft;var mo=Pe(Mt),_o=Me(),Eo=ao?function(t,e){return ao.set(t,e),t}:Vs,Ao=Hr?function(t,e){return Hr(t,"toString",{configurable:!0,enumerable:!1,value:Gs(e),writable:!0})}:Vs,yo=ao?function(t){return ao.get(t)}:qs,So=Wr?function(t){return null==t?[]:(t=Object(t),n(Wr(t),function(e){return jr.call(t,e)}))}:Ys,bo=Wr?function(t){for(var e=[];t;)l(e,So(t)),t=Ur(t);return e}:Ys,To=wt;(Zr&&To(new Zr(new ArrayBuffer(1)))!=Jn||to&&To(new to)!=Fn||eo&&To(eo.resolve())!=Hn||io&&To(new io)!=Wn||so&&To(new so)!=Xn)&&(To=function(t){var e=wt(t),i=e==xn?t.constructor:Xs,s=i?Ti(i):"";if(s)switch(s){case oo:return Jn;case lo:return Fn;case uo:return Hn;case ho:return Wn;case co:return Xn}return e});var Co=Si(Eo),Do=Si(Ao),Io=gi(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(_a,function(t,i,s,n){e.push(s?n.replace(Ta,"$1"):i||t)}),e}),Ro=re(ki),Po=re(function(t,e){return ns(t)?Dt(t,e):[]}),Mo=xe(function(t){var e=t.length,i=e?t[0]:0,s=this.__wrapped__,n=function(e){return bt(e,t)};return!(e>1||this.__actions__.length)&&s instanceof G&&ri(i)?(s=s.slice(i,+i+(e?1:0)),s.__actions__.push({func:Bi,args:[n],thisArg:Xs}),new F(s,this.__chain__).thru(function(t){return e&&!t.length&&t.push(Xs),t})):this.thru(n)}),Oo=ke(Pi),Lo=re(function(t,e){if(null==t)return[];var i=e.length;return i>1&&oi(t,e[0],e[1])?e=[]:i>2&&oi(e[0],e[1],e[2])&&(e=[e[0]]),ee(t,Pt(e,1),[])}),ko=function(){return dr.Date.now()};Qi.Cache=it;var wo=Ft(function(){return arguments}())?Ft:function(t){return hs(t)&&Dr.call(t,"callee")&&!jr.call(t,"callee")},No=Array.isArray,Uo=Yr||zs,Bo=gr?A(gr):Gt,jo=fr?A(fr):Ht,Fo=mr?A(mr):Wt,Go=_r?A(_r):Yt,Vo=Re(function(t,e){if(ci(e)||ss(e))return void Ce(e,Rs(e),t);for(var i in e)Dr.call(e,i)&&_t(t,i,e[i])}),xo=Re(function(t,e){Ce(e,Ps(e),t)}),Ho=Re(function(t,e,i,s){Ce(e,Ps(e),t,s)}),Ko=Oe("toUpperCase"),qo=re(function(t,i){try{return e(t,Xs,i)}catch(t){return os(t)?t:new Error(t)}}),Wo=Be("round");B.assign=Vo,B.assignIn=xo,B.assignInWith=Ho,B.chain=Ni,B.compact=Ii,B.constant=Gs,B.debounce=Xi,B.drop=Ri,B.flatten=Mi,B.iteratee=xs,B.keys=Rs,B.keysIn=Ps,B.map=zi,B.memoize=Qi,B.mixin=Hs,B.negate=Ji,B.omitBy=Ms,B.pickBy=Os,B.property=Ws,B.pull=Ro,B.pullAll=ki,B.reverse=wi,B.sortBy=Lo,B.tap=Ui,B.throttle=Zi,B.thru=Bi,B.toArray=Es,B.values=Ls,B.without=Po,B.extend=xo,B.extendWith=Ho,Hs(B,B),B.attempt=qo,B.capitalize=ws,B.clone=ts,B.cloneDeep=es,B.endsWith=Ns,B.eq=is,B.escape=Us,B.every=qi,B.find=Oo,B.findIndex=Pi,B.forEach=Wi,B.forOwn=Ts,B.get=Cs,B.has=Ds,B.hasIn=Is,B.identity=Vs,B.includes=Yi,B.indexOf=Oi,B.inRange=ks,B.isArguments=wo,B.isArray=No,B.isArrayLike=ss,B.isArrayLikeObject=ns,B.isBoolean=as,B.isBuffer=Uo,B.isDate=Bo,B.isEmpty=rs,B.isError=os,B.isFunction=ls,B.isLength=ds,B.isMap=jo,B.isNaN=cs,B.isNull=ps,B.isNumber=vs,B.isObject=us,B.isObjectLike=hs,B.isPlainObject=gs,B.isSet=Fo,B.isString=fs,B.isSymbol=ms,B.isTypedArray=Go,B.isUndefined=_s,B.last=Li,B.min=$s,B.stubArray=Ys,B.stubFalse=zs,B.noConflict=Ks,B.noop=qs,B.now=ko,B.padStart=Bs,B.round=Wo,B.some=$i,B.startsWith=js,B.template=Fs,B.toFinite=As,B.toInteger=ys,B.toNumber=Ss,B.toString=bs,B.upperFirst=Ko,B.each=Wi,Hs(B,function(){var t={};return Mt(B,function(e,i){Dr.call(B.prototype,i)||(t[i]=e)}),t}(),{chain:!1}),B.VERSION=Qs,i(["drop","take"],function(t,e){G.prototype[t]=function(i){i=i===Xs?1:$r(ys(i),0);var s=this.__filtered__&&!e?new G(this):this.clone();return s.__filtered__?s.__takeCount__=Xr(i,s.__takeCount__):s.__views__.push({size:Xr(i,Rn),type:t+(s.__dir__<0?"Right":"")}),s},G.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),i(["filter","map","takeWhile"],function(t,e){var i=e+1,s=i==yn||3==i;G.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Ye(t,3),type:i}),e.__filtered__=e.__filtered__||s,e}}),i(["head","last"],function(t,e){var i="take"+(e?"Right":"");G.prototype[t]=function(){return this[i](1).value()[0]}}),i(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");G.prototype[t]=function(){return this.__filtered__?new G(this):this[i](1)}}),G.prototype.compact=function(){return this.filter(Vs)},G.prototype.find=function(t){return this.filter(t).head()},G.prototype.findLast=function(t){return this.reverse().find(t)},G.prototype.invokeMap=re(function(t,e){return"function"==typeof t?new G(this):this.map(function(i){return jt(i,t,e)})}),G.prototype.reject=function(t){return this.filter(Ji(Ye(t)))},G.prototype.slice=function(t,e){t=ys(t);var i=this;return i.__filtered__&&(t>0||e<0)?new G(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==Xs&&(e=ys(e),i=e<0?i.dropRight(-e):i.take(e-t)),i)},G.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},G.prototype.toArray=function(){return this.take(Rn)},Mt(G.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),n=B[s?"take"+("last"==e?"Right":""):e],a=s||/^find/.test(e);n&&(B.prototype[e]=function(){var e=this.__wrapped__,r=s?[1]:arguments,o=e instanceof G,d=r[0],u=o||No(e),h=function(t){var e=n.apply(B,l([t],r));return s&&c?e[0]:e};u&&i&&"function"==typeof d&&1!=d.length&&(o=u=!1);var c=this.__chain__,p=!!this.__actions__.length,v=a&&!c,g=o&&!p;if(!a&&u){e=g?e:new G(this);var f=t.apply(e,r);return f.__actions__.push({func:Bi,args:[h],thisArg:Xs}),new F(f,c)}return v&&g?t.apply(this,r):(f=this.thru(h),v?s?f.value()[0]:f.value():f)})}),i(["pop","push","shift","sort","splice","unshift"],function(t){var e=yr[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);B.prototype[t]=function(){var t=arguments;if(s&&!this.__chain__){var n=this.value();return e.apply(No(n)?n:[],t)}return this[i](function(i){return e.apply(No(i)?i:[],t)})}}),Mt(G.prototype,function(t,e){var i=B[e];if(i){var s=i.name+"";(ro[s]||(ro[s]=[])).push({name:e,func:i})}}),ro[we(Xs,un).name]=[{name:"wrapper",func:Xs}],G.prototype.clone=V,G.prototype.reverse=x,G.prototype.value=H,B.prototype.chain=ji,B.prototype.commit=Fi,B.prototype.next=Gi,B.prototype.plant=xi,B.prototype.reverse=Hi,B.prototype.toJSON=B.prototype.valueOf=B.prototype.value=Ki,B.prototype.first=B.prototype.head,Vr&&(B.prototype[Vr]=Vi),"function"==typeof t&&"object"==typeof t.amd&&t.amd?(dr._=B,t(function(){return B})):hr?((hr.exports=B)._=B,ur._=B):dr._=B}).call(this),"undefined"!=typeof window&&function e(i,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof t&&t.amd?t([],s):"object"==typeof exports?exports.Hls=s():i.Hls=s()}(this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function e(){return t.default}:function e(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=11)}([function(t,e,i){"use strict";function s(){}function n(t,e){return e="["+t+"] > "+e}function a(t){var e=h.console[t];return e?function(){for(var i=arguments.length,s=Array(i),a=0;a<i;a++)s[a]=arguments[a];s[0]&&(s[0]=n(t,s[0])),e.apply(h.console,s)}:s}function r(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];i.forEach(function(e){u[e]=t[e]?t[e].bind(t):a(e)})}i.d(e,"a",function(){return c}),i.d(e,"b",function(){return p});var o=i(4),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d={trace:s,debug:s,log:s,warn:s,info:s,error:s},u=d,h=Object(o.a)(),c=function t(e){if(!0===e||"object"===(void 0===e?"undefined":l(e))){r(e,"debug","log","info","warn","error");try{u.log()}catch(t){u=d}}else u=d},p=u},function(t,e,i){"use strict";var s={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};e.a=s},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return n});var s={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var s=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)}},function(t,e,i){"use strict";function s(){return"undefined"==typeof window?self:window}e.a=s},function(t,e,i){!function(e){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/;?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,r={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=this.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");return n.path=r.normalizePath(n.path),r.buildURLFromParts(n)}var a=this.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=r.normalizePath(a.path),r.buildURLFromParts(a)):e;var o=this.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=s.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+a.path;d.path=r.normalizePath(h)}else d.path=o.path,a.params||(d.params=o.params,a.query||(d.query=o.query));return null===d.path&&(d.path=i.alwaysNormalize?r.normalizePath(a.path):a.path),r.buildURLFromParts(d)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=r}(this)},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.d(e,"b",function(){return a});var n=function(){function t(){s(this,t)}return t.isHeader=function t(e,i){return i+10<=e.length&&73===e[i]&&68===e[i+1]&&51===e[i+2]&&e[i+3]<255&&e[i+4]<255&&e[i+6]<128&&e[i+7]<128&&e[i+8]<128&&e[i+9]<128},t.isFooter=function t(e,i){return i+10<=e.length&&51===e[i]&&68===e[i+1]&&73===e[i+2]&&e[i+3]<255&&e[i+4]<255&&e[i+6]<128&&e[i+7]<128&&e[i+8]<128&&e[i+9]<128},t.getID3Data=function e(i,s){for(var n=s,a=0;t.isHeader(i,s);)a+=10,a+=t._readSize(i,s+6),t.isFooter(i,s+10)&&(a+=10),s+=a;if(a>0)return i.subarray(n,n+a)},t._readSize=function t(e,i){var s=0;return s=(127&e[i])<<21,s|=(127&e[i+1])<<14,s|=(127&e[i+2])<<7,s|=127&e[i+3]},t.getTimeStamp=function e(i){
for(var s=t.getID3Frames(i),n=0;n<s.length;n++){var a=s[n];if(t.isTimeStampFrame(a))return t._readTimeStamp(a)}},t.isTimeStampFrame=function t(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},t._getFrameData=function e(i){var s=String.fromCharCode(i[0],i[1],i[2],i[3]),n=t._readSize(i,4),a=10;return{type:s,size:n,data:i.subarray(10,10+n)}},t.getID3Frames=function e(i){for(var s=0,n=[];t.isHeader(i,s);){var a=t._readSize(i,s+6);s+=10;for(var r=s+a;s+8<r;){var o=t._getFrameData(i.subarray(s)),l=t._decodeFrame(o);l&&n.push(l),s+=o.size+10}t.isFooter(i,s)&&(s+=10)}return n},t._decodeFrame=function e(i){return"PRIV"===i.type?t._decodePrivFrame(i):"T"===i.type[0]?t._decodeTextFrame(i):"W"===i.type[0]?t._decodeURLFrame(i):void 0},t._readTimeStamp=function t(e){if(8===e.data.byteLength){var i=new Uint8Array(e.data),s=1&i[3],n=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return n/=45,s&&(n+=47721858.84),Math.round(n)}},t._decodePrivFrame=function e(i){if(!(i.size<2)){var s=t._utf8ArrayToStr(i.data,!0),n=new Uint8Array(i.data.subarray(s.length+1));return{key:i.type,info:s,data:n.buffer}}},t._decodeTextFrame=function e(i){if(!(i.size<2)){if("TXXX"===i.type){var s=1,n=t._utf8ArrayToStr(i.data.subarray(s));s+=n.length+1;var a=t._utf8ArrayToStr(i.data.subarray(s));return{key:i.type,info:n,data:a}}var r=t._utf8ArrayToStr(i.data.subarray(1));return{key:i.type,data:r}}},t._decodeURLFrame=function e(i){if("WXXX"===i.type){if(i.size<2)return;var s=1,n=t._utf8ArrayToStr(i.data.subarray(s));s+=n.length+1;var a=t._utf8ArrayToStr(i.data.subarray(s));return{key:i.type,info:n,data:a}}var r=t._utf8ArrayToStr(i.data);return{key:i.type,data:r}},t._utf8ArrayToStr=function t(e){for(var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e.length,n=void 0,a=void 0,r=void 0,o="",l=0;l<s;){if(0===(n=e[l++])&&i)return o;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:a=e[l++],o+=String.fromCharCode((31&n)<<6|63&a);break;case 14:a=e[l++],r=e[l++],o+=String.fromCharCode((15&n)<<12|(63&a)<<6|(63&r)<<0)}}return o},t}(),a=n._utf8ArrayToStr;e.a=n},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function n(t){return"number"==typeof t}function a(t){return"object"==typeof t&&null!==t}function r(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!n(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,n,o,l,d;if(this._events||(this._events={}),"error"===t&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(i=this._events[t],r(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(a(i))for(o=Array.prototype.slice.call(arguments,1),d=i.slice(),n=d.length,l=0;l<n;l++)d[l].apply(this,o);return!0},i.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?a(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,a(this._events[t])&&!this._events[t].warned&&(n=r(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!s(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,n,r,o;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],r=i.length,n=-1,i===e||s(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(a(i)){for(o=r;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){n=o;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],s(i))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){var e=t.byteLength,i=e&&new DataView(t).getUint8(e-1);return i?t.slice(0,e-i):t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function t(e,i){s(this,t),this.subtle=e,this.aesIV=i}return t.prototype.decrypt=function t(e,i){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},i,e)},t}(),d=l,u=function(){function t(e,i){n(this,t),this.subtle=e,this.key=i}return t.prototype.expandKey=function t(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}(),h=u,c=function(){function t(){a(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function t(e){for(var i=new DataView(e),s=new Uint32Array(4),n=0;n<4;n++)s[n]=i.getUint32(4*n);return s},t.prototype.initTable=function t(){var e=this.sBox,i=this.invSBox,s=this.subMix,n=s[0],a=s[1],r=s[2],o=s[3],l=this.invSubMix,d=l[0],u=l[1],h=l[2],c=l[3],p=new Uint32Array(256),v=0,g=0,f=0;for(f=0;f<256;f++)p[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){var m=g^g<<1^g<<2^g<<3^g<<4;m=m>>>8^255&m^99,e[v]=m,i[m]=v;var _=p[v],E=p[_],A=p[E],y=257*p[m]^16843008*m;n[v]=y<<24|y>>>8,a[v]=y<<16|y>>>16,r[v]=y<<8|y>>>24,o[v]=y,y=16843009*A^65537*E^257*_^16843008*v,d[m]=y<<24|y>>>8,u[m]=y<<16|y>>>16,h[m]=y<<8|y>>>24,c[m]=y,v?(v=_^p[p[p[A^_]]],g^=p[p[g]]):v=g=1}},t.prototype.expandKey=function t(e){for(var i=this.uint8ArrayToUint32Array_(e),s=!0,n=0;n<i.length&&s;)s=i[n]===this.key[n],n++;if(!s){this.key=i;var a=this.keySize=i.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var r=this.ksRows=4*(a+6+1),o=void 0,l=void 0,d=this.keySchedule=new Uint32Array(r),u=this.invKeySchedule=new Uint32Array(r),h=this.sBox,c=this.rcon,p=this.invSubMix,v=p[0],g=p[1],f=p[2],m=p[3],_=void 0,E=void 0;for(o=0;o<r;o++)o<a?_=d[o]=i[o]:(E=_,o%a==0?(E=E<<8|E>>>24,E=h[E>>>24]<<24|h[E>>>16&255]<<16|h[E>>>8&255]<<8|h[255&E],E^=c[o/a|0]<<24):a>6&&o%a==4&&(E=h[E>>>24]<<24|h[E>>>16&255]<<16|h[E>>>8&255]<<8|h[255&E]),d[o]=_=(d[o-a]^E)>>>0);for(l=0;l<r;l++)o=r-l,E=3&l?d[o]:d[o-4],u[l]=l<4||o<=4?E:v[h[E>>>24]]^g[h[E>>>16&255]]^f[h[E>>>8&255]]^m[h[255&E]],u[l]=u[l]>>>0}},t.prototype.networkToHostOrderSwap=function t(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.prototype.decrypt=function t(e,i,s,n){for(var a=this.keySize+6,o=this.invKeySchedule,l=this.invSBox,d=this.invSubMix,u=d[0],h=d[1],c=d[2],p=d[3],v=this.uint8ArrayToUint32Array_(s),g=v[0],f=v[1],m=v[2],_=v[3],E=new Int32Array(e),A=new Int32Array(E.length),y=void 0,S=void 0,b=void 0,T=void 0,C=void 0,D=void 0,I=void 0,R=void 0,P=void 0,M=void 0,O=void 0,L=void 0,k=void 0,w=void 0,N=this.networkToHostOrderSwap;i<E.length;){for(P=N(E[i]),M=N(E[i+1]),O=N(E[i+2]),L=N(E[i+3]),C=P^o[0],D=L^o[1],I=O^o[2],R=M^o[3],k=4,w=1;w<a;w++)y=u[C>>>24]^h[D>>16&255]^c[I>>8&255]^p[255&R]^o[k],S=u[D>>>24]^h[I>>16&255]^c[R>>8&255]^p[255&C]^o[k+1],b=u[I>>>24]^h[R>>16&255]^c[C>>8&255]^p[255&D]^o[k+2],T=u[R>>>24]^h[C>>16&255]^c[D>>8&255]^p[255&I]^o[k+3],C=y,D=S,I=b,R=T,k+=4;y=l[C>>>24]<<24^l[D>>16&255]<<16^l[I>>8&255]<<8^l[255&R]^o[k],S=l[D>>>24]<<24^l[I>>16&255]<<16^l[R>>8&255]<<8^l[255&C]^o[k+1],b=l[I>>>24]<<24^l[R>>16&255]<<16^l[C>>8&255]<<8^l[255&D]^o[k+2],T=l[R>>>24]<<24^l[C>>16&255]<<16^l[D>>8&255]<<8^l[255&I]^o[k+3],k+=3,A[i]=N(y^g),A[i+1]=N(T^f),A[i+2]=N(b^m),A[i+3]=N(S^_),g=P,f=M,m=O,_=L,i+=4}return n?r(A.buffer):A.buffer},t.prototype.destroy=function t(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),p=c,v=i(2),g=i(0),f=i(1),m=i(4),_=Object(m.a)(),E=function(){function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=s.removePKCS7Padding,a=void 0===n||n;if(o(this,t),this.logEnabled=!0,this.observer=e,this.config=i,this.removePKCS7Padding=a,a)try{var r=_.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function t(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function t(e,i,s,n){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(g.b.log("JS AES decrypt"),this.logEnabled=!1);var r=this.decryptor;r||(this.decryptor=r=new p),r.expandKey(i),n(r.decrypt(e,0,s,this.removePKCS7Padding))}else{this.logEnabled&&(g.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var o=this.subtle;this.key!==i&&(this.key=i,this.fastAesKey=new h(o,i)),this.fastAesKey.expandKey().then(function(t){new d(o,s).decrypt(e,t).catch(function(t){a.onWebCryptoError(t,e,i,s,n)}).then(function(t){n(t)})}).catch(function(t){a.onWebCryptoError(t,e,i,s,n)})}},t.prototype.onWebCryptoError=function t(e,i,s,n,a){this.config.enableSoftwareAES?(g.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(i,s,n,a)):(g.b.error("decrypting error : "+e.message),this.observer.trigger(f.a.ERROR,{type:v.b.MEDIA_ERROR,details:v.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.prototype.destroy=function t(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},t}(),A=e.a=E},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=i(0),a=i(1),r=Math.pow(2,32)-1,o=function(){function t(e,i){s(this,t),this.observer=e,this.remuxer=i}return t.prototype.resetTimeStamp=function t(e){this.initPTS=e},t.prototype.resetInitSegment=function e(i,s,n,r){if(i&&i.byteLength){var o=this.initData=t.parseInitSegment(i);null==s&&(s="mp4a.40.5"),null==n&&(n="avc1.42e01e");var l={};o.audio&&o.video?l.audiovideo={container:"video/mp4",codec:s+","+n,initSegment:r?i:null}:(o.audio&&(l.audio={container:"audio/mp4",codec:s,initSegment:r?i:null}),o.video&&(l.video={container:"video/mp4",codec:n,initSegment:r?i:null})),this.observer.trigger(a.a.FRAG_PARSING_INIT_SEGMENT,{tracks:l})}else s&&(this.audioCodec=s),n&&(this.videoCodec=n)},t.probe=function e(i){return t.findBox({data:i,start:0,end:Math.min(i.length,16384)},["moof"]).length>0},t.bin2str=function t(e){return String.fromCharCode.apply(null,e)},t.readUint16=function t(e,i){e.data&&(i+=e.start,e=e.data);var s=e[i]<<8|e[i+1];return s<0?65536+s:s},t.readUint32=function t(e,i){e.data&&(i+=e.start,e=e.data);var s=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3];return s<0?4294967296+s:s},t.writeUint32=function t(e,i,s){e.data&&(i+=e.start,e=e.data),e[i]=s>>24,e[i+1]=s>>16&255,e[i+2]=s>>8&255,e[i+3]=255&s},t.findBox=function e(i,s){var n=[],a=void 0,r=void 0,o=void 0,l=void 0,d=void 0,u=void 0,h=void 0;if(i.data?(u=i.start,l=i.end,i=i.data):(u=0,l=i.byteLength),!s.length)return null;for(a=u;a<l;)r=t.readUint32(i,a),o=t.bin2str(i.subarray(a+4,a+8)),h=r>1?a+r:l,o===s[0]&&(1===s.length?n.push({data:i,start:a+8,end:h}):(d=t.findBox({data:i,start:a+8,end:h},s.slice(1)),d.length&&(n=n.concat(d)))),a=h;return n},t.parseSegmentIndex=function e(i){var s=t.findBox(i,["moov"])[0],n=s?s.end:null,a=0,r=t.findBox(i,["sidx"]),o=void 0;if(!r||!r[0])return null;o=[],r=r[0];var l=r.data[0];a=0===l?8:16;var d=t.readUint32(r,a);a+=4;var u=0,h=0;a+=0===l?8:16,a+=2;var c=r.end+0,p=t.readUint16(r,a);a+=2;for(var v=0;v<p;v++){var g=a,f=t.readUint32(r,g);g+=4;var m=2147483647&f;if(1==(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var _=t.readUint32(r,g);g+=4,o.push({referenceSize:m,subsegmentDuration:_,info:{duration:_/d,start:c,end:c+m-1}}),c+=m,g+=4,a=g}return{earliestPresentationTime:0,timescale:d,version:l,referencesCount:p,references:o,moovEndOffset:n}},t.parseInitSegment=function e(i){var s=[];return t.findBox(i,["moov","trak"]).forEach(function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var a=i.data[i.start],r=0===a?12:20,o=t.readUint32(i,r),l=t.findBox(e,["mdia","mdhd"])[0];if(l){a=l.data[l.start],r=0===a?12:20;var d=t.readUint32(l,r),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var h=t.bin2str(u.data.subarray(u.start+8,u.start+12)),c={soun:"audio",vide:"video"}[h];if(c){var p=t.findBox(e,["mdia","minf","stbl","stsd"]);if(p.length){p=p[0];var v=t.bin2str(p.data.subarray(p.start+12,p.start+16));n.b.log("MP4Demuxer:"+c+":"+v+" found")}s[o]={timescale:d,type:c},s[c]={timescale:d,id:o}}}}}}),s},t.getStartDTS=function e(i,s){var n=void 0,a=void 0,r=void 0;return n=t.findBox(s,["moof","traf"]),a=[].concat.apply([],n.map(function(e){return t.findBox(e,["tfhd"]).map(function(s){var n=void 0,a=void 0,r=void 0;return n=t.readUint32(s,4),a=i[n].timescale||9e4,(r=t.findBox(e,["tfdt"]).map(function(e){var i=void 0,s=void 0;return i=e.data[e.start],s=t.readUint32(e,4),1===i&&(s*=Math.pow(2,32),s+=t.readUint32(e,8)),s})[0])/a})})),r=Math.min.apply(null,a),isFinite(r)?r:0},t.offsetStartDTS=function e(i,s,n){t.findBox(s,["moof","traf"]).map(function(e){return t.findBox(e,["tfhd"]).map(function(s){var a=t.readUint32(s,4),o=i[a].timescale||9e4;t.findBox(e,["tfdt"]).map(function(e){var i=e.data[e.start],s=t.readUint32(e,4);if(0===i)t.writeUint32(e,4,s-n*o);else{s*=Math.pow(2,32),s+=t.readUint32(e,8),s-=n*o,s=Math.max(s,0);var a=Math.floor(s/(r+1)),l=Math.floor(s%(r+1));t.writeUint32(e,4,a),t.writeUint32(e,8,l)}})})})},t.prototype.append=function e(i,s,n,r){var o=this.initData;o||(this.resetInitSegment(i,this.audioCodec,this.videoCodec,!1),o=this.initData);var l=void 0,d=this.initPTS;if(void 0===d){var u=t.getStartDTS(o,i);this.initPTS=d=u-s,this.observer.trigger(a.a.INIT_PTS_FOUND,{initPTS:d})}t.offsetStartDTS(o,i,d),l=t.getStartDTS(o,i),this.remuxer.remux(o.audio,o.video,null,null,l,n,r,i)},t.prototype.destroy=function t(){},t}();e.a=o},function(t,e,i){"use strict";function s(t,e,i,s){var n=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=navigator.userAgent.toLowerCase(),u=s,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return n=1+((192&e[i+2])>>>6),(a=(60&e[i+2])>>>2)>h.length-1?void t.trigger(b.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a}):(o=(1&e[i+2])<<2,o|=(192&e[i+3])>>>6,I.b.log("manifest codec:"+s+",ADTS data:type:"+n+",sampleingIndex:"+a+"["+h[a]+"Hz],channelConfig:"+o),/firefox/i.test(d)?a>=6?(n=5,l=new Array(4),r=a-3):(n=2,l=new Array(2),r=a):-1!==d.indexOf("android")?(n=2,l=new Array(2),r=a):(n=5,l=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&a>=6?r=a-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(a>=6&&1===o||/vivaldi/i.test(d))||!s&&1===o)&&(n=2,l=new Array(2)),r=a)),l[0]=n<<3,l[0]|=(14&a)>>1,l[1]|=(1&a)<<7,l[1]|=o<<3,5===n&&(l[1]|=(14&r)>>1,l[2]=(1&r)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:h[a],channelCount:o,codec:"mp4a.40."+n,manifestCodec:u})}function n(t,e){return 255===t[e]&&240==(246&t[e+1])}function a(t,e){return 1&t[e+1]?7:9}function r(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function o(t,e){return!!(e+1<t.length&&n(t,e))}function l(t,e){if(e+1<t.length&&n(t,e)){var i=a(t,e),s=i;e+5<t.length&&(s=r(t,e));var o=e+s;if(o===t.length||o+1<t.length&&n(t,o))return!0}return!1}function d(t,e,i,n,a){if(!t.samplerate){var r=s(e,i,n,a);t.config=r.config,t.samplerate=r.samplerate,t.channelCount=r.channelCount,t.codec=r.codec,t.manifestCodec=r.manifestCodec,I.b.log("parsed codec:"+t.codec+",rate:"+r.samplerate+",nb channel:"+r.channelCount)}}function u(t){return 9216e4/t}function h(t,e,i,s,n){var o=void 0,l=void 0,d=void 0,u=t.length;if(o=a(t,e),l=r(t,e),(l-=o)>0&&e+o+l<=u)return d=i+s*n,{headerLength:o,frameLength:l,stamp:d}}function c(t,e,i,s,n){var a=u(t.samplerate),r=h(e,i,s,n,a);if(r){var o=r.stamp,l=r.headerLength,d=r.frameLength,c={unit:e.subarray(i+l,i+l+d),pts:o,dts:o};return t.samples.push(c),t.len+=d,{sample:c,length:d+l}}}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var b=i(1),T=i(2),C=i(8),D=i(3),I=i(0),R=i(4),P=i(6),M=function(){function t(e,i,s){p(this,t),this.observer=e,this.config=s,this.remuxer=i}return t.prototype.resetInitSegment=function t(e,i,s,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:i,duration:n,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function t(){},t.probe=function t(e){if(!e)return!1;for(var i=P.a.getID3Data(e,0)||[],s=i.length,n=e.length;s<n;s++)if(l(e,s))return I.b.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function t(e,i,s,n){for(var a=this._audioTrack,r=P.a.getID3Data(e,0)||[],l=P.a.getTimeStamp(r),u=Object(D.a)(l)?90*l:9e4*i,h=0,p=u,v=e.length,g=r.length,f=[{pts:p,dts:p,data:r}];g<v-1;)if(o(e,g)&&g+5<v){d(a,this.observer,e,g,a.manifestCodec);var m=c(a,e,g,u,h);if(!m){I.b.log("Unable to parse AAC frame");break}g+=m.length,p=m.sample.pts,h++}else P.a.isHeader(e,g)?(r=P.a.getID3Data(e,g),f.push({pts:p,dts:p,data:r}),g+=r.length):g++;this.remuxer.remux(a,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},i,s,n)},t.prototype.destroy=function t(){},t}(),O=M,L=i(9),k={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function t(e,i,s,n,a){if(!(s+24>i.length)){var r=this.parseHeader(i,s);if(r&&s+r.frameLength<=i.length){var o=9e4*r.samplesPerFrame/r.sampleRate,l=n+a*o,d={unit:i.subarray(s,s+r.frameLength),pts:l,dts:l};return e.config=[],e.channelCount=r.channelCount,e.samplerate=r.sampleRate,e.samples.push(d),e.len+=r.frameLength,{sample:d,length:r.frameLength}}}},parseHeader:function t(e,i){var s=e[i+1]>>3&3,n=e[i+1]>>1&3,a=e[i+2]>>4&15,r=e[i+2]>>2&3,o=e[i+2]>>1&1;if(1!==s&&0!==a&&15!==a&&3!==r){var l=3===s?3-n:3===n?3:4,d=1e3*k.BitratesMap[14*l+a-1],u=3===s?0:2===s?1:2,h=k.SamplingRateMap[3*u+r],c=e[i+3]>>6==3?1:2,p=k.SamplesCoefficients[s][n],v=k.BytesInSlot[n],g=8*p*v;return{sampleRate:h,channelCount:c,frameLength:parseInt(p*d/h+o,10)*v,samplesPerFrame:g}}},isHeaderPattern:function t(e,i){return 255===e[i]&&224==(224&e[i+1])&&0!=(6&e[i+1])},isHeader:function t(e,i){return!!(i+1<e.length&&this.isHeaderPattern(e,i))},probe:function t(e,i){if(i+1<e.length&&this.isHeaderPattern(e,i)){var s=4,n=this.parseHeader(e,i),a=4;n&&n.frameLength&&(a=n.frameLength);var r=i+a;if(r===e.length||r+1<e.length&&this.isHeaderPattern(e,r))return!0}return!1}},w=k,N=function(){function t(e){v(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function t(){var e=this.data,i=this.bytesAvailable,s=e.byteLength-i,n=new Uint8Array(4),a=Math.min(4,i);if(0===a)throw new Error("no bytes available");n.set(e.subarray(s,s+a)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},t.prototype.skipBits=function t(e){var i=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,i=e>>3,e-=i>>3,this.bytesAvailable-=i,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.prototype.readBits=function t(e){var i=Math.min(this.bitsAvailable,e),s=this.word>>>32-i;return e>32&&I.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),i=e-i,i>0&&this.bitsAvailable?s<<i|this.readBits(i):s},t.prototype.skipLZ=function t(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.prototype.skipUEG=function t(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function t(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function t(){var e=this.skipLZ();return this.readBits(e+1)-1},t.prototype.readEG=function t(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.prototype.readBoolean=function t(){return 1===this.readBits(1)},t.prototype.readUByte=function t(){return this.readBits(8)},t.prototype.readUShort=function t(){return this.readBits(16)},t.prototype.readUInt=function t(){return this.readBits(32)},t.prototype.skipScalingList=function t(e){var i=8,s=8,n=void 0,a=void 0;for(n=0;n<e;n++)0!==s&&(a=this.readEG(),s=(i+a+256)%256),i=0===s?i:s},t.prototype.readSPS=function t(){var e=0,i=0,s=0,n=0,a=void 0,r=void 0,o=void 0,l=void 0,d=void 0,u=void 0,h=void 0,c=void 0,p=void 0,v=this.readUByte.bind(this),g=this.readBits.bind(this),f=this.readUEG.bind(this),m=this.readBoolean.bind(this),_=this.skipBits.bind(this),E=this.skipEG.bind(this),A=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(v(),a=v(),r=g(5),_(3),o=v(),A(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var S=f();if(3===S&&_(1),A(),A(),_(1),m())for(c=3!==S?8:12,p=0;p<c;p++)m()&&y(p<6?16:64)}A();var b=f();if(0===b)f();else if(1===b)for(_(1),E(),E(),l=f(),p=0;p<l;p++)E();A(),_(1),d=f(),u=f(),h=g(1),0===h&&_(1),_(1),m()&&(e=f(),i=f(),s=f(),n=f());var T=[1,1];if(m()&&m())switch(v()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[v()<<8|v(),v()<<8|v()]}return{width:Math.ceil(16*(d+1)-2*e-2*i),height:(2-h)*(u+1)*16-(h?2:4)*(s+n),pixelRatio:T}},t.prototype.readSliceType=function t(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),U=N,B=function(){function t(e,i,s,n){g(this,t),this.decryptdata=s,this.discardEPB=n,this.decrypter=new C.a(e,i,{removePKCS7Padding:!1})}return t.prototype.decryptBuffer=function t(e,i){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,i)},t.prototype.decryptAacSample=function t(e,i,s,n){var a=e[i].unit,r=a.subarray(16,a.length-a.length%16),o=r.buffer.slice(r.byteOffset,r.byteOffset+r.length),l=this;this.decryptBuffer(o,function(t){t=new Uint8Array(t),a.set(t,16),n||l.decryptAacSamples(e,i+1,s)})},t.prototype.decryptAacSamples=function t(e,i,s){for(;;i++){if(i>=e.length)return void s();if(!(e[i].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,i,s,n),!n)return}}},t.prototype.getAvcEncryptedData=function t(e){for(var i=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(i),n=0,a=32;a<=e.length-16;a+=160,n+=16)s.set(e.subarray(a,a+16),n);return s},t.prototype.getAvcDecryptedUnit=function t(e,i){i=new Uint8Array(i);for(var s=0,n=32;n<=e.length-16;n+=160,s+=16)e.set(i.subarray(s,s+16),n);return e},t.prototype.decryptAvcSample=function t(e,i,s,n,a,r){var o=this.discardEPB(a.data),l=this.getAvcEncryptedData(o),d=this;this.decryptBuffer(l.buffer,function(t){a.data=d.getAvcDecryptedUnit(o,t),r||d.decryptAvcSamples(e,i,s+1,n)})},t.prototype.decryptAvcSamples=function t(e,i,s,n){for(;;i++,s=0){if(i>=e.length)return void n();for(var a=e[i].units;!(s>=a.length);s++){var r=a[s];if(!(r.length<=48||1!==r.type&&5!==r.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(e,i,s,n,r,o),!o)return}}}},t}(),j=B,F={video:1,audio:2,id3:3,text:4},G=function(){function t(e,i,s,n){f(this,t),this.observer=e,this.config=s,this.typeSupported=n,this.remuxer=i,this.sampleAes=null}return t.prototype.setDecryptData=function t(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new j(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},t.probe=function e(i){var s=t._syncOffset(i);return!(s<0||(s&&I.b.warn("MPEG2-TS detected but first sync word found @ offset "+s+", junk ahead ?"),0))},t._syncOffset=function t(e){for(var i=Math.min(1e3,e.length-564),s=0;s<i;){if(71===e[s]&&71===e[s+188]&&71===e[s+376])return s;s++}return-1},t.createTrack=function t(e,i){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:F[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?i:void 0}},t.prototype.resetInitSegment=function e(i,s,n,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",a),this._audioTrack=t.createTrack("audio",a),this._id3Track=t.createTrack("id3",a),this._txtTrack=t.createTrack("text",a),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=s,this.videoCodec=n,this._duration=a},t.prototype.resetTimeStamp=function t(){},t.prototype.append=function e(i,s,n,a){var r=void 0,o=i.length,l=void 0,d=void 0,u=void 0,h=void 0,c=void 0,p=!1;this.contiguous=n;var v=this.pmtParsed,g=this._avcTrack,f=this._audioTrack,m=this._id3Track,_=g.pid,E=f.pid,A=m.pid,y=this._pmtId,S=g.pesData,C=f.pesData,D=m.pesData,R=this._parsePAT,P=this._parsePMT,M=this._parsePES,O=this._parseAVCPES.bind(this),L=this._parseAACPES.bind(this),k=this._parseMPEGPES.bind(this),w=this._parseID3PES.bind(this),N=t._syncOffset(i);for(o-=(o+N)%188,r=N;r<o;r+=188)if(71===i[r]){if(l=!!(64&i[r+1]),d=((31&i[r+1])<<8)+i[r+2],(u=(48&i[r+3])>>4)>1){if((h=r+5+i[r+4])===r+188)continue}else h=r+4;switch(d){case _:l&&(S&&(c=M(S))&&void 0!==c.pts&&O(c,!1),S={data:[],size:0}),S&&(S.data.push(i.subarray(h,r+188)),S.size+=r+188-h);break;case E:l&&(C&&(c=M(C))&&void 0!==c.pts&&(f.isAAC?L(c):k(c)),C={data:[],size:0}),C&&(C.data.push(i.subarray(h,r+188)),C.size+=r+188-h);break;case A:l&&(D&&(c=M(D))&&void 0!==c.pts&&w(c),D={data:[],size:0}),D&&(D.data.push(i.subarray(h,r+188)),D.size+=r+188-h);break;case 0:l&&(h+=i[h]+1),y=this._pmtId=R(i,h);break;case y:l&&(h+=i[h]+1);var U=P(i,h,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);_=U.avc,_>0&&(g.pid=_),E=U.audio,E>0&&(f.pid=E,f.isAAC=U.isAAC),A=U.id3,A>0&&(m.pid=A),p&&!v&&(I.b.log("reparse from beginning"),p=!1,r=N-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(b.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});S&&(c=M(S))&&void 0!==c.pts?(O(c,!0),g.pesData=null):g.pesData=S,C&&(c=M(C))&&void 0!==c.pts?(f.isAAC?L(c):k(c),f.pesData=null):(C&&C.size&&I.b.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=C),D&&(c=M(D))&&void 0!==c.pts?(w(c),m.pesData=null):m.pesData=D,null==this.sampleAes?this.remuxer.remux(f,g,m,this._txtTrack,s,n,a):this.decryptAndRemux(f,g,m,this._txtTrack,s,n,a)},t.prototype.decryptAndRemux=function t(e,i,s,n,a,r,o){if(e.samples&&e.isAAC){var l=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){l.decryptAndRemuxAvc(e,i,s,n,a,r,o)})}else this.decryptAndRemuxAvc(e,i,s,n,a,r,o)},t.prototype.decryptAndRemuxAvc=function t(e,i,s,n,a,r,o){if(i.samples){var l=this;this.sampleAes.decryptAvcSamples(i.samples,0,0,function(){l.remuxer.remux(e,i,s,n,a,r,o)})}else this.remuxer.remux(e,i,s,n,a,r,o)},t.prototype.destroy=function t(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function t(e,i){return(31&e[i+10])<<8|e[i+11]},t.prototype._parsePMT=function t(e,i,s,n){var a=void 0,r=void 0,o=void 0,l=void 0,d={audio:-1,avc:-1,id3:-1,isAAC:!0};for(a=(15&e[i+1])<<8|e[i+2],r=i+3+a-4,o=(15&e[i+10])<<8|e[i+11],i+=12+o;i<r;){switch(l=(31&e[i+1])<<8|e[i+2],e[i]){case 207:if(!n){I.b.log("unkown stream type:"+e[i]);break}case 15:-1===d.audio&&(d.audio=l);break;case 21:-1===d.id3&&(d.id3=l);break;case 219:if(!n){I.b.log("unkown stream type:"+e[i]);break}case 27:-1===d.avc&&(d.avc=l);break;case 3:case 4:s?-1===d.audio&&(d.audio=l,d.isAAC=!1):I.b.log("MPEG audio found, not supported in this browser for now");break;case 36:I.b.warn("HEVC stream type found, not supported for now");break;default:I.b.log("unkown stream type:"+e[i])}i+=5+((15&e[i+3])<<8|e[i+4])}return d},t.prototype._parsePES=function t(e){var i=0,s=void 0,n=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=void 0,u=void 0,h=void 0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var p=new Uint8Array(c[0].length+c[1].length);p.set(c[0]),p.set(c[1],c[0].length),c[0]=p,c.splice(1,1)}if(s=c[0],1===(a=(s[0]<<16)+(s[1]<<8)+s[2])){if((r=(s[4]<<8)+s[5])&&r>e.size-6)return null;n=s[7],192&n&&(d=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,d>4294967295&&(d-=8589934592),64&n?(u=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2,u>4294967295&&(u-=8589934592),d-u>54e5&&(I.b.warn(Math.round((d-u)/9e4)+"s delta between PTS and DTS, align them"),d=u)):u=d),o=s[8],h=o+9,e.size-=h,l=new Uint8Array(e.size);for(var v=0,g=c.length;v<g;v++){s=c[v];var f=s.byteLength;if(h){if(h>f){h-=f;continue}s=s.subarray(h),f-=h,h=0}l.set(s,i),i+=f}return r&&(r-=o+3),
{data:l,pts:d,dts:u,len:r}}return null},t.prototype.pushAccesUnit=function t(e,i){if(e.units.length&&e.frame){var s=i.samples,n=s.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||i.sps&&(n||this.contiguous)?(e.id=n,s.push(e)):i.dropped++}e.debug.length&&I.b.log(e.pts+"/"+e.dts+":"+e.debug)},t.prototype._parseAVCPES=function t(e,i){var s=this,n=this._avcTrack,a=this._parseAVCNALu(e.data),r=!1,o=void 0,l=this.avcSample,d=void 0,u=!1,h=void 0,c=this.pushAccesUnit.bind(this),p=function t(e,i,s,n){return{key:e,pts:i,dts:s,units:[],debug:n}};e.data=null,l&&a.length&&!n.audFound&&(c(l,n),l=this.avcSample=p(!1,e.pts,e.dts,"")),a.forEach(function(t){switch(t.type){case 1:d=!0,l||(l=s.avcSample=p(!0,e.pts,e.dts,"")),l.frame=!0;var i=t.data;if(u&&i.length>4){var a=new U(i).readSliceType();2!==a&&4!==a&&7!==a&&9!==a||(l.key=!0)}break;case 5:d=!0,l||(l=s.avcSample=p(!0,e.pts,e.dts,"")),l.key=!0,l.frame=!0;break;case 6:d=!0,o=new U(s.discardEPB(t.data)),o.readUByte();for(var r=0,v=0,g=!1,f=0;!g&&o.bytesAvailable>1;){r=0;do{f=o.readUByte(),r+=f}while(255===f);v=0;do{f=o.readUByte(),v+=f}while(255===f);if(4===r&&0!==o.bytesAvailable){if(g=!0,181===o.readUByte()&&49===o.readUShort()&&1195456820===o.readUInt()&&3===o.readUByte()){var m=o.readUByte(),_=o.readUByte(),E=31&m,A=[m,_];for(h=0;h<E;h++)A.push(o.readUByte()),A.push(o.readUByte()),A.push(o.readUByte());s._insertSampleInOrder(s._txtTrack.samples,{type:3,pts:e.pts,bytes:A})}}else if(v<o.bytesAvailable)for(h=0;h<v;h++)o.readUByte()}break;case 7:if(d=!0,u=!0,!n.sps){o=new U(t.data);var y=o.readSPS();n.width=y.width,n.height=y.height,n.pixelRatio=y.pixelRatio,n.sps=[t.data],n.duration=s._duration;var S=t.data.subarray(1,4),b="avc1.";for(h=0;h<3;h++){var T=S[h].toString(16);T.length<2&&(T="0"+T),b+=T}n.codec=b}break;case 8:d=!0,n.pps||(n.pps=[t.data]);break;case 9:d=!1,n.audFound=!0,l&&c(l,n),l=s.avcSample=p(!1,e.pts,e.dts,"");break;case 12:d=!1;break;default:d=!1,l&&(l.debug+="unknown NAL "+t.type+" ")}l&&d&&l.units.push(t)}),i&&l&&(c(l,n),this.avcSample=null)},t.prototype._insertSampleInOrder=function t(e,i){var s=e.length;if(s>0){if(i.pts>=e[s-1].pts)e.push(i);else for(var n=s-1;n>=0;n--)if(i.pts<e[n].pts){e.splice(n,0,i);break}}else e.push(i)},t.prototype._getLastNalUnit=function t(){var e=this.avcSample,i=void 0;if(!e||0===e.units.length){var s=this._avcTrack,n=s.samples;e=n[n.length-1]}if(e){var a=e.units;i=a[a.length-1]}return i},t.prototype._parseAVCNALu=function t(e){var i=0,s=e.byteLength,n=void 0,a=void 0,r=this._avcTrack,o=r.naluState||0,l=o,d=[],u=void 0,h=void 0,c=-1,p=void 0;for(-1===o&&(c=0,p=31&e[0],o=0,i=1);i<s;)if(n=e[i++],o)if(1!==o)if(n)if(1===n){if(c>=0)u={data:e.subarray(c,i-o-1),type:p},d.push(u);else{var v=this._getLastNalUnit();if(v&&(l&&i<=4-l&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-l)),(a=i-o-1)>0)){var g=new Uint8Array(v.data.byteLength+a);g.set(v.data,0),g.set(e.subarray(0,a),v.data.byteLength),v.data=g}}i<s?(h=31&e[i],c=i,p=h,o=0):o=-1}else o=0;else o=3;else o=n?0:2;else o=n?0:1;if(c>=0&&o>=0&&(u={data:e.subarray(c,s),type:p,state:o},d.push(u)),0===d.length){var f=this._getLastNalUnit();if(f){var m=new Uint8Array(f.data.byteLength+e.byteLength);m.set(f.data,0),m.set(e,f.data.byteLength),f.data=m}}return r.naluState=o,d},t.prototype.discardEPB=function t(e){for(var i=e.byteLength,s=[],n=1,a=void 0,r=void 0;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(s.push(n+2),n+=2):n++;if(0===s.length)return e;a=i-s.length,r=new Uint8Array(a);var o=0;for(n=0;n<a;o++,n++)o===s[0]&&(o++,s.shift()),r[n]=e[o];return r},t.prototype._parseAACPES=function t(e){var i=this._audioTrack,s=e.data,n=e.pts,a=0,r=this.aacOverFlow,l=this.aacLastPTS,h=void 0,p=void 0,v=void 0,g=void 0,f=void 0;if(r){var m=new Uint8Array(r.byteLength+s.byteLength);m.set(r,0),m.set(s,r.byteLength),s=m}for(v=0,f=s.length;v<f-1&&!o(s,v);v++);if(v){var _=void 0,E=void 0;if(v<f-1?(_="AAC PES did not start with ADTS header,offset:"+v,E=!1):(_="no ADTS header found in AAC PES",E=!0),I.b.warn("parsing error:"+_),this.observer.trigger(b.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:E,reason:_}),E)return}if(d(i,this.observer,s,v,this.audioCodec),p=0,h=u(i.samplerate),r&&l){var A=l+h;Math.abs(A-n)>1&&(I.b.log("AAC: align PTS for overlapping frames by "+Math.round((A-n)/90)),n=A)}for(;v<f;)if(o(s,v)&&v+5<f){var y=c(i,s,v,n,p);if(!y)break;v+=y.length,g=y.sample.pts,p++}else v++;r=v<f?s.subarray(v,f):null,this.aacOverFlow=r,this.aacLastPTS=g},t.prototype._parseMPEGPES=function t(e){for(var i=e.data,s=i.length,n=0,a=0,r=e.pts;a<s;)if(w.isHeader(i,a)){var o=w.appendFrame(this._audioTrack,i,a,r,n);if(!o)break;a+=o.length,n++}else a++},t.prototype._parseID3PES=function t(e){this._id3Track.samples.push(e)},t}(),V=G,x=function(){function t(e,i,s){m(this,t),this.observer=e,this.config=s,this.remuxer=i}return t.prototype.resetInitSegment=function t(e,i,s,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:i,duration:n,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function t(){},t.probe=function t(e){var i=void 0,s=void 0,n=P.a.getID3Data(e,0);if(n&&void 0!==P.a.getTimeStamp(n))for(i=n.length,s=Math.min(e.length-1,i+100);i<s;i++)if(w.probe(e,i))return I.b.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function t(e,i,s,n){for(var a=P.a.getID3Data(e,0),r=P.a.getTimeStamp(a),o=r?90*r:9e4*i,l=a.length,d=e.length,u=0,h=0,c=this._audioTrack,p=[{pts:o,dts:o,data:a}];l<d;)if(w.isHeader(e,l)){var v=w.appendFrame(c,e,l,o,u);if(!v)break;l+=v.length,h=v.sample.pts,u++}else P.a.isHeader(e,l)?(a=P.a.getID3Data(e,l),p.push({pts:h,dts:h,data:a}),l+=a.length):l++;this.remuxer.remux(c,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},i,s,n)},t.prototype.destroy=function t(){},t}(),H=x,K=function(){function t(){_(this,t)}return t.getSilentFrame=function t(e,i){switch(e){case"mp4a.40.2":if(1===i)return new Uint8Array([0,200,0,128,35,128]);if(2===i)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===i)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===i)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===i)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),q=K,W=Math.pow(2,32)-1,Y=function(){function t(){E(this,t)}return t.init=function e(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var i=void 0;for(i in t.types)t.types.hasOwnProperty(i)&&(t.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var s=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:s,audio:n};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=r,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,d,o,l),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,a))},t.box=function t(e){for(var i=Array.prototype.slice.call(arguments,1),s=8,n=i.length,a=n,r=void 0;n--;)s+=i[n].byteLength;for(r=new Uint8Array(s),r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=255&s,r.set(e,4),n=0,s=8;n<a;n++)r.set(i[n],s),s+=i[n].byteLength;return r},t.hdlr=function e(i){return t.box(t.types.hdlr,t.HDLR_TYPES[i])},t.mdat=function e(i){return t.box(t.types.mdat,i)},t.mdhd=function e(i,s){s*=i;var n=Math.floor(s/(W+1)),a=Math.floor(s%(W+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},t.mdia=function e(i){return t.box(t.types.mdia,t.mdhd(i.timescale,i.duration),t.hdlr(i.type),t.minf(i))},t.mfhd=function e(i){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]))},t.minf=function e(i){return"audio"===i.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(i)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(i))},t.moof=function e(i,s,n){return t.box(t.types.moof,t.mfhd(i),t.traf(n,s))},t.moov=function e(i){for(var s=i.length,n=[];s--;)n[s]=t.trak(i[s]);return t.box.apply(null,[t.types.moov,t.mvhd(i[0].timescale,i[0].duration)].concat(n).concat(t.mvex(i)))},t.mvex=function e(i){for(var s=i.length,n=[];s--;)n[s]=t.trex(i[s]);return t.box.apply(null,[t.types.mvex].concat(n))},t.mvhd=function e(i,s){s*=i;var n=Math.floor(s/(W+1)),a=Math.floor(s%(W+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,r)},t.sdtp=function e(i){var s=i.samples||[],n=new Uint8Array(4+s.length),a=void 0,r=void 0;for(r=0;r<s.length;r++)a=s[r].flags,n[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return t.box(t.types.sdtp,n)},t.stbl=function e(i){return t.box(t.types.stbl,t.stsd(i),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function e(i){var s=[],n=[],a=void 0,r=void 0,o=void 0;for(a=0;a<i.sps.length;a++)r=i.sps[a],o=r.byteLength,s.push(o>>>8&255),s.push(255&o),s=s.concat(Array.prototype.slice.call(r));for(a=0;a<i.pps.length;a++)r=i.pps[a],o=r.byteLength,n.push(o>>>8&255),n.push(255&o),n=n.concat(Array.prototype.slice.call(r));var l=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|i.sps.length].concat(s).concat([i.pps.length]).concat(n))),d=i.width,u=i.height,h=i.pixelRatio[0],c=i.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,c>>24,c>>16&255,c>>8&255,255&c])))},t.esds=function t(e){var i=e.config.length;return new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(e.config).concat([6,1,2]))},t.mp4a=function e(i){var s=i.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,s>>8&255,255&s,0,0]),t.box(t.types.esds,t.esds(i)))},t.mp3=function e(i){var s=i.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,s>>8&255,255&s,0,0]))},t.stsd=function e(i){return"audio"===i.type?i.isAAC||"mp3"!==i.codec?t.box(t.types.stsd,t.STSD,t.mp4a(i)):t.box(t.types.stsd,t.STSD,t.mp3(i)):t.box(t.types.stsd,t.STSD,t.avc1(i))},t.tkhd=function e(i){var s=i.id,n=i.duration*i.timescale,a=i.width,r=i.height,o=Math.floor(n/(W+1)),l=Math.floor(n%(W+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,255&s,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,r>>8&255,255&r,0,0]))},t.traf=function e(i,s){var n=t.sdtp(i),a=i.id,r=Math.floor(s/(W+1)),o=Math.floor(s%(W+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(i,n.length+16+20+8+16+8+8),n)},t.trak=function e(i){return i.duration=i.duration||4294967295,t.box(t.types.trak,t.tkhd(i),t.mdia(i))},t.trex=function e(i){var s=i.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function e(i,s){var n=i.samples||[],a=n.length,r=12+16*a,o=new Uint8Array(r),l=void 0,d=void 0,u=void 0,h=void 0,c=void 0,p=void 0;for(s+=8+r,o.set([0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s],0),l=0;l<a;l++)d=n[l],u=d.duration,h=d.size,c=d.flags,p=d.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,h>>>24&255,h>>>16&255,h>>>8&255,255&h,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,p>>>24&255,p>>>16&255,p>>>8&255,255&p],12+16*l);return t.box(t.types.trun,o)},t.initSegment=function e(i){t.types||t.init();var s=t.moov(i),n=void 0;return n=new Uint8Array(t.FTYP.byteLength+s.byteLength),n.set(t.FTYP),n.set(s,t.FTYP.byteLength),n},t}(),z=Y,$=1e4,X=function(){function t(e,i,s,n){A(this,t),this.observer=e,this.config=i,this.typeSupported=s;var a=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function t(){},t.prototype.resetTimeStamp=function t(e){this._initPTS=this._initDTS=e},t.prototype.resetInitSegment=function t(){this.ISGenerated=!1},t.prototype.remux=function t(e,i,s,n,a,r,o){if(this.ISGenerated||this.generateIS(e,i,a),this.ISGenerated){var l=e.samples.length,d=i.samples.length,u=a,h=a;if(l&&d){var c=(e.samples[0].dts-i.samples[0].dts)/i.inputTimeScale;u+=Math.max(0,c),h+=Math.max(0,-c)}if(l){e.timescale||(I.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,i,a));var p=this.remuxAudio(e,u,r,o);if(d){var v=void 0;p&&(v=p.endPTS-p.startPTS),i.timescale||(I.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,i,a)),this.remuxVideo(i,h,r,v,o)}}else if(d){var g=this.remuxVideo(i,h,r,0,o);g&&e.codec&&this.remuxEmptyAudio(e,u,r,g)}}s.samples.length&&this.remuxID3(s,a),n.samples.length&&this.remuxText(n,a),this.observer.trigger(b.a.FRAG_PARSED)},t.prototype.generateIS=function t(e,i,s){var n=this.observer,a=e.samples,r=i.samples,o=this.typeSupported,l="audio/mp4",d={},u={tracks:d},h=void 0===this._initPTS,c=void 0,p=void 0;if(h&&(c=p=1/0),e.config&&a.length&&(e.timescale=e.samplerate,I.b.log("audio sampling rate : "+e.samplerate),e.isAAC||(o.mpeg?(l="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3")),d.audio={container:l,codec:e.codec,initSegment:!e.isAAC&&o.mpeg?new Uint8Array:z.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(c=p=a[0].pts-e.inputTimeScale*s)),i.sps&&i.pps&&r.length){var v=i.inputTimeScale;i.timescale=v,d.video={container:"video/mp4",codec:i.codec,initSegment:z.initSegment([i]),metadata:{width:i.width,height:i.height}},h&&(c=Math.min(c,r[0].pts-v*s),p=Math.min(p,r[0].dts-v*s),this.observer.trigger(b.a.INIT_PTS_FOUND,{initPTS:c}))}Object.keys(d).length?(n.trigger(b.a.FRAG_PARSING_INIT_SEGMENT,u),this.ISGenerated=!0,h&&(this._initPTS=c,this._initDTS=p)):n.trigger(b.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function t(e,i,s,n,a){var r=8,o=e.timescale,l=void 0,d=void 0,u=void 0,h=void 0,c=void 0,p=void 0,v=void 0,g=void 0,f=e.samples,m=[],_=f.length,E=this._PTSNormalize,A=this._initDTS,y=this.nextAvcDts,S=this.isSafari;if(0!==_){S&&(s|=f.length&&y&&(a&&Math.abs(i-y/o)<.1||Math.abs(f[0].pts-y-A)<o/5)),s||(y=i*o),f.forEach(function(t){t.pts=E(t.pts-A,y),t.dts=E(t.dts-A,y)}),f.sort(function(t,e){var i=t.dts-e.dts,s=t.pts-e.pts;return i||s||t.id-e.id});var C=f.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(C<0){I.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(C/90)+" ms to overcome this issue");for(var D=0;D<f.length;D++)f[D].dts+=C}var R=f[0];c=Math.max(R.dts,0),h=Math.max(R.pts,0);var P=Math.round((c-y)/90);s&&P&&(P>1?I.b.log("AVC:"+P+" ms hole between fragments detected,filling it"):P<-1&&I.b.log("AVC:"+-P+" ms overlapping between fragments detected"),c=y,f[0].dts=c,h=Math.max(h-P,y),f[0].pts=h,I.b.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(c/90)+",delta:"+P+" ms")),p=c,R=f[f.length-1],g=Math.max(R.dts,0),v=Math.max(R.pts,0,g),S&&(l=Math.round((g-c)/(f.length-1)));for(var M=0,O=0,L=0;L<_;L++){for(var k=f[L],w=k.units,N=w.length,U=0,B=0;B<N;B++)U+=w[B].data.length;O+=U,M+=N,k.length=U,k.dts=S?c+L*l:Math.max(k.dts,c),k.pts=Math.max(k.pts,k.dts)}var j=O+4*M+8;try{d=new Uint8Array(j)}catch(t){return void this.observer.trigger(b.a.ERROR,{type:T.b.MUX_ERROR,details:T.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:j,reason:"fail allocating video mdat "+j})}var F=new DataView(d.buffer);F.setUint32(0,j),d.set(z.types.mdat,4);for(var G=0;G<_;G++){for(var V=f[G],x=V.units,H=0,K=void 0,q=0,W=x.length;q<W;q++){var Y=x[q],$=Y.data,X=Y.data.byteLength;F.setUint32(r,X),r+=4,d.set($,r),r+=X,H+=4+X}if(S)K=Math.max(0,l*Math.round((V.pts-V.dts)/l));else{if(G<_-1)l=f[G+1].dts-V.dts;else{var Q=this.config,J=V.dts-f[G>0?G-1:G].dts;if(Q.stretchShortVideoTrack){var Z=Q.maxBufferHole,tt=Math.floor(Z*o),et=(n?h+n*o:this.nextAudioPts)-V.pts;et>tt?(l=et-J,l<0&&(l=J),I.b.log("It is approximately "+et/90+" ms to the next segment; using duration "+l/90+" ms for the last video frame.")):l=J}else l=J}K=Math.round(V.pts-V.dts)}m.push({size:H,duration:l,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:V.key?2:1,isNonSync:V.key?0:1}})}this.nextAvcDts=g+l;var it=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,m.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var st=m[0].flags;st.dependsOn=2,st.isNonSync=0}e.samples=m,u=z.moof(e.sequenceNumber++,c,e),e.samples=[];var nt={data1:u,data2:d,startPTS:h/o,endPTS:(v+l)/o,startDTS:c/o,endDTS:this.nextAvcDts/o,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:it};return this.observer.trigger(b.a.FRAG_PARSING_DATA,nt),nt}},t.prototype.remuxAudio=function t(e,i,s,n){var a=e.inputTimeScale,r=e.timescale,o=a/r,l=e.isAAC?1024:1152,d=l*o,u=this._PTSNormalize,h=this._initDTS,c=!e.isAAC&&this.typeSupported.mpeg,p=void 0,v=void 0,g=void 0,f=void 0,m=void 0,_=void 0,E=void 0,A=e.samples,y=[],S=this.nextAudioPts;if(s|=A.length&&S&&(n&&Math.abs(i-S/a)<.1||Math.abs(A[0].pts-S-h)<20*d),A.forEach(function(t){t.pts=t.dts=u(t.pts-h,i*a)}),A=A.filter(function(t){return t.pts>=0}),0!==A.length){if(s||(S=n?i*a:A[0].pts),e.isAAC)for(var C=this.config.maxAudioFramesDrift,D=0,R=S;D<A.length;){var P=A[D],M,O=P.pts;M=O-R;var L=Math.abs(1e3*M/a);if(M<=-C*d)I.b.warn("Dropping 1 audio frame @ "+(R/a).toFixed(3)+"s due to "+Math.round(L)+" ms overlap."),A.splice(D,1),e.len-=P.unit.length;else if(M>=C*d&&L<1e4&&R){var k=Math.round(M/d);I.b.warn("Injecting "+k+" audio frame @ "+(R/a).toFixed(3)+"s due to "+Math.round(1e3*M/a)+" ms gap.");for(var w=0;w<k;w++){var N=Math.max(R,0);g=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),g||(I.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),g=P.unit.subarray()),A.splice(D,0,{unit:g,pts:N,dts:N}),e.len+=g.length,R+=d,D++}P.pts=P.dts=R,R+=d,D++}else Math.abs(M),P.pts=P.dts=R,R+=d,D++}for(var U=0,B=A.length;U<B;U++){var j=A[U],F=j.unit,G=j.pts;if(void 0!==E)v.duration=Math.round((G-E)/o);else{var V=Math.round(1e3*(G-S)/a),x=0;if(s&&e.isAAC&&V){if(V>0&&V<1e4)x=Math.round((G-S)/d),I.b.log(V+" ms hole between AAC samples detected,filling it"),x>0&&(g=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),g||(g=F.subarray()),e.len+=x*g.length);else if(V<-12){I.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(S/a).toFixed(3)+"s/"+(G/a).toFixed(3)+"s/"+-V+"ms"),e.len-=F.byteLength;continue}G=S}if(_=G,!(e.len>0))return;var H=c?e.len:e.len+8;p=c?0:8;try{f=new Uint8Array(H)}catch(t){return void this.observer.trigger(b.a.ERROR,{type:T.b.MUX_ERROR,details:T.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating audio mdat "+H})}c||(new DataView(f.buffer).setUint32(0,H),f.set(z.types.mdat,4));for(var K=0;K<x;K++)g=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),g||(I.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),g=F.subarray()),f.set(g,p),p+=g.byteLength,v={size:g.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(v)}f.set(F,p);var W=F.byteLength;p+=W,v={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(v),E=G}var Y=0,$=y.length;if($>=2&&(Y=y[$-2].duration,v.duration=Y),$){this.nextAudioPts=S=E+o*Y,e.len=0,e.samples=y,m=c?new Uint8Array:z.moof(e.sequenceNumber++,_/o,e),e.samples=[];var X=_/a,Q=S/a,J={data1:m,data2:f,startPTS:X,endPTS:Q,startDTS:X,endDTS:Q,type:"audio",hasAudio:!0,hasVideo:!1,nb:$};return this.observer.trigger(b.a.FRAG_PARSING_DATA,J),J}return null}},t.prototype.remuxEmptyAudio=function t(e,i,s,n){var a=e.inputTimeScale,r=e.samplerate?e.samplerate:a,o=a/r,l=this.nextAudioPts,d=(void 0!==l?l:n.startDTS*a)+this._initDTS,u=n.endDTS*a+this._initDTS,h=1024,c=1024*o,p=Math.ceil((u-d)/c),v=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(I.b.warn("remux empty Audio"),!v)return void I.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var g=[],f=0;f<p;f++){var m=d+f*c;g.push({unit:v,pts:m,dts:m}),e.len+=v.length}e.samples=g,this.remuxAudio(e,i,s)},t.prototype.remuxID3=function t(e,i){var s=e.samples.length,n=void 0,a=e.inputTimeScale,r=this._initPTS,o=this._initDTS;if(s){for(var l=0;l<s;l++)n=e.samples[l],n.pts=(n.pts-r)/a,n.dts=(n.dts-o)/a;this.observer.trigger(b.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],i=i},t.prototype.remuxText=function t(e,i){e.samples.sort(function(t,e){return t.pts-e.pts});var s=e.samples.length,n=void 0,a=e.inputTimeScale,r=this._initPTS;if(s){for(var o=0;o<s;o++)n=e.samples[o],n.pts=(n.pts-r)/a;this.observer.trigger(b.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],i=i},t.prototype._PTSNormalize=function t(e,i){var s=void 0;if(void 0===i)return e;for(s=i<e?-8589934592:8589934592;Math.abs(e-i)>4294967296;)e+=s;return e},t}(),Q=X,J=function(){function t(e){y(this,t),this.observer=e}return t.prototype.destroy=function t(){},t.prototype.resetTimeStamp=function t(){},t.prototype.resetInitSegment=function t(){},t.prototype.remux=function t(e,i,s,n,a,r,o,l){var d=this.observer,u="";e&&(u+="audio"),i&&(u+="video"),d.trigger(b.a.FRAG_PARSING_DATA,{data1:l,startPTS:a,startDTS:a,type:u,hasAudio:!!e,hasVideo:!!i,nb:1,dropped:0}),d.trigger(b.a.FRAG_PARSED)},t}(),Z=J,tt=Object(R.a)(),et=tt.performance,it=function(){function t(e,i,s,n){S(this,t),this.observer=e,this.typeSupported=i,this.config=s,this.vendor=n}return t.prototype.destroy=function t(){var e=this.demuxer;e&&e.destroy()},t.prototype.push=function t(e,i,s,n,a,r,o,l,d,u,h,c){if(e.byteLength>0&&null!=i&&null!=i.key&&"AES-128"===i.method){var p=this.decrypter;null==p&&(p=this.decrypter=new C.a(this.observer,this.config));var v=this,g=void 0;try{g=et.now()}catch(t){g=Date.now()}p.decrypt(e,i.key.buffer,i.iv.buffer,function(t){var e=void 0;try{e=et.now()}catch(t){e=Date.now()}v.observer.trigger(b.a.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:e}}),v.pushDecrypted(new Uint8Array(t),i,new Uint8Array(s),n,a,r,o,l,d,u,h,c)})}else this.pushDecrypted(new Uint8Array(e),i,new Uint8Array(s),n,a,r,o,l,d,u,h,c)},t.prototype.pushDecrypted=function t(e,i,s,n,a,r,o,l,d,u,h,c){var p=this.demuxer;if(!p||(o||l)&&!this.probe(e)){for(var v=this.observer,g=this.typeSupported,f=this.config,m=[{demux:V,remux:Q},{demux:L.a,remux:Z},{demux:O,remux:Q},{demux:H,remux:Q}],_=0,E=m.length;_<E;_++){var A=m[_],y=A.demux.probe;if(y(e)){var S=this.remuxer=new A.remux(v,f,g,this.vendor);p=new A.demux(v,S,f,g),this.probe=y;break}}if(!p)return void v.trigger(b.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=p}var C=this.remuxer;(o||l)&&(p.resetInitSegment(s,n,a,u),C.resetInitSegment()),o&&(p.resetTimeStamp(c),C.resetTimeStamp(c)),"function"==typeof p.setDecryptData&&p.setDecryptData(i),p.append(e,r,d,h)},t}(),st=e.a=it},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){var i=be[e];return!!i&&!0===i[t.slice(0,4)]}function d(t,e){return window.MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var i=t[e],s=e-1;s>=0;s--){var n=t[s];n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}function c(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(ie.a)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}}function P(t,e,i){var s=t[e],n=t[i],a=n.startPTS;Object(ie.a)(a)?i>e?(s.duration=a-s.start,s.duration<0&&ne.b.warn("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!")):(n.duration=s.start-a,n.duration<0&&ne.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=i>e?s.start+s.duration:Math.max(s.start-n.duration,0)}function M(t,e,i,s,n,a){var r=i;if(Object(ie.a)(e.startPTS)){var o=Math.abs(e.startPTS-i);Object(ie.a)(e.deltaPTS)?e.deltaPTS=Math.max(o,e.deltaPTS):e.deltaPTS=o,r=Math.max(i,e.startPTS),i=Math.min(i,e.startPTS),s=Math.max(s,e.endPTS),n=Math.min(n,e.startDTS),a=Math.max(a,e.endDTS)}var l=i-e.start;e.start=e.startPTS=i,e.maxStartPTS=r,e.endPTS=s,e.startDTS=n,e.endDTS=a,e.duration=s-i;var d=e.sn;if(!t||d<t.startSN||d>t.endSN)return 0;var u=void 0,h=void 0,c=void 0;for(u=d-t.startSN,h=t.fragments,h[u]=e,c=u;c>0;c--)P(h,c,c-1);for(c=u;c<h.length-1;c++)P(h,c,c+1);return t.PTSKnown=!0,l}function O(t,e){var i=Math.max(t.startSN,e.startSN)-e.startSN,s=Math.min(t.endSN,e.endSN)-e.startSN,n=e.startSN-t.startSN,a=t.fragments,r=e.fragments,o=0,l=void 0;if(e.initSegment&&t.initSegment&&(e.initSegment=t.initSegment),s<i)return void(e.PTSKnown=!1);for(var d=i;d<=s;d++){var u=a[n+d],h=r[d];h&&u&&(o=u.cc-h.cc,Object(ie.a)(u.startPTS)&&(h.start=h.startPTS=u.startPTS,h.endPTS=u.endPTS,h.duration=u.duration,h.backtracked=u.backtracked,h.dropped=u.dropped,l=h))}if(o)for(ne.b.log("discontinuity sliding from playlist, take drift into account"),d=0;d<r.length;d++)r[d].cc+=o;if(l)M(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS);else if(n>=0&&n<a.length){var c=a[n].start;for(d=0;d<r.length;d++)r[d].start+=c}e.PTSKnown=t.PTSKnown}function L(t,e){for(var i=null,s=0;s<t.length;s+=1){var n=t[s];if(n&&n.cc===e){i=n;break}}return i}function k(t,e){return qe.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}function w(t,e,i){var s=!1;return e&&e.details&&i&&(i.endCC>i.startCC||t&&t.cc<i.startCC)&&(s=!0),s}function N(t,e){var i=t.fragments,s=e.fragments;if(!s.length||!i.length)return void ne.b.log("No fragments to align");var n=L(i,s[0].cc);return!n||n&&!n.startPTS?void ne.b.log("No frag in previous level to align on"):n}function U(t,e){e.fragments.forEach(function(e){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}),e.PTSKnown=!0}function B(t,e,i){j(t,i,e),!i.PTSKnown&&e&&F(i,e.details)}function j(t,e,i){if(w(t,i,e)){var s=N(i.details,e);s&&(ne.b.log("Adjusting PTS using last level due to CC increase within current level"),U(s.start,e))}}function F(t,e){if(e&&e.fragments.length){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return
;var i=e.fragments[0].programDateTime,s=t.fragments[0].programDateTime,n=(s-i)/1e3+e.fragments[0].start;Object(ie.a)(n)&&(ne.b.log("adjusting PTS using programDateTime delta, sliding:"+n.toFixed(3)),U(n,t))}}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function H(t,e,i){if(!Array.isArray(t)||!t.length||!Object(ie.a)(e))return null;if(e<t[0].programDateTime)return null;if(e>=t[t.length-1].endProgramDateTime)return null;i=i||0;for(var s=0;s<t.length;++s){var n=t[s];if(W(e,i,n))return n}return null}function K(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=t?e[t.sn-e[0].sn+1]:null;return n&&!q(i,s,n)?n:qe.search(e,q.bind(null,i,s))}function q(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2],s=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-s<=t?1:i.start-s>t&&i.start?-1:0}function W(t,e,i){var s=1e3*Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-s>t}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function X(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function J(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Z(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function tt(t,e){var i=null;try{i=new window.Event("addtrack")}catch(t){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function et(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function nt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function at(){var t=D(),e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!i&&!!s}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ut(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ct(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function pt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ft(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Et(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function At(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function bt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ct(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Dt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function It(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new ns,this.regionList=[]}function Rt(t){function e(t,e,i,s){return 3600*(0|t)+60*(0|e)+(0|i)+(0|s)/1e3}var i=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?e(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?e(i[1],i[2],0,i[4]):e(0,i[1],i[2],i[4]):null}function Pt(){this.values=Object.create(null)}function Mt(t,e,i,s){var n=s?t.split(s):[t];for(var a in n)if("string"==typeof n[a]){var r=n[a].split(i);if(2===r.length){var o=r[0],l=r[1];e(o,l)}}}function Ot(t,e,i){function s(){var e=Rt(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function n(t,e){var s=new Pt;Mt(t,function(t,e){switch(t){case"region":for(var n=i.length-1;n>=0;n--)if(i[n].id===e){s.set(t,i[n].region);break}break;case"vertical":s.alt(t,e,["rl","lr"]);break;case"line":var a=e.split(","),r=a[0];s.integer(t,r),s.percent(t,r)&&s.set("snapToLines",!1),s.alt(t,r,["auto"]),2===a.length&&s.alt("lineAlign",a[1],["start",rs,"end"]);break;case"position":a=e.split(","),s.percent(t,a[0]),2===a.length&&s.alt("positionAlign",a[1],["start",rs,"end","line-left","line-right","auto"]);break;case"size":s.percent(t,e);break;case"align":s.alt(t,e,["start",rs,"end","left","right"])}},/:/,/\s/),e.region=s.get("region",null),e.vertical=s.get("vertical","");var n=s.get("line","auto");"auto"===n&&-1===as.line&&(n=-1),e.line=n,e.lineAlign=s.get("lineAlign","start"),e.snapToLines=s.get("snapToLines",!0),e.size=s.get("size",100),e.align=s.get("align",rs);var a=s.get("position","auto");"auto"===a&&50===as.position&&(a="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=a}function a(){t=t.replace(/^\s+/,"")}var r=t;if(a(),e.startTime=s(),a(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.substr(3),a(),e.endTime=s(),a(),n(t,e)}function Lt(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function kt(t,e,i,s){for(var n=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=window.VTTCue||window.TextTrackCue,u=0;u<s.rows.length;u++)if(n=s.rows[u],r=!0,o=0,l="",!n.isEmpty()){for(var h=0;h<n.chars.length;h++)n.chars[h].uchar.match(/\s/)&&r?o++:(l+=n.chars[h].uchar,r=!1);n.cueStartTime=e,e===i&&(i+=1e-4),a=new d(e,i,Lt(l.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=u+1:a.line=u>7?u-2:u+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(a)}}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function jt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Ft(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function Gt(t,e,i,s){return Math.min(e,s)-Math.max(t,i)}function Vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Ht(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Kt(t){for(var e=[],i=0;i<t.length;i++)"subtitles"===t[i].kind&&e.push(t[i]);return e}function qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Yt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function zt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Xt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var Jt={};i.d(Jt,"newCue",function(){return kt});var Zt=i(5),te=i.n(Zt),ee=i(2),ie=i(3),se=i(1),ne=i(0),ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},re=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]),oe=function(){function t(e){s(this,t),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function t(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.prototype.onHandlerDestroying=function t(){},t.prototype.onHandlerDestroyed=function t(){},t.prototype.isEventHandler=function t(){return"object"===ae(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function t(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if(re.has(t))throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function t(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function t(e,i){this.onEventGeneric(e,i)},t.prototype.onEventGeneric=function t(e,i){var s=function t(e,i){var s="on"+e.replace("hls","");if("function"!=typeof this[s])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+s+")");return this[s].bind(this,i)};try{s.call(this,e,i).call()}catch(t){ne.b.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(se.a.ERROR,{type:ee.b.OTHER_ERROR,details:ee.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},t}(),le=oe,de=i(9),ue=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),he=function(){function t(){n(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return ue(t,[{key:"uri",get:function t(){return!this._uri&&this.reluri&&(this._uri=te.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),ce=he,pe=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),ve=function(){function t(){var e;a(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(e={},e[t.ElementaryStreamTypes.AUDIO]=!1,e[t.ElementaryStreamTypes.VIDEO]=!1,e)}return t.prototype.addElementaryStream=function t(e){this._elementaryStreams[e]=!0},t.prototype.hasElementaryStream=function t(e){return!0===this._elementaryStreams[e]},t.prototype.createInitializationVector=function t(e){for(var i=new Uint8Array(16),s=12;s<16;s++)i[s]=e>>8*(15-s)&255;return i},t.prototype.fragmentDecryptdataFromLevelkey=function t(e,i){var s=e;return e&&e.method&&e.uri&&!e.iv&&(s=new ce,s.method=e.method,s.baseuri=e.baseuri,s.reluri=e.reluri,s.iv=this.createInitializationVector(i)),s},pe(t,[{key:"url",get:function t(){return!this._url&&this.relurl&&(this._url=te.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function t(e){this._url=e}},{key:"byteRange",get:function t(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var i=this.rawByteRange.split("@",2);if(1===i.length){var s=this.lastByteRangeEndOffset;e[0]=s||0}else e[0]=parseInt(i[1]);e[1]=parseInt(i[0])+e[0],this._byteRange=e}return e}},{key:"byteRangeStartOffset",get:function t(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function t(){return this.byteRange[1]}},{key:"decryptdata",get:function t(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"endProgramDateTime",get:function t(){if(!Object(ie.a)(this.programDateTime))return null;var e=Object(ie.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function t(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function t(){return{AUDIO:"audio",VIDEO:"video"}}}]),t}(),ge=ve,fe=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),me=function(){function t(e){r(this,t),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return fe(t,[{key:"hasProgramDateTime",get:function t(){return!(!this.fragments[0]||!Object(ie.a)(this.fragments[0].programDateTime))}}]),t}(),_e=me,Ee=/^(\d+)x(\d+)$/,Ae=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,ye=function(){function t(e){o(this,t),"string"==typeof e&&(e=t.parseAttrList(e));for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i])}return t.prototype.decimalInteger=function t(e){var i=parseInt(this[e],10);return i>Number.MAX_SAFE_INTEGER?1/0:i},t.prototype.hexadecimalInteger=function t(e){if(this[e]){var i=(this[e]||"0x").slice(2);i=(1&i.length?"0":"")+i;for(var s=new Uint8Array(i.length/2),n=0;n<i.length/2;n++)s[n]=parseInt(i.slice(2*n,2*n+2),16);return s}return null},t.prototype.hexadecimalIntegerAsNumber=function t(e){var i=parseInt(this[e],16);return i>Number.MAX_SAFE_INTEGER?1/0:i},t.prototype.decimalFloatingPoint=function t(e){return parseFloat(this[e])},t.prototype.enumeratedString=function t(e){return this[e]},t.prototype.decimalResolution=function t(e){var i=Ee.exec(this[e]);if(null!==i)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}},t.parseAttrList=function t(e){var i=void 0,s={};for(Ae.lastIndex=0;null!==(i=Ae.exec(e));){var n=i[2],a='"';0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),s[i[1]]=n}return s},t}(),Se=ye,be={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Te=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Ce=/#EXT-X-MEDIA:(.*)/g,De=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ie=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,Re=/\.(mp4|m4s|m4v|m4a)$/i,Pe=function(){function t(){u(this,t)}return t.findGroup=function t(e,i){if(!e)return null;for(var s=null,n=0;n<e.length;n++){var a=e[n];a.id===i&&(s=a)}return s},t.convertAVC1ToAVCOTI=function t(e){var i=void 0,s=e.split(".");return s.length>2?(i=s.shift()+".",i+=parseInt(s.shift()).toString(16),i+=("000"+parseInt(s.shift()).toString(16)).substr(-4)):i=e,i},t.resolve=function t(e,i){return te.a.buildAbsoluteURL(i,e,{alwaysNormalize:!0})},t.parseMasterPlaylist=function e(i,s){function n(t,e){["video","audio"].forEach(function(i){var s=t.filter(function(t){return l(t,i)});if(s.length){var n=s.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[i+"Codec"]=n.length>0?n[0]:s[0],t=t.filter(function(t){return-1===s.indexOf(t)})}}),e.unknownCodecs=t}var a=[],r=void 0;for(Te.lastIndex=0;null!=(r=Te.exec(i));){var o={},d=o.attrs=new Se(r[1]);o.url=t.resolve(r[2],s);var u=d.decimalResolution("RESOLUTION");u&&(o.width=u.width,o.height=u.height),o.bitrate=d.decimalInteger("AVERAGE-BANDWIDTH")||d.decimalInteger("BANDWIDTH"),o.name=d.NAME,n([].concat((d.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=t.convertAVC1ToAVCOTI(o.videoCodec)),a.push(o)}return a},t.parseMasterPlaylistMedia=function e(i,s,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=void 0,o=[],l=0;for(Ce.lastIndex=0;null!==(r=Ce.exec(i));){var d={},u=new Se(r[1]);if(u.TYPE===n){if(d.groupId=u["GROUP-ID"],d.name=u.NAME,d.type=n,d.default="YES"===u.DEFAULT,d.autoselect="YES"===u.AUTOSELECT,d.forced="YES"===u.FORCED,u.URI&&(d.url=t.resolve(u.URI,s)),d.lang=u.LANGUAGE,d.name||(d.name=d.lang),a.length){var h=t.findGroup(a,d.groupId);d.audioCodec=h?h.codec:a[0].codec}d.id=l++,o.push(d)}}return o},t.parseLevelPlaylist=function t(e,i,s,n,a){var r=0,o=0,l=new _e(i),d=new ce,u=0,p=null,v=new ge,g=void 0,f=void 0,m=null;for(De.lastIndex=0;null!==(g=De.exec(e));){var _=g[1];if(_){v.duration=parseFloat(_);var E=(" "+g[2]).slice(1);v.title=E||null,v.tagList.push(E?["INF",_,E]:["INF",_])}else if(g[3]){if(Object(ie.a)(v.duration)){var A=r++;v.type=n,v.start=o,v.levelkey=d,v.sn=A,v.level=s,v.cc=u,v.urlId=a,v.baseurl=i,v.relurl=(" "+g[3]).slice(1),c(v,p),l.fragments.push(v),p=v,o+=v.duration,v=new ge}}else if(g[4]){if(v.rawByteRange=(" "+g[4]).slice(1),p){var y=p.byteRangeEndOffset;y&&(v.lastByteRangeEndOffset=y)}}else if(g[5])v.rawProgramDateTime=(" "+g[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),null===m&&(m=l.fragments.length);else{for(g=g[0].match(Ie),f=1;f<g.length&&void 0===g[f];f++);var S=(" "+g[f+1]).slice(1),b=(" "+g[f+2]).slice(1);switch(g[f]){case"#":v.tagList.push(b?[S,b]:[S]);break;case"PLAYLIST-TYPE":l.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":r=l.startSN=parseInt(S);break;case"TARGETDURATION":l.targetduration=parseFloat(S);break;case"VERSION":l.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":u++,v.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":u=parseInt(S);break;case"KEY":var T=S,C=new Se(T),D=C.enumeratedString("METHOD"),I=C.URI,R=C.hexadecimalInteger("IV");D&&(d=new ce,I&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(D)>=0&&(d.method=D,d.baseuri=i,d.reluri=I,d.key=null,d.iv=R));break;case"START":var P=S,M=new Se(P),O=M.decimalFloatingPoint("TIME-OFFSET");Object(ie.a)(O)&&(l.startTimeOffset=O);break;case"MAP":var L=new Se(S);v.relurl=L.URI,v.rawByteRange=L.BYTERANGE,v.baseurl=i,v.level=s,v.type=n,v.sn="initSegment",l.initSegment=v,v=new ge,v.rawProgramDateTime=l.initSegment.rawProgramDateTime;break;default:ne.b.warn("line parsed but not handled: "+g)}}}return v=p,v&&!v.relurl&&(l.fragments.pop(),o-=v.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=r-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=u,!l.initSegment&&l.fragments.length&&l.fragments.every(function(t){return Re.test(t.relurl)})&&(ne.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),v=new ge,v.relurl=l.fragments[0].relurl,v.baseurl=i,v.level=s,v.type=n,v.sn="initSegment",l.initSegment=v,l.needSidxRanges=!0),m&&h(l.fragments,m),l},t}(),Me=Pe,Oe=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Le=window,ke=Le.performance,we={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ne={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},Ue=function(t){function e(i){p(this,e);var s=v(this,t.call(this,i,se.a.MANIFEST_LOADING,se.a.LEVEL_LOADING,se.a.AUDIO_TRACK_LOADING,se.a.SUBTITLE_TRACK_LOADING));return s.loaders={},s}return g(e,t),e.canHaveQualityLevels=function t(e){return e!==we.AUDIO_TRACK&&e!==we.SUBTITLE_TRACK},e.mapContextToLevelType=function t(e){switch(e.type){case we.AUDIO_TRACK:return Ne.AUDIO;case we.SUBTITLE_TRACK:return Ne.SUBTITLE;default:return Ne.MAIN}},e.getResponseUrl=function t(e,i){var s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=i.url),s},e.prototype.createInternalLoader=function t(e){var i=this.hls.config,s=i.pLoader,n=i.loader,a=s||n,r=new a(i);return e.loader=r,this.loaders[e.type]=r,r},e.prototype.getInternalLoader=function t(e){return this.loaders[e.type]},e.prototype.resetInternalLoader=function t(e){this.loaders[e]&&delete this.loaders[e]},e.prototype.destroyInternalLoaders=function t(){for(var e in this.loaders){var i=this.loaders[e];i&&i.destroy(),this.resetInternalLoader(e)}},e.prototype.destroy=function e(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},e.prototype.onManifestLoading=function t(e){this.load(e.url,{type:we.MANIFEST,level:0,id:null})},e.prototype.onLevelLoading=function t(e){this.load(e.url,{type:we.LEVEL,level:e.level,id:e.id})},e.prototype.onAudioTrackLoading=function t(e){this.load(e.url,{type:we.AUDIO_TRACK,level:null,id:e.id})},e.prototype.onSubtitleTrackLoading=function t(e){this.load(e.url,{type:we.SUBTITLE_TRACK,level:null,id:e.id})},e.prototype.load=function t(e,i){var s=this.hls.config;ne.b.debug("Loading playlist of type "+i.type+", level: "+i.level+", id: "+i.id);var n=this.getInternalLoader(i);if(n){var a=n.context;if(a&&a.url===e)return ne.b.trace("playlist request ongoing"),!1;ne.b.warn("aborting previous loader for type: "+i.type),n.abort()}var r=void 0,o=void 0,l=void 0,d=void 0;switch(i.type){case we.MANIFEST:r=s.manifestLoadingMaxRetry,o=s.manifestLoadingTimeOut,l=s.manifestLoadingRetryDelay,d=s.manifestLoadingMaxRetryTimeout;break;case we.LEVEL:r=0,o=s.levelLoadingTimeOut;break;default:r=s.levelLoadingMaxRetry,o=s.levelLoadingTimeOut,l=s.levelLoadingRetryDelay,d=s.levelLoadingMaxRetryTimeout}n=this.createInternalLoader(i),i.url=e,i.responseType=i.responseType||"";var u={timeout:o,maxRetry:r,retryDelay:l,maxRetryDelay:d},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return ne.b.debug("Calling internal loader delegate for URL: "+e),n.load(i,u,h),!0},e.prototype.loadsuccess=function t(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(s.isSidxRequest)return this._handleSidxRequest(e,s),void this._handlePlaylistLoaded(e,i,s,n);this.resetInternalLoader(s.type);var a=e.data;if(i.tload=ke.now(),0!==a.indexOf("#EXTM3U"))return void this._handleManifestParsingError(e,s,"no EXTM3U delimiter",n);a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,i,s,n):this._handleMasterPlaylist(e,i,s,n)},e.prototype.loaderror=function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(i,s)},e.prototype.loadtimeout=function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(i,s,!0)},e.prototype._handleMasterPlaylist=function t(i,s,n,a){var r=this.hls,o=i.data,l=e.getResponseUrl(i,n),d=Me.parseMasterPlaylist(o,l);if(!d.length)return void this._handleManifestParsingError(i,n,"no level found in manifest",a);var u=d.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),h=Me.parseMasterPlaylistMedia(o,l,"AUDIO",u),c=Me.parseMasterPlaylistMedia(o,l,"SUBTITLES");if(h.length){var p=!1;h.forEach(function(t){t.url||(p=!0)}),!1===p&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(ne.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}r.trigger(se.a.MANIFEST_LOADED,{levels:d,audioTracks:h,subtitles:c,url:l,stats:s,networkDetails:a})},e.prototype._handleTrackOrLevelPlaylist=function t(i,s,n,a){var r=this.hls,o=n.id,l=n.level,d=n.type,u=e.getResponseUrl(i,n),h=Object(ie.a)(o)?o:0,c=Object(ie.a)(l)?l:h,p=e.mapContextToLevelType(n),v=Me.parseLevelPlaylist(i.data,u,c,p,h);if(v.tload=s.tload,d===we.MANIFEST){var g={url:u,details:v};r.trigger(se.a.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:s,networkDetails:a})}if(s.tparsed=ke.now(),v.needSidxRanges){var f=v.initSegment.url;return void this.load(f,{isSidxRequest:!0,type:d,level:l,levelDetails:v,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}n.levelDetails=v,this._handlePlaylistLoaded(i,s,n,a)},e.prototype._handleSidxRequest=function t(e,i){var s=de.a.parseSegmentIndex(new Uint8Array(e.data));s.references.forEach(function(t,e){var s=t.info,n=i.levelDetails.fragments[e];0===n.byteRange.length&&(n.rawByteRange=String(1+s.end-s.start)+"@"+String(s.start))}),i.levelDetails.initSegment.rawByteRange=String(s.moovEndOffset)+"@0"},e.prototype._handleManifestParsingError=function t(e,i,s,n){this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:s,networkDetails:n})},e.prototype._handleNetworkError=function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ne.b.info("A network error occured while loading a "+e.type+"-type playlist");var n=void 0,a=void 0,r=this.getInternalLoader(e);switch(e.type){case we.MANIFEST:n=s?ee.a.MANIFEST_LOAD_TIMEOUT:ee.a.MANIFEST_LOAD_ERROR,a=!0;break;case we.LEVEL:n=s?ee.a.LEVEL_LOAD_TIMEOUT:ee.a.LEVEL_LOAD_ERROR,a=!1;break;case we.AUDIO_TRACK:n=s?ee.a.AUDIO_TRACK_LOAD_TIMEOUT:ee.a.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}r&&(r.abort(),this.resetInternalLoader(e.type)),this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:n,fatal:a,url:r.url,loader:r,context:e,networkDetails:i})},e.prototype._handlePlaylistLoaded=function t(i,s,n,a){var r=n.type,o=n.level,l=n.id,d=n.levelDetails;if(!d.targetduration)return void this._handleManifestParsingError(i,n,"invalid target duration",a);if(e.canHaveQualityLevels(n.type))this.hls.trigger(se.a.LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:s,networkDetails:a});else switch(r){case we.AUDIO_TRACK:this.hls.trigger(se.a.AUDIO_TRACK_LOADED,{details:d,id:l,stats:s,networkDetails:a});break;case we.SUBTITLE_TRACK:this.hls.trigger(se.a.SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:s,networkDetails:a})}},Oe(e,null,[{key:"ContextType",get:function t(){return we}},{key:"LevelType",get:function t(){return Ne}}]),e}(le),Be=Ue,je=function(t){function e(i){f(this,e)
;var s=m(this,t.call(this,i,se.a.FRAG_LOADING));return s.loaders={},s}return _(e,t),e.prototype.destroy=function e(){var i=this.loaders;for(var s in i){var n=i[s];n&&n.destroy()}this.loaders={},t.prototype.destroy.call(this)},e.prototype.onFragLoading=function t(e){var i=e.frag,s=i.type,n=this.loaders,a=this.hls.config,r=a.fLoader,o=a.loader;i.loaded=0;var l=n[s];l&&(ne.b.warn("abort previous fragment loader for type: "+s),l.abort()),l=n[s]=i.loader=a.fLoader?new r(a):new o(a);var d=void 0,u=void 0,h=void 0;d={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var c=i.byteRangeStartOffset,p=i.byteRangeEndOffset;Object(ie.a)(c)&&Object(ie.a)(p)&&(d.rangeStart=c,d.rangeEnd=p),u={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},l.load(d,u,h)},e.prototype.loadsuccess=function t(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.data,r=s.frag;r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(se.a.FRAG_LOADED,{payload:a,frag:r,stats:i,networkDetails:n})},e.prototype.loaderror=function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=i.frag,a=n.loader;a&&a.abort(),this.loaders[n.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.FRAG_LOAD_ERROR,fatal:!1,frag:i.frag,response:e,networkDetails:s})},e.prototype.loadtimeout=function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=i.frag,a=n.loader;a&&a.abort(),this.loaders[n.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i.frag,networkDetails:s})},e.prototype.loadprogress=function t(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=i.frag;a.loaded=e.loaded,this.hls.trigger(se.a.FRAG_LOAD_PROGRESS,{frag:a,stats:e,networkDetails:n})},e}(le),Fe=je,Ge=function(t){function e(i){E(this,e);var s=A(this,t.call(this,i,se.a.KEY_LOADING));return s.loaders={},s.decryptkey=null,s.decrypturl=null,s}return y(e,t),e.prototype.destroy=function t(){for(var e in this.loaders){var i=this.loaders[e];i&&i.destroy()}this.loaders={},le.prototype.destroy.call(this)},e.prototype.onKeyLoading=function t(e){var i=e.frag,s=i.type,n=this.loaders[s],a=i.decryptdata,r=a.uri;if(r!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;n&&(ne.b.warn("abort previous key loader for type:"+s),n.abort()),i.loader=this.loaders[s]=new o.loader(o),this.decrypturl=r,this.decryptkey=null;var l=void 0,d=void 0,u=void 0;l={url:r,frag:i,responseType:"arraybuffer"},d={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},i.loader.load(l,d,u)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(se.a.KEY_LOADED,{frag:i}))},e.prototype.loadsuccess=function t(e,i,s){var n=s.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(se.a.KEY_LOADED,{frag:n})},e.prototype.loaderror=function t(e,i){var s=i.frag,n=s.loader;n&&n.abort(),this.loaders[i.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.KEY_LOAD_ERROR,fatal:!1,frag:s,response:e})},e.prototype.loadtimeout=function t(e,i){var s=i.frag,n=s.loader;n&&n.abort(),this.loaders[i.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:s})},e}(le),Ve=Ge,xe={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},He=function(t){function e(i){S(this,e);var s=b(this,t.call(this,i,se.a.BUFFER_APPENDED,se.a.FRAG_BUFFERED,se.a.FRAG_LOADED));return s.bufferPadding=.2,s.fragments=Object.create(null),s.timeRanges=Object.create(null),s.config=i.config,s}return T(e,t),e.prototype.destroy=function e(){this.fragments=null,this.timeRanges=null,this.config=null,le.prototype.destroy.call(this),t.prototype.destroy.call(this)},e.prototype.getBufferedFrag=function t(e,i){var s=this.fragments,n=Object.keys(s).filter(function(t){var n=s[t];if(n.body.type!==i)return!1;if(!n.buffered)return!1;var a=n.body;return a.startPTS<=e&&e<=a.endPTS});if(0===n.length)return null;var a=n.pop();return s[a].body},e.prototype.detectEvictedFragments=function t(e,i){var s=this,n=void 0,a=void 0;Object.keys(this.fragments).forEach(function(t){var r=s.fragments[t];if(!0===r.buffered){var o=r.range[e];if(o){n=o.time;for(var l=0;l<n.length;l++)if(a=n[l],!1===s.isTimeBuffered(a.startPTS,a.endPTS,i)){s.removeFragment(r.body);break}}}})},e.prototype.detectPartialFragments=function t(e){var i=this,s=this.getFragmentKey(e),n=this.fragments[s];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(t){if(e.hasElementaryStream(t)){var s=i.timeRanges[t];n.range[t]=i.getBufferedTimes(e.startPTS,e.endPTS,s)}}))},e.prototype.getBufferedTimes=function t(e,i,s){for(var n=[],a=void 0,r=void 0,o=!1,l=0;l<s.length;l++){if(a=s.start(l)-this.bufferPadding,r=s.end(l)+this.bufferPadding,e>=a&&i<=r){n.push({startPTS:Math.max(e,s.start(l)),endPTS:Math.min(i,s.end(l))});break}if(e<r&&i>a)n.push({startPTS:Math.max(e,s.start(l)),endPTS:Math.min(i,s.end(l))}),o=!0;else if(i<=a)break}return{time:n,partial:o}},e.prototype.getFragmentKey=function t(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},e.prototype.getPartialFragment=function t(e){var i=this,s=void 0,n=void 0,a=void 0,r=null,o=0;return Object.keys(this.fragments).forEach(function(t){var l=i.fragments[t];i.isPartial(l)&&(n=l.body.startPTS-i.bufferPadding,a=l.body.endPTS+i.bufferPadding,e>=n&&e<=a&&(s=Math.min(e-n,a-e),o<=s&&(r=l.body,o=s)))}),r},e.prototype.getState=function t(e){var i=this.getFragmentKey(e),s=this.fragments[i],n=xe.NOT_LOADED;return void 0!==s&&(n=s.buffered?!0===this.isPartial(s)?xe.PARTIAL:xe.OK:xe.APPENDING),n},e.prototype.isPartial=function t(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},e.prototype.isTimeBuffered=function t(e,i,s){for(var n=void 0,a=void 0,r=0;r<s.length;r++){if(n=s.start(r)-this.bufferPadding,a=s.end(r)+this.bufferPadding,e>=n&&i<=a)return!0;if(i<=n)return!1}return!1},e.prototype.onFragLoaded=function t(e){var i=e.frag;Object(ie.a)(i.sn)&&!i.bitrateTest&&(this.fragments[this.getFragmentKey(i)]={body:i,range:Object.create(null),buffered:!1})},e.prototype.onBufferAppended=function t(e){var i=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var e=i.timeRanges[t];i.detectEvictedFragments(t,e)})},e.prototype.onFragBuffered=function t(e){this.detectPartialFragments(e.frag)},e.prototype.hasFragment=function t(e){var i=this.getFragmentKey(e);return void 0!==this.fragments[i]},e.prototype.removeFragment=function t(e){var i=this.getFragmentKey(e);delete this.fragments[i]},e.prototype.removeAllFragments=function t(){this.fragments=Object.create(null)},e}(le),Ke={search:function t(e,i){for(var s=0,n=e.length-1,a=null,r=null;s<=n;){a=(s+n)/2|0,r=e[a];var o=i(r);if(o>0)s=a+1;else{if(!(o<0))return r;n=a-1}}return null}},qe=Ke,We=function(){function t(){C(this,t)}return t.isBuffered=function t(e,i){try{if(e)for(var s=e.buffered,n=0;n<s.length;n++)if(i>=s.start(n)&&i<=s.end(n))return!0}catch(t){}return!1},t.bufferInfo=function t(e,i,s){try{if(e){var n=e.buffered,a=[],r=void 0;for(r=0;r<n.length;r++)a.push({start:n.start(r),end:n.end(r)});return this.bufferedInfo(a,i,s)}}catch(t){}return{len:0,start:i,end:i,nextStart:void 0}},t.bufferedInfo=function t(e,i,s){var n=[],a=void 0,r=void 0,o=void 0,l=void 0,d=void 0;for(e.sort(function(t,e){return t.start-e.start||e.end-t.end}),d=0;d<e.length;d++){var u=n.length;if(u){var h=n[u-1].end;e[d].start-h<s?e[d].end>h&&(n[u-1].end=e[d].end):n.push(e[d])}else n.push(e[d])}for(d=0,a=0,r=o=i;d<n.length;d++){var c=n[d].start,p=n[d].end;if(i+s>=c&&i<p)r=c,o=p,a=o-i;else if(i+s<c){l=c;break}}return{len:a,start:r,end:o,nextStart:l}},t}(),Ye=i(7),ze=i.n(Ye),$e=i(12),Xe=i.n($e),Qe=i(10),Je=i(4),Ze=Object(Je.a)(),ti=D(),ei=function(){function t(e,i){I(this,t),this.hls=e,this.id=i;var s=this.observer=new ze.a,n=e.config;s.trigger=function t(e){for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];s.emit.apply(s,[e,e].concat(n))},s.off=function t(e){for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];s.removeListener.apply(s,[e].concat(n))};var a=function(t,i){i=i||{},i.frag=this.frag,i.id=this.id,e.trigger(t,i)}.bind(this);s.on(se.a.FRAG_DECRYPTED,a),s.on(se.a.FRAG_PARSING_INIT_SEGMENT,a),s.on(se.a.FRAG_PARSING_DATA,a),s.on(se.a.FRAG_PARSED,a),s.on(se.a.ERROR,a),s.on(se.a.FRAG_PARSING_METADATA,a),s.on(se.a.FRAG_PARSING_USERDATA,a),s.on(se.a.INIT_PTS_FOUND,a);var r={mp4:ti.isTypeSupported("video/mp4"),mpeg:ti.isTypeSupported("audio/mpeg"),mp3:ti.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(n.enableWorker&&"undefined"!=typeof Worker){ne.b.log("demuxing in webworker");var l=void 0;try{l=this.w=Xe()(13),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(t){e.trigger(se.a.ERROR,{type:ee.b.OTHER_ERROR,details:ee.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},l.postMessage({cmd:"init",typeSupported:r,vendor:o,id:i,config:JSON.stringify(n)})}catch(t){ne.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),l&&Ze.URL.revokeObjectURL(l.objectURL),this.demuxer=new Qe.a(s,r,n,o),this.w=void 0}}else this.demuxer=new Qe.a(s,r,n,o)}return t.prototype.destroy=function t(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var i=this.demuxer;i&&(i.destroy(),this.demuxer=null)}var s=this.observer;s&&(s.removeAllListeners(),this.observer=null)},t.prototype.push=function t(e,i,s,n,a,r,o,l){var d=this.w,u=Object(ie.a)(a.startDTS)?a.startDTS:a.start,h=a.decryptdata,c=this.frag,p=!(c&&a.cc===c.cc),v=!(c&&a.level===c.level),g=c&&a.sn===c.sn+1,f=!v&&g;if(p&&ne.b.log(this.id+":discontinuity detected"),v&&ne.b.log(this.id+":switch detected"),this.frag=a,d)d.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:i,audioCodec:s,videoCodec:n,timeOffset:u,discontinuity:p,trackSwitch:v,contiguous:f,duration:r,accurateTimeOffset:o,defaultInitPTS:l},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,h,i,s,n,u,p,v,f,r,o,l)}},t.prototype.onWorkerMessage=function t(e){var i=e.data,s=this.hls;switch(i.event){case"init":Ze.URL.revokeObjectURL(this.w.objectURL);break;case se.a.FRAG_PARSING_DATA:i.data.data1=new Uint8Array(i.data1),i.data2&&(i.data.data2=new Uint8Array(i.data2));default:i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,s.trigger(i.event,i.data)}},t}(),ii=ei,si={toString:function t(e){for(var i="",s=e.length,n=0;n<s;n++)i+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return i}},ni=si,ai=function(t){function e(i){G(this,e);for(var s=arguments.length,n=Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];var r=V(this,t.call.apply(t,[this,i].concat(n)));return r._tickInterval=null,r._tickTimer=null,r._tickCallCount=0,r._boundTick=r.tick.bind(r),r}return x(e,t),e.prototype.onHandlerDestroying=function t(){this.clearNextTick(),this.clearInterval()},e.prototype.hasInterval=function t(){return!!this._tickInterval},e.prototype.hasNextTick=function t(){return!!this._tickTimer},e.prototype.setInterval=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,t),!0)}),e.prototype.clearInterval=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),e.prototype.clearNextTick=function t(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.prototype.tick=function t(){1==++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},e.prototype.doTick=function t(){},e}(le),ri=ai,oi=1e3,li=.5,di=function(){function t(e,i,s,n){Y(this,t),this.config=e,this.media=i,this.fragmentTracker=s,this.hls=n,this.stallReported=!1}return t.prototype.poll=function t(e,i){var s=this.config,n=this.media,a=n.currentTime,r=window.performance.now();if(a!==e)return this.stallReported&&(ne.b.warn("playback not stuck anymore @"+a+", after "+Math.round(r-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||n.readyState>2||n.seeking&&We.isBuffered(n,a))){var o=r-this.stalled,l=We.bufferInfo(n,a,s.maxBufferHole);if(!this.stalled)return void(this.stalled=r);o>=1e3&&this._reportStall(l.len),this._tryFixBufferStall(l,o)}},t.prototype._tryFixBufferStall=function t(e,i){var s=this.config,n=this.fragmentTracker,a=this.media,r=a.currentTime,o=n.getPartialFragment(r);o&&this._trySkipBufferHole(o),e.len>.5&&i>1e3*s.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t.prototype._reportStall=function t(e){var i=this.hls,s=this.media;this.stallReported||(this.stallReported=!0,ne.b.warn("Playback stalling at @"+s.currentTime+" due to low buffer"),i.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t.prototype._trySkipBufferHole=function t(e){for(var i=this.hls,s=this.media,n=s.currentTime,a=0,r=0;r<s.buffered.length;r++){var o=s.buffered.start(r);if(n>=a&&n<o)return s.currentTime=Math.max(o,s.currentTime+.1),ne.b.warn("skipping hole, adjusting currentTime from "+n+" to "+s.currentTime),this.stalled=null,void i.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+s.currentTime,frag:e});a=s.buffered.end(r)}},t.prototype._tryNudgeBuffer=function t(){var e=this.config,i=this.hls,s=this.media,n=s.currentTime,a=(this.nudgeRetry||0)+1;if(this.nudgeRetry=a,a<e.nudgeMaxRetry){var r=n+a*e.nudgeOffset;ne.b.log("adjust currentTime from "+n+" to "+r),s.currentTime=r,i.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else ne.b.error("still stuck in high buffer @"+n+" after "+e.nudgeMaxRetry+", raise fatal error"),i.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_STALLED_ERROR,fatal:!0})},t}(),ui=di,hi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),ci={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},pi=function(t){function e(i,s){z(this,e);var n=$(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.MANIFEST_LOADING,se.a.MANIFEST_PARSED,se.a.LEVEL_LOADED,se.a.KEY_LOADED,se.a.FRAG_LOADED,se.a.FRAG_LOAD_EMERGENCY_ABORTED,se.a.FRAG_PARSING_INIT_SEGMENT,se.a.FRAG_PARSING_DATA,se.a.FRAG_PARSED,se.a.ERROR,se.a.AUDIO_TRACK_SWITCHING,se.a.AUDIO_TRACK_SWITCHED,se.a.BUFFER_CREATED,se.a.BUFFER_APPENDED,se.a.BUFFER_FLUSHED));return n.fragmentTracker=s,n.config=i.config,n.audioCodecSwap=!1,n._state=ci.STOPPED,n.stallReported=!1,n.gapController=null,n}return X(e,t),e.prototype.onHandlerDestroying=function e(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function e(){this.state=ci.STOPPED,this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},e.prototype.startLoad=function t(e){if(this.levels){var i=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=s.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=s.nextLoadLevel=n,this.loadedmetadata=!1}i>0&&-1===e&&(ne.b.log("override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i),this.state=ci.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=ci.STOPPED},e.prototype.stopLoad=function t(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=ci.STOPPED,this.forceStartLoad=!1},e.prototype.doTick=function t(){switch(this.state){case ci.BUFFER_FLUSHING:this.fragLoadError=0;break;case ci.IDLE:this._doTickIdle();break;case ci.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=ci.IDLE);break;case ci.FRAG_LOADING_WAITING_RETRY:var i=window.performance.now(),s=this.retryDate;(!s||i>=s||this.media&&this.media.seeking)&&(ne.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ci.IDLE);break;case ci.ERROR:case ci.STOPPED:case ci.FRAG_LOADING:case ci.PARSING:case ci.PARSED:case ci.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},e.prototype._doTickIdle=function t(){var e=this.hls,i=e.config,s=this.media;if(void 0!==this.levelLastLoaded&&(s||!this.startFragRequested&&i.startFragPrefetch)){var n=void 0;n=this.loadedmetadata?s.currentTime:this.nextLoadPosition;var a=e.nextLoadLevel,r=this.levels[a];if(r){var o=r.bitrate,l=void 0;l=o?Math.max(8*i.maxBufferSize/o,i.maxBufferLength):i.maxBufferLength,l=Math.min(l,i.maxMaxBufferLength);var d=We.bufferInfo(this.mediaBuffer?this.mediaBuffer:s,n,i.maxBufferHole),u=d.len;if(!(u>=l)){ne.b.trace("buffer length of "+u.toFixed(3)+" is below max of "+l.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=a;var h=r.details;if(!h||h.live&&this.levelLastLoaded!==a)return void(this.state=ci.WAITING_LEVEL);var c=this.fragPrevious;if(!h.live&&c&&!c.backtracked&&c.sn===h.endSN&&!d.nextStart&&Math.min(s.duration,c.start+c.duration)-Math.max(d.end,c.start)<=Math.max(.2,c.duration)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(se.a.BUFFER_EOS,p),void(this.state=ci.ENDED)}this._fetchPayloadOrEos(n,d,h)}}}},e.prototype._fetchPayloadOrEos=function t(e,i,s){var n=this.fragPrevious,a=this.level,r=s.fragments,o=r.length;if(0!==o){var l=r[0].start,d=r[o-1].start+r[o-1].duration,u=i.end,h=void 0;if(s.initSegment&&!s.initSegment.data)h=s.initSegment;else if(s.live){var c=this.config.initialLiveManifestSize;if(o<c)return void ne.b.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+c);if(null===(h=this._ensureFragmentAtLivePoint(s,u,l,d,n,r,o)))return}else u<l&&(h=r[0]);h||(h=this._findFragment(l,n,o,r,u,d,s)),h&&(h.encrypted?(ne.b.log("Loading key for "+h.sn+" of ["+s.startSN+" ,"+s.endSN+"],level "+a),this._loadKey(h)):(ne.b.log("Loading "+h.sn+" of ["+s.startSN+" ,"+s.endSN+"],level "+a+", currentTime:"+e.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(h)))}},e.prototype._ensureFragmentAtLivePoint=function t(e,i,s,n,a,r,o){var l=this.hls.config,d=this.media,u=void 0,h=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*e.targetduration;if(i<Math.max(s-l.maxFragLookUpTolerance,n-h)){var c=this.liveSyncPosition=this.computeLivePosition(s,e);ne.b.log("buffer end: "+i.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),i=c,d&&d.readyState&&d.duration>c&&(d.currentTime=c),this.nextLoadPosition=c}if(e.PTSKnown&&i>n&&d&&d.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(a)if(e.hasProgramDateTime)ne.b.log("live playlist, switching playlist, load frag with same PDT: "+a.programDateTime),u=H(r,a.endProgramDateTime,l.maxFragLookUpTolerance);else{var p=a.sn+1;if(p>=e.startSN&&p<=e.endSN){var v=r[p-e.startSN];a.cc===v.cc&&(u=v,ne.b.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=qe.search(r,function(t){return a.cc-t.cc}))&&ne.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}u||(u=r[Math.min(o-1,Math.round(o/2))],ne.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u},e.prototype._findFragment=function t(e,i,s,n,a,r,o){var l=this.hls.config,d=void 0;if(d=a<r?K(i,n,a,a>r-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance):n[s-1]){var u=d.sn-o.startSN,h=i&&d.level===i.level,c=n[u-1],p=n[u+1];if(i&&d.sn===i.sn)if(h&&!d.backtracked)if(d.sn<o.endSN){var v=i.deltaPTS;v&&v>l.maxBufferHole&&i.dropped&&u?(d=c,ne.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(d=p,ne.b.log("SN just loaded, load next one: "+d.sn,d))}else d=null;else d.backtracked&&(p&&p.backtracked?(ne.b.warn("Already backtracked from fragment "+p.sn+", will not backtrack to fragment "+d.sn+". Loading fragment "+p.sn),d=p):(ne.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),d.dropped=0,c?(d=c,d.backtracked=!0):u&&(d=null)))}return d},e.prototype._loadKey=function t(e){this.state=ci.KEY_LOADING,this.hls.trigger(se.a.KEY_LOADING,{frag:e})},e.prototype._loadFragment=function t(e){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,Object(ie.a)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===xe.NOT_LOADED||i===xe.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(se.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new ii(this.hls,"main")),this.state=ci.FRAG_LOADING):i===xe.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},e.prototype.getBufferedFrag=function t(e){return this.fragmentTracker.getBufferedFrag(e,Be.LevelType.MAIN)},e.prototype.followingBufferedFrag=function t(e){return e?this.getBufferedFrag(e.endPTS+.5):null},e.prototype._checkFragmentChanged=function t(){var e=void 0,i=void 0,s=this.media;if(s&&s.readyState&&!1===s.seeking&&(i=s.currentTime,i>this.lastCurrentTime&&(this.lastCurrentTime=i),We.isBuffered(s,i)?e=this.getBufferedFrag(i):We.isBuffered(s,i+.1)&&(e=this.getBufferedFrag(i+.1)),e)){var n=e;if(n!==this.fragPlaying){this.hls.trigger(se.a.FRAG_CHANGED,{frag:n});var a=n.level;this.fragPlaying&&this.fragPlaying.level===a||this.hls.trigger(se.a.LEVEL_SWITCHED,{level:a}),this.fragPlaying=n}}},e.prototype.immediateLevelSwitch=function t(){if(ne.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,i=void 0;e?(i=e.paused,e.pause()):i=!0,this.previouslyPaused=i}var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.prototype.immediateLevelSwitchEnd=function t(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,We.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},e.prototype.nextLevelSwitch=function t(){var e=this.media;if(e&&e.readyState){var i=void 0,s=void 0,n=void 0;if(s=this.getBufferedFrag(e.currentTime),s&&s.startPTS>1&&this.flushMainBuffer(0,s.startPTS-1),e.paused)i=0;else{var a=this.hls.nextLoadLevel,r=this.levels[a],o=this.fragLastKbps;i=o&&this.fragCurrent?this.fragCurrent.duration*r.bitrate/(1e3*o)+1:0}if((n=this.getBufferedFrag(e.currentTime+i))&&(n=this.followingBufferedFrag(n))){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY)}}},e.prototype.flushMainBuffer=function t(e,i){this.state=ci.BUFFER_FLUSHING;var s={startOffset:e,endOffset:i};this.altAudio&&(s.type="video"),this.hls.trigger(se.a.BUFFER_FLUSHING,s)},e.prototype.onMediaAttached=function t(e){var i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("seeked",this.onvseeked),i.addEventListener("ended",this.onvended);var s=this.config;this.levels&&s.autoStartLoad&&this.hls.startLoad(s.startPosition),this.gapController=new ui(s,i,this.fragmentTracker,this.hls)},e.prototype.onMediaDetaching=function t(){var e=this.media;e&&e.ended&&(ne.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var i=this.levels;i&&i.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function t(){var e=this.media,i=e?e.currentTime:void 0,s=this.config;Object(ie.a)(i)&&ne.b.log("media seeking to "+i.toFixed(3));var n=this.mediaBuffer?this.mediaBuffer:e,a=We.bufferInfo(n,i,this.config.maxBufferHole);if(this.state===ci.FRAG_LOADING){var r=this.fragCurrent;if(0===a.len&&r){var o=s.maxFragLookUpTolerance,l=r.start-o,d=r.start+r.duration+o;i<l||i>d?(r.loader&&(ne.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ci.IDLE):ne.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===ci.ENDED&&(0===a.len&&(this.fragPrevious=0),this.state=ci.IDLE);e&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},e.prototype.onMediaSeeked=function t(){var e=this.media,i=e?e.currentTime:void 0;Object(ie.a)(i)&&ne.b.log("media seeked to "+i.toFixed(3)),this.tick()},e.prototype.onMediaEnded=function t(){ne.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestLoading=function t(){ne.b.log("trigger BUFFER_RESET"),this.hls.trigger(se.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestParsed=function t(e){var i=!1,s=!1,n=void 0;e.levels.forEach(function(t){(n=t.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(i=!0),-1!==n.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=i&&s,this.audioCodecSwitch&&ne.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var a=this.config;(a.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(a.startPosition)},e.prototype.onLevelLoaded=function t(e){var i=e.details,s=e.level,n=this.levels[this.levelLastLoaded],a=this.levels[s],r=i.totalduration,o=0;if(ne.b.log("level "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+r),i.live){var l=a.details;l&&i.fragments.length>0?(O(l,i),o=i.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,l),i.PTSKnown&&Object(ie.a)(o)?ne.b.log("live playlist sliding:"+o.toFixed(3)):(ne.b.log("live playlist - outdated PTS, unknown sliding"),B(this.fragPrevious,n,i))):(ne.b.log("live playlist - first load, unknown sliding"),i.PTSKnown=!1,B(this.fragPrevious,n,i))}else i.PTSKnown=!1;if(a.details=i,this.levelLastLoaded=s,this.hls.trigger(se.a.LEVEL_UPDATED,{details:i,level:s}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=i.startTimeOffset;Object(ie.a)(d)?(d<0&&(ne.b.log("negative start time offset "+d+", count from end of last fragment"),d=o+r+d),ne.b.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):i.live?(this.startPosition=this.computeLivePosition(o,i),ne.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===ci.WAITING_LEVEL&&(this.state=ci.IDLE),this.tick()},e.prototype.onKeyLoaded=function t(){this.state===ci.KEY_LOADING&&(this.state=ci.IDLE,this.tick())},e.prototype.onFragLoaded=function t(e){var i=this.fragCurrent,s=this.hls,n=this.levels,a=this.media,r=e.frag;if(this.state===ci.FRAG_LOADING&&i&&"main"===r.type&&r.level===i.level&&r.sn===i.sn){var o=e.stats,l=n[i.level],d=l.details;if(this.bitrateTest=!1,this.stats=o,ne.b.log("Loaded "+i.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+i.level),r.bitrateTest&&s.nextLoadLevel)this.state=ci.IDLE,this.startFragRequested=!1,o.tparsed=o.tbuffered=window.performance.now(),s.trigger(se.a.FRAG_BUFFERED,{stats:o,frag:i,id:"main"}),this.tick();else if("initSegment"===r.sn)this.state=ci.IDLE,o.tparsed=o.tbuffered=window.performance.now(),d.initSegment.data=e.payload,s.trigger(se.a.FRAG_BUFFERED,{stats:o,frag:i,id:"main"}),this.tick();else{ne.b.log("Parsing "+i.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+i.level+", cc "+i.cc),this.state=ci.PARSING,this.pendingBuffering=!0,this.appended=!1,r.bitrateTest&&(r.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:r}));var u=!(a&&a.seeking)&&(d.PTSKnown||!d.live),h=d.initSegment?d.initSegment.data:[],c=this._getAudioCodec(l),p=this.demuxer=this.demuxer||new ii(this.hls,"main");p.push(e.payload,h,c,l.videoCodec,i,d.totalduration,u)}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function t(e){var i=this.fragCurrent,s=e.frag;if(i&&"main"===e.id&&s.sn===i.sn&&s.level===i.level&&this.state===ci.PARSING){var n=e.tracks,a=void 0,r=void 0;if(n.audio&&this.altAudio&&delete n.audio,r=n.audio){var o=this.levels[this.level].audioCodec,l=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(ne.b.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===l.indexOf("firefox")&&(o="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==r.container&&(o="mp4a.40.2",ne.b.log("Android: force audio codec to "+o)),r.levelCodec=o,r.id=e.id}r=n.video,r&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=e.id),this.hls.trigger(se.a.BUFFER_CODECS,n);for(a in n){r=n[a],ne.b.log("main track:"+a+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var d=r.initSegment;d&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(se.a.BUFFER_APPENDING,{type:a,data:d,parent:"main",content:"initSegment"}))}this.tick()}},e.prototype.onFragParsingData=function t(e){var i=this,s=this.fragCurrent,n=e.frag;if(s&&"main"===e.id&&n.sn===s.sn&&n.level===s.level&&("audio"!==e.type||!this.altAudio)&&this.state===ci.PARSING){var a=this.levels[this.level],r=s;if(Object(ie.a)(e.endPTS)||(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),!0===e.hasAudio&&r.addElementaryStream(ge.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&r.addElementaryStream(ge.ElementaryStreamTypes.VIDEO),ne.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(r.dropped=e.dropped,r.dropped)if(r.backtracked)ne.b.warn("Already backtracked on this fragment, appending with the gap",r.sn);else{var o=a.details;if(!o||r.sn!==o.startSN)return ne.b.warn("missing video frame(s), backtracking fragment",r.sn),this.fragmentTracker.removeFragment(r),r.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ci.IDLE,this.fragPrevious=r,void this.tick();ne.b.warn("missing video frame(s) on first frag, appending with gap",r.sn)}else r.backtracked=!1;var l=M(a.details,r,e.startPTS,e.endPTS,e.startDTS,e.endDTS),d=this.hls;d.trigger(se.a.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,
drift:l,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&i.state===ci.PARSING&&(i.appended=!0,i.pendingBuffering=!0,d.trigger(se.a.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},e.prototype.onFragParsed=function t(e){var i=this.fragCurrent,s=e.frag;i&&"main"===e.id&&s.sn===i.sn&&s.level===i.level&&this.state===ci.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=ci.PARSED,this._checkAppendedParsed())},e.prototype.onAudioTrackSwitching=function t(e){var i=!!e.url,s=e.id;if(!i){if(this.mediaBuffer!==this.media){ne.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(ne.b.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ci.IDLE}var a=this.hls;a.trigger(se.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:s}),this.altAudio=!1}},e.prototype.onAudioTrackSwitched=function t(e){var i=e.id,s=!!this.hls.audioTracks[i].url;if(s){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(ne.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s,this.tick()},e.prototype.onBufferCreated=function t(e){var i=e.tracks,s=void 0,n=void 0,a=!1;for(var r in i){var o=i[r];"main"===o.id?(n=r,s=o,"video"===r&&(this.videoBuffer=i[r].buffer)):a=!0}a&&s?(ne.b.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},e.prototype.onBufferAppended=function t(e){if("main"===e.parent){var i=this.state;i!==ci.PARSING&&i!==ci.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function t(){if(!(this.state!==ci.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var i=this.mediaBuffer?this.mediaBuffer:this.media;ne.b.log("main buffered : "+ni.toString(i.buffered)),this.fragPrevious=e;var s=this.stats;s.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*s.total/(s.tbuffered-s.tfirst)),this.hls.trigger(se.a.FRAG_BUFFERED,{stats:s,frag:e,id:"main"}),this.state=ci.IDLE}this.tick()}},e.prototype.onError=function t(e){var i=e.frag||this.fragCurrent;if(!i||"main"===i.type){var s=!!this.media&&We.isBuffered(this.media,this.media.currentTime)&&We.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:case ee.a.KEY_LOAD_ERROR:case ee.a.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);ne.b.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ci.FRAG_LOADING_WAITING_RETRY}else ne.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=ci.ERROR;break;case ee.a.LEVEL_LOAD_ERROR:case ee.a.LEVEL_LOAD_TIMEOUT:this.state!==ci.ERROR&&(e.fatal?(this.state=ci.ERROR,ne.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==ci.WAITING_LEVEL||(this.state=ci.IDLE));break;case ee.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==ci.PARSING&&this.state!==ci.PARSED||(s?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ci.IDLE):(ne.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},e.prototype._reduceMaxBufferLength=function t(e){var i=this.config;return i.maxMaxBufferLength>=e&&(i.maxMaxBufferLength/=2,ne.b.warn("main:reduce max buffer length to "+i.maxMaxBufferLength+"s"),!0)},e.prototype._checkBuffer=function t(){var e=this.media;if(e&&0!==e.readyState){var i=this.mediaBuffer?this.mediaBuffer:e,s=i.buffered;!this.loadedmetadata&&s.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,s)}},e.prototype.onFragLoadEmergencyAborted=function t(){this.state=ci.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},e.prototype.onBufferFlushed=function t(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(ge.ElementaryStreamTypes.VIDEO,e.buffered),this.state=ci.IDLE,this.fragPrevious=null},e.prototype.swapAudioCodec=function t(){this.audioCodecSwap=!this.audioCodecSwap},e.prototype.computeLivePosition=function t(e,i){var s=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*i.targetduration;return e+Math.max(0,i.totalduration-s)},e.prototype._seekToStartPos=function t(){var e=this.media,i=e.currentTime,s=e.seeking?i:this.startPosition;i!==s&&(ne.b.log("target start position not buffered, seek to buffered.start(0) "+s+" from current time "+i+" "),e.currentTime=s)},e.prototype._getAudioCodec=function t(e){var i=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(ne.b.log("swapping playlist audio codec"),i&&(i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),i},hi(e,[{key:"state",set:function t(e){if(this.state!==e){var i=this.state;this._state=e,ne.b.log("main stream:"+i+"->"+e),this.hls.trigger(se.a.STREAM_STATE_TRANSITION,{previousState:i,nextState:e})}},get:function t(){return this._state}},{key:"currentLevel",get:function t(){var e=this.media;if(e){var i=this.getBufferedFrag(e.currentTime);if(i)return i.level}return-1}},{key:"nextBufferedFrag",get:function t(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function t(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function t(){return this._liveSyncPosition},set:function t(e){this._liveSyncPosition=e}}]),e}(ri),vi=pi,gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),mi=window,_i=mi.performance,Ei=function(t){function e(i){Q(this,e);var s=J(this,t.call(this,i,se.a.MANIFEST_LOADED,se.a.LEVEL_LOADED,se.a.AUDIO_TRACK_SWITCHED,se.a.FRAG_LOADED,se.a.ERROR));return s.canload=!1,s.currentLevelIndex=null,s.manualLevelIndex=-1,s.timer=null,s}return Z(e,t),e.prototype.onHandlerDestroying=function t(){this.clearTimer(),this.manualLevelIndex=-1},e.prototype.clearTimer=function t(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function t(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function t(){this.canload=!1},e.prototype.onManifestLoaded=function t(e){var i=[],s=void 0,n={},a=null,r=!1,o=!1,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=[];if(e.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,r=r||!!t.videoCodec,o=o||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),l&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),a=n[t.bitrate],a?a.url.push(t.url):(t.url=[t.url],t.urlId=0,n[t.bitrate]=t,i.push(t)),t.attrs&&t.attrs.AUDIO&&R(a||t,"audio",t.attrs.AUDIO),t.attrs&&t.attrs.SUBTITLES&&R(a||t,"text",t.attrs.SUBTITLES)}),r&&o&&(i=i.filter(function(t){return!!t.videoCodec})),i=i.filter(function(t){var e=t.audioCodec,i=t.videoCodec;return(!e||d(e))&&(!i||d(i))}),e.audioTracks&&(u=e.audioTracks.filter(function(t){return!t.audioCodec||d(t.audioCodec,"audio")}),u.forEach(function(t,e){t.id=e})),i.length>0){s=i[0].bitrate,i.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=i;for(var h=0;h<i.length;h++)if(i[h].bitrate===s){this._firstLevel=h,ne.b.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+s);break}this.hls.trigger(se.a.MANIFEST_PARSED,{levels:i,audioTracks:u,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:r,altAudio:u.length>0&&r})}else this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},e.prototype.setLevelInternal=function t(e){var i=this._levels,s=this.hls;if(e>=0&&e<i.length){if(this.clearTimer(),this.currentLevelIndex!==e){ne.b.log("switching to level "+e),this.currentLevelIndex=e;var n=i[e];n.level=e,s.trigger(se.a.LEVEL_SWITCHING,n)}var a=i[e],r=a.details;if(!r||r.live){var o=a.urlId;s.trigger(se.a.LEVEL_LOADING,{url:a.url[o],level:e,id:o})}}else s.trigger(se.a.ERROR,{type:ee.b.OTHER_ERROR,details:ee.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},e.prototype.onError=function t(e){if(e.fatal)return void(e.type===ee.b.NETWORK_ERROR&&this.clearTimer());var i=!1,s=!1,n=void 0;switch(e.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:case ee.a.KEY_LOAD_ERROR:case ee.a.KEY_LOAD_TIMEOUT:n=e.frag.level,s=!0;break;case ee.a.LEVEL_LOAD_ERROR:case ee.a.LEVEL_LOAD_TIMEOUT:n=e.context.level,i=!0;break;case ee.a.REMUX_ALLOC_ERROR:n=e.level,i=!0}void 0!==n&&this.recoverLevel(e,n,i,s)},e.prototype.recoverLevel=function t(e,i,s,n){var a=this,r=this.hls.config,o=e.details,l=this._levels[i],d=void 0,u=void 0,h=void 0;if(l.loadError++,l.fragmentError=n,s){if(!(this.levelRetryCount+1<=r.levelLoadingMaxRetry))return ne.b.error("level controller, cannot recover from "+o+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return a.loadLevel()},u),e.levelRetry=!0,this.levelRetryCount++,ne.b.warn("level controller, "+o+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}(s||n)&&(d=l.url.length,d>1&&l.loadError<d?(l.urlId=(l.urlId+1)%d,l.details=void 0,ne.b.warn("level controller, "+o+" for level "+i+": switching to redundant URL-id "+l.urlId)):-1===this.manualLevelIndex?(h=0===i?this._levels.length-1:i-1,ne.b.warn("level controller, "+o+": switch to "+h),this.hls.nextAutoLevel=this.currentLevelIndex=h):n&&(ne.b.warn("level controller, "+o+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function t(e){var i=e.frag;if(void 0!==i&&"main"===i.type){var s=this._levels[i.level];void 0!==s&&(s.fragmentError=!1,s.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function t(e){var i=this,s=e.level;if(s===this.currentLevelIndex){var n=this._levels[s];n.fragmentError||(n.loadError=0,this.levelRetryCount=0);var a=e.details;if(a.live){var r=1e3*(a.averagetargetduration?a.averagetargetduration:a.targetduration),o=r,l=n.details;l&&a.endSN===l.endSN&&(o/=2,ne.b.log("same live playlist, reload twice faster")),o-=_i.now()-e.stats.trequest,o=Math.max(r/2,Math.round(o)),ne.b.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout(function(){return i.loadLevel()},o)}else this.clearTimer()}},e.prototype.onAudioTrackSwitched=function t(e){var i=this.hls.audioTracks[e.id].groupId,s=this.hls.levels[this.currentLevelIndex];if(s&&s.audioGroupIds){var n=s.audioGroupIds.findIndex(function(t){return t===i});n!==s.urlId&&(s.urlId=n,this.startLoad())}},e.prototype.loadLevel=function t(){if(ne.b.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"===(void 0===e?"undefined":gi(e))&&e.url.length>0){var i=this.currentLevelIndex,s=e.urlId,n=e.url[s];ne.b.log("Attempt loading level index "+i+" with URL-id "+s),this.hls.trigger(se.a.LEVEL_LOADING,{url:n,level:i,id:s})}}},fi(e,[{key:"levels",get:function t(){return this._levels}},{key:"level",get:function t(){return this.currentLevelIndex},set:function t(e){var i=this._levels;i&&(e=Math.min(e,i.length-1),this.currentLevelIndex===e&&i[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function t(){return this.manualLevelIndex},set:function t(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function t(){return this._firstLevel},set:function t(e){this._firstLevel=e}},{key:"startLevel",get:function t(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function t(e){this._startLevel=e}},{key:"nextLoadLevel",get:function t(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function t(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),e}(le),Ai=Ei,yi=i(6),Si=function(t){function e(i){it(this,e);var s=st(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.FRAG_PARSING_METADATA));return s.id3Track=void 0,s.media=void 0,s}return nt(e,t),e.prototype.destroy=function t(){le.prototype.destroy.call(this)},e.prototype.onMediaAttached=function t(e){this.media=e.media,this.media},e.prototype.onMediaDetaching=function t(){et(this.id3Track),this.id3Track=void 0,this.media=void 0},e.prototype.getID3Track=function t(e){for(var i=0;i<e.length;i++){var s=e[i];if("metadata"===s.kind&&"id3"===s.label)return tt(s,this.media),s}return this.media.addTextTrack("metadata","id3")},e.prototype.onFragParsingMetadata=function t(e){var i=e.frag,s=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,a=0;a<s.length;a++){var r=yi.a.getID3Frames(s[a].data);if(r){var o=s[a].pts,l=a<s.length-1?s[a+1].pts:i.endPTS;o===l&&(l+=1e-4);for(var d=0;d<r.length;d++){var u=r[d];if(!yi.a.isTimeStampFrame(u)){var h=new n(o,l,"");h.value=u,this.id3Track.addCue(h)}}}}},e}(le),bi=Si,Ti=function(){function t(e){rt(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function t(e,i){var s=Math.pow(this.alpha_,e);this.estimate_=i*(1-s)+s*this.estimate_,this.totalWeight_+=e},t.prototype.getTotalWeight=function t(){return this.totalWeight_},t.prototype.getEstimate=function t(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},t}(),Ci=Ti,Di=function(){function t(e,i,s,n){ot(this,t),this.hls=e,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ci(i),this.fast_=new Ci(s)}return t.prototype.sample=function t(e,i){e=Math.max(e,this.minDelayMs_);var s=8e3*i/e,n=e/1e3;this.fast_.sample(n,s),this.slow_.sample(n,s)},t.prototype.canEstimate=function t(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function t(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function t(){},t}(),Ii=Di,Ri=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Pi=window,Mi=Pi.performance,Oi=function(t){function e(i){lt(this,e);var s=dt(this,t.call(this,i,se.a.FRAG_LOADING,se.a.FRAG_LOADED,se.a.FRAG_BUFFERED,se.a.ERROR));return s.lastLoadedFragLevel=0,s._nextAutoLevel=-1,s.hls=i,s.timer=null,s._bwEstimator=null,s.onCheck=s._abandonRulesCheck.bind(s),s}return ut(e,t),e.prototype.destroy=function t(){this.clearTimer(),le.prototype.destroy.call(this)},e.prototype.onFragLoading=function t(e){var i=e.frag;if("main"===i.type&&(this.timer||(this.fragCurrent=i,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var s=this.hls,n=s.config,a=i.level,r=s.levels[a].details.live,o=void 0,l=void 0;r?(o=n.abrEwmaFastLive,l=n.abrEwmaSlowLive):(o=n.abrEwmaFastVoD,l=n.abrEwmaSlowVoD),this._bwEstimator=new Ii(s,l,o,n.abrEwmaDefaultEstimate)}},e.prototype._abandonRulesCheck=function t(){var e=this.hls,i=e.media,s=this.fragCurrent;if(s){var n=s.loader,a=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return ne.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var r=n.stats;if(i&&r&&(!i.paused&&0!==i.playbackRate||!i.readyState)&&s.autoLevel&&s.level){var o=Mi.now()-r.trequest,l=Math.abs(i.playbackRate);if(o>500*s.duration/l){var d=e.levels,u=Math.max(1,r.bw?r.bw/8:1e3*r.loaded/o),h=d[s.level],c=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,p=r.total?r.total:Math.max(r.loaded,Math.round(s.duration*c/8)),v=i.currentTime,g=(p-r.loaded)/u,f=(We.bufferInfo(i,v,e.config.maxBufferHole).end-v)/l;if(f<2*s.duration/l&&g>f){var m=void 0,_=void 0;for(_=s.level-1;_>a;_--){var E=d[_].realBitrate?Math.max(d[_].realBitrate,d[_].bitrate):d[_].bitrate;if((m=s.duration*E/(6.4*u))<f)break}m<g&&(ne.b.warn("loading too slow, abort fragment loading and switch to level "+_+":fragLoadedDelay["+_+"]<fragLoadedDelay["+(s.level-1)+"];bufferStarvationDelay:"+m.toFixed(1)+"<"+g.toFixed(1)+":"+f.toFixed(1)),e.nextLoadLevel=_,this._bwEstimator.sample(o,r.loaded),n.abort(),this.clearTimer(),e.trigger(se.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,stats:r}))}}}}},e.prototype.onFragLoaded=function t(e){var i=e.frag;if("main"===i.type&&Object(ie.a)(i.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[i.level],n=(s.loaded?s.loaded.bytes:0)+e.stats.loaded,a=(s.loaded?s.loaded.duration:0)+e.frag.duration;s.loaded={bytes:n,duration:a},s.realBitrate=Math.round(8*n/a)}if(e.frag.bitrateTest){var r=e.stats;r.tparsed=r.tbuffered=r.tload,this.onFragBuffered(e)}}},e.prototype.onFragBuffered=function t(e){var i=e.stats,s=e.frag;if(!0!==i.aborted&&"main"===s.type&&Object(ie.a)(s.sn)&&(!s.bitrateTest||i.tload===i.tbuffered)){var n=i.tparsed-i.trequest;ne.b.log("latency/loading/parsing/append/kbps:"+Math.round(i.tfirst-i.trequest)+"/"+Math.round(i.tload-i.tfirst)+"/"+Math.round(i.tparsed-i.tload)+"/"+Math.round(i.tbuffered-i.tparsed)+"/"+Math.round(8*i.loaded/(i.tbuffered-i.trequest))),this._bwEstimator.sample(n,i.loaded),i.bwEstimate=this._bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},e.prototype.onError=function t(e){switch(e.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.prototype.clearTimer=function t(){clearInterval(this.timer),this.timer=null},e.prototype._findBestLevel=function t(e,i,s,n,a,r,o,l,d){for(var u=a;u>=n;u--){var h=d[u];if(h){var c=h.details,p=c?c.totalduration/c.fragments.length:i,v=!!c&&c.live,g=void 0;g=u<=e?o*s:l*s;var f=d[u].realBitrate?Math.max(d[u].realBitrate,d[u].bitrate):d[u].bitrate,m=f*p/g;if(ne.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(g)+"/"+f+"/"+p+"/"+r+"/"+m),g>f&&(!m||v&&!this.bitrateTestDelay||m<r))return u}}return-1},Ri(e,[{key:"nextAutoLevel",get:function t(){var e=this._nextAutoLevel,i=this._bwEstimator;if(!(-1===e||i&&i.canEstimate()))return e;var s=this._nextABRAutoLevel;return-1!==e&&(s=Math.min(e,s)),s},set:function t(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function t(){var e=this.hls,i=e.maxAutoLevel,s=e.levels,n=e.config,a=e.minAutoLevel,r=e.media,o=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,d=r?r.currentTime:0,u=r&&0!==r.playbackRate?Math.abs(r.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=(We.bufferInfo(r,d,n.maxBufferHole).end-d)/u,p=this._findBestLevel(o,l,h,a,i,c,n.abrBandWidthFactor,n.abrBandWidthUpFactor,s);if(p>=0)return p;ne.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=l?Math.min(l,n.maxStarvationDelay):n.maxStarvationDelay,g=n.abrBandWidthFactor,f=n.abrBandWidthUpFactor;if(0===c){var m=this.bitrateTestDelay;m&&(v=(l?Math.min(l,n.maxLoadingDelay):n.maxLoadingDelay)-m,ne.b.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),g=f=1)}return p=this._findBestLevel(o,l,h,a,i,c+v,g,f,s),Math.max(p,0)}}]),e}(le),Li=Oi,ki=D(),wi=function(t){function e(i){ht(this,e);var s=ct(this,t.call(this,i,se.a.MEDIA_ATTACHING,se.a.MEDIA_DETACHING,se.a.MANIFEST_PARSED,se.a.BUFFER_RESET,se.a.BUFFER_APPENDING,se.a.BUFFER_CODECS,se.a.BUFFER_EOS,se.a.BUFFER_FLUSHING,se.a.LEVEL_PTS_UPDATED,se.a.LEVEL_UPDATED));return s._msDuration=null,s._levelDuration=null,s._live=null,s._objectUrl=null,s.onsbue=s.onSBUpdateEnd.bind(s),s.onsbe=s.onSBUpdateError.bind(s),s.pendingTracks={},s.tracks={},s}return pt(e,t),e.prototype.destroy=function t(){le.prototype.destroy.call(this)},e.prototype.onLevelPtsUpdated=function t(e){var i=e.type,s=this.tracks.audio;if("audio"===i&&s&&"audio/mpeg"===s.container){var n=this.sourceBuffer.audio;if(Math.abs(n.timestampOffset-e.start)>.1){var a=n.updating;try{n.abort()}catch(t){a=!0,ne.b.warn("can not abort audio buffer: "+t)}a?this.audioTimestampOffset=e.start:(ne.b.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}},e.prototype.onManifestParsed=function t(e){var i=e.audio,s=e.video||e.levels.length&&e.altAudio,n=0;e.altAudio&&(i||s)&&(n=(i?1:0)+(s?1:0),ne.b.log(n+" sourceBuffer(s) expected")),this.sourceBufferNb=n},e.prototype.onMediaAttaching=function t(e){var i=this.media=e.media;if(i){var s=this.mediaSource=new ki;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),s.addEventListener("sourceopen",this.onmso),s.addEventListener("sourceended",this.onmse),s.addEventListener("sourceclose",this.onmsc),i.src=window.URL.createObjectURL(s),this._objectUrl=i.src}},e.prototype.onMediaDetaching=function t(){ne.b.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(t){ne.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):ne.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(se.a.MEDIA_DETACHED)},e.prototype.onMediaSourceOpen=function t(){ne.b.log("media source opened"),this.hls.trigger(se.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},e.prototype.checkPendingTracks=function t(){var e=this.pendingTracks,i=Object.keys(e).length;i&&(this.sourceBufferNb<=i||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},e.prototype.onMediaSourceClose=function t(){ne.b.log("media source closed")},e.prototype.onMediaSourceEnded=function t(){ne.b.log("media source ended")},e.prototype.onSBUpdateEnd=function t(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;ne.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var i=this.parent,s=this.segments.reduce(function(t,e){return e.parent===i?t+1:t},0),n={},a=this.sourceBuffer;for(var r in a)n[r]=a[r].buffered;this.hls.trigger(se.a.BUFFER_APPENDED,{parent:i,pending:s,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},e.prototype.onSBUpdateError=function t(e){ne.b.error("sourceBuffer error:",e),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferReset=function t(){var e=this.sourceBuffer;for(var i in e){var s=e[i];try{this.mediaSource.removeSourceBuffer(s),s.removeEventListener("updateend",this.onsbue),s.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},e.prototype.onBufferCodecs=function t(e){if(0===Object.keys(this.sourceBuffer).length){for(var i in e)this.pendingTracks[i]=e[i];var s=this.mediaSource;s&&"open"===s.readyState&&this.checkPendingTracks()}},e.prototype.createSourceBuffers=function t(e){var i=this.sourceBuffer,s=this.mediaSource;for(var n in e)if(!i[n]){var a=e[n],r=a.levelCodec||a.codec,o=a.container+";codecs="+r;ne.b.log("creating sourceBuffer("+o+")");try{var l=i[n]=s.addSourceBuffer(o);l.addEventListener("updateend",this.onsbue),l.addEventListener("error",this.onsbe),this.tracks[n]={codec:r,container:a.container},a.buffer=l}catch(t){ne.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(se.a.BUFFER_CREATED,{tracks:e})},e.prototype.onBufferAppending=function t(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},e.prototype.onBufferAppendFail=function t(e){ne.b.error("sourceBuffer error:",e.event),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferEos=function t(e){var i=this.sourceBuffer,s=e.type;for(var n in i)s&&n!==s||i[n].ended||(i[n].ended=!0,ne.b.log(n+" sourceBuffer now EOS"));this.checkEos()},e.prototype.checkEos=function t(){var e=this.sourceBuffer,i=this.mediaSource;if(!i||"open"!==i.readyState)return void(this._needsEos=!1);for(var s in e){var n=e[s];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}ne.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{i.endOfStream()}catch(t){ne.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},e.prototype.onBufferFlushing=function t(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},e.prototype.onLevelUpdated=function t(e){var i=e.details;i.fragments.length>0&&(this._levelDuration=i.totalduration+i.fragments[0].start,this._live=i.live,this.updateMediaElementDuration())},e.prototype.updateMediaElementDuration=function t(){var e=this.hls.config,i=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var s in this.sourceBuffer)if(!0===this.sourceBuffer[s].updating)return;i=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(ne.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>i||!Object(ie.a)(i))&&(ne.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},e.prototype.doFlush=function t(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var i=0,s=this.sourceBuffer;try{for(var n in s)i+=s[n].buffered.length}catch(t){ne.b.error("error while accessing sourceBuffer.buffered")}this.appended=i,this.hls.trigger(se.a.BUFFER_FLUSHED)}},e.prototype.doAppending=function t(){var e=this.hls,i=this.sourceBuffer,s=this.segments;if(Object.keys(i).length){if(this.media.error)return this.segments=[],void ne.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(s&&s.length){var n=s.shift();try{var a=n.type,r=i[a];r?r.updating?s.unshift(n):(r.ended=!1,this.parent=n.parent,r.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){ne.b.error("error while trying to append buffer:"+t.message),s.unshift(n);var o={type:ee.b.MEDIA_ERROR,parent:n.parent};22!==t.code?(this.appendError?this.appendError++:this.appendError=1,o.details=ee.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(ne.b.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),s=[],o.fatal=!0,e.trigger(se.a.ERROR,o)):(o.fatal=!1,e.trigger(se.a.ERROR,o))):(this.segments=[],o.details=ee.a.BUFFER_FULL_ERROR,o.fatal=!1,e.trigger(se.a.ERROR,o))}}}},e.prototype.flushBuffer=function t(e,i,s){var n=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=void 0,u=this.sourceBuffer;if(Object.keys(u).length){if(ne.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+i),this.flushBufferCounter<this.appended){for(var h in u)if(!s||h===s){if(n=u[h],n.ended=!1,n.updating)return ne.b.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<n.buffered.length;a++)if(r=n.buffered.start(a),o=n.buffered.end(a),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&i===Number.POSITIVE_INFINITY?(l=e,d=i):(l=Math.max(r,e),d=Math.min(o,i)),Math.min(d,o)-l>.5)return this.flushBufferCounter++,ne.b.log("flush "+h+" ["+l+","+d+"], of ["+r+","+o+"], pos:"+this.media.currentTime),n.remove(l,d),!1}catch(t){ne.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else ne.b.warn("abort flushing too many retries");ne.b.log("buffer flushed")}return!0},e}(le),Ni=wi,Ui=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Bi=function(t){function e(i){vt(this,e);var s=gt(this,t.call(this,i,se.a.FPS_DROP_LEVEL_CAPPING,se.a.MEDIA_ATTACHING,se.a.MANIFEST_PARSED,se.a.BUFFER_CODECS,se.a.MEDIA_DETACHING));return s.autoLevelCapping=Number.POSITIVE_INFINITY,s.firstLevel=null,s.levels=[],s.media=null,s.restrictedLevels=[],s.timer=null,s}return ft(e,t),e.prototype.destroy=function t(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},e.prototype.onFpsDropLevelCapping=function t(i){e.isLevelAllowed(i.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(i.droppedLevel)},e.prototype.onMediaAttaching=function t(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},e.prototype.onManifestParsed=function t(e){var i=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&(e.video||e.levels.length&&e.altAudio)&&this._startCapping()},e.prototype.onBufferCodecs=function t(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},e.prototype.onLevelsUpdated=function t(e){this.levels=e.levels},e.prototype.onMediaDetaching=function t(){this._stopCapping()},e.prototype.detectPlayerSize=function t(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var i=this.hls;i.autoLevelCapping=this.getMaxLevel(e-1),
i.autoLevelCapping>this.autoLevelCapping&&i.streamController.nextLevelSwitch(),this.autoLevelCapping=i.autoLevelCapping}}},e.prototype.getMaxLevel=function t(i){var s=this;if(!this.levels)return-1;var n=this.levels.filter(function(t,n){return e.isLevelAllowed(n,s.restrictedLevels)&&n<=i});return e.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},e.prototype._startCapping=function t(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.prototype._stopCapping=function t(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},e.isLevelAllowed=function t(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)},e.getMaxLevelByMediaSize=function t(e,i,s){if(!e||e&&!e.length)return-1;for(var n=function t(e,i){return!i||e.width!==i.width||e.height!==i.height},a=e.length-1,r=0;r<e.length;r+=1){var o=e[r];if((o.width>=i||o.height>=s)&&n(o,e[r+1])){a=r;break}}return a},Ui(e,[{key:"mediaWidth",get:function t(){var i=void 0,s=this.media;return s&&(i=s.width||s.clientWidth||s.offsetWidth,i*=e.contentScaleFactor),i}},{key:"mediaHeight",get:function t(){var i=void 0,s=this.media;return s&&(i=s.height||s.clientHeight||s.offsetHeight,i*=e.contentScaleFactor),i}}],[{key:"contentScaleFactor",get:function t(){var e=1;try{e=window.devicePixelRatio}catch(t){}return e}}]),e}(le),ji=Bi,Fi=window,Gi=Fi.performance,Vi=function(t){function e(i){return mt(this,e),_t(this,t.call(this,i,se.a.MEDIA_ATTACHING))}return Et(e,t),e.prototype.destroy=function t(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function t(e){var i=this.hls.config;i.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod))},e.prototype.checkFPS=function t(e,i,s){var n=Gi.now();if(i){if(this.lastTime){var a=n-this.lastTime,r=s-this.lastDroppedFrames,o=i-this.lastDecodedFrames,l=1e3*r/a,d=this.hls;if(d.trigger(se.a.FPS_DROP,{currentDropped:r,currentDecoded:o,totalDroppedFrames:s}),l>0&&r>d.config.fpsDroppedMonitoringThreshold*o){var u=d.currentLevel;ne.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=u)&&(u-=1,d.trigger(se.a.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:d.currentLevel}),d.autoLevelCapping=u,d.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=i}},e.prototype.checkFPSInterval=function t(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var i=e.getVideoPlaybackQuality();this.checkFPS(e,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}(le),xi=Vi,Hi=window,Ki=Hi.performance,qi=Hi.XMLHttpRequest,Wi=function(){function t(e){At(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return t.prototype.destroy=function t(){this.abort(),this.loader=null},t.prototype.abort=function t(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function t(e,i,s){this.context=e,this.config=i,this.callbacks=s,this.stats={trequest:Ki.now(),retry:0},this.retryDelay=i.retryDelay,this.loadInternal()},t.prototype.loadInternal=function t(){var e=void 0,i=this.context;e=this.loader=new qi;var s=this.stats;s.tfirst=0,s.loaded=0;var n=this.xhrSetup;try{if(n)try{n(e,i.url)}catch(t){e.open("GET",i.url,!0),n(e,i.url)}e.readyState||e.open("GET",i.url,!0)}catch(t){return void this.callbacks.onError({code:e.status,text:t.message},i,e)}i.rangeEnd&&e.setRequestHeader("Range","bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=i.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.prototype.readystatechange=function t(e){var i=e.currentTarget,s=i.readyState,n=this.stats,a=this.context,r=this.config;if(!n.aborted&&s>=2)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(Ki.now(),n.trequest)),4===s){var o=i.status;if(o>=200&&o<300){n.tload=Math.max(n.tfirst,Ki.now());var l=void 0,d=void 0;"arraybuffer"===a.responseType?(l=i.response,d=l.byteLength):(l=i.responseText,d=l.length),n.loaded=n.total=d;var u={url:i.responseURL,data:l};this.callbacks.onSuccess(u,n,a,i)}else n.retry>=r.maxRetry||o>=400&&o<499?(ne.b.error(o+" while loading "+a.url),this.callbacks.onError({code:o,text:i.statusText},a,i)):(ne.b.warn(o+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,r.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),r.timeout)},t.prototype.loadtimeout=function t(){ne.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function t(e){var i=e.currentTarget,s=this.stats;s.loaded=e.loaded,e.lengthComputable&&(s.total=e.total);var n=this.callbacks.onProgress;n&&n(s,this.context,null,i)},t}(),Yi=Wi,zi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),$i=function(t){function e(i){yt(this,e);var s=St(this,t.call(this,i,se.a.MANIFEST_LOADING,se.a.MANIFEST_PARSED,se.a.AUDIO_TRACK_LOADED,se.a.AUDIO_TRACK_SWITCHED,se.a.LEVEL_LOADED,se.a.ERROR));return s._trackId=-1,s._selectDefaultTrack=!0,s.tracks=[],s.trackIdBlacklist=Object.create(null),s.audioGroupId=null,s}return bt(e,t),e.prototype.onManifestLoading=function t(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},e.prototype.onManifestParsed=function t(e){var i=this.tracks=e.audioTracks||[];this.hls.trigger(se.a.AUDIO_TRACKS_UPDATED,{audioTracks:i})},e.prototype.onAudioTrackLoaded=function t(e){if(e.id>=this.tracks.length)return void ne.b.warn("Invalid audio track id:",e.id);if(ne.b.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var i=1e3*e.details.targetduration;this.setInterval(i)}!e.details.live&&this.hasInterval()&&this.clearInterval()},e.prototype.onAudioTrackSwitched=function t(e){var i=this.tracks[e.id].groupId;i&&this.audioGroupId!==i&&(this.audioGroupId=i)},e.prototype.onLevelLoaded=function t(e){var i=this.hls.levels[e.level];if(i.audioGroupIds){var s=i.audioGroupIds[i.urlId];this.audioGroupId!==s&&(this.audioGroupId=s,this._selectInitialAudioTrack())}},e.prototype.onError=function t(e){e.type===ee.b.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===ee.a.AUDIO_TRACK_LOAD_ERROR&&(ne.b.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},e.prototype._setAudioTrack=function t(e){if(this._trackId===e&&this.tracks[this._trackId].details)return void ne.b.debug("Same id as current audio-track passed, and track details available -> no-op");if(e<0||e>=this.tracks.length)return void ne.b.warn("Invalid id passed to audio-track controller");var i=this.tracks[e];ne.b.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var s=i.url,n=i.type,a=i.id;this.hls.trigger(se.a.AUDIO_TRACK_SWITCHING,{id:a,type:n,url:s}),this._loadTrackDetailsIfNeeded(i)},e.prototype.doTick=function t(){this._updateTrack(this._trackId)},e.prototype._selectInitialAudioTrack=function t(){var e=this,i=this.tracks;if(i.length){var s=this.tracks[this._trackId],n=null;if(s&&(n=s.name),this._selectDefaultTrack){var a=i.filter(function(t){return t.default});a.length?i=a:ne.b.warn("No default audio tracks defined")}var r=!1,o=function t(){i.forEach(function(t){r||e.audioGroupId&&t.groupId!==e.audioGroupId||n&&n!==t.name||(e._setAudioTrack(t.id),r=!0)})};o(),r||(n=null,o()),r||(ne.b.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},e.prototype._needsTrackLoading=function t(e){var i=e.details;return!i||!!i.live||void 0},e.prototype._loadTrackDetailsIfNeeded=function t(e){if(this._needsTrackLoading(e)){var i=e.url,s=e.id;ne.b.log("loading audio-track playlist for id: "+s),this.hls.trigger(se.a.AUDIO_TRACK_LOADING,{url:i,id:s})}},e.prototype._updateTrack=function t(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,ne.b.log("trying to update audio-track "+e);var i=this.tracks[e];this._loadTrackDetailsIfNeeded(i)}},e.prototype._handleLoadError=function t(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,i=this.tracks[e],s=i.name,n=i.language,a=i.groupId;ne.b.warn("Loading failed on audio track id: "+e+", group-id: "+a+', name/language: "'+s+'" / "'+n+'"');for(var r=e,o=0;o<this.tracks.length;o++)if(!this.trackIdBlacklist[o]){var l=this.tracks[o];if(l.name===s){r=o;break}}if(r===e)return void ne.b.warn('No fallback audio-track found for name/language: "'+s+'" / "'+n+'"');ne.b.log("Attempting audio-track fallback id:",r,"group-id:",this.tracks[r].groupId),this._setAudioTrack(r)},zi(e,[{key:"audioTracks",get:function t(){return this.tracks}},{key:"audioTrack",get:function t(){return this._trackId},set:function t(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),e}(ri),Xi=$i,Qi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Ji=window,Zi=Ji.performance,ts={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},es=function(t){function e(i,s){Tt(this,e);var n=Ct(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.AUDIO_TRACKS_UPDATED,se.a.AUDIO_TRACK_SWITCHING,se.a.AUDIO_TRACK_LOADED,se.a.KEY_LOADED,se.a.FRAG_LOADED,se.a.FRAG_PARSING_INIT_SEGMENT,se.a.FRAG_PARSING_DATA,se.a.FRAG_PARSED,se.a.ERROR,se.a.BUFFER_RESET,se.a.BUFFER_CREATED,se.a.BUFFER_APPENDED,se.a.BUFFER_FLUSHED,se.a.INIT_PTS_FOUND));return n.fragmentTracker=s,n.config=i.config,n.audioCodecSwap=!1,n._state=ts.STOPPED,n.initPTS=[],n.waitingFragment=null,n.videoTrackCC=null,n}return Dt(e,t),e.prototype.onHandlerDestroying=function e(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function e(){this.state=ts.STOPPED,this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},e.prototype.onInitPtsFound=function t(e){var i=e.id,s=e.frag.cc,n=e.initPTS;"main"===i&&(this.initPTS[s]=n,this.videoTrackCC=s,ne.b.log("InitPTS for cc: "+s+" found from video track: "+n),this.state===ts.WAITING_INIT_PTS&&this.tick())},e.prototype.startLoad=function t(e){if(this.tracks){var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,i>0&&-1===e?(ne.b.log("audio:override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=ts.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=ts.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=ts.STOPPED},e.prototype.stopLoad=function t(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ts.STOPPED},e.prototype.doTick=function t(){var e=void 0,i=void 0,s=void 0,n=this.hls,a=n.config;switch(this.state){case ts.ERROR:case ts.PAUSED:case ts.BUFFER_FLUSHING:break;case ts.STARTING:this.state=ts.WAITING_TRACK,this.loadedmetadata=!1;break;case ts.IDLE:var r=this.tracks;if(!r)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var o=this.mediaBuffer?this.mediaBuffer:this.media,l=this.videoBuffer?this.videoBuffer:this.media,d=We.bufferInfo(o,e,a.maxBufferHole),u=We.bufferInfo(l,e,a.maxBufferHole),h=d.len,c=d.end,p=this.fragPrevious,v=Math.min(a.maxBufferLength,a.maxMaxBufferLength),g=Math.max(v,u.len),f=this.audioSwitch,m=this.trackId;if((h<g||f)&&m<r.length){if(void 0===(s=r[m].details)){this.state=ts.WAITING_TRACK;break}if(!f&&!s.live&&p&&p.sn===s.endSN&&!d.nextStart&&(!this.media.seeking||this.media.duration-c<p.duration/2)){this.hls.trigger(se.a.BUFFER_EOS,{type:"audio"}),this.state=ts.ENDED;break}var _=s.fragments,E=_.length,A=_[0].start,y=_[E-1].start+_[E-1].duration,S=void 0;if(f)if(s.live&&!s.PTSKnown)ne.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),c=0;else if(c=e,s.PTSKnown&&e<A){if(!(d.end>A||d.nextStart))return;ne.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=A+.05}if(s.initSegment&&!s.initSegment.data)S=s.initSegment;else if(c<=A){if(S=_[0],null!==this.videoTrackCC&&S.cc!==this.videoTrackCC&&(S=k(_,this.videoTrackCC)),s.live&&S.loadIdx&&S.loadIdx===this.fragLoadIdx){var b=d.nextStart?d.nextStart:A;return ne.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(b+.05)),void(this.media.currentTime=b+.05)}}else{var T=void 0,C=a.maxFragLookUpTolerance,D=p?_[p.sn-_[0].sn+1]:void 0,I=function t(e){var i=Math.min(C,e.duration);return e.start+e.duration-i<=c?1:e.start-i>c&&e.start?-1:0};c<y?(c>y-C&&(C=0),T=D&&!I(D)?D:qe.search(_,I)):T=_[E-1],T&&(S=T,A=T.start,p&&S.level===p.level&&S.sn===p.sn&&(S.sn<s.endSN?(S=_[S.sn+1-s.startSN],ne.b.log("SN just loaded, load next one: "+S.sn)):S=null))}S&&(S.encrypted?(ne.b.log("Loading key for "+S.sn+" of ["+s.startSN+" ,"+s.endSN+"],track "+m),this.state=ts.KEY_LOADING,n.trigger(se.a.KEY_LOADING,{frag:S})):(ne.b.log("Loading "+S.sn+", cc: "+S.cc+" of ["+s.startSN+" ,"+s.endSN+"],track "+m+", currentTime:"+e+",bufferEnd:"+c.toFixed(3)),(f||this.fragmentTracker.getState(S)===xe.NOT_LOADED)&&(this.fragCurrent=S,this.startFragRequested=!0,Object(ie.a)(S.sn)&&(this.nextLoadPosition=S.start+S.duration),n.trigger(se.a.FRAG_LOADING,{frag:S}),this.state=ts.FRAG_LOADING)))}break;case ts.WAITING_TRACK:(i=this.tracks[this.trackId])&&i.details&&(this.state=ts.IDLE);break;case ts.FRAG_LOADING_WAITING_RETRY:var R=Zi.now(),P=this.retryDate;o=this.media;var M=o&&o.seeking;(!P||R>=P||M)&&(ne.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ts.IDLE);break;case ts.WAITING_INIT_PTS:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var L=this.waitingFragment;if(L){var w=L.frag.cc;O!==w?(i=this.tracks[this.trackId],i.details&&i.details.live&&(ne.b.warn("Waiting fragment CC ("+w+") does not match video track CC ("+O+")"),this.waitingFragment=null,this.state=ts.IDLE)):(this.state=ts.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=ts.IDLE;break;case ts.STOPPED:case ts.FRAG_LOADING:case ts.PARSING:case ts.PARSED:case ts.ENDED:}},e.prototype.onMediaAttached=function t(e){var i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var s=this.config;this.tracks&&s.autoStartLoad&&this.startLoad(s.startPosition)},e.prototype.onMediaDetaching=function t(){var e=this.media;e&&e.ended&&(ne.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function t(){this.state===ts.ENDED&&(this.state=ts.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},e.prototype.onMediaEnded=function t(){this.startPosition=this.lastCurrentTime=0},e.prototype.onAudioTracksUpdated=function t(e){ne.b.log("audio tracks updated"),this.tracks=e.audioTracks},e.prototype.onAudioTrackSwitching=function t(e){var i=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=ts.PAUSED,this.waitingFragment=null,i?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),i&&(this.audioSwitch=!0,this.state=ts.IDLE),this.tick()},e.prototype.onAudioTrackLoaded=function t(e){var i=e.details,s=e.id,n=this.tracks[s],a=i.totalduration,r=0;if(ne.b.log("track "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+a),i.live){var o=n.details;o&&i.fragments.length>0?(O(o,i),r=i.fragments[0].start,i.PTSKnown?ne.b.log("live audio playlist sliding:"+r.toFixed(3)):ne.b.log("live audio playlist - outdated PTS, unknown sliding")):(i.PTSKnown=!1,ne.b.log("live audio playlist - first load, unknown sliding"))}else i.PTSKnown=!1;if(n.details=i,!this.startFragRequested){if(-1===this.startPosition){var l=i.startTimeOffset;Object(ie.a)(l)?(ne.b.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===ts.WAITING_TRACK&&(this.state=ts.IDLE),this.tick()},e.prototype.onKeyLoaded=function t(){this.state===ts.KEY_LOADING&&(this.state=ts.IDLE,this.tick())},e.prototype.onFragLoaded=function t(e){var i=this.fragCurrent,s=e.frag;if(this.state===ts.FRAG_LOADING&&i&&"audio"===s.type&&s.level===i.level&&s.sn===i.sn){var n=this.tracks[this.trackId],a=n.details,r=a.totalduration,o=i.level,l=i.sn,d=i.cc,u=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",h=this.stats=e.stats;if("initSegment"===l)this.state=ts.IDLE,h.tparsed=h.tbuffered=Zi.now(),a.initSegment.data=e.payload,this.hls.trigger(se.a.FRAG_BUFFERED,{stats:h,frag:i,id:"audio"}),this.tick();else{this.state=ts.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new ii(this.hls,"audio"));var c=this.initPTS[d],p=a.initSegment?a.initSegment.data:[];if(a.initSegment||void 0!==c){this.pendingBuffering=!0,ne.b.log("Demuxing "+l+" of ["+a.startSN+" ,"+a.endSN+"],track "+o);var v=!1;this.demuxer.push(e.payload,p,u,null,i,r,!1,c)}else ne.b.log("unknown video PTS for continuity counter "+d+", waiting for video PTS before demuxing audio frag "+l+" of ["+a.startSN+" ,"+a.endSN+"],track "+o),this.waitingFragment=e,this.state=ts.WAITING_INIT_PTS}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function t(e){var i=this.fragCurrent,s=e.frag;if(i&&"audio"===e.id&&s.sn===i.sn&&s.level===i.level&&this.state===ts.PARSING){var n=e.tracks,a=void 0;if(n.video&&delete n.video,a=n.audio){a.levelCodec=a.codec,a.id=e.id,this.hls.trigger(se.a.BUFFER_CODECS,n),ne.b.log("audio track:audio,container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var r=a.initSegment;if(r){var o={type:"audio",data:r,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(se.a.BUFFER_APPENDING,o))}this.tick()}}},e.prototype.onFragParsingData=function t(e){var i=this,s=this.fragCurrent,n=e.frag;if(s&&"audio"===e.id&&"audio"===e.type&&n.sn===s.sn&&n.level===s.level&&this.state===ts.PARSING){var a=this.trackId,r=this.tracks[a],o=this.hls;Object(ie.a)(e.endPTS)||(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),s.addElementaryStream(ge.ElementaryStreamTypes.AUDIO),ne.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),M(r.details,s,e.startPTS,e.endPTS);var l=this.audioSwitch,d=this.media,u=!1;if(l&&d)if(d.readyState){var h=d.currentTime;ne.b.log("switching audio track : currentTime:"+h),h>=e.startPTS&&(ne.b.log("switching audio track : flushing all audio"),this.state=ts.BUFFER_FLUSHING,o.trigger(se.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,o.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,o.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:a});var c=this.pendingData;if(!c)return ne.b.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void o.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!u&&c.length&&(c.forEach(function(t){i.state===ts.PARSING&&(i.pendingBuffering=!0,i.hls.trigger(se.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},e.prototype.onFragParsed=function t(e){var i=this.fragCurrent,s=e.frag;i&&"audio"===e.id&&s.sn===i.sn&&s.level===i.level&&this.state===ts.PARSING&&(this.stats.tparsed=Zi.now(),this.state=ts.PARSED,this._checkAppendedParsed())},e.prototype.onBufferReset=function t(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.prototype.onBufferCreated=function t(e){var i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},e.prototype.onBufferAppended=function t(e){if("audio"===e.parent){var i=this.state;i!==ts.PARSING&&i!==ts.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function t(){if(!(this.state!==ts.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,i=this.stats,s=this.hls;if(e){this.fragPrevious=e,i.tbuffered=Zi.now(),s.trigger(se.a.FRAG_BUFFERED,{stats:i,frag:e,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;ne.b.log("audio buffered : "+ni.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,s.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ts.IDLE}this.tick()}},e.prototype.onError=function t(e){var i=e.frag;if(!i||"audio"===i.type)switch(e.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:var s=e.frag;if(s&&"audio"!==s.type)break;if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var a=this.config;if(n<=a.fragLoadingMaxRetry){this.fragLoadError=n;var r=Math.min(Math.pow(2,n-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);ne.b.warn("AudioStreamController: frag loading failed, retry in "+r+" ms"),this.retryDate=Zi.now()+r,this.state=ts.FRAG_LOADING_WAITING_RETRY}else ne.b.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=ts.ERROR}break;case ee.a.AUDIO_TRACK_LOAD_ERROR:case ee.a.AUDIO_TRACK_LOAD_TIMEOUT:case ee.a.KEY_LOAD_ERROR:case ee.a.KEY_LOAD_TIMEOUT:this.state!==ts.ERROR&&(this.state=e.fatal?ts.ERROR:ts.IDLE,ne.b.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case ee.a.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===ts.PARSING||this.state===ts.PARSED)){var o=this.mediaBuffer,l=this.media.currentTime;if(o&&We.isBuffered(o,l)&&We.isBuffered(o,l+.5)){var d=this.config;d.maxMaxBufferLength>=d.maxBufferLength&&(d.maxMaxBufferLength/=2,ne.b.warn("AudioStreamController: reduce max buffer length to "+d.maxMaxBufferLength+"s")),this.state=ts.IDLE}else ne.b.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=ts.BUFFER_FLUSHING,this.hls.trigger(se.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},e.prototype.onBufferFlushed=function t(){var e=this,i=this.pendingData;i&&i.length?(ne.b.log("AudioStreamController: appending pending audio data after buffer flushed"),i.forEach(function(t){e.hls.trigger(se.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=ts.PARSED):(this.state=ts.IDLE,this.fragPrevious=null,this.tick())},Qi(e,[{key:"state",set:function t(e){if(this.state!==e){var i=this.state;this._state=e,ne.b.log("audio stream:"+i+"->"+e)}},get:function t(){return this._state}}]),e}(ri),is=es,ss=function(){function t(t){return"string"==typeof t&&!!a[t.toLowerCase()]&&t.toLowerCase()}function e(t){return"string"==typeof t&&!!r[t.toLowerCase()]&&t.toLowerCase()}function i(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)t[s]=i[s]}return t}function s(s,a,r){var o=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),d={};l?o=document.createElement("custom"):d.enumerable=!0,o.hasBeenReset=!1;var u="",h=!1,c=s,p=a,v=r,g=null,f="",m=!0,_="auto",E="start",A=50,y="middle",S=50,b="middle";if(Object.defineProperty(o,"id",i({},d,{get:function t(){return u},set:function t(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},d,{get:function t(){return h},set:function t(e){h=!!e}})),Object.defineProperty(o,"startTime",i({},d,{get:function t(){return c},set:function t(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},d,{get:function t(){return p},set:function t(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},d,{get:function t(){return v},set:function t(e){v=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},d,{get:function t(){return g},set:function t(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},d,{get:function t(){return f},set:function e(i){var s=t(i);if(!1===s)throw new SyntaxError("An invalid or illegal string was specified.");f=s,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},d,{get:function t(){return m},set:function t(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},d,{get:function t(){return _},set:function t(e){if("number"!=typeof e&&e!==n)throw new SyntaxError("An invalid number or illegal string was specified.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},d,{get:function t(){return E},set:function t(i){var s=e(i);if(!s)throw new SyntaxError("An invalid or illegal string was specified.");E=s,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},d,{get:function t(){return A},set:function t(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");A=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},d,{get:function t(){return y},set:function t(i){var s=e(i);if(!s)throw new SyntaxError("An invalid or illegal string was specified.");y=s,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},d,{get:function t(){return S},set:function t(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},d,{get:function t(){return b},set:function t(i){var s=e(i);if(!s)throw new SyntaxError("An invalid or illegal string was specified.");b=s,this.hasBeenReset=!0}})),o.displayState=void 0,l)return o}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var n="auto",a={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};return s.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},s}(),ns=function t(){return{decode:function t(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};Pt.prototype={set:function t(e,i){this.get(e)||""===i||(this.values[e]=i)},get:function t(e,i,s){return s?this.has(e)?this.values[e]:i[s]:this.has(e)?this.values[e]:i},has:function t(e){return e in this.values},alt:function t(e,i,s){for(var n=0;n<s.length;++n)if(i===s[n]){this.set(e,i);break}},integer:function t(e,i){/^-?\d+$/.test(i)&&this.set(e,parseInt(i,10))},percent:function t(e,i){var s=void 0;return!!((s=i.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(i=parseFloat(i))>=0&&i<=100)&&(this.set(e,i),!0)}};var as=new ss(0,0,0),rs="middle"===as.align?"middle":"center";It.prototype={parse:function t(e){function i(){var t=n.buffer,e=0;for(t=Lt(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,n.buffer=t.substr(e),i}function s(t){Mt(t,function(t,e){},/:/)}var n=this;e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));try{var a=void 0;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;a=i();var r=a.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var o=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(o?o=!1:a=i(),n.state){case"HEADER":/:/.test(a)?s(a):a||(n.state="ID");continue;case"NOTE":a||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){n.state="NOTE";break}if(!a)continue;if(n.cue=new ss(0,0,""),n.state="CUE",-1===a.indexOf("--\x3e")){n.cue.id=a;continue}case"CUE":try{Ot(a,n.cue,n.regionList)}catch(t){n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var l=-1!==a.indexOf("--\x3e");if(!a||l&&(o=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=a;continue;case"BADCUE":a||(n.state="ID");continue}}}catch(t){"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function t(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return e.onflush&&e.onflush(),this}};var os=It,ls={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ds=function t(e){var i=e;return ls.hasOwnProperty(e)&&(i=ls[e]),String.fromCharCode(i)},us=15,hs=100,cs={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ps={17:2,18:4,21:6,22:8,23:10,19:13,20:15},vs={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},gs={25:2,26:4,29:6,30:8,31:10,27:13,28:15},fs=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ms={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function t(e){this.time=e},log:function t(e,i){var s=this.verboseFilter[e];this.verboseLevel}},_s=function t(e){for(var i=[],s=0;s<e.length;s++)i.push(e[s].toString(16));return i},Es=function(){function t(e,i,s,n,a){wt(this,t),this.foreground=e||"white",this.underline=i||!1,this.italics=s||!1,this.background=n||"black",this.flash=a||!1}return t.prototype.reset=function t(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},
t.prototype.setStyles=function t(e){for(var i=["foreground","underline","italics","background","flash"],s=0;s<i.length;s++){var n=i[s];e.hasOwnProperty(n)&&(this[n]=e[n])}},t.prototype.isDefault=function t(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function t(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.prototype.copy=function t(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.prototype.toString=function t(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),As=function(){function t(e,i,s,n,a,r){wt(this,t),this.uchar=e||" ",this.penState=new Es(i,s,n,a,r)}return t.prototype.reset=function t(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function t(e,i){this.uchar=e,this.penState.copy(i)},t.prototype.setPenState=function t(e){this.penState.copy(e)},t.prototype.equals=function t(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.prototype.copy=function t(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.prototype.isEmpty=function t(){return" "===this.uchar&&this.penState.isDefault()},t}(),ys=function(){function t(){wt(this,t),this.chars=[];for(var e=0;e<hs;e++)this.chars.push(new As);this.pos=0,this.currPenState=new Es}return t.prototype.equals=function t(e){for(var i=!0,s=0;s<hs;s++)if(!this.chars[s].equals(e.chars[s])){i=!1;break}return i},t.prototype.copy=function t(e){for(var i=0;i<hs;i++)this.chars[i].copy(e.chars[i])},t.prototype.isEmpty=function t(){for(var e=!0,i=0;i<hs;i++)if(!this.chars[i].isEmpty()){e=!1;break}return e},t.prototype.setCursor=function t(e){this.pos!==e&&(this.pos=e),this.pos<0?(ms.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>hs&&(ms.log("ERROR","Too large cursor position "+this.pos),this.pos=hs)},t.prototype.moveCursor=function t(e){var i=this.pos+e;if(e>1)for(var s=this.pos+1;s<i+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(i)},t.prototype.backSpace=function t(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function t(e){e>=144&&this.backSpace();var i=ds(e);if(this.pos>=hs)return void ms.log("ERROR","Cannot insert "+e.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1)},t.prototype.clearFromPos=function t(e){var i=void 0;for(i=e;i<hs;i++)this.chars[i].reset()},t.prototype.clear=function t(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function t(){this.clearFromPos(this.pos)},t.prototype.getTextString=function t(){for(var e=[],i=!0,s=0;s<hs;s++){var n=this.chars[s].uchar;" "!==n&&(i=!1),e.push(n)}return i?"":e.join("")},t.prototype.setPenStyles=function t(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},t}(),Ss=function(){function t(){wt(this,t),this.rows=[];for(var e=0;e<us;e++)this.rows.push(new ys);this.currRow=us-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function t(){for(var e=0;e<us;e++)this.rows[e].clear();this.currRow=us-1},t.prototype.equals=function t(e){for(var i=!0,s=0;s<us;s++)if(!this.rows[s].equals(e.rows[s])){i=!1;break}return i},t.prototype.copy=function t(e){for(var i=0;i<us;i++)this.rows[i].copy(e.rows[i])},t.prototype.isEmpty=function t(){for(var e=!0,i=0;i<us;i++)if(!this.rows[i].isEmpty()){e=!1;break}return e},t.prototype.backSpace=function t(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function t(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function t(e){this.rows[this.currRow].insertChar(e)},t.prototype.setPen=function t(e){this.rows[this.currRow].setPenStyles(e)},t.prototype.moveCursor=function t(e){this.rows[this.currRow].moveCursor(e)},t.prototype.setCursor=function t(e){ms.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.prototype.setPAC=function t(e){ms.log("INFO","pacData = "+JSON.stringify(e));var i=e.row-1;if(this.nrRollUpRows&&i<this.nrRollUpRows-1&&(i=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==i){for(var s=0;s<us;s++)this.rows[s].clear();var n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var r=a.rows[n].cueStartTime;if(r&&r<ms.time)for(var o=0;o<this.nrRollUpRows;o++)this.rows[i-this.nrRollUpRows+o+1].copy(a.rows[n+o])}}this.currRow=i;var l=this.rows[this.currRow];if(null!==e.indent){var d=e.indent,u=Math.max(d-1,0);l.setCursor(e.indent),e.color=l.chars[u].penState.foreground}var h={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(h)},t.prototype.setBkgData=function t(e){ms.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.prototype.setRollUpRows=function t(e){this.nrRollUpRows=e},t.prototype.rollUp=function t(){if(null===this.nrRollUpRows)return void ms.log("DEBUG","roll_up but nrRollUpRows not set yet");ms.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(e,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),ms.log("INFO","Rolling up")},t.prototype.getDisplayText=function t(e){e=e||!1;for(var i=[],s="",n=-1,a=0;a<us;a++){var r=this.rows[a].getTextString();r&&(n=a+1,e?i.push("Row "+n+": '"+r+"'"):i.push(r.trim()))}return i.length>0&&(s=e?"["+i.join(" | ")+"]":i.join("\n")),s},t.prototype.getTextAndFormat=function t(){return this.rows},t}(),bs=function(){function t(e,i){wt(this,t),this.chNr=e,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new Ss,this.nonDisplayedMemory=new Ss,this.lastOutputScreen=new Ss,this.currRollUpRow=this.displayedMemory.rows[us-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function t(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[us-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function t(){return this.outputFilter},t.prototype.setHandler=function t(e){this.outputFilter=e},t.prototype.setPAC=function t(e){this.writeScreen.setPAC(e)},t.prototype.setBkgData=function t(e){this.writeScreen.setBkgData(e)},t.prototype.setMode=function t(e){e!==this.mode&&(this.mode=e,ms.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.prototype.insertChars=function t(e){for(var i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);var s=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";ms.log("INFO",s+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(ms.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function t(){ms.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function t(){ms.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function t(){},t.prototype.ccAON=function t(){},t.prototype.ccDER=function t(){ms.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function t(e){ms.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.prototype.ccFON=function t(){ms.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function t(){ms.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function t(){ms.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function t(){ms.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function t(){ms.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function t(){ms.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function t(){ms.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function t(){if(ms.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,ms.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function t(e){ms.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.prototype.ccMIDROW=function t(e){var i={flash:!1};if(i.underline=e%2==1,i.italics=e>=46,i.italics)i.foreground="white";else{var s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];i.foreground=n[s]}ms.log("INFO","MIDROW: "+JSON.stringify(i)),this.writeScreen.setPen(i)},t.prototype.outputDataUpdate=function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=ms.time;null!==i&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,i,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:i):this.cueStartTime=i,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function t(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},t}(),Ts=function(){function t(e,i,s){wt(this,t),this.field=e||1,this.outputs=[i,s],this.channels=[new bs(1,i),new bs(2,s)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function t(e){return this.channels[e].getHandler()},t.prototype.setHandler=function t(e,i){this.channels[e].setHandler(i)},t.prototype.addData=function t(e,i){var s=void 0,n=void 0,a=void 0,r=!1;this.lastTime=e,ms.setTime(e);for(var o=0;o<i.length;o+=2)if(n=127&i[o],a=127&i[o+1],0!==n||0!==a){if(ms.log("DATA","["+_s([i[o],i[o+1]])+"] -> ("+_s([n,a])+")"),s=this.parseCmd(n,a),s||(s=this.parseMidrow(n,a)),s||(s=this.parsePAC(n,a)),s||(s=this.parseBackgroundAttributes(n,a)),!s&&(r=this.parseChars(n,a)))if(this.currChNr&&this.currChNr>=0){var l=this.channels[this.currChNr-1];l.insertChars(r)}else ms.log("WARNING","No channel found yet. TEXT-MODE?");s?this.dataCounters.cmd+=2:r?this.dataCounters.char+=2:(this.dataCounters.other+=2,ms.log("WARNING","Couldn't parse cleaned data "+_s([n,a])+" orig: "+_s([i[o],i[o+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function t(e,i){var s=null,n=(20===e||28===e)&&i>=32&&i<=47,a=(23===e||31===e)&&i>=33&&i<=35;if(!n&&!a)return!1;if(e===this.lastCmdA&&i===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,ms.log("DEBUG","Repeated command ("+_s([e,i])+") is dropped"),!0;s=20===e||23===e?1:2;var r=this.channels[s-1];return 20===e||28===e?32===i?r.ccRCL():33===i?r.ccBS():34===i?r.ccAOF():35===i?r.ccAON():36===i?r.ccDER():37===i?r.ccRU(2):38===i?r.ccRU(3):39===i?r.ccRU(4):40===i?r.ccFON():41===i?r.ccRDC():42===i?r.ccTR():43===i?r.ccRTD():44===i?r.ccEDM():45===i?r.ccCR():46===i?r.ccENM():47===i&&r.ccEOC():r.ccTO(i-32),this.lastCmdA=e,this.lastCmdB=i,this.currChNr=s,!0},t.prototype.parseMidrow=function t(e,i){var s=null;return(17===e||25===e)&&i>=32&&i<=47&&((s=17===e?1:2)!==this.currChNr?(ms.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[s-1].ccMIDROW(i),ms.log("DEBUG","MIDROW ("+_s([e,i])+")"),!0))},t.prototype.parsePAC=function t(e,i){var s=null,n=null,a=(e>=17&&e<=23||e>=25&&e<=31)&&i>=64&&i<=127,r=(16===e||24===e)&&i>=64&&i<=95;if(!a&&!r)return!1;if(e===this.lastCmdA&&i===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;s=e<=23?1:2,n=i>=64&&i<=95?1===s?cs[e]:vs[e]:1===s?ps[e]:gs[e];var o=this.interpretPAC(n,i);return this.channels[s-1].setPAC(o),this.lastCmdA=e,this.lastCmdB=i,this.currChNr=s,!0},t.prototype.interpretPAC=function t(e,i){var s=i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return s=i>95?i-96:i-64,n.underline=1==(1&s),s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((s-16)/2),n},t.prototype.parseChars=function t(e,i){var s=null,n=null,a=null;if(e>=25?(s=2,a=e-8):(s=1,a=e),a>=17&&a<=19){var r=i;r=17===a?i+80:18===a?i+112:i+144,ms.log("INFO","Special char '"+ds(r)+"' in channel "+s),n=[r]}else e>=32&&e<=127&&(n=0===i?[e]:[e,i]);if(n){var o=_s(n);ms.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n},t.prototype.parseBackgroundAttributes=function t(e,i){var s=void 0,n=void 0,a=void 0,r=void 0,o=(16===e||24===e)&&i>=32&&i<=47,l=(23===e||31===e)&&i>=45&&i<=47;return!(!o&&!l||(s={},16===e||24===e?(n=Math.floor((i-32)/2),s.background=fs[n],i%2==1&&(s.background=s.background+"_semi")):45===i?s.background="transparent":(s.foreground="black",47===i&&(s.underline=!0)),a=e<24?1:2,r=this.channels[a-1],r.setBkgData(s),this.lastCmdA=null,this.lastCmdB=null,0))},t.prototype.reset=function t(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function t(e){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].cueSplitAtTime(e)},t}(),Cs=Ts,Ds=function(){function t(e,i){Nt(this,t),this.timelineController=e,this.trackName=i,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function t(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function t(e,i,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=i,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)},t}(),Is=Ds,Rs=function t(e,i,s){return e.substr(s||0,i.length)===i},Ps=function t(e){var i=parseInt(e.substr(-3)),s=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),a=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;return Object(ie.a)(i)&&Object(ie.a)(s)&&Object(ie.a)(n)&&Object(ie.a)(a)?(i+=1e3*s,i+=6e4*n,i+=36e5*a):-1},Ms=function t(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()},Os=function t(e,i,s){var n=e[i],a=e[n.prevCC];if(!a||!a.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;a&&a.new;)e.ccOffset+=n.start-a.start,n.new=!1,n=a,a=e[n.prevCC];e.presentationOffset=s},Ls={parse:function t(e,i,s,n,a,r){var o=/\r\n|\n\r|\n|\r/g,l=Object(yi.b)(new Uint8Array(e)).trim().replace(o,"\n").split("\n"),d="00:00.000",u=0,h=0,c=0,p=[],v=void 0,g=!0,f=new os;f.oncue=function(t){var e=s[n],i=s.ccOffset;e&&e.new&&(void 0!==h?i=s.ccOffset=e.start:Os(s,n,c)),c&&(i=c+s.ccOffset-s.presentationOffset),t.startTime+=i-h,t.endTime+=i-h,t.id=Ms(t.startTime.toString())+Ms(t.endTime.toString())+Ms(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&p.push(t)},f.onparsingerror=function(t){v=t},f.onflush=function(){if(v&&r)return void r(v);a(p)},l.forEach(function(t){if(g){if(Rs(t,"X-TIMESTAMP-MAP=")){g=!1,t.substr(16).split(",").forEach(function(t){Rs(t,"LOCAL:")?d=t.substr(6):Rs(t,"MPEGTS:")&&(u=parseInt(t.substr(7)))});try{i=i<0?i+8589934592:i,u-=i,h=Ps(d)/1e3,c=u/9e4,-1===h&&(v=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){v=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(g=!1)}f.parse(t+"\n")}),f.flush()}},ks=Ls,ws=function(t){function e(i){Ut(this,e);var s=Bt(this,t.call(this,i,se.a.MEDIA_ATTACHING,se.a.MEDIA_DETACHING,se.a.FRAG_PARSING_USERDATA,se.a.FRAG_DECRYPTED,se.a.MANIFEST_LOADING,se.a.MANIFEST_LOADED,se.a.FRAG_LOADED,se.a.LEVEL_SWITCHING,se.a.INIT_PTS_FOUND));if(s.hls=i,s.config=i.config,s.enabled=!0,s.Cues=i.config.cueHandler,s.textTracks=[],s.tracks=[],s.unparsedVttFrags=[],s.initPTS=void 0,s.cueRanges=[],s.captionsTracks={},s.captionsProperties={textTrack1:{label:s.config.captionsTextTrack1Label,languageCode:s.config.captionsTextTrack1LanguageCode},textTrack2:{label:s.config.captionsTextTrack2Label,languageCode:s.config.captionsTextTrack2LanguageCode}},s.config.enableCEA708Captions){var n=new Is(s,"textTrack1"),a=new Is(s,"textTrack2");s.cea608Parser=new Cs(0,n,a)}return s}return jt(e,t),e.prototype.addCues=function t(e,i,s,n){for(var a=this.cueRanges,r=!1,o=a.length;o--;){var l=a[o],d=Gt(l[0],l[1],i,s);if(d>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],s),r=!0,d/(s-i)>.5))return}r||a.push([i,s]),this.Cues.newCue(this.captionsTracks[e],i,s,n)},e.prototype.onInitPtsFound=function t(e){var i=this;void 0===this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){i.onFragLoaded(t)}),this.unparsedVttFrags=[])},e.prototype.getExistingTrack=function t(e){var i=this.media;if(i)for(var s=0;s<i.textTracks.length;s++){var n=i.textTracks[s];if(n[e])return n}return null},e.prototype.createCaptionsTrack=function t(e){var i=this.captionsProperties[e],s=i.label,n=i.languageCode,a=this.captionsTracks;if(!a[e]){var r=this.getExistingTrack(e);if(r)a[e]=r,et(a[e]),tt(a[e],this.media);else{var o=this.createTextTrack("captions",s,n);o&&(o[e]=!0,a[e]=o)}}},e.prototype.createTextTrack=function t(e,i,s){var n=this.media;if(n)return n.addTextTrack(e,i,s)},e.prototype.destroy=function t(){le.prototype.destroy.call(this)},e.prototype.onMediaAttaching=function t(e){this.media=e.media,this._cleanTracks()},e.prototype.onMediaDetaching=function t(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){et(e[t]),delete e[t]})},e.prototype.onManifestLoading=function t(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},e.prototype._cleanTracks=function t(){var e=this.media;if(e){var i=e.textTracks;if(i)for(var s=0;s<i.length;s++)et(i[s])}},e.prototype.onManifestLoaded=function t(e){var i=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,e){var n=void 0;if(e<s.length){var a=s[e];Ft(a,t)&&(n=a)}n||(n=i.createTextTrack("subtitles",t.name,t.lang)),t.default?n.mode=i.hls.subtitleDisplay?"showing":"hidden":n.mode="disabled",i.textTracks.push(n)})}},e.prototype.onLevelSwitching=function t(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},e.prototype.onFragLoaded=function t(e){var i=e.frag,s=e.payload;if("main"===i.type){var n=i.sn;if(n!==this.lastSn+1){var a=this.cea608Parser;a&&a.reset()}this.lastSn=n}else if("subtitle"===i.type)if(s.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);var r=i.decryptdata;null!=r&&null!=r.key&&"AES-128"===r.method||this._parseVTTs(i,s)}else this.hls.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i})},e.prototype._parseVTTs=function t(e,i){var s=this.vttCCs;s[e.cc]||(s[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n=this.textTracks,a=this.hls;ks.parse(i,this.initPTS,s,e.cc,function(t){var i=n[e.trackId];if("disabled"===i.mode)return void a.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach(function(t){if(!i.cues.getCueById(t.id))try{i.addCue(t)}catch(s){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,i.addCue(e)}}),a.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){ne.b.log("Failed to parse VTT cue: "+t),a.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},e.prototype.onFragDecrypted=function t(e){var i=e.payload,s=e.frag;if("subtitle"===s.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(s,i)}},e.prototype.onFragParsingUserdata=function t(e){if(this.enabled&&this.config.enableCEA708Captions)for(var i=0;i<e.samples.length;i++){var s=this.extractCea608Data(e.samples[i].bytes);this.cea608Parser.addData(e.samples[i].pts,s)}},e.prototype.extractCea608Data=function t(e){for(var i=31&e[0],s=2,n=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=[],u=0;u<i;u++)n=e[s++],a=127&e[s++],r=127&e[s++],o=0!=(4&n),l=3&n,0===a&&0===r||o&&0===l&&(d.push(a),d.push(r));return d},e}(le),Ns=ws,Us=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Bs=function(t){function e(i){Vt(this,e);var s=xt(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.MANIFEST_LOADING,se.a.MANIFEST_LOADED,se.a.SUBTITLE_TRACK_LOADED));return s.tracks=[],s.trackId=-1,s.media=null,s.subtitleDisplay=!0,s}return Ht(e,t),e.prototype._onTextTracksChanged=function t(){if(this.media){for(var e=-1,i=Kt(this.media.textTracks),s=0;s<i.length;s++)if("hidden"===i[s].mode)e=s;else if("showing"===i[s].mode){e=s;break}this.subtitleTrack=e}},e.prototype.destroy=function t(){le.prototype.destroy.call(this)},e.prototype.onMediaAttached=function t(e){var i=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){i.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},e.prototype.onMediaDetaching=function t(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},e.prototype.onManifestLoading=function t(){this.tracks=[],this.trackId=-1},e.prototype.onManifestLoaded=function t(e){var i=this,s=e.subtitles||[];this.tracks=s,this.trackId=-1,this.hls.trigger(se.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:s}),s.forEach(function(t){t.default&&(i.media?i.subtitleTrack=t.id:i.queuedDefaultTrack=t.id)})},e.prototype.onTick=function t(){var e=this.trackId,i=this.tracks[e];if(i){var s=i.details;s&&!s.live||(ne.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(se.a.SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))}},e.prototype.onSubtitleTrackLoaded=function t(e){var i=this;e.id<this.tracks.length&&(ne.b.log("subtitle track "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){i.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&this._stopTimer())},e.prototype.setSubtitleTrackInternal=function t(e){var i=this.hls,s=this.tracks;if(!("number"!=typeof e||e<-1||e>=s.length)&&(this._stopTimer(),this.trackId=e,ne.b.log("switching to subtitle track "+e),i.trigger(se.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e)){var n=s[e],a=n.details;a&&!a.live||(ne.b.log("(re)loading playlist for subtitle track "+e),i.trigger(se.a.SUBTITLE_TRACK_LOADING,{url:n.url,id:e}))}},e.prototype._stopTimer=function t(){this.timer&&(clearInterval(this.timer),this.timer=null)},e.prototype._toggleTrackModes=function t(e){var i=this.media,s=this.subtitleDisplay,n=this.trackId;if(i){var a=Kt(i.textTracks);if(-1===e)[].slice.call(a).forEach(function(t){t.mode="disabled"});else{var r=a[n];r&&(r.mode="disabled")}var o=a[e];o&&(o.mode=s?"showing":"hidden")}},Us(e,[{key:"subtitleTracks",get:function t(){return this.tracks}},{key:"subtitleTrack",get:function t(){return this.trackId},set:function t(e){this.trackId!==e&&(this._toggleTrackModes(e),this.setSubtitleTrackInternal(e))}}]),e}(le),js=Bs,Fs=i(8),Gs=window,Vs=Gs.performance,xs={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Hs=function(t){function e(i){qt(this,e);var s=Wt(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.ERROR,se.a.KEY_LOADED,se.a.FRAG_LOADED,se.a.SUBTITLE_TRACKS_UPDATED,se.a.SUBTITLE_TRACK_SWITCH,se.a.SUBTITLE_TRACK_LOADED,se.a.SUBTITLE_FRAG_PROCESSED));return s.config=i.config,s.vttFragSNsProcessed={},s.vttFragQueues=void 0,s.currentlyProcessing=null,s.state=xs.STOPPED,s.currentTrackId=-1,s.decrypter=new Fs.a(i.observer,i.config),s}return Yt(e,t),e.prototype.onHandlerDestroyed=function t(){this.state=xs.STOPPED},e.prototype.clearVttFragQueues=function t(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},e.prototype.nextFrag=function t(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(se.a.FRAG_LOADING,{frag:e}),this.state=xs.FRAG_LOADING}},e.prototype.onSubtitleFragProcessed=function t(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=xs.IDLE,this.nextFrag()},e.prototype.onMediaAttached=function t(){this.state=xs.IDLE},e.prototype.onError=function t(e){var i=e.frag;i&&"subtitle"!==i.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},e.prototype.doTick=function t(){var e=this;switch(this.state){case xs.IDLE:var i=this.tracks,s=this.currentTrackId,n=this.vttFragSNsProcessed[s],a=this.vttFragQueues[s],r=this.currentlyProcessing?this.currentlyProcessing.sn:-1,o=function t(e){return n.indexOf(e.sn)>-1},l=function t(e){return a.some(function(t){return t.sn===e.sn})};if(!i)break;var d;if(s<i.length&&(d=i[s].details),void 0===d)break;d.fragments.forEach(function(t){o(t)||t.sn===r||l(t)||(t.encrypted?(ne.b.log("Loading key for "+t.sn),e.state=xs.KEY_LOADING,e.hls.trigger(se.a.KEY_LOADING,{frag:t})):(t.trackId=s,a.push(t),e.nextFrag()))})}},e.prototype.onSubtitleTracksUpdated=function t(e){var i=this;ne.b.log("subtitle tracks updated"),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){i.vttFragSNsProcessed[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function t(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var i=this.tracks[this.currentTrackId];i&&i.details&&this.tick()}},e.prototype.onSubtitleTrackLoaded=function t(){this.tick()},e.prototype.onKeyLoaded=function t(){this.state===xs.KEY_LOADING&&(this.state=xs.IDLE,this.tick())},e.prototype.onFragLoaded=function t(e){var i=this.fragCurrent,s=e.frag.decryptdata,n=e.frag,a=this.hls;if(this.state===xs.FRAG_LOADING&&i&&"subtitle"===e.frag.type&&i.sn===e.frag.sn&&e.payload.byteLength>0&&null!=s&&null!=s.key&&"AES-128"===s.method){var r=void 0;try{r=Vs.now()}catch(t){r=Date.now()}this.decrypter.decrypt(e.payload,s.key.buffer,s.iv.buffer,function(t){var e=void 0;try{e=Vs.now()}catch(t){e=Date.now()}a.trigger(se.a.FRAG_DECRYPTED,{frag:n,payload:t,stats:{tstart:r,tdecrypt:e}})})}},e}(ri),Ks=Hs,qs=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Ws=window,Ys=Ws.XMLHttpRequest,zs=3,$s={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},Xs=function t(e,i,s){var n={videoCapabilities:[]};return i.forEach(function(t){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"'})}),[n]},Qs=function t(e,i,s){switch(e){case $s.WIDEVINE:return Xs(i,s);default:throw Error("Unknown key-system: "+e)}},Js=function(t){function e(i){zt(this,e);var s=$t(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MANIFEST_PARSED));return s._widevineLicenseUrl=i.config.widevineLicenseUrl,s._licenseXhrSetup=i.config.licenseXhrSetup,s._emeEnabled=i.config.emeEnabled,s._requestMediaKeySystemAccess=i.config.requestMediaKeySystemAccessFunc,s._mediaKeysList=[],s._media=null,s._hasSetMediaKeys=!1,s._isMediaEncrypted=!1,s._requestLicenseFailureCount=0,s}return Xt(e,t),e.prototype.getLicenseServerUrl=function t(e){var i=void 0;switch(e){case $s.WIDEVINE:i=this._widevineLicenseUrl;break;default:i=null}return i||(ne.b.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),i},e.prototype._attemptKeySystemAccess=function t(e,i,s){var n=this,a=Qs(e,i,s);if(!a)return void ne.b.warn("Can not create config for key-system (maybe because platform is not supported):",e);ne.b.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,a).then(function(t){n._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){ne.b.error('Failed to obtain key-system "'+e+'" access:',t)})},e.prototype._onMediaKeySystemAccessObtained=function t(e,i){var s=this;ne.b.log('Access for key-system "'+e+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:i,mediaKeySystemDomain:e};this._mediaKeysList.push(n),i.createMediaKeys().then(function(t){n.mediaKeys=t,ne.b.log('Media-keys created for key-system "'+e+'"'),s._onMediaKeysCreated()}).catch(function(t){ne.b.error("Failed to create media-keys:",t)})},e.prototype._onMediaKeysCreated=function t(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},e.prototype._onNewMediaKeySession=function t(e){var i=this;ne.b.log("New key-system session "+e.sessionId),e.addEventListener("message",function(t){i._onKeySessionMessage(e,t.message)},!1)},e.prototype._onKeySessionMessage=function t(e,i){ne.b.log("Got EME message event, creating license request"),this._requestLicense(i,function(t){ne.b.log("Received license data, updating key-session"),e.update(t)})},e.prototype._onMediaEncrypted=function t(e,i){ne.b.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=i,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},e.prototype._attemptSetMediaKeys=function t(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return ne.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_KEYS,fatal:!0});ne.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},e.prototype._generateRequestWithPreferredKeySession=function t(){var e=this,i=this._mediaKeysList[0];if(!i)return ne.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(i.mediaKeysSessionInitialized)return void ne.b.warn("Key-Session already initialized but requested again");var s=i.mediaKeysSession;s||(ne.b.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,a=this._mediaEncryptionInitData
;ne.b.log('Generating key-session request for "'+n+'" init data type'),i.mediaKeysSessionInitialized=!0,s.generateRequest(n,a).then(function(){ne.b.debug("Key-session generation succeeded")}).catch(function(t){ne.b.error("Error generating key-session request:",t),e.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})},e.prototype._createLicenseXhr=function t(e,i,s){var n=new Ys,a=this._licenseXhrSetup;try{if(a)try{a(n,e)}catch(t){n.open("POST",e,!0),a(n,e)}n.readyState||n.open("POST",e,!0)}catch(t){return ne.b.error("Error setting up key-system license XHR",t),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,i,s),n},e.prototype._onLicenseRequestReadyStageChange=function t(e,i,s,n){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,ne.b.log("License request succeeded"),n(e.response);else{if(ne.b.error("License Request XHR failed ("+i+"). Status: "+e.status+" ("+e.statusText+")"),++this._requestLicenseFailureCount<=3){var a=3-this._requestLicenseFailureCount+1;return ne.b.warn("Retrying license request, "+a+" attempts left"),void this._requestLicense(s,n)}this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},e.prototype._generateLicenseRequestChallenge=function t(e,i){var s=void 0;return e.mediaKeySystemDomain===$s.PLAYREADY?ne.b.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===$s.WIDEVINE?s=i:ne.b.error("Unsupported key-system:",e.mediaKeySystemDomain),s},e.prototype._requestLicense=function t(e,i){ne.b.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s)return ne.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(s.mediaKeySystemDomain),a=this._createLicenseXhr(n,e,i);ne.b.log("Sending license request to URL: "+n),a.send(this._generateLicenseRequestChallenge(s,e))},e.prototype.onMediaAttached=function t(e){var i=this;if(this._emeEnabled){var s=e.media;this._media=s,s.addEventListener("encrypted",function(t){i._onMediaEncrypted(t.initDataType,t.initData)})}},e.prototype.onManifestParsed=function t(e){if(this._emeEnabled){var i=e.levels.map(function(t){return t.audioCodec}),s=e.levels.map(function(t){return t.videoCodec});this._attemptKeySystemAccess($s.WIDEVINE,i,s)}},qs(e,[{key:"requestMediaKeySystemAccess",get:function t(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}(le),Zs=Js,tn=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}(),en={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Yi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Li,bufferController:Ni,capLevelController:ji,fpsController:xi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:tn};en.subtitleStreamController=Ks,en.subtitleTrackController=js,en.timelineController=Ns,en.cueHandler=Jt,en.enableCEA708Captions=!0,en.enableWebVTT=!0,en.captionsTextTrack1Label="English",en.captionsTextTrack1LanguageCode="en",en.captionsTextTrack2Label="Spanish",en.captionsTextTrack2LanguageCode="es",en.audioStreamController=is,en.audioTrackController=Xi,en.emeController=Zs;var sn=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();i(14);var nn=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Qt(this,t);var s=t.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in s)n in i||(i[n]=s[n]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(ne.a)(i.debug),this.config=i,this._autoLevelCapping=-1;var a=this.observer=new ze.a;a.trigger=function t(e){for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];a.emit.apply(a,[e,e].concat(s))},a.off=function t(e){for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];a.removeListener.apply(a,[e].concat(s))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.once=a.once.bind(a),this.trigger=a.trigger.bind(a);var r=this.abrController=new i.abrController(this),o=new i.bufferController(this),l=new i.capLevelController(this),d=new i.fpsController(this),u=new Be(this),h=new Fe(this),c=new Ve(this),p=new bi(this),v=this.levelController=new Ai(this),g=new He(this),f=this.streamController=new vi(this,g),m=[v,f],_=i.audioStreamController;_&&m.push(new _(this,g)),this.networkControllers=m;var E=[u,h,c,r,o,l,d,p,g];if(_=i.audioTrackController){var A=new _(this);this.audioTrackController=A,E.push(A)}if(_=i.subtitleTrackController){var y=new _(this);this.subtitleTrackController=y,E.push(y)}if(_=i.emeController){var S=new _(this);this.emeController=S,E.push(S)}[i.subtitleStreamController,i.timelineController].forEach(function(t){t&&E.push(new t(e))}),this.coreComponents=E}return t.isSupported=function t(){return at()},sn(t,null,[{key:"version",get:function t(){return"0.11.0"}},{key:"Events",get:function t(){return se.a}},{key:"ErrorTypes",get:function t(){return ee.b}},{key:"ErrorDetails",get:function t(){return ee.a}},{key:"DefaultConfig",get:function e(){return t.defaultConfig?t.defaultConfig:en},set:function e(i){t.defaultConfig=i}}]),t.prototype.destroy=function t(){ne.b.log("destroy"),this.trigger(se.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function t(e){ne.b.log("attachMedia"),this.media=e,this.trigger(se.a.MEDIA_ATTACHING,{media:e})},t.prototype.detachMedia=function t(){ne.b.log("detachMedia"),this.trigger(se.a.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function t(e){e=te.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),ne.b.log("loadSource:"+e),this.url=e,this.trigger(se.a.MANIFEST_LOADING,{url:e})},t.prototype.startLoad=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;ne.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},t.prototype.stopLoad=function t(){ne.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},t.prototype.swapAudioCodec=function t(){ne.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function t(){ne.b.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},sn(t,[{key:"levels",get:function t(){return this.levelController.levels}},{key:"currentLevel",get:function t(){return this.streamController.currentLevel},set:function t(e){ne.b.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function t(){return this.streamController.nextLevel},set:function t(e){ne.b.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function t(){return this.levelController.level},set:function t(e){ne.b.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function t(){return this.levelController.nextLoadLevel},set:function t(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function t(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function t(e){ne.b.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function t(){return this.levelController.startLevel},set:function t(e){ne.b.log("set startLevel:"+e);var i=this;-1!==e&&(e=Math.max(e,i.minAutoLevel)),i.levelController.startLevel=e}},{key:"autoLevelCapping",get:function t(){return this._autoLevelCapping},set:function t(e){ne.b.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function t(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function t(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function t(){for(var e=this,i=e.levels,s=e.config.minAutoBitrate,n=i?i.length:0,a=0;a<n;a++)if((i[a].realBitrate?Math.max(i[a].realBitrate,i[a].bitrate):i[a].bitrate)>s)return a;return 0}},{key:"maxAutoLevel",get:function t(){var e=this,i=e.levels,s=e.autoLevelCapping,n=void 0;return n=-1===s&&i&&i.length?i.length-1:s}},{key:"nextAutoLevel",get:function t(){var e=this;return Math.min(Math.max(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function t(e){var i=this;i.abrController.nextAutoLevel=Math.max(i.minAutoLevel,e)}},{key:"audioTracks",get:function t(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function t(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function t(e){var i=this.audioTrackController;i&&(i.audioTrack=e)}},{key:"liveSyncPosition",get:function t(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function t(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function t(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function t(e){var i=this.subtitleTrackController;i&&(i.subtitleTrack=e)}},{key:"subtitleDisplay",get:function t(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function t(e){var i=this.subtitleTrackController;i&&(i.subtitleDisplay=e)}}]),t}(),an=e.default=nn},function(t,e,i){function s(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function e(){return t.default}:function e(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e.oe=function(t){throw console.error(t),t};var s=e(e.s=ENTRY_MODULE);return s.default||s}function n(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(t,e,s){var a={};a[s]=[];var r=e.toString(),o=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var u=o[1],h=new RegExp("(\\\\n|\\W)"+n(u)+d,"g"),c;c=h.exec(r);)"dll-reference"!==c[3]&&a[s].push(c[3]);for(h=new RegExp("\\("+n(u)+'\\("(dll-reference\\s('+l+'))"\\)\\)'+d,"g");c=h.exec(r);)t[c[2]]||(a[s].push(c[1]),t[c[2]]=i(c[1]).m),a[c[2]]=a[c[2]]||[],a[c[2]].push(c[4]);return a}function r(t){return Object.keys(t).reduce(function(e,i){return e||t[i].length>0},!1)}function o(t,e){for(var i={main:[e]},s={main:[]},n={main:{}};r(i);)for(var o=Object.keys(i),l=0;l<o.length;l++){var d=o[l],u=i[d],h=u.pop();if(n[d]=n[d]||{},!n[d][h]&&t[d][h]){n[d][h]=!0,s[d]=s[d]||[],s[d].push(h);for(var c=a(t,t[d][h],d),p=Object.keys(c),v=0;v<p.length;v++)i[p[v]]=i[p[v]]||[],i[p[v]]=i[p[v]].concat(c[p[v]])}}return s}var l="[\\.|\\-|\\+|\\w|/|@]+",d="\\((/\\*.*?\\*/)?s?.*?("+l+").*?\\)";t.exports=function(t,e){e=e||{};var n={main:i.m},a=e.all?{main:Object.keys(n)}:o(n,t),r="";Object.keys(a).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;a[t][e];)e++;a[t].push(e),n[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map(function(e){return JSON.stringify(e)+": "+n[t][e].toString()}).join(",")+"});\n"}),r=r+"("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map(function(t){return JSON.stringify(t)+": "+n.main[t].toString()}).join(",")+"})(self);";var l=new window.Blob([r],{type:"text/javascript"});if(e.bare)return l;var d=window.URL||window.webkitURL||window.mozURL||window.msURL,u=d.createObjectURL(l),h=new window.Worker(u);return h.objectURL=u,h}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(10),n=i(1),a=i(0),r=i(7),o=i.n(r),l=function t(e){var i=new o.a;i.trigger=function t(e){for(var s=arguments.length,n=Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];i.emit.apply(i,[e,e].concat(n))},i.off=function t(e){for(var s=arguments.length,n=Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];i.removeListener.apply(i,[e].concat(n))};var r=function t(i,s){e.postMessage({event:i,data:s})};e.addEventListener("message",function(t){var n=t.data;switch(n.cmd){case"init":var o=JSON.parse(n.config);e.demuxer=new s.a(i,n.typeSupported,o,n.vendor);try{Object(a.a)(!0===o.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}r("init",null);break;case"demux":e.demuxer.push(n.data,n.decryptdata,n.initSegment,n.audioCodec,n.videoCodec,n.timeOffset,n.discontinuity,n.trackSwitch,n.contiguous,n.duration,n.accurateTimeOffset,n.defaultInitPTS)}}),i.on(n.a.FRAG_DECRYPTED,r),i.on(n.a.FRAG_PARSING_INIT_SEGMENT,r),i.on(n.a.FRAG_PARSED,r),i.on(n.a.ERROR,r),i.on(n.a.FRAG_PARSING_METADATA,r),i.on(n.a.FRAG_PARSING_USERDATA,r),i.on(n.a.INIT_PTS_FOUND,r),i.on(n.a.FRAG_PARSING_DATA,function(t,i){var s=[],n={event:t,data:i};i.data1&&(n.data1=i.data1.buffer,s.push(i.data1.buffer),delete i.data1),i.data2&&(n.data2=i.data2.buffer,s.push(i.data2.buffer),delete i.data2),e.postMessage(n,s)})};e.default=l},function(t,e){String.prototype.endsWith||function(){"use strict";var t=function(){try{var t={},e=Object.defineProperty,i=e(t,t,t)&&e}catch(t){}return i}(),e={}.toString,i=function(t){if(null==this)throw TypeError();var i=String(this);if(t&&"[object RegExp]"==e.call(t))throw TypeError();var s=i.length,n=String(t),a=n.length,r=s;if(arguments.length>1){var o=arguments[1];void 0!==o&&(r=o?Number(o):0)!=r&&(r=0)}var l=Math.min(Math.max(r,0),s),d=l-a;if(d<0)return!1;for(var u=-1;++u<a;)if(i.charCodeAt(d+u)!=n.charCodeAt(u))return!1;return!0};t?t(String.prototype,"endsWith",{value:i,configurable:!0,writable:!0}):String.prototype.endsWith=i}()}]).default}),function(i){"use strict";function s(){var t=i.crypto||i.msCrypto;if(!d&&t&&t.getRandomValues)try{var e=new Uint8Array(16);c=d=function i(){return t.getRandomValues(e),e},d()}catch(t){}if(!d){var s=new Array(16);u=d=function(){for(var t=0,e;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function n(){if("function"==typeof e)try{var t=e("crypto").randomBytes;h=d=t&&function(){return t(16)},d()}catch(t){}}function a(t,e,i){var s=e&&i||0,n=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){n<16&&(e[s+n++]=f[t])});n<16;)e[s+n++]=0;return e}function r(t,e){var i=e||0,s=g;return s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]}function o(t,e,i){var s=e&&i||0,n=e||[];t=t||{};var a=null!=t.clockseq?t.clockseq:A,o=null!=t.msecs?t.msecs:(new Date).getTime(),l=null!=t.nsecs?t.nsecs:S+1,d=o-y+(l-S)/1e4;if(d<0&&null==t.clockseq&&(a=a+1&16383),(d<0||o>y)&&null==t.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");y=o,S=l,A=a,o+=122192928e5;var u=(1e4*(268435455&o)+l)%4294967296;n[s++]=u>>>24&255,n[s++]=u>>>16&255,n[s++]=u>>>8&255,n[s++]=255&u;var h=o/4294967296*1e4&268435455;n[s++]=h>>>8&255,n[s++]=255&h,n[s++]=h>>>24&15|16,n[s++]=h>>>16&255,n[s++]=a>>>8|128,n[s++]=255&a;for(var c=t.node||E,p=0;p<6;p++)n[s+p]=c[p];return e||r(n)}function l(t,e,i){var s=e&&i||0;"string"==typeof t&&(e="binary"===t?new v(16):null,t=null),t=t||{};var n=t.random||(t.rng||d)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e)for(var a=0;a<16;a++)e[s+a]=n[a];return e||r(n)}var d,u,h,c,p;i?s():n();for(var v="function"==typeof Buffer?Buffer:Array,g=[],f={},m=0;m<256;m++)g[m]=(m+256).toString(16).substr(1),f[g[m]]=m;var _=d(),E=[1|_[0],_[1],_[2],_[3],_[4],_[5]],A=16383&(_[6]<<8|_[7]),y=0,S=0,b=l;b.v1=o,b.v4=l,b.parse=a,b.unparse=r,b.BufferClass=v,b._rng=d,b._mathRNG=u,b._nodeRNG=h,b._whatwgRNG=c,"undefined"!=typeof module&&module.exports?module.exports=b:"function"==typeof t&&t.amd?t(function(){return b}):(p=i.uuid,b.noConflict=function(){return i.uuid=p,b},i.uuid=b)}("undefined"!=typeof window?window:null),function(){function t(t){var e=t.__resizeTriggers__,i=e.firstElementChild,s=e.lastElementChild,n=i.firstElementChild;s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,n.style.width=i.offsetWidth+1+"px",n.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function e(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height}function i(i){var s=this;t(this),this.__resizeRAF__&&o(this.__resizeRAF__),this.__resizeRAF__=r(function(){e(s)&&(s.__resizeLast__.width=s.offsetWidth,s.__resizeLast__.height=s.offsetHeight,s.__resizeListeners__.forEach(function(t){t.call(s,i)}))})}function s(){if(!a){var t=(_||"")+".resize-triggers { "+(E||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i),a=!0}}var n=document.attachEvent,a=!1;if(!n){var r=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)};return function(e){return t(e)}}(),o=function(){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(e){return t(e)}}(),l=!1,d="animation",u="",h="animationstart",c="Webkit Moz O ms".split(" "),p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),v="",g=document.createElement("fakeelement");if(void 0!==g.style.animationName&&(l=!0),!1===l)for(var f=0;f<c.length;f++)if(void 0!==g.style[c[f]+"AnimationName"]){v=c[f],d=v+"Animation",u="-"+v.toLowerCase()+"-",h=p[f],l=!0;break}var m="resizeanim",_="@"+u+"keyframes "+m+" { from { opacity: 0; } to { opacity: 0; } } ",E=u+"animation: 1ms "+m+"; "}window.addResizeListener=function(e,a){n?e.attachEvent("onresize",a):(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),s(),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),t(e),e.addEventListener("scroll",i,!0),h&&e.__resizeTriggers__.addEventListener(h,function(i){i.animationName==m&&t(e)})),e.__resizeListeners__.push(a))},window.removeResizeListener=function(t,e){n?t.detachEvent("onresize",e):(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",i),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)))}}(),function(e,i){"object"==typeof module&&module.exports?module.exports=i():"function"==typeof t&&t.amd?t(i):e.Spinner=i()}(this,function(){"use strict";function t(t,e){var i,s=document.createElement(t||"div");for(i in e)s[i]=e[i];return s}function e(t){for(var e=1,i=arguments.length;i>e;e++)t.appendChild(arguments[e]);return t}function i(t,e,i,s){var n=["opacity",e,~~(100*t),i,s].join("-"),a=.01+i/s*100,r=Math.max(1-(1-t)/e*(100-a),t),o=d.substring(0,d.indexOf("Animation")).toLowerCase(),l=o&&"-"+o+"-"||"";return c[n]||(u.insertRule("@"+l+"keyframes "+n+"{0%{opacity:"+r+"}"+a+"%{opacity:"+t+"}"+(a+.01)+"%{opacity:1}"+(a+e)%100+"%{opacity:"+t+"}100%{opacity:"+r+"}}",u.cssRules.length),c[n]=1),n}function s(t,e){var i,s,n=t.style;if(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==n[e])return e;for(s=0;s<h.length;s++)if(i=h[s]+e,void 0!==n[i])return i}function n(t,e){for(var i in e)t.style[s(t,i)||i]=e[i];return t}function a(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)void 0===t[s]&&(t[s]=i[s])}return t}function r(t,e){return"string"==typeof t?t:t[e%t.length]}function o(t){this.opts=a(t||{},o.defaults,p)}function l(){function i(e,i){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}u.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(t,s){function a(){return n(i("group",{coordsize:u+" "+u,coordorigin:-d+" "+-d}),{width:u,height:u})}function o(t,o,l){e(c,e(n(a(),{rotation:360/s.lines*t+"deg",left:~~o}),e(n(i("roundrect",{arcsize:s.corners}),{width:d,height:s.scale*s.width,left:s.scale*s.radius,top:-s.scale*s.width>>1,filter:l}),i("fill",{color:r(s.color,t),opacity:s.opacity}),i("stroke",{opacity:0}))))}var l,d=s.scale*(s.length+s.width),u=2*s.scale*d,h=-(s.width+s.length)*s.scale*2+"px",c=n(a(),{position:"absolute",top:h,left:h});if(s.shadow)for(l=1;l<=s.lines;l++)o(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=s.lines;l++)o(l);return e(t,c)},o.prototype.opacity=function(t,e,i,s){var n=t.firstChild;s=s.shadow&&s.lines||0,n&&e+s<n.childNodes.length&&(n=n.childNodes[e+s],n=n&&n.firstChild,(n=n&&n.firstChild)&&(n.opacity=i))}}var d,u,h=["webkit","Moz","ms","O"],c={},p={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},a(o.prototype,{spin:function(e){this.stop();var i=this,s=i.opts,a=i.el=t(null,{className:s.className});if(n(a,{position:s.position,width:0,zIndex:s.zIndex,left:s.left,top:s.top}),e&&e.insertBefore(a,e.firstChild||null),a.setAttribute("role","progressbar"),i.lines(a,i.opts),!d){var r,o=0,l=(s.lines-1)*(1-s.direction)/2,u=s.fps,h=u/s.speed,c=(1-s.opacity)/(h*s.trail/100),p=h/s.lines;!function t(){o++;for(var e=0;e<s.lines;e++)r=Math.max(1-(o+(s.lines-e)*p)%h*c,s.opacity),i.opacity(a,e*s.direction+l,r,s);i.timeout=i.el&&setTimeout(t,~~(1e3/u))}()}return i},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(s,a){function o(e,i){return n(t(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*u+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var l,u=0,h=(a.lines-1)*(1-a.direction)/2;u<a.lines;u++)l=n(t(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:d&&i(a.opacity,a.trail,h+u*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&e(l,n(o("#000","0 0 4px #000"),{top:"2px"})),e(s,e(l,o(r(a.color,u),"0 0 1px rgba(0,0,0,.1)")));return s},opacity:function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)}}),"undefined"!=typeof document){u=function(){var i=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var v=n(t("group"),{behavior:"url(#default#VML)"});!s(v,"transform")&&v.adj?l():d=s(v,"animation")}return o}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam",SEGMENT:"Segment"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(t){var e=t.split("."),i=window,s=e.length,n,a;for(n=0;n<s;n++)a=e[n],void 0===i[a]&&(i[a]={}),i=i[a];return i},getClass:function(t){var e,i,s,n,a,r;if("string"!=typeof t)return t;for(e=t.split("."),i=window,s=e.length,n="",a=0;a<s;a++){if(r=e[a],n+=r,void 0===i[r])throw new Error("uvpjs.getClass(): "+n+" is undefined.");a<s-1&&(n+="."),i=i[r]}return i},getObject:function(t){return uvpjs.getClass(t)}},function(){var t=!1,e=/xyz/.test(function(){var t;t=null})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(i){function s(){!t&&this.init&&this.init.apply(this,arguments)}var n=this.prototype,a,r,o,l;t=!0,r=new this,t=!1,a=function(t,e){return function(){var i=this._super,s;return this._super=n[t],s=e.apply(this,arguments),this._super=i,s}};for(l in i)i.hasOwnProperty(l)&&(o=i[l],r[l]="function"==typeof o&&"function"==typeof n[l]&&e.test(o)?a(l,o):o);return s.prototype=r,s.prototype.constructor=s,s.subClass=arguments.callee,s}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),function(t){
t.b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA=="}(uvpjs.register("uvpjs")),function(t){"use strict";t.util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(t){return t&&this.xhrMessages[t]||"XHR status: "+t},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(t){var e=document.createElement("a");return e.href=t,{host:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search}},objFromQueryStr:function(t){var e="string"==typeof t?t:"",i=e.indexOf("?")>-1?e.split("?")[1]:e,s=i.split("&"),n={},a,r,o;for(r=0,o=s.length;r<o;r++)a=s[r].split("="),n[a[0]]=a[1];return n},queryStrFromObj:function(t,e){var i="",s=!1,n;for(n in t)i+=(s?"&":"")+n+"="+(e?encodeURIComponent(t[n]):t[n]),s=!0;return i},uid8:function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()},getUserStatusForQuery:function(t){var e="";switch(t){case"anon":e="sb=0";break;case"reg;sub;pay":e="sb=1";break;case"reg":e="sb=2";break;case"reg;sub;susp":e="sb=3";break;case"reg;sub;exsub":e="sb=4";break;case"reg;sub;trial":e="sb=5";break;default:if(t.indexOf("|")>-1){var i,s,n,a,r,o="",l=t.split(","),d=l.length;for(l.sort(),r=0;r<d;r++)i=l[r],s=i.split("|"),2==s.length&&(n=s[0],a=s[1],o!=n?(e.length>0&&(e+="&"),e+=n+"="+a):e+=","+a,o=n)}}return""==e&&(e="sb=0"),e},firstInt:function(){var t=arguments.length,e,i;for(i=0;i<t;i++)if(e=arguments[i],parseInt(e)===e)return e},inRange:function(t,e,i){return"number"==typeof t&&t>=e&&t<=i},isEmpty:function(t){return null===t||void 0===t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&""===t},isPlainObject:function(t){return t&&"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"==typeof t},isDefinedString:function(t){return!!(t&&"string"==typeof t&&t.length>0)},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isDefined:function(t){return void 0!==t},isFlagTrue:function(t){return!0===t||"true"===t||1===t||"1"===t},getDefinedString:function(){var t=arguments.length,e,i;for(i=0;i<t;i++)if(e=arguments[i],this.isDefinedString(e))return e;return""},supportsLocalStorage:function(){var t="test",e;if(null===this.isLocalStorageSupported)try{localStorage.setItem("test","1"),e=localStorage.getItem("test"),this.isLocalStorageSupported="1"===e,localStorage.removeItem("test")}catch(t){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},createStyleSheet:function(t,e){var i=document.styleSheets,s=i.length,n,a,r,o,l,d,u,h,c,p,v;for(p=function(){v||(t(l),v=!0)},n=0;n<s;n++){l=i[n];try{if((u=l.href&&l.href.replace(/http(s)?:/,""))===e)return void p()}catch(t){u=null}}a="string"==typeof e&&""!==e,r=uvpjs.mediaCapabilities.isFirefox(),o=!a||r?"style":"link",l=document.createElement(o),l.setAttribute("type","text/css"),l.appendChild(document.createTextNode("")),a&&(l.setAttribute("rel","stylesheet"),l.setAttribute("href",e),l.textContent='@import "'+e+'"'),"function"==typeof t&&(l.onload=p,l.addEventListener&&l.addEventListener("load",p,!1),l.onreadystatechange=function(){"loaded"!==(d=l.readyState)&&"complete"!==d||(link.onreadystatechange=null,p())},h=setInterval(function(){document.styleSheets.length>s&&(p(),clearInterval(h))},10),r&&(c=setInterval(function(){try{l.sheet.cssRules,clearInterval(c),p()}catch(t){}},10)),document.getElementsByTagName("head")[0].appendChild(l))},addCSSObject:function(t,e,i,s){var n=uvpjs.util,a="#"+e.id+" "+(s||""),r;for(r in i)n.addCSSRule(t,a,r,i[r])},addCSSRule:function(t,e,i,s){var n=uvpjs.mediaCapabilities,a,r,o,l,d="string"==typeof s&&s.match(/NaN(%|px)/);if(t&&t.sheet)if(!d||n.isAndroid()&&n.isChrome()||(s="0"),a=t.sheet,r=a.rules||a.cssRules,o=r.length,l=i+":"+s+";",a.insertRule)try{a.insertRule(e+"{"+l+"}",o)}catch(t){console.warn("Unable to add CSS rule: "+t.message)}else a.addRule&&a.addRule(e,l,o)},addCSSRules:function(t,e,i){for(var s=i.length,n;s--;)n=i[s],uvpjs.util.addCSSRule(t,e,n.name,n.value)},copyObjectWithKeyMap:function(t){var e=t,i=null;return this.from=function(t){return i=t,this},this.to=function(t){if(!(e&&i&&t))return t;for(var s in e)e.hasOwnProperty(s)&&i.hasOwnProperty(s)&&null!==i[s]&&(t[e[s]]=i[s]);return t},this}}}(uvpjs.register("uvpjs")),function(t){var e=uvpjs._,i={mediaRefId:/\{mediaReferenceId}/g,partner:/PARTNER/g,ptype:/\{ptype}/g,vguid:/\{VGUID}/g,ptypeAlt:/%7Bptype%7D/g,vguidAlt:/%7BVGUID%7D/g,session:/;/g};t.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(t,s,n,a){var r=uvpjs.util,o="cust_params",l=t.split("?"),d=l[1],u=t.indexOf("{ptype}")>-1,h=this.getAdParams(s,n,a),c,p,v,g,f,m,_,E;return d=d.replace(i.mediaRefId,h.vid).replace(i.partner,h.partner),d.indexOf("VGUID")>-1&&(d=d.replace(u?i.vguidAlt:i.vguid,h.vguid)),d=d.replace(u?i.ptypeAlt:i.ptype,h.ptype),p=r.objFromQueryStr(d),this.isExcludedFromVpaid(s)&&delete p.pp,v=p[o],v&&(c=r.objFromQueryStr(decodeURIComponent(v)),delete p[o]),g=h[o],delete h[o],delete h.partner,delete h.vguid,delete h.ptype,f=e.assign(h,p),m=e.assign(g,c||{}),decodeURIComponent(f.iu).indexOf("/8264/")>=0&&s.isMuteAtPlayStart&&!s.userHasUnmuted&&(f.sz="640x483"),this.removeEmpty(f),this.removeEmpty(m),_=r.queryStrFromObj(f,!1),E=r.queryStrFromObj(m,!1),_+="&"+o+"="+encodeURIComponent(E),l[0]+"?"+_},getAdParams:function(t,i,s){var n=t.dwPageParams,a=this.getDwViewGuid(t),r=this.getPpidValue(t),o=t.contentVideoState,l=encodeURIComponent(t.sessionOptions.partner),d=n.pagetype||"",u=this.getUserStatusKey(t.getSessionOption("userStatus")),h=""!==o.contPlayState,c=h&&!uvpjs.util.isFlagTrue(s)?"1":"0",p=t.getSessionOption("isEmbedded")?"1":"0",v=this.getHost("1"===p,t),g=o.pid,f={cust_params:{}},m=uvpjs.Configuration.env,_=t.getAdCallParams(),E,A;E=i?this.getVideoDfpId(t):"",f.vid=E,f.partner=l,f.ptype=d,f.vguid=a,f.cust_params.vguid=a,f.cust_params.embed=p,v&&(f.cust_params.host=v),this.populateCustParamsWithAdSessionValues(f.cust_params,g),o.podsToSkip.length>0&&(f.cust_params.resume=1,f.cust_params.skippod=o.podsToSkip);for(A in u)f.cust_params[A]=u[A];if(r&&(f.ppid=r,f.cust_params.ppid=r),"cbs"===l&&(f.cust_params.cpSession=c,f.cust_params.cpPre=c,f.cust_params.sub=e.isEmpty(t.sessionOptions.userId)?"":t.sessionOptions.userId),_&&!uvpjs.util.isEmpty(_.standardParams))for(A in _.standardParams)f[A]=_.standardParams[A];if(_&&!uvpjs.util.isEmpty(_.customParams))for(A in _.customParams)f.cust_params[A]=_.customParams[A];return this.isExcludedFromVpaid(t)?f.pp="ssai":("local"===m||"dev"===m)&&(f.pp="vpaid_js"),f},getVideoDfpId:function(t){return uvpjs.util.isEmpty(t.contentVideoState.dfpMediaId)?t.contentVideoState.cmsRefGuid:t.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(t){return"AA Original"===t.contentVideoState.contentType},getDwViewGuid:function(t){var e=t.dwPageParams;return e&&e.viewguid||e.pguid||""},extractAdInfo:function(t,i){var s=i===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma",n,a;return uvpjs.util.isEmpty(t)||!i?(!i&&console.error("No 'context' arg supplied"),null):(n={adId:t.getAdId(),adSystem:t.getAdSystem(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId()},n.adPodInfo=this.extractPodInfo(t.getAdPodInfo()),a=this[s](t),e.assign(n,a))},extractAdStateData:function(t,e){var i=t.getAdPodInfo(),s=i.getPodIndex(),n=i.getAdPosition(),a=t.getDuration(),r=0===s?"pre":s>=1?"mid":-1===s?"post":"",o=("mid"!==r?r+"_0":"mid_"+s)+"_"+n,l=e===this.context.IMA,d=l?this.extractIdInfo(t):null,u=this.getAdStateBlank();return u.adPosition=n,u.adBitrate=t.getVastMediaBitrate(),u.adServerName=l?this.context.IMA:this.context.DAI,u.adVideoTitle=t.getTitle(),u.duration=a,u.adType=r,u.adClipID=o,u.wrapperAdId=l?d.wrapperAdId||"":"",u.adVideoId=l?d.wrapperAdId||d.adId:t.getAdId(),u.creativeId=l?d.wrapperCreativeId||d.creativeId:t.getCreativeId(),e===this.context.DAI&&(u.sourceWidth=t.getVastMediaWidth(),u.sourceHeight=t.getVastMediaHeight()),u},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(t){var e=t.getWrapperAdIds(),i=t.getWrapperCreativeIds(),s=Array.isArray(e)&&e.length||0,n=Array.isArray(i)&&i.length||0,a=null,r=null,o=t.getAdId()||"",l=t.getCreativeId()||"";return s&&(s>1&&(a=e[1]),o=e[0]),n&&(n>1&&(r=i[1]),l=i[0]),{adId:o,wrapperAdId:a,creativeId:l,wrapperCreativeId:r}},getHost:function(t,e){var i,s,n;return t?(i=e.getSessionOption("referrer"))&&(s=uvpjs.util.parseUrl(i),n=s.host):n=window.location.hostname,n&&""!==n?n:null},getUserStatusKey:function(t){for(var e=uvpjs.util.getUserStatusForQuery(t),i=e.split("&"),s=i.length,n={},a;s--;)a=i[s].split("="),n[a[0]]=a[1];return n},trackAd:function(t){var e=t.model,i=t.context,s=e.getAdVideoState(),n=i===this.context.IMA,a=i===this.context.DAI,r=n||a,o,l,d;return r?(l=e.dwPageParams.pagetype||"",o={level1:"",level2:"",level3:s.adVideoId,level4:s.creativeId,slicer1:"vaw-can",slicer2:e.sessionOptions.partner,slicer3:l,moatVASTSystem:s.adServerName,moatVASTAdID:s.wrapperAdId},d=this.getDwViewGuid(e),""!==d&&(o.zMoatVGUID=d),""!==l&&(o.zMoatPT=l),this.initMoatTracking(t.adVideoContainer,o,s.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(t){var e=this.getVpaidEventForEvent(t.eventName,t.context);e&&t.trackingHandle.dispatchEvent({type:e,adVolume:t.volume})},checkForAdBlocker:function(t){var e=t.getSessionOption("adBlockerCallback");return e&&e()},populateCustParamsWithAdSessionValues:function(t,e){var s,n,a;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(s=window.getVideoAdSessionValues(e))&&""!==s){s=s.replace(i.session,"&"),n=uvpjs.util.objFromQueryStr(s);for(a in n)t[a]=n[a]}},removeEmpty:function(t){for(var e in t)(null===t[e]||""===t[e])&&delete t[e]},extractAdInfoIma:function(t){return{contentType:t.getContentType(),isLinear:t.isLinear()}},extractAdInfoDai:function(t){return{advertiserName:t.getAdvertiserName(),description:t.getDescription(),duration:t.getDuration(),title:t.getTitle()}},extractPodInfo:function(t){return t?{adPosition:t.getAdPosition(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()}:null},getPpidValue:function(t){var e=t.getSessionOption("userPPID");return uvpjs.util.isDefinedString(e)?e:null},initMoatTracking:function(t,e,i,s,n){var a=document.createElement("script"),r=[],o,l,d;e={adData:{ids:e,duration:i,url:n},dispatchEvent:function(t){this.sendEvent?(r&&(r.push(t),t=r,r=!1),this.sendEvent(t)):r.push(t)}},d="_moatApi"+Math.floor(1e8*Math.random());try{o=t.ownerDocument,l=o.defaultView||o.parentWindow}catch(t){l=window}return l[d]=e,a.type="text/javascript",t&&t.insertBefore(a,t.childNodes[0]||null),a.src="https://z.moatads.com/"+s+"/moatvideo.js#"+d,e},getVpaidEventForEvent:function(t,e){var i=this.moatEventMapping[e][t];return uvpjs.util.isEmpty(i)?null:this.vpaidEvents[i]}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.Configuration={env:"production",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"2.9.52",date:"11/13/18 1:00:28 PM (PST)",path:"//vidtech.cbsinteractive.com/uvpjs/2.9.52/",playerName:"CBSI-PLAYER"}}(uvpjs),function(t){t.AutoplayDetectionService=uvpjs.Class.subClass({init:function(t){this.mc=t.mediaCapabilities,this.completeCallback=t.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=t.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(t,e){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:t,supportsMutedAutoplay:e})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(t,e){this.killVid(),this.setInfo(t,e),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var t,e;this.vidEl=e=this.createVideoElement(!1),e.load(),t=e.play(),void 0===t?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):t.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var t,e;if(this.killVid(),this.checkForEarlySafari())return void this.finishCheck(!1,!1);this.vidEl=e=this.createVideoElement(!0),e.load(),t=e.play(),t.then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var t=this.mc.getBrowserName()===this.mc.SAFARI,e=this.mc.isDesktop(),i=t&&e?this.mc.getBrowserVersion():null,s=i&&i.split("."),n=s?11===parseInt(s[0])&&0===parseInt(s[1]):null;return null!==i&&n&&(!s[2]||parseInt(s[2])<3)},detectMobileCapabilities:function(){var t=!1,e=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,e)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var t=this.mc.isIOSTen(),e=t&&this.mc.isSafari(),i=t&&!e&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return e||i},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(t){var e=document.createElement("video");return t&&(e.muted=!0,e.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(e,!0),e.volume=.005,e.style.width="100%",e.style.height="100%",e.src=this.testVidPath,this.testDom.appendChild(e),e},createTestDom:function(){var t=document.createElement("div"),e=t.style,i="-1000px";return e.position="absolute",e.top=i,e.left=i,e.width="320px",e.height="180px",document.body.appendChild(t),t}})}(uvpjs.register("uvpjs")),uvpjs.MediaCapabilities=function(){var t=uvpjs._,e=uuid.noConflict(),i=!1,s,n,a,r,o,l,d,u,h,c,p,v=!1,g=!1,f,m,_,E,A=!1,y={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(t,e){var a=this.systemInfo;return typeof t===this.STRING?(s=t,n=!0):(s=navigator.userAgent||null,n=!1),o=document.createElement(this.VIDEO),l=document.createElement(this.AUDIO),typeof e===this.BOOLEAN&&(i=e),S(),D(),j(),A="https:"===location.protocol,a.browser=this.getBrowserName(),a.version=parseInt(this.getBrowserMajorVersion()),a.isMobile=this.isMobile(),a.isDesktop=this.isDesktop(),a.os=this.getOS()+"; ver. "+this.getOSVersion(),a.supportsMse=this.hasMediaSourceSupport(),a.isHlsjsEligible=this.canPlayHLSJS(),a.supportsNativeHls=this.canPlayNativeHLS(),a.supportsMp4=this.canPlayH264(),a.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(t){var e;if(null!==this.systemInfo.supportsUnmutedAutoplay)return void t();e=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,t()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:e,testVidPath:this.PLACEHOLDER_MP4_URL})},setTrackingInfo:function(t){var e=uvpjs.tracking,i={},s,n;for(n in e)s=e[n],i[n]=!!t[s];this.systemInfo.trackingAvailability=i},setAutoplayInfo:function(t){this.systemInfo.supportsUnmutedAutoplay=t.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=t.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return e.v1().replace(/-/g,"")},checkBrowserName:function(t){return typeof t===this.STRING&&this.getBrowserName()===t},canPlayHTML5Video:function(){var t=document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var t=document.createElement(this.AUDIO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},getBrowserName:function(){return f},getBrowserVersion:function(){return m},getBrowserMajorVersion:function(){return _},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(t,e){if(typeof e===this.OBJECT){var i=new RegExp(e),s=i.exec(this.getUserAgent()),n="",a="";if(typeof s===this.OBJECT&&s.length&&s.length>1){if(n=s[1]||"",n.indexOf(".")){var r=n.split(".");"object"==typeof r&&r.length&&r.length>0&&(a=r[0])}else a=n;return f=t,m=n,_=a,!0}}return!1},hasTealium:function(){return t.has(window,"utag")||t.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(t){return typeof t===this.STRING&&(this._detectEnvironment(t),!0)},getUserAgent:function(){return s},getMimeTypesObj:function(){return a||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(a=navigator.mimeTypes),a)},getMimeTypes:function(){if(typeof r===this.OBJECT)return r;var t={length:0},e=this.getMimeTypesObj();if(typeof e===this.OBJECT){for(var i=0;i<this.length;i++){var s=e[i].enabledPlugin&&e[i].enabledPlugin.name?e[i].enabledPlugin.name:"";t[e[i].type]={type:e[i].type,description:e[i].description,suffixes:e[i].suffixes,enabledPlugin:e[i].enabledPlugin,enabledPluginName:s},t.length++}return r=t}},getPlatform:function(){return typeof u===this.STRING?u:null},getOS:function(){return typeof h===this.STRING?h:null},getOSVersion:function(){return typeof c===this.STRING?c:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof p===this.BOOLEAN?p:p=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return I()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var t='video/mp4; codecs="avc1.42E01E,mp4a.40.2"',e=window.MediaSource||window.WebKitMediaSource,i=window.SourceBuffer||window.WebKitSourceBuffer,s=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported(t),n=!i||i.prototype&&"function"==typeof i.prototype.appendBuffer&&"function"==typeof i.prototype.remove;this.hasMse=!(!s||!n)}return this.hasMse},canPlayHLSJS:function(t){var e=this.isMobile(),i=!!I(),s=this.hasMediaSourceSupport(),n=this.isFirefox()||this.isChrome(),a=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),r=this.isOpera()&&this.getBrowserMajorVersion()>=30,o=this.isPlaystation();return!(!s||!i||e||o)&&(!!t||n||a||r)},canPlayNativeHLSAudio:function(){return R()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return I()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return I()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return I()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(t,e){return I()&&this.canPlayMediaType(this.VIDEO,t,e||!1)},canPlayAudioType:function(t,e){return I()&&this.canPlayMediaType(this.AUDIO,t,e||!1)},canPlayMediaType:function(t,e,i){var s=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof s!==this.OBJECT||typeof s.canPlayType!==this.FUNCTION||!(i&&s.canPlayType(e)===this.PROBABLY||!i&&""!==s.canPlayType(e)))},canPlayType:function(t,e){e=1==e;var i=/audio\//,s=i.test(t)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof s!==this.OBJECT||typeof s.canPlayType!==this.FUNCTION||!(e&&s.canPlayType(t)===this.PROBABLY||!e&&""!==s.canPlayType(t)))},nativeCanPlayType:function(t,e){var i=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION?i.canPlayType(e)||null:null},canPlayDASHType:function(t){if(typeof t!==this.STRING||t.length<1)return null;var e=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(t)&&this.hasMSE()&&e.isTypeSupported(t)},canPlayDASH264:function(t){return t=typeof t===this.STRING?t:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(t)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var t=this.getUserAgent();return t&&!(this.isChromecast()||this.isIOS()||t.indexOf("Android 2.")>-1||t.indexOf("Android 4.0")>-1||t.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(t){return!(t&&this.supportsAutoplay()||this.isChromecast()||this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(t){return t&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(t){return!t&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(t,e){var i=this.getInlinePlayAttribute(),s=i&&i.name;e&&i?i&&t.setAttribute(s,i.value):!e&&s&&t.removeAttribute(s)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var t="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return t&&!t.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var t,e;return void 0===this._hasFullscreenApiSupport&&(t=document.createElement("div"),e=uvpjs.util,this._hasFullscreenApiSupport=!!(e.isFunction(t.requestFullscreen)||e.isFunction(t.webkitRequestFullscreen)||e.isFunction(t.mozRequestFullScreen)||e.isFunction(t.msRequestFullscreen))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(t){var e=document,i=this.supportsFullscreenApi()&&(e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled);return!i&&(i=t&&t.webkitSupportsFullscreen),i},getDevice:function(){return d||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var t=this.isIOS();return!t||t&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(t){return/\.m3u|assetType=hls/i.test(t)},isDashUrl:function(t){return/\.mpd/i.test(t)},isSecure:function(){return A},setUrlProtocol:function(t){return A?t.replace("http:","https:"):t},getDrmType:function(t){var e="none";return t.enabled?((this.isIOS()||this.isSafari())&&null!==t.fairplay.appCertURL?e="Fairplay":(this.isIE()||this.isEdge())&&null!==t.dash.playreadyURL?e="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==t.dash.widevineURL&&(e="Widevine"),e):e}},S=function(){var t=/\s(\([^)]+\))/,e=new RegExp(t),i=e.exec(y.getUserAgent());i&&i.length&&i.length>1&&(i=i[1].replace(/_/gi,"."),T(i)||C(i)||b(i)||O(i))},b=function(t){if(-1!==t.indexOf(y.LINUX)||-1!==t.indexOf(y.ANDROID)){if(u=y.LINUX,-1!==t.indexOf(y.ANDROID)){var e=/\ Android\ ([^\s]+);/;t=new RegExp(e).exec(t),d=y.ANDROID,h=y.ANDROID,c=t&&t[1]?t[1]:""}return!0}return!1},T=function(t){var e,i,s="like Mac OS X";if(-1!==t.indexOf(y.MAC))return u=y.MAC,d=y.DESKTOP,-1!==t.indexOf(y.OSX)&&(e=/Mac\ OS\ X\ ([\d\.]+)/,i=new RegExp(e),t=i.exec(t),h=y.OSX,c=t&&t[1]?t[1]:null),!0;if(-1!==t.indexOf(s)){
u=y.MAC,h=y.IOS;var n=/\(iPhone;/,a=/\(iPad;/,r=/\(iPod;/;i=/\sOS\s([^\s]*)\s/;var o=i.exec(t);if(o&&o[1]&&(c=o[1]),n.test(t))d=y.IPHONE;else if(a.test(t))d=y.IPAD;else{if(!r.test(t))return!1;d=y.IPOD}return!0}return!1},C=function(t){var e=/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/,i=/Windows\ NT\ ([^\s]+)[;\)]/,s=new RegExp(e);if((t=s.exec(y.getUserAgent()))&&t[2])return u=y.WINDOWS,h=y.WINDOWS_PHONE,c=t[2],d=y.PHONE,!0;if(s=new RegExp(i),(t=s.exec(y.getUserAgent()))&&t[1]){u=y.WINDOWS,h=y.WINDOWS;var n=t[1];return 6==n?h=y.WINDOWS_VISTA:6.1==n?(h=y.WINDOWS7,c=7):6.2==n?(h=y.WINDOWS8,c=8):10==parseInt(n)&&(h=y.WINDOWS10,c=n),d=y.DESKTOP,!0}return!1},D=function(){return!!(P()||L()||k()||w()||N()||U()||B()||M())},I=function(){return o},R=function(){return l},P=function(){var t=/Chrome\/(\S+)/,e=/CriOS\/(\S+)/,i=/(Opera|OPR)/,s=/Edge/,n=/CrKey/,a=y.getUserAgent(),r=e.test(a);return!(!t.test(a)&&!r||i.test(a)||s.test(a)||n.test(a)||(y.setBrowserVersion(y.CHROME,r?e:t),0))},M=function(){var t=/Playstation (\S+)/i;return!!t.test(y.getUserAgent())&&(y.setBrowserVersion(y.PLAYSTATION,t),!0)},O=function(){return null!=y.getUserAgent()&&y.getUserAgent().indexOf(y.CHROMECAST_USER_AGENT)>-1&&(u=y.LINUX,d=y.CHROMECAST,h=y.ANDROID,!0)},L=function(){var t=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,e=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return t.test(y.getUserAgent())?(y.setBrowserVersion(y.IE,t),!0):e.test(y.getUserAgent())?(y.setBrowserVersion(y.EDGE,e),!0):!!i.test(y.getUserAgent())&&(y.setBrowserVersion(y.IE,i),!0)},k=function(){var t=/Firefox\/(\S+)/;return!!t.test(y.getUserAgent())&&(y.setBrowserVersion(y.FIREFOX,t),!0)},w=function(){var t=/Version\/(\S+).*Safari\//,e=t.test(y.getUserAgent()),i;return i=h===y.ANDROID?y.ANDROID:y.SAFARI,!!e&&(y.setBrowserVersion(i,t),!0)},N=function(){var t=/Opera|OPR\/(\S+)/,e=new RegExp(t),i=e.exec(y.getUserAgent());if(i){var s=-1!==i.indexOf("Opera Mini/")||-1!==i.indexOf("Opera Mobi")?y.OPERA_MOBILE:y.OPERA;return y.setBrowserVersion(s,/Opera|OPR\/(\S+)/),!0}return!1},U=function(){return!!/Silk/i.test(y.getUserAgent())&&(y.setBrowserVersion(y.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},B=function(){return!!/Android/.test(y.getUserAgent())&&(f=y.ANDROID_BROWSER,!0)},j=function(){var t=I(),e=function(t,e){t._fullscreenEventName=e?e[0]:null,t._fullscreenEnterEventName=e?e[1]:null,t._fullscreenExitEventName=e?e[2]:null,t._enterFullscreenMethodName=e?e[3]:null,t._exitFullscreenMethodName=e?e[4]:null,t._isFullscreenPropertyName=e?e[5]:null,t._fullscreenElementName=e?e[6]:null,t._fullscreenErrorEventName=e?e[7]:null},i=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],s=null;t.requestFullscreen?s=i:t.webkitRequestFullscreen?s=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:t.mozRequestFullScreen?s=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:t.msRequestFullscreen?y.getBrowserVersion()<12?s=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(s=i.slice(),s[5]=null):(y.isIOS()||y.isAndroid())&&(s=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"]),e(y,s)};return y},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(t){var e=uvpjs._,i=uvpjs.mediaCapabilities;if(this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,!e.isObject(t))return void this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.");this.cookie=this._getCookie(),this.CDO=t,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(t,e,i){this.debugCount++;var s=uvpjs._;if(this.isEnabled||s.isUndefined(this.CDO)){if(!s.isString(t)||!s.isString(e)||s.isUndefined(i))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,e);if(this.showAll||s.isUndefined(this.CDO)||this.isParamEnabled(e)||!0===this.cookie[e]){var n=this.showTimestamps?"["+this._timestamp()+"] ":"",a=s.drop(arguments,3),r=s.isEmpty(a)?"":a,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[t]("%sUVPJS %s %s",n,e,i,r);console[t]("%s%cUVPJS %c%s%c %s",n,o.bold,o.underline,e,o.normal,i,r)}}},isParamEnabled:function(t){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,t)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var t=uvpjs._,e=new Date,i=e-this.adjustedStartTime,s=i%1e3;i=(i-s)/1e3;var n=i%60;i=(i-n)/60;var a=i%60;i=(i-a)/60;var r=i%24-this.adjustedTimezone;return t.padStart(r,2,"0")+":"+t.padStart(a,2,"0")+":"+t.padStart(n,2,"0")+"."+t.padStart(s,3,"0")},_getCookie:function(){var t=this._readCookie(this.COOKIE_NAME),e={};if(!t)return e;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",t);try{e=JSON.parse(t)}catch(t){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",t)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",e),e},_readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,n=i.length;s<n;s++){for(var a=i[s];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null}},function(t){var e,i=t._;t.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.mc=null,this._createControls=t.createControls,this._createAds=t.createAds,this._useInlinePlayAttribute=t.useInlinePlayAttribute,this._useMutedAttribute=t.useMutedAttribute,this._DOMReadyCB=t.callback,this._useAutoplayAttribute=t.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=e(),this.dom.outer.id=t.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var t=this.dom.video.el;t&&t instanceof HTMLElement&&(t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),t.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return i.clone(this.dom)},createAdClickElement:function(){var t={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};this.adClickElement=document.createElement("div");for(var e in t)this.adClickElement.style[e]=t[e];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(t){this.dom.ad.el&&(this.dom.ad.el.style.display=t?"block":"none")},showAdClickElement:function(t){this.adClickElement&&(this.adClickElement.style.display=t?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var t=this.dom.video.el;t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var t=this.dom;if(t.outer.el=document.getElementById(t.outer.id),i.isNull(this.dom.outer.el))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",t.outer.id));t.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),t.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),t.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),t.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),t.content.el=this._getOrCreateElement("content"),t.outer.el.insertBefore(t.content.el,t.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),t.ad.el=this._getOrCreateElement("ad"),t.outer.el.insertBefore(t.ad.el,t.content.el.nextSibling)),this._createControls?(t.controls.el=this._getOrCreateElement("controls"),t.outer.el.appendChild(t.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB()},_createVideoElement:function(){var t=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),e=document.querySelectorAll(t),i;if(e instanceof NodeList&&e[0]instanceof HTMLElement&&e[0].id)return void this._checkVideoTagAttributes(e);if(t=[this.dom.outer.id,this.dom.video.id].join(" "),(e=document.querySelectorAll(t))instanceof NodeList&&e[0]instanceof HTMLElement){if(e[0].id)return;return e[0].id=this.dom.video.id,void this.dom.content.el.appendChild(e[0])}i=this._getOrCreateElement("video"),this._checkVideoTagAttributes(i),this.dom.content.el.appendChild(i),this.dom.video.el=i},_createPlaceholderContent:function(){var t=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||i.isNull(this._userAgent)&&this.mc.isIPhone()?t.innerHTML='<source src="'+this.dom.video.url+'">':t.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),t.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY,this._handleEvent,!1),t.addEventListener(this.PLAY,this._handleEvent,!1),t.addEventListener(this.PAUSE,this._handleEvent,!1),t.style.width="100%",this._DOMReadyCB()},_handleEvent:function(t){var e=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",t),!i.isNull(e)){var s=this._useSeparateTags?e.getElementsByTagName("source")[0]:e;if(!i.isNull(s)){if(t.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,t.target),e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===s.src.indexOf(this.dom.video.url))return e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),void e.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",t.type),t.type){case this.CAN_PLAY:e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(e.removeEventListener(this.PLAY,this._handleEvent,!1),e.pause(),!i.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:e.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(t){this._useMutedAttribute&&t.setAttribute("muted","muted"),this._useAutoplayAttribute&&t.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(t,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var t=this.dom.ad.el;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0"}},_getIdByPrefix:function(t){if(!i.isNull(t))return uvpjs.domConstants[t]+this.dom.outer.id},_getOrCreateElement:function(t){var e=this.dom[t],s=document.getElementById(e.id);return i.isNull(s)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+e.type+' id="'+e.id+'">.'),s=document.createElement(e.type),s.id=e.id),s}}),e=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",CDN_TYPE:{AKAMAI:"Akamai",FASTLY:"Fastly"},contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(t,i,s,n){if(!e.isString(t)||!e.isObject(i)||!e.isObject(s))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN"));this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+t),this.vidContId=t,this.cviMgr=i,this.CDO=s,this.sessionOptions=n,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(t){if(e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+t.payload.newState);var i=t.payload.newState;i!==uvpjs.mediaCapabilities.EMPTY&&i!==uvpjs.mediaCapabilities.LOADING&&i!==uvpjs.mediaCapabilities.STOPPED&&i!==uvpjs.mediaCapabilities.PLAYING&&i!==uvpjs.mediaCapabilities.PAUSED&&i!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(t){var e=t.payload;t.target===this.vidContId&&(this.isCurrVideoAd=e.isAd,this.playbackState=e.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.currentTime,this.adPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.adPlaybackState.duration=e.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.playbackStarted,this.adPlaybackState.playbackComplete=e.playbackComplete,this.adPlaybackState.sourceBitrate=e.sourceBitrate,this.adPlaybackState.playbackBitrate=e.playbackBitrate,this.adPlaybackState.errorInfo=e.errorInfo,this.adPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.currentTime,this.contentPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.playbackStarted,this.contentPlaybackState.playbackComplete=e.playbackComplete,this.contentPlaybackState.sourceBitrate=e.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.playbackBitrate,this.contentPlaybackState.videoFramerate=e.videoFramerate,this.contentPlaybackState.isSeeking=e.isSeeking,this.contentPlaybackState.isHDStreamLive=e.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=e.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.vol)&&(this.volume=t.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.isFullscreen=t.payload.isFs)},onContextMetadata:function(t){!e.isPlainObject(t)||t.target!==this.vidContId||e.isPlainObject(t.target.contextMetadata)},onResourceStart:function(t){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){e.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){e.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){e.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(t){this.CDO.setAdCallParams(t)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var t=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof t&&t.length?t:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(t){var i=void 0;return t&&e.isString(t)&&this.hasOwnProperty(t)&&!e.isFunction(this[t])&&(i=this[t]),i},getModule:function(t){if(e.isString(t))return this.CDO.getModule(t)},getModuleParam:function(t,i){if(e.isString(t)&&e.isString(i))return this.CDO.getModuleParam(t,i)},getModules:function(){return this.CDO.getModules()},isModuleEnabled:function(t){return!(!t||!e.isString(t))&&this.CDO.isModuleEnabled(t)},isModuleSet:function(t){return!uvpjs.util.isEmpty(t)&&this.CDO.isModuleSet(t)},getSessionOption:function(t){return t?this.sessionOptions[t]:null},getClass:function(t){if(e.isString(t))return this.CDO.getClass(t)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(t,e){return this.CDO.getClassProperty(t,e)},getClassListItems:function(t){return this.CDO.getClassListItems(t)},getClassListItemProperty:function(t,e,i){return this.CDO.getClassListItemProperty(t,e,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var t={};return e.assign(t,this.contentVideoState),t},getAdVideoState:function(){var t={};return e.assign(t,this.adVideoState),t},getContentPlaybackState:function(){var t={};return e.assign(t,this.contentPlaybackState),t},getAdPlaybackState:function(){return e.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(t){this.contentVideoState.abrInfo=t,this.contentPlaybackState.abrInfo=t},setAdVideoState:function(t){this.adVideoState=e.assign({},this.adVideoStateDefaults,t||{})},setContentVideoStateItems:function(t){this._addItemsToInstanceObj("contentVideoState",t)},setContentPlaybackStateItems:function(t){this._addItemsToInstanceObj("contentPlaybackState",t)},setAdVideoStateItems:function(t){this._addItemsToInstanceObj("adVideoState",t)},setAdPlaybackStateItems:function(t){this._addItemsToInstanceObj("adPlaybackState",t)},setNonDefaultContentVideoStateItems:function(t){this.setContentVideoStateItems(this._removeDefaults(t,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(t){this.setAdVideoStateItems(this._removeDefaults(t,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(t){var e=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(e),s=this.getModuleParam(e,t);if(i&&s)return s},setAbrStartBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==t&&this.setStartBitrate(t)},setAbrMinBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==t&&this.setMinBitrate(t)},setAbrMaxBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==t&&this.setMaxBitrate(t)},setLiveSyncDurationCountFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==t&&this.setLiveSyncDurationCount(t)},setCapLevelToPlayerSizeFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==t&&this.setCapLevelToPlayerSize(t)},setDashJSFastSwitchABRFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==t&&this.setDashJSFastSwitchABR(t)},setStartBitrate:function(t){this.startBitrate=t,this.setContentPlaybackStateItems({startBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(t){this.minBitrate=t,this.setContentPlaybackStateItems({minBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(t){this.maxBitrate=t,this.setContentPlaybackStateItems({maxBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(t){this.liveSyncDurationCount=t,this.setContentPlaybackStateItems({liveSyncDurationCount:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(t){this.capLevelToPlayerSize=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(t){this.enableDashJSFastSwitchABR=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setErrorRecovery:function(t){this.errorRecovery=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(t){this.useDynamicSwitching=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var t=this;e.forOwn(this.sessionOptions,function(i,s){if(e.isString(i))return e.has(t.contentVideoState,s)?void(t.contentVideoState[s]=i):e.has(t.adVideoState,s)?void(t.adVideoState[s]=i):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(t,i){return e.omitBy(t,function(e,s){return t[s]===i[s]})},_addItemsToInstanceObj:function(t,i){var s,n,a;if(!(s=this[t]))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+t));if(!e.isObject(i))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",i));this.debug;for(n in s)a=i[n],!i.hasOwnProperty(n)||e.isUndefined(a)||e.isFunction(a)||(s[n]=a)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,
this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(t,i,s){var n,a;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",t),this.scriptsLoadedCB=i,this.timeout=s||this.REQUEST_TIMEOUT,e.isString(t)&&this.urls.push(t),e.isArray(t)&&(this.urls=t),a=this.urls.length,n=0;n<a;n++)this._getScript(this.urls[n])},_getScript:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",t);var i=this,s=function(t,s){if(!e.isFunction(i._onScriptLoaded)||i._onScriptLoaded.done)return void(i.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called."));i.urls=e.without(i.urls,t),i._onScriptLoaded({url:t,error:s})},n=document.createElement("script");n.src=this._setUrlProtocol(t),n.async=!0,n.onreadystatechange=n.onload=function(){n.readyState&&!/loaded|complete/.test(n.readyState)||s(t)},n.onerror=function(e){uvpjs.error(i.DEBUG_ID,"_getScript "+e.target.src+" is not accessible."),s(t,e)},document.querySelector("head").appendChild(n),this.timeoutHandle=setTimeout(function(t){-1===e.indexOf(i.urls,t)||(this.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript request timeout"),s(t,"timeout"))}.bind(this,t),this.timeout)},_onScriptLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var i=e.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),i&&e.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(t))},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return e=this._setUrlProtocol(e),"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=!1,i},loadXHR:function(t,i,s,n){var a,r;if(t=this._setUrlProtocol(t),!1===(a=this.createCORSRequest("GET",t)))return r="loadXHR CORS not supported for url = "+t,uvpjs.warn(this.DEBUG_ID,r),void s(a);n&&!uvpjs.util.isEmpty(n)&&(a.responseType=n),a.timeout=this.REQUEST_TIMEOUT,a.onload=function(){if(e.inRange(a.status,200,400))return void i(a);s(a)},a.onerror=function(){s(a)},a.ontimeout=function(){s(a)},a.send()},loadXML:function(t,e,i){this.loadXHR(t,e,i,"document")},loadArrayBuffer:function(t,e,i){this.loadXHR(t,e,i,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t){var e=t.vidContId;if(!t.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=e,this.eventsMgr=t.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=t.readyCallback,this.cachedOptions={suppressFacadePlay:t.suppressFacadePlay,deferLoadingCaptions:t.playerOptions.deferLoadingCaptions},this.cviModel.initialize(e,this,t.CDO,t.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(t){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(t)},setAdCallParams:function(t){this.cviModel.setAdCallParams(t)},setInitialPlaybackType:function(t,e){this.initialPlaybackInfo.isAutoplay=t,this.initialPlaybackInfo.isMuteAtPlayStart=e},setContextMetadata:function(t){this.cviModel.contentVideoState.contextMetadata=t||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:t||null,multiCdnClient:e||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(t){var i=this.cviModel.getSessionOption("adBlockerCallback"),s=!(!i||!i()),n=this.eventsMgr.eventTypes,a=uvpjs.ErrorInfo,r=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+s),s&&this.eventsMgr.dispatchEvent(n.AD_BLOCKED,{errorInfo:new a({eventType:n.AD_BLOCKED,errorCode:a.errorCodes.AD_BLOCKING_DETECTED,message:a.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),!s&&!r)return void this.eventsMgr.dispatchEvent(n.PLAYER_START_ERROR,{errorInfo:new a({eventType:n.PLAYER_START_ERROR,errorCode:a.errorCodes.IMA_SDK_MISSING,message:a.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId);if(r){if(!e.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(t),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var o=this.adsLoader.getSettings();o.setAutoPlayAdBreaks(!0),o.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}},_createIMAAdDisplayContainer:function(t){var e,i,s;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),i=e.getElementsByTagName("video")[0],s=new google.ima.AdDisplayContainer(this.adVideoDiv,i,t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",s),s},onAdsManagerLoaded:function(t){var e=uvpjs.util,i=e.isEmpty(this.RPM),s=e.isEmpty(this.RPM.currRP),n=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA,a;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",t),i||s||n)return a="CVI mgr: onAdsManagerLoaded; ",a+=i?"no RPM found":s?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,a),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+a,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(t)},onAdError:function(t){var i=!e.isEmpty(this.RPM)&&this.RPM,s=i&&!e.isEmpty(i.currRP)&&i.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",t),!i||!s)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof s.handleAdsLoaderError&&s.handleAdsLoaderError(t)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),this.RPM.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+t),e.isNaN(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+t));-1===t&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:t},this.vidContId)},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",t),e.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:t},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",t),e.isString(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:t},this.vidContId)},showCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},setCaptionsStyleRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",t),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(t):this.captionsMgr.setStyles(t)},setCaptionsCuePropertyRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",t,e),this.captionsMgr.setCueProperty(t,e)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},resizeRequest:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+t+"  height = "+i),!e.isNaN(t)&&!e.isNaN(i)&&t>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:t,height:i},this.vidContId)},fullscreenRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:t},this.vidContId)},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:t},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",t),e.isPlainObject(t)},setNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",t),e.isBoolean(t)&&(this.cviModel.nativeControls=t)},createPauseAdRetriever:function(){var t=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),e={eventsMgr:this.eventsMgr,adCallUrl:t,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return t?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(e)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+t))},checkForPauseAd:function(){var t=this.cviModel.isModuleEnabled("PauseAd"),e=uvpjs.Configuration.path+"lib/PauseAdRetriever.js",i;t&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(i=new uvpjs.CodeLoader,i.loadScript(e,this.createPauseAdRetriever.bind(this))))}})}(uvpjs.register("uvpjs")),function(t){t.ErrorInfo=uvpjs.Class.subClass({init:function(t){var e=t||{};this.errorCode=e.errorCode||null,this.eventType=e.eventType||null,this.isFatal=!!e.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=e.message||null,this.adInfo=e.adInfo||null,this.serverCode=e.serverCode||null,this.hlsjsErrorCode=null}}),t.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},t.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(t){if(this.debug=uvpjs.debug,!t||t!==i)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance()."));this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(t,i){if(!(t&&e.isString(t)&&i&&e.isFunction(i)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var s=this._returnValidEvtTypeAndNameSpace(t);if(!1===s)return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+t},this.internalNS);var n=s[0],a=s[1];if(this.registeredEventsTable[n]||(this.registeredEventsTable[n]={}),this.registeredEventsTable[n][a])return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",n," ns = ",a));this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",n," ns = ",a),this.registeredEventsTable[n][a]=i},removeEventListener:function(t){if(!t||!e.isString(t))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",t),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(t);if(!1===i)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",t));var s=i[0],n=i[1];if(!this.registeredEventsTable[s]||!this.registeredEventsTable[s][n])return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",t));this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",t),delete this.registeredEventsTable[s][n]},dispatchEvent:function(t,i,s){var n={};if(!t||!e.isString(t))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+t+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS);if(!e.isUndefined(i)&&!e.isPlainObject(i))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);if(!e.isUndefined(s)&&!e.isString(s))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);var a=this.registeredEventsTable[t];if(a){e.isUndefined(i)&&(i={}),e.isUndefined(s)&&(s=""),n.type=t,n.payload=i,n.target=s;for(var r in a)a.hasOwnProperty(r)&&a[r](n)}},_returnValidEvtTypeAndNameSpace:function(t){var e=[],i=t.split(".");if(i.length<2)return!1;var s=i[0];i.shift();var n=i.join("_");return!(!this._validateEventType(s)||n.indexOf("undefined")>-1)&&(e[0]=s,e[1]=n,e)},_validateEventType:function(t){var e=!1,i=this.eventTypes;for(var s in i)if(i.hasOwnProperty(s)&&i[s]===t){e=!0;break}return e},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(t){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),t)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(t,i,s,n){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var a={},r=0;if(!t||!e.isNumber(t)||!i||!e.isString(i)||!s||!e.isFunction(s)||n&&!e.isNumber(n)&&(n>=1||-1===n))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);t<this.uvpjsClockInterval&&(t=this.uvpjsClockInterval),i=i.split(".").join("_"),a={freq:t,ns:i,cb:s,rptCnt:-1,nextTime:Date.now()+t},n&&(a.rptCnt=n),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",t),this.timerCBOs.push(a)},removeTimedEventCallback:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",t+" ns = "+i),!(t&&e.isNumber(t)&&i&&e.isString(i)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var s,n,a=i.split(".");for(i=a.join("_"),s=this.timerCBOs.length;s--;)n=this.timerCBOs[s],n.freq===t&&n.ns===i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",n.freq+" CBO.ns = "+n.ns),this.timerCBOs.splice(s,1))},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var t,e,i=Date.now();for(t=this.timerCBOs.length-1;t>=0;t--)e=this.timerCBOs[t],i>=e.nextTime&&(e.cb(),e.nextTime=i+e.freq,-1!==e.rptCnt&&(e.rptCnt=e.rptCnt-1,0===e.rptCnt&&this.timerCBOs.splice(t,1)))},eventTypes:{FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),t.EventsManager._instance=null,t.EventsManager.destroyInstance=function(){this._instance=null},t.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(i)),this._instance}}(uvpjs.register("uvpjs")),function(t){var e="www.nielsen.com";t.AbstractId3Parser=uvpjs.Class.subClass({init:function(t){this.findNielsen=t.findNielsen,this.dataCallback=t.dataCallback,this.ownerIds=this.assembleOwnerIds(t.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(t){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(t){for(var e=t.length,i=[];e--;)i[e]=t[e].length;return i},assembleOwnerIds:function(t,i){var s=[],n,a;if("string"==typeof t)for(n=t.split(","),a=n.length;a--;)s.push(n[a].trim());return i&&-1===s.indexOf(e)&&s.push(e),s}})}(uvpjs.register("uvpjs")),function(t){var e=249;t.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){var e=t.length,i;for(i=0;i<e;i++)t[i].data&&this.findId3(t[i])},findId3:function(t){var e=0,i=t.data,s,n,a,r,o,l,d;d=this.readStr(i,e,3),e+=3,"ID3"===d&&(e+=3,s=127&i[e++],n=127&i[e++],a=127&i[e++],r=127&i[e++],o=(s<<21)+(n<<14)+(a<<7)+r,l=e+o,this.findId3PrivateFrame(t,e,l))},findId3PrivateFrame:function(t,e,i){for(var s=t.data,n,a,r,o;e+8<=i;)n=this.readStr(s,e,4),e+=4,a=s[e++]<<24+s[e++]<<16+s[e++]<<8+s[e++],o=(s[e++]<<8)+s[e++],r=e,"PRIV"===n&&this.parseFrame(t,e)},parseFrame:function(t,e){for(var i=this.idLengths,s=this.totalIds,n=t.data,a,r,o;s--;)if(o=i[s],(r=this.readStr(n,e,o))===this.ownerIds[s]){e+=o,a="www.nielsen.com"===r?this.parseNielsen(r,n,e):this.readStr(n,++e,n.length),this.dataCallback({name:r,data:a,pts:t.pts});break}},parseNielsen:function(t,e,i){var s=t+this.readStr(e,i,e.length-(i+2));return 249===s.length?s:null},readStr:function(t,e,i){var s="",n=e||0,a=e+i;do{s+=String.fromCharCode(t[n++])}while(n<a);return s}})}(uvpjs.register("uvpjs")),function(t){t.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){if(1===t.length){var e=t[0];if("PRIV"===e.value.key)for(var i=0;i<this.ownerIds.length;i++){var s=this.ownerIds[i];-1!==e.value.info.indexOf(s)&&this.dataCallback({name:s,data:"www.nielsen.com"===s?e.value.info:String.fromCharCode.apply(null,new Uint8Array(e.value.data)),pts:e.startTime})}}}})}(uvpjs.register("uvpjs")),function(t){t.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var t={};for(var e in this.historyItems)t[e]=this.historyItems[e];return t},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(t){var e="//79423.analytics.edgesuite.net/js/csma.js";return e=t&&t.getModuleParam("AkamaiQOSPluginJS","libpath")||e,uvpjs.mediaCapabilities.isSecure()?[e.replace("edgesuite","edgekey")]:[e]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===t._.get(ADB,"va.Heartbeat"))},getPath:function(t){var e=uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return t.sessionOptions.usesTealium?[i]:[e,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}},Segment:{isDefined:function(){return void 0!==window.analytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/segment-loader.js"]}}},init:function(t,e){var i=[],s=t.getModules(),n=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.cdo=t,this.initCallback=e,n.isEmpty(s))return void this.invokeCallbackWithHistory();t.getModule("MuxQOSPluginJS")||s.push({name:"MuxQOSPluginJS",enabled:"true"});for(var a=s.length;a--;){var r=s[a],o=r.name,l=this.sdkModules[r.name],d,u;if(r.enabled&&l)if(l.isDefined())this.addToHistory({name:r.name,loaded:!0
});else for(d=l.getPath(t),u=d.length;u--;)i.push({name:o,path:d[u]})}n.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)},invokeCallbackWithHistory:function(){var t=this.initCallback,e=this.getHistory();setTimeout(function(){t(e)},1)},bulkLoad:function(t){var e=t,i=[],s=this.handleAllLoadResults,n=function(t,s,n){i.push({name:t,result:n}),s.destroy(),0===e.length?this.handleAllLoadResults(i):a()},a=function(){var t=e.shift(),i=new uvpjs.CodeLoader;i.loadScript(t.path,n.bind(this,t.name,i))}.bind(this);a()},handleAllLoadResults:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",t);for(var e=t.length;e--;){var i=t[e];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(t){if(!t.name)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",t));!1!==this.historyItems[t.name]&&(this.historyItems[t.name]=!t.error&&t.loaded)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=t.p2pClient||null,this.multiCdnClient=t.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=t.suppressFacadePlay,this.deferLoadingCaptions=t.deferLoadingCaptions,this.playlistPaused=!1,!e.isEmpty(t)&&this.initialize(t.vidContId,t.cviMgr)},initialize:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",t),!e.isString(t)||!e.isObject(i))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS"));this.vidContId=t,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()},setContainers:function(t){this.containers=t},setCaptionStyle:function(t){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(t)},onResourceLoadRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",t.payload.rcObj),this.playlistPaused=!1;var e=this._createResourceProvider(t.payload.rcObj);this.rscProviders.unshift(e),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",t.payload.rcObjs);var i=t.payload.rcObjs,s=i.length,n,a;for(n=0;n<s;n++)a=this._createResourceProvider(i[n]),this.rscProviders.push(a);e.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(t){if(t.target===this.vidContId){for(var e=t.payload.rcObjs,i=e.length,s=this.rscProviders,n=this.usedRPs,a=!1,r=!uvpjs.util.isEmpty(this.currRP),o;i--;)o=e[i],this.removeFromList(o,s),this.removeFromList(o,n),r&&!a&&(a=this.isMatchingResource(o,this.currRP.rco.rcoSeed));a&&this.advancePlaylist()}},removeFromList:function(t,e){for(var i=e.length;i--;)this.isMatchingResource(t,e[i].rco.rcoSeed)&&e.splice(i,1)},isMatchingResource:function(t,e){var i=uvpjs.util;return t.type===e.type&&(!i.isEmpty(t.pid)&&t.pid===e.pid||!i.isEmpty(t.assetURL)&&t.assetURL===e.assetURL||!i.isEmpty(t.selectorCall)&&t.selectorCall===e.selectorCall)},onResourcePlaylistPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),t.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(t){t.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,e.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),e.isEmpty(this.currRP)||e.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){!e.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(t){var e={rco:t,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient},i,s;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",t),t.type){case this.mc.RP_URL:i=new uvpjs.RP_URL(e);break;case this.mc.RP_PLATFORM:i=new uvpjs.RP_Platform(e);break;case this.mc.RP_DAI:s=t.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider,i=new s(e);break;case this.mc.RP_IMA:i=new uvpjs.RP_IMA(e);break;case this.mc.RP_MDIALOG:i=new uvpjs.RP_Mdialog(e)}return i},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!e.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",t.message),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},this.vidContId),this.advancePlaylist()},resourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:t},this.vidContId)},resourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",t),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:t,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!e.isEmpty(this.currRP)&&e.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(t,i,s,n,a){var r=!0===a.skin;if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",t),!(e.isString(t)&&e.isObject(i)&&e.isObject(s)&&e.isFunction(n)))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"-"));this.vidContId=t,this.namespace=".vci_"+t,this.eventsMgr=i,this.CDO=s,this.vciReadyCB=n,this._usesIMA=a.usesIMA,this._loadSkinFlag=r,this._isPreviewBtnInternallyManaged=r,this._isUnmutedAutoplay=a.enableUnmutedAutoplay,this._isMutedAutoplay=a.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!a.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:t,eventsMgr:i,CDO:s,playerOptions:a,suppressFacadePlay:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,a)})},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(t){var e={skin:!0===t.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:t.customCSS,enableReplay:t.enableReplay,previewImage:t.previewImage,themeName:t.themeName,controls:t.controls,template:t.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:t.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(t.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,e)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(t){},onAdStart:function(t){var e=t.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(e),e.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(t){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){this.handleFirstGesture();var t=this.skinMgr,e=this.mc.PAUSED;setTimeout(function(){t.setPlaystate(e)},200)},setAdCallParams:function(t){this.CVI_Mgr.setAdCallParams(t)},checkAutoplayRestriction:function(t){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===t.adType&&"ima"===t.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(t){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,t,this.vidContId)},prepForRestrictedAutoplay:function(t){var e=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,e.removeEventListener("play",i,!1),t&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),e.src=this.mc.getPreferredPlaceholderURL(),e.addEventListener("play",i,!1),e.muted=!0,e.load();var s=e.play();void 0!==s&&s.then(Function.prototype).catch(function(t){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(t){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:t||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(t){if(this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),!this.useBrowserNativeControls&&this._loadSkinFlag)return void(this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:t}));this.onVCIReady()},checkNativeAutoplay:function(t){return t&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),!e.isString(t))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)"));this.CVI_Mgr.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(t){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(t)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=t,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void t())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(t){var e,i;if(!0!==t&&!this.canOverrideUserGesture())return e=uvpjs.ErrorInfo,i=this.eventsMgr,void i.dispatchEvent(i.eventTypes.PLAYER_START_ERROR,{errorInfo:new e({eventType:i.eventTypes.PLAYER_START_ERROR,errorCode:e.errorCodes.USER_GESTURE_REQUIRED,message:e.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(t,i){if(!t||!e.isString(t)||!e.isFunction(i))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId);this.eventsMgr.addEventListener(t,i)},removeEventListener:function(t){if(!t||!e.isString(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId);this.eventsMgr.removeEventListener(t)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(t){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,t),void this.playBlankVideo();i=this.createResourceConfig(t),e.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,t),void this.playBlankVideo();if(e.isArray(t)&&t.length>0){var i=[],s,n;for(s in t)n=this.createResourceConfig(t[s]),e.isObject(n)?i.push(n):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);i.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:i},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(t){var e="",i=!1,s=t.type===this.mc.RP_IMA,n="",a=!1,r=!1,o=null,l,d,u,h,c,p,v;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",t),v=this.prevalidateRcObj(t),v.error)return e="Resource configuration error: "+v.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(e,null),!1;switch(t.type){case this.mc.RP_URL:d=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:d=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(e="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",i=!0),a=!0,d=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:d=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:a=!t.useSsb,d=uvpjs.DaiRco;break;default:n="Unknown resource type "+t.type,e="VCI createResourceConfig "+n+"; this.vidContId = "+this.vidContId,i=!0}return i?(this.dispatchStartError(e,null),!1):(this.rcoIdIndex++,l=this.rcoIdIndex+"_"+this.vidContId,u=new d(t,l,this.vidContId),v=u.getValidationInfo(),a&&(r=this.checkForAdBlocker())?(!0===v.missingSDK&&(o=s?"IMA":"DAI"),this.dispatchAdBlocked(o,!0),!1):v.error?(e="VCI error initializing RCO: "+v.message,h=uvpjs.ErrorInfo,c=h.errorCodes,!0===v.missingSDK?(p=s?c.IMA_SDK_MISSING:c.DAI_SDK_MISSING,this.dispatchStartError(e,p)):this.dispatchStartError(e,null),!1):(this._replayRco=t,u))},prevalidateRcObj:function(t){var e=uvpjs.util,i="",s=!1;return e.isPlainObject(t)?e.isDefinedString(t.type)||(i="Invalid resource type encountered",s=!0):(i="Invalid resource config object format",s=!0),{error:s,message:i}},dispatchStartError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:e||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+t,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(t,e){var i=t?" (Missing "+t+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+i,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+i,isFatal:!!e})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(t){e.isArray(t)&&t.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:t},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",t),isNaN(t)||this.CVI_Mgr.seekToRequest(t)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.enableButton(t)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(t){e.isNaN(t)||this.CVI_Mgr.volumeChangeRequest(t)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",t),e.isString(t)&&this.CVI_Mgr.loadCaptionsRequest(t)},showCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",t),this.CVI_Mgr.setCaptionsStyleRequest(t)},setCaptionsStyleProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",t,e),this.CVI_Mgr.setCaptionsStyleRequest([{name:t,value:e}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",t,e),this.CVI_Mgr.setCaptionsCuePropertyRequest(t,e)},setSize:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+t+"  height = "+i),e.isNumber(t)||e.isNumber(i)||this.CVI_Mgr.resizeRequest(t,i)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),!e.isEmpty(t)&&(e.isArray(t)&&t.length>0||uvpjs.util.isDefinedString(t))&&this.CVI_Mgr.setUserGesture(t)},setQosMetadata:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",i),e.isEmpty(t)||e.isEmpty(i)||!e.isArray(t)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:t,paramsObj:i},this.vidContId))},fullscreen:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.fullscreenRequest(t)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(t){t&&e.isPlainObject(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:t},this.vidContId))},removeNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.setNativeControls(t)},useDynamicSwitching:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:t},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(t){if(!t||"number"!=typeof t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",t));this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)},switchTo:function(t){var e="up,down",i=null!==t&&void 0!==t&&"string"==typeof t&&-1!==e.indexOf(t),s=null!==t&&void 0!==t&&"number"==typeof t&&!isNaN(t);if(!i&&!s)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",t,i,s,typeof t));this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",t),s?this.switchBitrateTo(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)},setMinimumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},setMaximumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},pauseAdRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:t||null,height:e||null},this.vidContId)},_dispatchResizeEvent:function(t){
this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:t},this.vidContId)},liveSegmentStart:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)},liveSegmentEnd:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)}})}(uvpjs.register("uvpjs")),function(t){var e=Math.random(),i=t._;t.VideoManager=uvpjs.Class.subClass({init:function(t){if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance)return void console.warn("UVPJS: An instance of VideoManager has already been created.");uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1},destroy:function(){for(var t in this.VCIs)this.destroyVideoPlayer(t);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(t,e,i){var s=uvpjs.Configuration,n=uvpjs.VideoManager._instance,a=uvpjs.DebugManager,r=this.validateParams(t,e,i),o=r.message,l=r.isValid;if(!o||(console[l?"warn":"error"](o),!l&&r.errorCb&&r.errorCb(o),l)){if(n){if(n.isInitializing())return void n.addInitCallback(e);if(n.isReady())return void(uvpjs.util.isFunction(e)&&e(this.mc.systemInfo))}console.log([s.name,s.version,s.date].join(" ")),uvpjs.log=a.log.bind(a),uvpjs.warn=a.warn.bind(a),uvpjs.error=a.error.bind(a),a.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!t.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(e),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",t),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(t,this.onCongfigMgrReady.bind(this))}},validateParams:function(t,e,s){var n=uvpjs.util,a=null,r=!1,o="VideoManager.initialize()",l=n.isFunction(s)?s:null;return t&&i.isPlainObject(t)||(a=o+" was invoked with invalid session options.",r=!0),n.isFunction(e)||(a=o+": A success callback function is required.",r=!0),l||(a=o+" did not receive a valid error callback function.",r=!1),{errorCb:l,message:a,isValid:!r}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(t){var e=this.successCallbacks.length;if(uvpjs.util.isFunction(t)){for(;e--;)if(this.successCallbacks[e]===t)return;this.successCallbacks.push(t)}},onCongfigMgrReady:function(t){if(!i.isObject(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS);this.CDO=t,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))},onSdkLoadManagerReady:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",t),uvpjs.mediaCapabilities.setTrackingInfo(t),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(t){var e=t.isModuleEnabled("VideoPlaybackSettings"),i=e&&t.getModuleParam("VideoPlaybackSettings","forceHlsjs"),s="string"==typeof i,n=s&&i.toLowerCase(),a;i&&!uvpjs.util.isEmpty(i)&&(!0===i||1===i||s&&("1"===n||"y"===n||"yes"===n))&&(a=this.mc.canPlayHLSJS(!0),a&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=a)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(t,e){if(this.eventsMgr)return t&&i.isString(t)&&i.isFunction(e)?void this.eventsMgr.addEventListener(t,e):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){if(!t||!i.isString(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS);this.eventsMgr.removeEventListener(t)},getVideoPlayers:function(){var t={},e;for(e in this.VCIs)t[e]=this.VCIs[e];return t},createVideoPlayer:function(t,e,s){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!i.isString(t)||!i.isFunction(e)||s&&!i.isPlainObject(s))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);var n=[t,e];s&&n.push(s),this.createMultipleVideoPlayers([n])},destroyVideoPlayer:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),i.isString(t)?i.isEmpty(this.VCIs)||!this.VCIs[t]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+t},this.internalNS),!1):(this.VCIs[t].destroy(),delete this.VCIs[t]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(t){var e,s,n,a,r,o,l,d;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!i.isEmpty(this.VCIs)),!i.isArray(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS);for(a=t.length,n=0;n<a;n++)if(r=t[n],o=r[0],l=r[1],d=r[2],r.length<2||!i.isString(o)||!i.isFunction(l)||!i.isUndefined(d)&&!i.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),n=0;n<a;n++)r=t[n],o=r[0],l=r[1],d=r[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",o),d=this.CDO.getSessionOptions(d),e=this.validateAutoplay(d),!1===this._allowConcurrentPlayback&&e&&(this._disableAutoplay&&(d.enableMutedAutoplay=!1,d.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),s=new uvpjs.VideoControlInterface,this.VCIs[o]=s,s.initialize(o,this.eventsMgr,this.CDO,l,d);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))},validateAutoplay:function(t){var e=t.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(t.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||e);return e&&(t.enableMutedAutoplay=!1),i||(t.enableMutedAutoplay=!1,t.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(t){t&&i.isPlainObject(t)&&this.CDO.overrideSessionOptions(t)},onVideoProgress:function(t){if(!(this._allowConcurrentPlayback||!i.isPlainObject(t)||i.isUndefined(t.target)||i.isUndefined(t.payload)||i.isUndefined(t.payload.playbackState)||t.payload.playbackState!==this.mc.PLAYING)){var e=t.target;i.isEmpty(this.currActiveVCI)&&!i.isUndefined(this.VCIs[e])&&(this.currActiveVCI=this.VCIs[e]),e===this.currActiveVCI.vidContId||i.isUndefined(this.VCIs[e])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",e),this.VCIs[e].pauseVideo())}},onVideoPlaybackInitiated:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",t),!this._allowConcurrentPlayback&&i.isPlainObject(t)&&!i.isUndefined(t.target)){var e=t.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),i.isEmpty(this.VCIs)||i.isUndefined(this.VCIs[e])||this.currActiveVCI&&this.currActiveVCI.vidContId===e||(this.currActiveVCI=this.VCIs[e],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(t){t?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",t.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(t){t?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",t.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),t.VideoManager._instance=null,t.VideoManager.destroyInstance=function(){this._instance=null},t.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(e)),this._instance}}(uvpjs.register("uvpjs")),function(t){var e=t._,i,s,n,a,r,o,l,d,u,h,c,p,v,g,f,m;t.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(t){var e=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,t&&(this._cviModel=t.cviModel,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=n(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=e.getCaptionsLineOffset(),this._lineAlign=e.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=t.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._trackMode="hidden",this._disabled=!1,this.ccDisplayRequested=!1,this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=t,!this._ccEl&&this._createCaptionsElement()},showCaptions:function(t){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(t,"showing")},hideCaptions:function(t){this.ccDisplayRequested=!1,this._toggleVisibility(t,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:e.clone(this.styles)},setStyles:function(t){var e=this._pageStyles,i=t.length,s,n,a;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",t);i--;)a=t[i],s=g(a.name),n=a.value,e[s]=n;this._updateStylesObject(e),this._applyStyles()}},setCueProperty:function(t,e){var i;if(!this._disabled){if(i=this._getActiveTrack(),!(t&&e&&i&&this._supportsVTTCue))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",t,e));this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,t,e),this._props[t]=isNaN(e)?e:Number(e)}},_addEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace,s=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners",s),t.addEventListener(e.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),t.addEventListener(e.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),t.addEventListener(e.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),t.addEventListener(e.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),t.addEventListener(e.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),t.addEventListener(e.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),t.addEventListener(e.RESOURCE_END+i,this._onVideoComplete.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this))},_removeEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace,s=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.CONTROL_LOAD_CAPTIONS+i),t.removeEventListener(e.CONTENT_DATA_LOADED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CONTENT_FACADE_CREATED+i),t.removeEventListener(e.RESOURCE_END+i),t.removeEventListener(e.VIDEO_PROGRESS+i)},_createTrackElement:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",t);var e=document.createElement("track");e.default=!0,e.kind="captions",e.label="English",e.srclang="en",e.id=this._trackId,e.src=t,this._videoEl.appendChild(e)},_createCaptionsElement:function(){var t=uvpjs.util,e=this._styleEl,i=document.createElement("div"),s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);if(i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),!s)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container."));s.appendChild(i),this._ccEl=i,t.addCSSObject(e,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),t.addCSSObject(e,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),t.addCSSObject(e,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)},_dispatchCaptionsError:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",t),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:t},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(t){t.target===this._containerId&&this._setRect()},_onVideoComplete:function(t){var e=t.target,i=this._videoEl,s,n;e===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",e),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,i&&i.removeEventListener("loadeddata",this._onLoadedData),i&&i.removeEventListener("timeupdate",this._onTimeUpdate),n=this._getTextTracks(),n&&(n.onaddtrack=null),s=this._getActiveTrack(),s instanceof window.TextTrack&&d(s)&&(s.mode="disabled",s.oncuechange=null,s.textTrack1&&(s.textTrack1=!1),s.textTrack2&&(s.textTrack2=!1)),this._trackCount++)},_onContentDataLoaded:function(t){var e=uvpjs.util,i=t.target,s=t.payload.vidState,n=s.closedCaptionPath,a=s.isLive,r;i===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",i),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,r=this._getTextTracks(),r&&(r.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),e.isDefinedString(n)&&(this._captionsUrl=n))},_onLoadedData:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",t),this._checkForLiveCaptions()},_onTimeUpdate:function(t){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(t)},_onControlLoadCaptions:function(t){var i;t.target===this._containerId&&(i=t.payload.url,e.isString(i)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",t.target),this._loadCaptionsUrl(i)))},_onContentFacadeCreated:function(t){t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",t.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(t){var e=t.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",t);try{e=e.replace(/\n/g,""),e=e.substr(e.indexOf("<?xml"));var i=new DOMParser,s=i.parseFromString(e,"text/xml");this._xmlToCues(s)}catch(t){var n="Error parsing closed captions XML.";this._dispatchCaptionsError(n),this.debug&&uvpjs.error(this.DEBUG_ID,n,t)}},_onLoadError:function(t){var e=t.status,i="Unknown error";switch(e){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+e,this._dispatchCaptionsError(i),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_onAddTrack:function(t){var e=t.track;e.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(e,!1),d(e)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",t)},_syncCCTrackMode:function(t,e){if(t)return e?void(t.mode="disabled"):void(this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(t.mode="showing"):"hidden"!==t.mode&&(t.mode="hidden"))},_onVideoProgress:function(t){var e,i;if(t.target===this._containerId){var s=this._getActiveTrack();if(this._syncCCTrackMode(s,!1),!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();if(s&&s.activeCues&&(i=s.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);i--;)t.payload.currentTime-s.activeCues[i].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!t||!this._liveCaptionsInitalized){try{!t&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",t),this._dispatchCaptionsError(t)}t&&(this._liveCaptionsInitalized=!0),!!this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var t=this._getActiveTrack(),e=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),t&&(t.oncuechange=e)||this._videoEl.addEventListener("timeupdate",e)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var t=e.get(this._captionsJson,"tt.head.styling.style");if(t=e.isArray(t)?t[0]:t,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",t),!t)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file."));this._inlineStyles={backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}},_applyStyles:function(){var t=uvpjs.util,e=this.styles,i=this._styleSelector,n=[],a,r,o;this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",e);for(r in e){switch(o=e[r],a=!1,r){case"background-opacity":case"font-opacity":a=!0;break;case"text-position":a=!0,this._setPosition(o);break;case"background-color":o=s(o,e["background-opacity"]);break;case"color":case"font-color":r="color",o=s(o,e["font-opacity"]);break;case"text-edge-style":r="text-shadow",o=f(o)}a||(u(r,o)?n.push({name:r,value:o}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",r,o))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",i,n),t.addCSSRules(this._styleEl,i,n)},_updateStylesObject:function(t){var e,i,s;for(e in t){if(!(i=t[e])||!e)return;if((s=g(e))in this.styles){switch(s){case"font-size":i=a(i)}this.styles[s]=i}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",s)}},_hasCaptions:function(){return d(this._getActiveTrack())},_loadOrDeferCaptions:function(t){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(t)},_loadCaptionsUrl:function(t){var e=uvpjs.util.isDefinedString(t),i=e&&-1!==t.indexOf(".vtt"),s;if(e&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),i)return void this._createTrackElement(t);s=new uvpjs.CodeLoader,s.loadXHR(t,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),!this._hasCaptions())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize."));this._finalizeTrackElement(),this._finalizeLiveCaptions()},_clearAllCaptionTracks:function(){var t=this._ccEl,e=this._getTextTracks(),i=e&&e.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",e);i--;)this._clearCaptionTrack(e[i]);t&&(t.innerHTML="")},_clearCaptionTrack:function(t){var e,i;if(d(t)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",t),e=t&&t.cues,i=e&&e.length||0;i--;)t.removeCue(e[i]);this._syncCCTrackMode(t,!0),t.cues=null}},_toggleVisibility:function(t,e){t.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",e),this.showCcContainer("hidden"!==e))},showCcContainer:function(t){this._ccEl&&(this._ccEl.style.display=!1===t?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var t=this._getTextTracks(),e=t&&t.length||0,i,s,n;for(n=0;n<e;n++)if(i=t[n],(s=i&&i.cues)&&s.length&&d(i))return i},enableCaptionsTracks:function(){for(var t=this._getTextTracks(),e=t&&t.length||0,i;e--;)i=t[e],d(i)&&(i.mode="hidden")},_getTrackById:function(t){var e=this._getTextTracks();return e&&e.getTrackById(t||this._trackId)},_getActiveCues:function(){var t=this._getActiveTrack();return t&&t.activeCues},_getAllCues:function(){var t=this._getActiveTrack();return t&&t.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var t=this._cviModel.getModule(this.CONFIG_MODULE_NAME),i={},s,n,a;return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",t),t?!0!==t.enabled?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):e.isEmpty(t.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(e.each(t.params,function(t){s=t.name,n=t.value,s&&n&&(a=g(s),i[s]=n)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(i,null,2)),void(this._configStyles=i)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(t){var e=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"],i=e.indexOf(t)>-1?t:"bottom-center-floated";this._setPositionCSS(i)},_setPositionCSS:function(t){var e=uvpjs.util,i=this._styleEl,s=this._ccEl,n=s&&s.style.marginBottom,a=parseInt(this.BASE_CONTROLS_HEIGHT),r=10,o,l,d,u,h,c,p,v;i&&s&&(l=t.split("-"),u=l[0],d=l[1],p="inherit"===n?0:parseInt(n),v=p>a?10:a-p,h={top:"0",middle:"50%",bottom:"auto"}[u],c={top:"auto",middle:"auto",bottom:v+"px"}[u],o={top:h,bottom:c,"text-align":d,transform:"initial"},"middle"===u&&(o.transform="translateY(-50%)"),e.addCSSObject(i,s,o,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var t=this.styles;t&&this._setPosition(t["text-position"])},_setRect:function(){function t(){e.assign(i.style,v),s&&(e.assign(s.style,v),this._checkBottomPosition())}var i=this._videoEl,s=this._ccEl,n=i&&i.parentNode,a,r,o,l,d,u,h,c,p,v,g,f,m,_,E,A,y;i&&n&&(c=i.videoHeight,(p=i.videoWidth)&&c&&(r=i.getBoundingClientRect(),a=n.getBoundingClientRect(),o=r.height,l=r.width,h=c/p,u=o/l,d=u/h,E=a.height-r.height,_=a.width-r.width,A=d>1||0===_&&0!==E,y=d<1||0!==_&&0===E,v=A?{height:"auto","max-height":"100%",width:"100%",margin:0}:y?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0},v&&t.call(this),r=i.getBoundingClientRect(),a=n.getBoundingClientRect(),E=a.height-r.height,_=a.width-r.width,A?(g=E/2+"px",v={margin:"inherit","margin-top":g,"margin-bottom":g}):y&&(g=_/2+"px",v={margin:"inherit","margin-left":g,"margin-right":g}),s&&(v["font-size"]=this._calculateFontSize(r.width)),v&&t.call(this)))},_calculateFontSize:function(t){var e;try{e=t/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),e=Math.max(e,parseInt(this.MIN_FONT_SIZE))}catch(t){console.error(t)}return e&&e+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(t){var e=t&&t.target,i=e&&e.activeCues||this._getActiveCues();this._setCueProps(i)},_setAllCueProps:function(){var t=this._getAllCues();this._setCueProps(t)},_setCueProps:function(t){this._addCuesToCaptionsElement(t)},_xmlToCues:function(t){var i=m(t),s,n,a,l,d,u,h,p,v,g,f;if(this._captionsJson=i,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",i),!e.isEmpty(i)&&e.isPlainObject(i)){if(n=e.get(i,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",n),e.isUndefined(n)||e.isEmpty(n))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(!(s=this._supportsVTTCue?window.VTTCue:window.TextTrackCue))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for(d=this._videoEl.addTextTrack("captions","English","en"),d.id=this._trackId,g=n.length,p=0;p<g;p++)if(v=p+1,h=n[p],l=n[v],u=h.text,!e.isEmpty(u)){for(u=u.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3"),u=u.replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3"),u=u.replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),f=r(u),h._lineCountPrev=h._lineCountPrev||0,h._lineCountNext=h._lineCountNext||0;(l&&l.begin)===h.begin;)l._lineCountPrev=f+h._lineCountNext,h._lineCountNext+=r(l.text),l=n[++v];a=new s(o(h.begin),o(h.end),u),a._lineCount=f,a._lineCountPrev=h._lineCountPrev,a._lineCountNext=h._lineCountNext,a._metadata=h.metadata,a=c.call(this,a),d.addCue(a)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(t){var e=uvpjs.util,i=this._ccEl,s='<div class="{{cntrClass}}">{{spans}}</div>',n="",a=t&&t.length,r,o,l;if(a){for(r=0;r<a;r++)o=t[r],l=o.text,e.isDefinedString(l)&&(l=l.replace(/(\r\n|\n|\r)/g,"<br/>"),n+='<span class="{{txtClass}}">'+l+"</span>",r+1!==a&&(n+="<br/>"));s=s.replace("{{spans}}",n),s=s.replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME),s=s.replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),i&&(i.innerHTML=s)}}}),i=function(t){return t.indexOf("rgba")>-1?t.split(",")[3].replace(")",""):1},s=function(t,e){var i=p(t)||l(t)||l(h(t));return i&&e?v(i.r,i.g,i.b,e):t},n=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},a=function(t){var e="100%";return t.indexOf("px")>-1?(e=t.replace("px",""),e/=18,e=100*e+"%"):t.indexOf("%")>-1&&(e=t),e},r=function(t){return t&&(t.match(/\n/g)||[]).length+1},o=function(t){var i,s,n,a,r,o;if(!e.isNull(t)&&!e.isUndefined(t))return o=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},r=t.split(":"),i=60*Number(r[0])*60,s=60*Number(r[1]),n=Number(r[2]),a=i+s+n,o(a,2)},l=function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,s){return e+e+i+i+s+s});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},d=function(t){return t instanceof window.TextTrack&&("captions"===t.kind||"subtitles"===t.kind)},u=function(t,i){if(t&&i)return e.get(window,"CSS.supports")?window.CSS.supports(t,i):"string"==typeof document.createElement("div").style[t]},c=function(t){var e=t._metadata,i;return e&&(t.snapToLines=!0,i=Math.round(e.cccol/35*100),t.position=i,t.align=i<45?"start":i>55?"end":this._lineAlign,t.positionAlign=i<45?"line-left":i>55?"line-right":"center",t.line=e.ccrow-17+this._lineOffset,t._defaults={line:t.line,position:t.position,align:t.align,positionAlign:t.positionAlign}),t},h=function(t){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[t.toLowerCase()]},p=function(t){var e
;if(-1!==t.indexOf("rgba"))return e=t.substr(5,t.length).split(","),{r:e[0],g:e[1],b:e[2]}},g=function(t){if(e.isString(t)&&!e.isEmpty(t))return t.replace(/([A-Z])/g,"-$1").toLowerCase()},v=function(t,e,i,s){return"rgba("+[t,e,i,s].join(",")+")"},f=function(t){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[t]||"none"},m=function(t){var i={};if(1===t.nodeType&&t.attributes.length>0)for(var s=0,n=t.attributes.length;s<n;s++){var a=t.attributes.item(s);i[a.nodeName]=a.nodeValue}else 3===t.nodeType&&(i=t.nodeValue);if("p"===t.nodeName&&(i.text="",e.each(t.childNodes,function(t){if("metadata"!==t.nodeName){var e=(new XMLSerializer).serializeToString(t);1===t.nodeType&&(i.text+="br"===t.tagName?"\n":e),3===t.nodeType&&(i.text+=e)}})),t.hasChildNodes())for(var r=0,o=t.childNodes.length;r<o;r++){var l=t.childNodes.item(r),d=l.nodeName;if(void 0!==i[d]){if(void 0===i[d].push){var u=i[d];i[d]=[],i[d].push(u)}i[d].push(m(l))}else i[d]=m(l)}return i}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(t)},initialize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",t),this.overrideSessionOptions(t)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(t){var e;if(!uvpjs.util.isEmpty(t.standardParams)&&null===this.adCallParams.standardParams){this.adCallParams.standardParams={};for(e in t.standardParams)this.adCallParams.standardParams[e]=t.standardParams[e]}if(!uvpjs.util.isEmpty(t.customParams)&&null===this.adCallParams.customParams){this.adCallParams.customParams={};for(e in t.customParams)this.adCallParams.customParams[e]=t.customParams[e]}},overrideSessionOptions:function(t){var i=this.getSessionOptions(t);if(!i||!e.isPlainObject(i))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type."));this.sessionOptions=i},getSessionOption:function(t){return this.sessionOptions[t]||null},getSessionOptions:function(t){var i,s,n;if(i=e.clone(this.sessionOptions),!t||!e.isPlainObject(t))return i;if((s=t.skinConfig)&&!e.isEmpty(s)){uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object.");for(n in s)i.hasOwnProperty(n)&&(i[n]=s[n])}for(n in i)t.hasOwnProperty(n)&&(i[n]=t[n]);return i},getModule:function(t){return s(this.modules,t)},getModules:function(){return this.modules},getModuleParam:function(t,e){var i=s(this.modules,t),n=s(i.params,e);if(n&&n.hasOwnProperty("value"))return n.value},setModule:function(t){r(this.modules,t,"name",this.DEBUG_ID)},isModuleEnabled:function(t){var e=this.getModule(t);if(!e){var i="ConfigDataObject isModuleEnabled module not found: "+t;return this.debug&&uvpjs.log(this.DEBUG_ID,i),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+t+":",e.enabled),e.enabled},isModuleSet:function(t){return!!this.getModule(t)},getClass:function(t){return s(this.classes,t)},getClasses:function(){return this.classes},getClassProperty:function(t,e){var i=s(this.classes,t),n=a.call(this,i,"properties",this.DEBUG_ID),r=s(n,e);return a.call(this,r,"value",this.DEBUG_ID)},getClassListItems:function(t){var e=s(this.classes,t);return a.call(this,e,"list",this.DEBUG_ID)},getClassListItemProperty:function(t,e,i){var r=this.getClassListItems(t),o=n(r,e),l=a.call(this,o,"properties",this.DEBUG_ID),d=s(l,i);return a.call(this,d,"value",this.DEBUG_ID)},setClass:function(t){r(this.classes,t,"name",this.DEBUG_ID)},isCAN:function(){return e.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()}});var i=function(t,e,i){for(var s in t)if(t[s][e]==i)return t[s];return!1},s=function(t,e){return i(t,"name",e)},n=function(t,e){return i(t,"id",e)},a=function(t,e,i){return t?t.hasOwnProperty(e)?t[e]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",t,e),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",t),!1)},r=function(t,e,i,s){for(var n in t)if(t[n][i]==e[i])return this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray updating existing item",e),void(t[n]=e);this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray creating item",e),t.push(e)}}(uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.ConfigManager=uvpjs.Class.subClass({init:function(t,e,s){if(this.debug=uvpjs.debug,!t||t!==i)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance()."));this.initCallback=s,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new uvpjs.ConfigDataObject(e),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.CDO.isCAN()&&this.configSources.push(uvpjs.ConfigManager.CAN_CONFIG_PATH),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(!this.configSources.length)return void(e.isFunction(this.initCallback)&&this.initCallback(this.CDO));var t=this.configSources.shift();if(null!==t&&void 0!==t)switch(t.constructor){case String:if(""===t)break;return void(new uvpjs.CodeLoader).loadXHR(t,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=t.concat(this.configSources);break;case Object:this.updateCDO(t)}this.loadConfig()},onLoadComplete:function(t){var e=t.responseText,i=t.getResponseHeader("Content-Type"),s,n,a;i.indexOf("application/json")>-1?a=JSON.parse(e):i.indexOf("text/xml")>-1||i.indexOf("application/xml")>-1?(s=new DOMParser,n=s.parseFromString(e,"text/xml"),a=this.xmlToCDO(n)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",i),a&&this.updateCDO(a),this.loadConfig()},onLoadError:function(t){var e="unknown error";switch(t.status){case 0:e="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",e,t),this.loadConfig()},updateCDO:function(t){if(e.isEmpty(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"));["classes","modules"].map(function(e){t.hasOwnProperty(e)&&(this.CDO[e]=s(this.CDO[e],t[e]))},this)},xmlToCDO:function(t){var e={},i=function(t){return"y"===t||"n"===t},s=function(t){return"y"===t},r=n(t);return r.hasOwnProperty("player-config")&&(r=r["player-config"]),e.modules=function(){var t,e=[];if(r.modules){t=a(r.modules.module);for(var n in t){var o=t[n],l={name:o.name,category:o.category,enabled:s(o.enabled),params:[]};if(t[n].hasOwnProperty("params")){var d=a(o.params.param);for(var u in d){var h=d[u];h.name&&(i(h.value)&&(h.value=s(h.value)),l.params.push(h))}}var c=o.category||"unknown";e.push(l)}return e}}(e),e.classes=function(){var t=a(r.classes),e=[];for(var i in t){var s=t[i];if(s.hasOwnProperty("classDef")&&(s=s.classDef),s.name){var n={name:s.name,className:s.className,properties:[],list:[]};if(s.hasOwnProperty("list")){var o=a(s.list.listitem);for(var l in o){var d=o[l];d.id&&(d.hasOwnProperty("properties")&&(d.properties=d.properties.property),n.list.push(d))}}s.hasOwnProperty("properties")&&(n.properties=s.properties.property),e.push(n)}}return e}(),e},getCDO:function(){return this.CDO}}),t.ConfigManager.CAN_CONFIG_PATH="//can.cbs.com/thunder/player/chrome/smart_tag/config.php?url=http://can.cbs.com/thunder/player/chromeless/uvp/can.xml",t.ConfigManager._instance=null,t.ConfigManager.destroyInstance=function(){this._instance=null},t.ConfigManager.getInstance=function(t,e){return this._instance||(this._instance=new uvpjs.ConfigManager(i,t,e)),this._instance};var s=function(t,e){for(var i in e){var s=!1;for(var n in t)if(t[n].name===e[i].name){s=!0;break}s||t.push(e[i])}return t},n=function(t){var e={},i;if(1===t.nodeType&&t.attributes.length>0){i=t.attributes.length;for(var s=0;s<i;s++){var a=t.attributes.item(s);e[a.nodeName]=a.nodeValue}}if(t.hasChildNodes()){i=t.childNodes.length;for(var r=0;r<i;r++){var o=t.childNodes.item(r),l=o.nodeName;if(3!==o.nodeType)if(void 0!==e[l]){if(void 0===e[l].push){var d=e[l];e[l]=[],e[l].push(d)}e[l].push(n(o))}else e[l]=n(o)}}return e},a=function(t){if(void 0!==t&&t.constructor!==String)return t.constructor===Object&&(t=[t]),t}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=null,i=null,s=t._;t.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1},initialize:function(t){var s=t.resourceProvider,n=s.vidContId;this.resourceProvider=s,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=n,this.assetURL=t.assetURL,this.vidContentId=this.PREFIX_CONTENT+n,this.internalNS="."+n+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+n),this.deferLoadingCaptions=t.deferLoadingCaptions,this._updateVolumeSettings(t),s.createWatermark()&&!t.suppressWatermark&&(e=new uvpjs.Watermark({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),s.is360()&&!t.suppress360&&(i=new uvpjs.Kaleidoscope360({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==t.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){if(s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."));this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),e&&(e.destroy(),e=null),i&&(i.destroy(),i=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1},_updateVolumeSettings:function(t){var t=t||{},e=t.volume,i=!0===t.isMuted,s=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",t),uvpjs.util.inRange(e,0,1)&&s.volume!==e&&(s.volume=e),"isMuted"in t&&s.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var t=this.eventTypes.HTML5,e=this.supportsTouchEvents?"TOUCH_END":"CLICK",i;this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events");for(i in t)"CLICK"!==i&&"TOUCH_END"!==i&&this.videoTagRef.addEventListener(t[i],this,!1);this.videoTagRef.addEventListener(t[e],this,!1)},_removeHTML5Events:function(){var t=this.eventTypes.HTML5,e=this.supportsTouchEvents?"TOUCH_END":"CLICK",i;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events");for(i in t)"CLICK"!==i&&"TOUCH_END"!==i&&this.videoTagRef.removeEventListener(t[i],this,!1);this.videoTagRef.removeEventListener(t[e],this,!1)},handleEvent:function(t){var e=this.eventTypes.HTML5;if(this.videoTagRef)switch(t.type){case e.ABORT:break;case e.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(e.CAN_PLAY,this,!1);break;case e.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(e.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.CLICK:case e.DURATION_CHANGE:break;case e.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case e.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case e.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(t.target.error);break;case e.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case e.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case e.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case e.PLAY:break;case e.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case e.PROGRESS:this.videoLoading();break;case e.RATE_CHANGE:break;case e.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",t);break;case e.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",t),this.seeked(t.target.currentTime);break;case e.STALLED:case e.SUSPEND:break;case e.TIME_UPDATE:this.timeUpdated();break;case e.VOL_CHANGE:this.volumeChanged();break;case e.WAITING:}},seeked:function(t){var e=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(e?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:t,paused:e,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:t})},videoLoading:function(){var t;try{t=this.videoTagRef.buffered.end(0)||0}catch(e){t=0}var e={bufferLength:t,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(e)},volumeChanged:function(){var t=this.videoTagRef.volume;!s.isNumber(t)||t<0?t=0:t>1&&(t=1),this.resourceProvider.facadeVolumeChange(t)},timeUpdated:function(){var t=this.videoTagRef.currentTime;"number"==typeof t&&this.resourceProvider.facadeTimeUpdate(t)},error:function(t){var e=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,n=e.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,a=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=!0;if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:r=!1,n=e.MEDIA_ERR_ABORTED,a=i.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:n=e.MEDIA_ERR_NETWORK,a=i.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:n=e.MEDIA_ERR_DECODE,a=i.MEDIA_ERR_DECODE;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:n=e.MEDIA_ERR_SRC_NOT_SUPPORTED,a=i.MEDIA_ERR_SRC_NOT_SUPPORTED}if(this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+n),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."));this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:n,isFatal:r}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var t;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(t=this.videoTagRef.play())&&t.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+t.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(t.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",t),isNaN(t)||this.videoTagRef&&t>=0&&t<this.videoTagRef.duration&&(this.videoTagRef.currentTime=t)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var t=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(t)&&t>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=t)}},toggleMute:function(){var t;this.videoTagRef&&(t=!this.videoTagRef.muted,this.muteVideo(t))},setFullscreenState:function(t){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(t){var e=!1!==t;this.videoTagRef&&(this.videoTagRef.muted=e,e&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!e&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(t){this.videoTagRef&&t>=0&&t<=1&&(this.videoTagRef.volume=t)},getDuration:function(){var t=0;return this.videoTagRef&&(t=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(t=this.videoTagRef.seekable.end(0)),t},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(t){(!this.isAbrStreamingSupported()||"boolean"!=typeof t)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(t,e,i){if(t.length>0){var s=t.length,n=t[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(e>=t[s-1][n])return s-1;for(;s--;)if(e>=t[s][n])return i?s+1:s}return 0},addSessionIdAndTicketToURL:function(t,e,i){if(!t)return t;var s=function(t){return-1!==t.indexOf("?")?"&":"?"};return e&&-1===t.indexOf("SessionId=")&&(t+=s(t)+"SessionId="+e),i&&-1===t.indexOf("Ticket=")&&(t+=s(t)+"Ticket="+i),t},processResponseHeader:function(t,e){switch(e){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==t&&this.resourceProvider.setContentVideoStateCdn(t)}},getCdnNameAtStartup:function(t){return this.resourceProvider.cviModel.CDN_TYPE.AKAMAI},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(t,e){},getBuffered:function(){var t=this.videoTagRef,e=t&&t.buffered,i=0,s=0,n;return e&&e.length>0&&(i=e.start&&e.start(0),s=e.end&&e.end(0)),(n=s-i)>0&&n||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(t){if(this.videoTagRef){var e=this.videoTagRef.hasAttribute(this.CONTROLS);t&&!e?this.videoTagRef.setAttribute("controls",this.CONTROLS):!t&&e&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(t){if(t!==this.playbackState){if(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+t),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(t)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var t=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!s.isUndefined(t),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,t=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",t),t}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e="www.nielsen.com";t.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(t){for(var e in t)this.initOptions[e]=t[e];t.suppress360=!0,t.suppressCreatedEvent=!0,this._super(t),this.swfService=t.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var t;for(t in this.windowLabels)window[this.windowLabels[t]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(t){this.player&&this.player.setVolume(t)},seekTo:function(t){this.player&&this.player.seekTo(t)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(t){this.swfService.resetSize()},loadCaptions:function(t){this.captionsUrl=uvpjs.util.isEmpty(t)?null:t,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(t)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(t){for(var e=Array.isArray(t)&&t.length||0,i=uvpjs.util,s,n,a,r=uvpjs.VPF_Flash.styleTransform;e--;)s=t[e],n=this.dashToCamel(s.name),a=r[n]?r[n](s.value):s.value,!i.isEmpty(s.value)&&this.player.setStyleAttribute(n,a)},setId3Options:function(t){this.id3Options=t},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(t){var e=!1===t?"false":"true";this.player.enableDynamicStreaming(e)},switchToBitrate:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&this.player.switchStreamingIndex(e.index)},setMinBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.min=e.bitrate,this.player.setMinimumStreamingIndex(e.index))},setMaxBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.max=e.bitrate,this.player.setMaximumStreamingIndex(e.index))},switchUp:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t),i=-1!==e.index&&this.bitrateInfo.bitrates.length;-1!==e.index&&e.index<i-1&&this.player.switchStreamingIndex(e.index+1)},switchDown:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t);-1!==e.index&&e.index>0&&this.player.switchStreamingIndex(e.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var t=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return t?this.bitrateInfo.bitrates[t-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(t){for(var e=this.bitrateInfo.bitrates,i=e?e.length:0,s,n={bitrate:0,delta:1/0,index:-1};i--;)(s=Math.abs(t-e[i]))<n.delta&&(n.bitrate=e[i],n.index=i,n.delta=s);return n},hContentEvent:function(t){var e=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(t){case e.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case e.CONTENT_END:}},hPlaybackEvent:function(t,e){var i=uvpjs.VPF_Flash.uvpFlashEvent.playback,s;switch(t){case i.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+e);break;case i.VIDEO_PROGRESS:this.processCvioPayload(e);break;case i.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(e);break;case i.VIDEO_ERROR:this.processCvioPayload(e),this.dispatchError();break;case i.VIDEO_DONE:this.processCvioPayload(e),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case i.VIDEO_TRANSITION_COMPLETE:s=this.parsePayload(e),this.resourceProvider.facadeVideoTransitionComplete(s.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break
;case i.VIDEO_TRANSITION_START:s=this.parsePayload(e),this.pendingSwitchMode=s.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(s.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(t){var e=this.parsePayload(t,"ContentVIO"),i,s;if(e){s=e.ContentVIO;for(i in s)this.currFlashVideoState[i]=this.getCvioValue(s[i]);null===this.bitrateInfo.bitrates&&s.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){var t;this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var t=[],e=[],i=this.player.getContentBitrateInfo(),s="string"==typeof i&&i.split(","),n=Array.isArray(s)?s.length:0;n--;)t[n]=+s[n],e[n]={bitrate:+s[n]};this.bitrateInfo.bitrates=t,this.bitrateInfo.abrInfo=e},processCuepointPayload:function(t){var i=this.parsePayload(t,"Cuepoint"),s=this.id3Options,n={pts:null};!i||!s.dataCallback||i.text.indexOf("syncbak.cc")>=0||(n.name=s.findNielsen&&i.text.indexOf(e)>-1?e:i.name,n.data=i.text,s.dataCallback(n))},getCvioValue:function(t){var e,i,s,n,a;return"boolean"==typeof t||"number"==typeof t?t:"string"==typeof t?(e="NaN"===t||"null"===t||""===t,i=!e&&"true"===t.toLowerCase(),s=!e&&!i&&"false"===t.toLowerCase(),n=!e&&!i&&!s&&parseInt(t),a=isNaN(n)?t:n,e?-1:!!i||!s&&a):void 0},parsePayload:function(t,e){var i=null;if(0===t.indexOf("{")||0===t.indexOf("[")){try{i=JSON.parse(t)}catch(t){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+e+"as JSON; "+t.message),null}return i}return t},addUvpFlashEventListeners:function(){var t=uvpjs.VPF_Flash.uvpFlashEvent,e={},i=function(t,e,i){return t["h"+(e.charAt(0).toUpperCase()+e.substr(1))+"Event"].bind(t,i)},s,n,a,r,o;for(a in t){n=t[a];for(o in n)r=n[o],e[r]=i(this,a,r)}s=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(e);for(a in s)this.player.addEventJSCallback(a,s[a])},loadVideo:function(){var t={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(t.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,t)},initializeCaptionStyles:function(){var t={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"},e;for(e in t)this.player.setStyleAttribute(e,t[e])},dashToCamel:function(t){return t.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}}),t.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},t.VPF_Flash.styleTransform={_opacity:function(t){return 100*+t},backgroundOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontSize:function(t){var e=t.substr(0,t.indexOf("%")),i=.01*+e;return Math.round(14*i)}}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(t){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",t.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",t)),this._super(t),t.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:t.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(t.startTime)&&(this.startTime=Math.floor(t.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",t)},handleEvent:function(t){var e=this.eventTypes.HTML5;this.videoTagRef&&(this._super(t),t.type===e.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(t,e){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:t,message:e,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(t){console.log("Error caught at setSource: ",t)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(this.activeMetadataTrack=t.track),t.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(t){t&&t.target&&t.target.activeCues&&t.target.activeCues.length>=1&&("metadata"===t.target.kind?this.resourceProvider.facadeId3Data(t.target.activeCues):"captions"!==t.target.kind&&"subtitles"!==t.target.kind||(t.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(t){if(e.isEmpty(this.resourceProvider)||e.isEmpty(this.resourceProvider.cviModel))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",t));var i=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",t,i)}})}(uvpjs.register("uvpjs")),function(t){t.VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isLiveStreamKnown=!1,this._isHdStreamLive=!1,this._isPlayingLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy"),this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null},initialize:function(t){return this._super(t),this.id3HandlingEnabled=t.enableId3Handling,"number"==typeof t.liveSyncDurationCount&&t.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=t.liveSyncDurationCount),!0===t.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=t.capLevelToPlayerSize),uvpjs.util.isEmpty(t.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=t.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof t.startBitrate&&t.startBitrate>-1&&(this.startBitrate=t.startBitrate),"number"==typeof t.maxBitrate&&t.maxBitrate>-1&&(this.maxBitrate=t.maxBitrate),"number"==typeof t.minBitrate&&t.minBitrate>-1&&(this.minBitrate=t.minBitrate),t.startTime&&(this.startTime=Math.round(t.startTime)),t.errorRecovery&&this.setErrorRecoveryOverrides(t.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){var t=this.player,e=this.player.liveSyncPosition,i=this.isHDStreamLive();i&&t&&e?this.seekTo(e):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+i)},seekTo:function(t){var e=this.player,i=this.player.liveSyncPosition,s=this.isHDStreamLive();this._isPlayingLive=e&&s&&i&&t===i,this._super(t)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(t){this._super(),this.player?this.player.nextLevel=t?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(t){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,t,!1))},switchToIndex:function(t){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var e=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,i=isNaN(e)?this.bitrateList.length-1:e;t>=0&&t<=i?this.player.nextLevel=t:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",i," : Index=",t)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var t=this.player;return this.startBitrate||this.minBitrate||t&&t.levels&&t.levels[0]&&t.levels[0].bitrate||-1},setStartBitrate:function(t){this.player?(t<this.getMinBitrateAllowed()&&(t=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,t,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var t=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(t){if(this.player){this.player.config.minAutoBitrate=t-1;var e=this.getIndexForBitrate(this.bitrateList,t,!0);this.player.currentLevel<e&&(this.player.nextAutoLevel=e),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",t)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var t=this.player.maxAutoLevel;return void 0!==t?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(t){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===t?t:this.getIndexForBitrate(this.bitrateList,t,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",t)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var t=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(t=this.bitrateList[this.player.currentLevel].bitrate),t},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var t=this.player,e,i,s;if(t)return e=this.player.media,(i=e.getVideoPlaybackQuality)&&"function"==typeof i?i.call(e).droppedVideoFrames:(s=e.webkitDroppedFrameCount)||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var t=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,e=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(e,t)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var t={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(t.abrInfo=this.bitrateList,t.currentAbr=this.bitrateList[this.player.currentLevel],t.cappedAbrInfo=this.getCappedAbrInfo(),t.startBitrate=this.getStartBitrate(),t.currentBitrate=this.getCurrentBitrate(),t.minBitrate=this.getMinBitrateAllowed(),t.maxBitrate=this.getMaxBitrateAllowed()),t},getStreamType:function(){return"HLS"},isPlayingLive:function(){return this._isPlayingLive},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onFragmentEvent;this.player.on(t.MEDIA_ATTACHING,e,!1),this.player.on(t.MEDIA_ATTACHED,e,!1),this.player.on(t.MEDIA_DETACHING,e,!1),this.player.on(t.MANIFEST_PARSED,e,!1),this.player.on(t.MANIFEST_LOADED,e,!1),this.player.on(t.MANIFEST_LOADING,e,!1),this.player.on(t.FPS_DROP,e,!1),this.player.on(t.SUBTITLE_TRACKS_UPDATED,e,!1),this.player.on(t.LEVEL_SWITCHING,i,!1),this.player.on(t.LEVEL_SWITCHED,i,!1),this.player.on(t.LEVEL_LOADING,i,!1),this.player.on(t.LEVEL_LOADED,i,!1),this.player.on(t.LEVEL_UPDATED,i,!1),this.player.on(t.LEVEL_PTS_UPDATED,i,!1),this.player.on(t.FRAG_LOADING,s,!1),this.player.on(t.FRAG_LOAD_PROGRESS,s,!1),this.player.on(t.FRAG_LOADED,s,!1),this.player.on(t.FRAG_PARSED,s,!1),this.player.on(t.FRAG_BUFFERED,s,!1),this.player.on(t.FRAG_CHANGED,s,!1),this.player.on(t.FRAG_PARSING_DATA,s,!1),this.id3HandlingEnabled&&this.player.on(t.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(t.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onFragmentEvent;this.player.off(t.MEDIA_ATTACHING,e),this.player.off(t.MEDIA_ATTACHED,e),this.player.off(t.MEDIA_DETACHING,e),this.player.off(t.MANIFEST_PARSED,e),this.player.off(t.MANIFEST_LOADED,e),this.player.off(t.MANIFEST_LOADING,e),this.player.off(t.FPS_DROP,e),this.player.off(t.SUBTITLE_TRACKS_UPDATED,e),this.player.off(t.LEVEL_SWITCHING,i),this.player.off(t.LEVEL_SWITCHED,i),this.player.off(t.LEVEL_LOADING,i),this.player.off(t.LEVEL_LOADED,i),this.player.off(t.LEVEL_UPDATED,i),this.player.off(t.LEVEL_PTS_UPDATED,i),this.player.off(t.FRAG_LOADING,s),this.player.off(t.FRAG_LOAD_PROGRESS,s),this.player.off(t.FRAG_LOADED,s),this.player.off(t.FRAG_PARSED,s),this.player.off(t.FRAG_BUFFERED,s),this.player.off(t.FRAG_CHANGED,s),this.player.off(t.FRAG_PARSING_DATA,s),this.id3HandlingEnabled&&this.player.off(t.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(t.ERROR,this.onError)},handleManifestData:function(t){this.bitrateList=this.player.levels;for(var e=t.levels,i=e.length,s=[],n;i--;)n=e[i],s.unshift({name:n.name||null,rate:n.bitrate,width:n.width,height:n.height});s.sort(function(t,e){var i=t.rate,s=e.rate;return i<s?-1:i>s?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:s})},onRequest:function(t,e){this.withCredentials=this.withCredentials||e.indexOf("akamaihd")>-1&&e.indexOf("csmil")>-1,t.withCredentials=this.withCredentials;var i=function(i){if(-1!==e.indexOf(".m3u8"))t.readyState===XMLHttpRequest.DONE&&200===t.status&&(this._isHdStreamLive=-1===t.responseText.indexOf("STREAM-INF")&&-1===t.responseText.indexOf("EXT-X-ENDLIST"),!this._isLiveStreamKnown&&this._isHdStreamLive&&(this._isPlayingLive=!0,this._isLiveStreamKnown=!0));else if(-1!==e.indexOf(".ts")&&t.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var s=t.getAllResponseHeaders();this.multiCDNEnabled=-1!==s.indexOf(this.responseHeaders.MULTI_CDN);var n=this.multiCDNEnabled?t.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(e);this.processResponseHeader(n,this.responseHeaders.MULTI_CDN)}};(this.multiCDNEnabled||-1!==e.indexOf(".m3u8"))&&t.addEventListener("readystatechange",i.bind(this))},onLibraryEvent:function(t,e){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(e);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(t,e){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(e.details);break;case i.LEVEL_LOADING:case i.LEVEL_UPDATED:case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[e.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[e.level].bitrate)}},onFragmentEvent:function(t,e){var i=Hls.Events,s,n;switch(t){case i.FRAG_LOAD_PROGRESS:break;case i.FRAG_PARSING_DATA:"video"===e.type&&(this._playbackFramerate=e.nb/(e.endPTS-e.startPTS));break;case i.FRAG_LOADED:n=e.stats,s=8e3*n.loaded/Number(window.performance.now()-n.trequest),this._currentBandwidth=s,this._currentMaxBandwidth=Math.max(s,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case i.FRAG_CHANGED:}},onID3Event:function(t,e){this.resourceProvider.facadeId3Data(e.samples)},onError:function(t,e){var i=!1,s=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(e.fatal&&-1===s.indexOf(e.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal),e.type){case Hls.ErrorTypes.NETWORK_ERROR:i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts,i&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else e.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",e.type,e.details,"isFatal: "+e.fatal),i=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal);i||(e.response&&e.response.code&&e.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,e.details,e.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(e.type,e.details,e.fatal)))},tryRecoveryFromMediaError:function(){var t=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return t&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(t).media()),t},getErrorMsg:function(t){var e=t?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+e+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+e+i}.bind(this)}},getErrorInfoForType:function(t,e,i){var s=uvpjs.ErrorInfo,n=Hls.ErrorTypes,a=uvpjs.ErrorInfo.errorCodes;switch(t){case n.NETWORK_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_NETWORK_ERROR,message:s.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",e),isFatal:i});case n.MEDIA_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MEDIA_ERROR,message:s.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",e),isFatal:i});case n.MUX_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MUX_ERROR,message:s.messages.HLSJS_MUX_ERROR.replace("{INFO}",e),isFatal:i});case n.OTHER_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:s.messages.HLSJS_OTHER_ERROR.replace("{INFO}",e),isFatal:i});case a.RESOURCE_GEOBLOCKED:return new s({errorCode:a.RESOURCE_GEOBLOCKED,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:s.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(t){["network","media"].forEach(function(e){t[e]&&t[e].attempts&&"number"==typeof t[e].attempts&&(this.errorRecovery[e+"RetryAttempts"]=t[e].attempts)}.bind(this))}})}(uvpjs.register("uvpjs")),function(t){"use strict";function e(t){if(!isNaN(t))return t<1048576?(t/1024).toFixed(2)+"k":t<1073741824?(t/1048576).toFixed(2)+"M":(t/1073741824).toFixed(2)+"G"}t.Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(t){var e=uvpjs.Configuration,i;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),t&&(i=t.videoEl,this._videoEl=i,this._containerEl=t.containerEl,this._eventsMgr=t.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=i.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":e.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),!this._diagEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window."));this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=t,this._createDiag(),this._addEventListeners()},_createDiag:function(){var t=uvpjs.util,e=this._styleEl,i=this._contentEl,s=this._template,n=this._params,a,r,o,l,d;i&&(o=document.createElement("div"),o.id=this._diagnosticId,i.insertBefore(o,i.firstChild),d=uvpjs.util.htmlToElement("<span>x</span>"),d.addEventListener("click",this._handleCloseButton.bind(this),!0),o.appendChild(d),l=document.createElement("table"),o.appendChild(l),t.addCSSObject(e,o,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),t.addCSSObject(e,o,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),t.addCSSObject(e,o,{color:"#fff"},"span:hover"),t.addCSSObject(e,o,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),t.addCSSObject(e,o,{background:"transparent"},"table td"),t.addCSSObject(e,o,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),t.addCSSObject(e,o,{width:"60px"},"table td:last-child"),this._diagEl=o,this._diagTableEl=l,this._hideDiagBtn=d)},_removeDiag:function(){var t=this._diagEl,e=this._hideDiagBtn;e&&e.removeEventListener("click",this._handleCloseButton.bind(this)),t&&t.remove()},_hideDiag:function(){var t=this._diagEl,e=this._eventsMgr;t&&(t.style.display="none"),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var t=this._diagEl;t&&(t.style.display="block")},_toggleDiag:function(){var t=this._diagEl;if(t)return"block"===t.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var t=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes,s=this._containerEl;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners."));this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_START+t,this._onVideoTransitionStart.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_COMPLETE+t,this._onVideoTransitionComplete.bind(this))},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes,s=this._containerEl;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners."));e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_TRANSITION_START+t),e.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+t)},_updateTableHtml:function(){var t="",e=this._params,i,s,n,a;for(n in e)null!==(a=e[n])&&void 0!==a&&(t+="<tr><td>"+n+"</td><td>"+a+"</td></tr>");this._diagTableEl.innerHTML=t},_onVideoProgress:function(t){var i=t.payload,s=i.facadeState,n=this._params,a=s.minABRLevel,r=s.maxABRLevel;t.target===this._containerId&&(n["stream type"]=i.streamType,n.duration=i.duration,n["current time"]=i.currentTime.toFixed(2),n["buffer length"]=i.bufferLength.toFixed(2),n["total dropped frames"]=i.droppedFrames>=0&&i.droppedFrames||null,n["average dropped (fps)"]=i.averageDroppedFPS>=0&&i.averageDroppedFPS.toFixed(2)||null,n["playback framerate (fps)"]=i.playbackFramerate>=0&&i.playbackFramerate.toFixed(2)||null,n["current bandwidth (B/s)"]=i.currentBandwidth>=0&&e(i.currentBandwidth)||null,n["switching mode"]=i.switchingMode,n["current index bitrate (B/s)"]=e(s.currentAbr&&s.currentAbr.bitrate),n["start index bitrate (B/s)"]=e(s.startBitrate),void 0!==a&&void 0!==r&&(n["available indexes"]=a+" to "+r),this._updateTableHtml())},_onVideoStateChange:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(i["playback state"]=e.newState,this._updateTableHtml())},_onVideoTransitionStart:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",e),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",e),i["transition state"]="complete",this._updateTableHtml())}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,
IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){if(!this._imgEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark."));this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null},_createImage:function(){var t;this._contentEl&&(t=document.createElement("img"),t.id=this._watermarkId,t.src=this.IMAGE,t.style.position="absolute",t.style.display="none",this._imgEl=t,this._contentEl.appendChild(t))},_removeImage:function(){var t=this._imgEl;t&&t.parentNode&&t.parentNode.removeChild(t)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var t=this._imgEl;t&&(t.style.display="none")},_showImage:function(){var t=this._imgEl;t&&(t.style.display="block")},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));e.addEventListener(i.AD_START+t,this._hideImage.bind(this)),e.addEventListener(i.CONTENT_START+t,this._showImage.bind(this)),e.addEventListener(i.CONTENT_END+t,this._hideImage.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),e.addTimedEventCallback(e.HALF_SECOND,t,this._ensureImage.bind(this))},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));e.removeEventListener(i.AD_START+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeTimedEventCallback(this.TIMER_INTERVAL,t),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(t){t.target===this._containerId&&this._setPosition()},_setPosition:function(){var t,e,i,s,n,a,r,o,l,d,u,h,c,p,v,g,f,m,_,E,A,y;e=this._contentEl,i=this._videoEl,(t=this._imgEl)&&i&&e&&(p=i.videoHeight,(v=i.videoWidth)&&p&&(a=this.OFFSET,d=this.SIZE,r=i.getBoundingClientRect(),g=e.getBoundingClientRect(),o=r.height,l=r.width,c=p/v,h=o/l,u=h/c,s=l*c,n=o/c,f=g.bottom-r.bottom,m=g.right-r.right,u>1?(_=(o-s)/2,E=0,y=l*d+"px",A="auto"):(_=0,E=(l-n)/2,y="auto",A=o*d*(this.RATIO/c)+"px"),t.style.width=y,t.style.height=A,t.style.bottom=_+f+a+"px",t.style.right=E+m+a+"px"))}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){if(!this._360El||!this._kaleidoscopeViewer)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360."));this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null},_loadKaleidoscope:function(t){return"function"!=typeof t?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));e.addEventListener(i.CONTAINER_RESIZE+t,this._handleContainerResize.bind(this)),e.addEventListener(i.CONTENT_START+t,this._startKaleidoscopeRender.bind(this))},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeEventListener(i.CONTENT_START+t)}})}(uvpjs.register("uvpjs")),function(t){t.ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(t,e,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=e,this.vidContId=i,this.rcoSeed={},this.initialize(t)},initialize:function(t){this.validationInfo=this.validateUserRco(t),this.validationInfo&&(this.rcoSeed=t,this.populateSelf(t))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},has:function(t){return!uvpjs.util.isEmpty(this[t])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(t){return{error:!1,message:""}}})}(uvpjs.register("uvpjs")),function(t){t.RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t),i=uvpjs.util.isDefinedString(t.assetURL);return{error:e.error||!i,message:e.error?e.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(t){t.DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(t,e,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(t){this.cmsRefGuid=t,this.daiParams.daiVideoId=t},canMakePlatformCall:function(t){var e=uvpjs.util.isDefinedString(t),i=this.has("selectorCall")&&this.selectorCall||e&&t;return!!i&&(i.indexOf("$PID$")>-1?this.has("pid"):!(i.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var t=this.daiParams.dfpMediaId,e=this.daiParams.daiVideoId,i=t||e||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return t||e||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(t){var e=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(t),s=this._super(t),n=(t.useSsb||e)&&i&&!s.error,a=e?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!n,missingSDK:!e,message:s.error?s.message:a}},populateSelf:function(t){var e,i;for(e in t)i=t.hasOwnProperty(e),i&&void 0!==this.daiParams[e]?this.daiParams[e]=t[e]:i&&(this[e]=t[e]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(t){var e=uvpjs.util,i=!e.isEmpty(t.adTagParameters),s=!e.isEmpty(t.contentSourceId);return t.useSsb||i&&s?t.useSsb?!e.isEmpty(t.assetURL):i&&s:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&s)},checkCustomAdTagParams:function(){var t=uvpjs.util,e=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null,i;e&&"string"!=typeof e&&t.isPlainObject(e)&&(i=t.queryStrFromObj(e),this.daiParams.adTagParameters.cust_params=encodeURIComponent(i))}})}(uvpjs.register("uvpjs")),function(t){t.RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.google&&google.ima,i=this._super(t);return{error:!(e&&!i.error),missingSDK:!e,message:i.error?i.message:"IMA SDK is missing."}}})}(uvpjs.register("uvpjs")),function(t){t.RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t);return{error:e.error||!uvpjs.util.isDefinedString(t.assetURL),message:e.err?e.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(t){t.RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=uvpjs.util,i=e.isDefinedString(t.pid),s=!i&&e.isDefinedString(t.cmsRefGuid)&&!e.isDefinedString(t.assetURL),n=this._super(t);return{error:!(!n.error&&(i||s||e.isDefinedString(t.selectorCall))),message:n.error?n.message:"Supplied RCO is not valid for type rp_platform"}}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.UvpSwfService=uvpjs.Class.subClass({init:function(t){this.debugId=t.debugId,this.debug=uvpjs.debug,this.containerId=t.containerId,this.dom=t.contentVideoDom,this.playerDom=t.playerDom,this.callback=t.readyCallback,this.id3OwnerIds=t.id3OwnerIds||"",this.capLevelToPlayerSize=t.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var t;this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype;for(t in this.windowLabels)window[this.windowLabels[t]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var t=this.getContainerSize(),e=t.width,i=t.height;this.swf&&this.swf.setSize(e,i,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(t){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(t){if(!t.success)return void this.callback(null,this.svcC.error.EMBED_FAILED);this.startTimer()},embed:function(t){var e=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,t,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:e.jsReady,playerReady:e.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var t=this.dom,e,i;if(!this.svcC.hasFlash())return void this.callback(null,this.svcC.error.FLASH_NOT_DETECTED);this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),e=document.createElement("div"),e.id=this.swfName,i=t.querySelector("video"),i.style.display="none",t.style.height="100%",this.playerDom.style.height="100%",t.insertBefore(e,i),this.embed(e)}}),t.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},t.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},t.UvpSwfService.hasFlash=function(){var t=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(t)&&parseInt(t)>0},t.UvpSwfService.setWindowMethods=function(t){var e="f_",i=uvpjs.util,s,n,a;for(s in t)n=t[s],a=e+i.uid8(),window[a]=n,t[s]=a;return t},t.UvpSwfService.swfobject=function(){function t(){if(!H&&document.getElementsByTagName("body")[0]){try{var t,e=m("span");e.style.display="none",t=L.getElementsByTagName("body")[0].appendChild(e),t.parentNode.removeChild(t),t=null,e=null}catch(t){return}H=!0;for(var i=N.length,s=0;s<i;s++)N[s]()}}function e(t){H?t():N[N.length]=t}function i(t){if(typeof O.addEventListener!=T)O.addEventListener("load",t,!1);else if(typeof L.addEventListener!=T)L.addEventListener("load",t,!1);else if(typeof O.attachEvent!=T)E(O,"onload",t);else if("function"==typeof O.onload){var e=O.onload;O.onload=function(){e(),t()}}else O.onload=t}function s(){var t=L.getElementsByTagName("body")[0],e=m(C);e.setAttribute("style","visibility: hidden;"),e.setAttribute("type",R);var i=t.appendChild(e);if(i){var s=0;!function a(){if(typeof i.GetVariable!=T)try{var r=i.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),$.pv=[_(r[0]),_(r[1]),_(r[2])])}catch(t){$.pv=[8,0,0]}else if(s<10)return s++,void setTimeout(a,10);t.removeChild(e),i=null,n()}()}else n()}function n(){var t=U.length;if(t>0)for(var e=0;e<t;e++){var i=U[e].id,s=U[e].callbackFn,n={success:!1,id:i};if($.pv[0]>0){var d=f(i);if(d)if(!A(U[e].swfVersion)||$.wk&&$.wk<312)if(U[e].expressInstall&&r()){var u={};u.data=U[e].expressInstall,u.width=d.getAttribute("width")||"0",u.height=d.getAttribute("height")||"0",d.getAttribute("class")&&(u.styleclass=d.getAttribute("class")),d.getAttribute("align")&&(u.align=d.getAttribute("align"));for(var h={},c=d.getElementsByTagName("param"),p=c.length,v=0;v<p;v++)"movie"!=c[v].getAttribute("name").toLowerCase()&&(h[c[v].getAttribute("name")]=c[v].getAttribute("value"));o(u,h,i,s)}else l(d),s&&s(n);else S(i,!0),s&&(n.success=!0,n.ref=a(i),n.id=i,s(n))}else if(S(i,!0),s){var g=a(i);g&&typeof g.SetVariable!=T&&(n.success=!0,n.ref=g,n.id=g.id),s(n)}}}function a(t){var e=null,i=f(t);return i&&"OBJECT"===i.nodeName.toUpperCase()&&(e=typeof i.SetVariable!==T?i:i.getElementsByTagName(C)[0]||i),e}function r(){return!K&&A("6.0.65")&&($.win||$.mac)&&!($.wk&&$.wk<312)}function o(t,e,i,s){var n=f(i);if(i=g(i),K=!0,V=s||null,x={success:!1,id:i},n){"OBJECT"==n.nodeName.toUpperCase()?(F=d(n),G=null):(F=n,G=i),t.id=P,(typeof t.width==T||!/%$/.test(t.width)&&_(t.width)<310)&&(t.width="310"),(typeof t.height==T||!/%$/.test(t.height)&&_(t.height)<137)&&(t.height="137");var a=$.ie?"ActiveX":"PlugIn",r="MMredirectURL="+encodeURIComponent(O.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+a+"&MMdoctitle="+encodeURIComponent(L.title.slice(0,47)+" - Flash Player Installation");if(typeof e.flashvars!=T?e.flashvars+="&"+r:e.flashvars=r,$.ie&&4!=n.readyState){var o=m("div");i+="SWFObjectNew",o.setAttribute("id",i),n.parentNode.insertBefore(o,n),n.style.display="none",p(n)}h(t,e,i)}}function l(t){if($.ie&&4!=t.readyState){t.style.display="none";var e=m("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(d(t),e),p(t)}else t.parentNode.replaceChild(d(t),t)}function d(t){var e=m("div");if($.win&&$.ie)e.innerHTML=t.innerHTML;else{var i=t.getElementsByTagName(C)[0];if(i){var s=i.childNodes;if(s)for(var n=s.length,a=0;a<n;a++)1==s[a].nodeType&&"PARAM"==s[a].nodeName||8==s[a].nodeType||e.appendChild(s[a].cloneNode(!0))}}return e}function u(t,e){var i=m("div");return i.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+t+"'>"+e+"</object>",i.firstChild}function h(t,e,i){var s,n=f(i);if(i=g(i),$.wk&&$.wk<312)return s;if(n){var a=m($.ie?"div":C),r,o,l;typeof t.id==T&&(t.id=i);for(l in e)e.hasOwnProperty(l)&&"movie"!==l.toLowerCase()&&c(a,l,e[l]);$.ie&&(a=u(t.data,a.innerHTML));for(r in t)t.hasOwnProperty(r)&&(o=r.toLowerCase(),"styleclass"===o?a.setAttribute("class",t[r]):"classid"!==o&&"data"!==o&&a.setAttribute(r,t[r]));$.ie?B[B.length]=t.id:(a.setAttribute("type",R),a.setAttribute("data",t.data)),n.parentNode.replaceChild(a,n),s=a}return s}function c(t,e,i){var s=m("param");s.setAttribute("name",e),s.setAttribute("value",i),t.appendChild(s)}function p(t){var e=f(t);e&&"OBJECT"==e.nodeName.toUpperCase()&&($.ie?(e.style.display="none",function t(){if(4==e.readyState){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}else setTimeout(t,10)}()):e.parentNode.removeChild(e))}function v(t){return t&&t.nodeType&&1===t.nodeType}function g(t){return v(t)?t.id:t}function f(t){if(v(t))return t;var e=null;try{e=L.getElementById(t)}catch(t){}return e}function m(t){return L.createElement(t)}function _(t){return parseInt(t,10)}function E(t,e,i){t.attachEvent(e,i),j[j.length]=[t,e,i]}function A(t){t+="";var e=$.pv,i=t.split(".");return i[0]=_(i[0]),i[1]=_(i[1])||0,i[2]=_(i[2])||0,e[0]>i[0]||e[0]==i[0]&&e[1]>i[1]||e[0]==i[0]&&e[1]==i[1]&&e[2]>=i[2]}function y(t,e,i,s){var n=L.getElementsByTagName("head")[0];if(n){var a="string"==typeof i?i:"screen";if(s&&(q=null,W=null),!q||W!=a){var r=m("style");r.setAttribute("type","text/css"),r.setAttribute("media",a),q=n.appendChild(r),$.ie&&typeof L.styleSheets!=T&&L.styleSheets.length>0&&(q=L.styleSheets[L.styleSheets.length-1]),W=a}q&&(typeof q.addRule!=T?q.addRule(t,e):typeof L.createTextNode!=T&&q.appendChild(L.createTextNode(t+" {"+e+"}")))}}function S(t,e){if(Y){var i=e?"visible":"hidden",s=f(t);H&&s?s.style.visibility=i:"string"==typeof t&&y("#"+t,"visibility:"+i)}}function b(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=T?encodeURIComponent(t):t}var T="undefined",C="object",D="Shockwave Flash",I="ShockwaveFlash.ShockwaveFlash",R="application/x-shockwave-flash",P="SWFObjectExprInst",M="onreadystatechange",O=window,L=document,k=navigator,w=!1,N=[],U=[],B=[],j=[],F,G,V,x,H=!1,K=!1,q,W,Y=!0,z=!1,$=function(){var t=typeof L.getElementById!=T&&typeof L.getElementsByTagName!=T&&typeof L.createElement!=T,e=k.userAgent.toLowerCase(),i=k.platform.toLowerCase(),s=/win/.test(i||e),n=/mac/.test(i||e),a=!!/webkit/.test(e)&&parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),r="Microsoft Internet Explorer"===k.appName,o=[0,0,0],l=null;if(typeof k.plugins!=T&&typeof k.plugins[D]==C)(l=k.plugins[D].description)&&typeof k.mimeTypes!=T&&k.mimeTypes[R]&&k.mimeTypes[R].enabledPlugin&&(w=!0,r=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=_(l.replace(/^(.*)\..*$/,"$1")),o[1]=_(l.replace(/^.*\.(.*)\s.*$/,"$1")),o[2]=/[a-zA-Z]/.test(l)?_(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof O.ActiveXObject!=T)try{var d=new ActiveXObject(I);d&&(l=d.GetVariable("$version"))&&(r=!0,l=l.split(" ")[1].split(","),o=[_(l[0]),_(l[1]),_(l[2])])}catch(t){}return{w3:t,pv:o,wk:a,ie:r,win:s,mac:n}}(),X=function(){$.w3&&((typeof L.readyState!=T&&("complete"===L.readyState||"interactive"===L.readyState)||typeof L.readyState==T&&(L.getElementsByTagName("body")[0]||L.body))&&t(),H||(typeof L.addEventListener!=T&&L.addEventListener("DOMContentLoaded",t,!1),$.ie&&(L.attachEvent(M,function e(){"complete"==L.readyState&&(L.detachEvent(M,e),t())}),O==top&&function e(){if(!H){try{L.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}t()}}()),$.wk&&function e(){if(!H)return/loaded|complete/.test(L.readyState)?void t():void setTimeout(e,0)}()))}();N[0]=function(){w?s():n()};var Q=function(){$.ie&&window.attachEvent("onunload",function(){for(var t=j.length,e=0;e<t;e++)j[e][0].detachEvent(j[e][1],j[e][2]);for(var i=B.length,s=0;s<i;s++)p(B[s]);for(var n in $)$[n]=null;$=null;for(var a in swfobject)swfobject[a]=null;swfobject=null})}();return{registerObject:function(t,e,i,s){if($.w3&&t&&e){var n={};n.id=t,n.swfVersion=e,n.expressInstall=i,n.callbackFn=s,U[U.length]=n,S(t,!1)}else s&&s({success:!1,id:t})},getObjectById:function(t){if($.w3)return a(t)},embedSWF:function(t,i,s,n,a,l,d,u,c,p){var v=g(i),f={success:!1,id:v};$.w3&&!($.wk&&$.wk<312)&&t&&i&&s&&n&&a?(S(v,!1),e(function(){s+="",n+="";var e={};if(c&&typeof c===C)for(var g in c)e[g]=c[g];e.data=t,e.width=s,e.height=n;var m={};if(u&&typeof u===C)for(var _ in u)m[_]=u[_];if(d&&typeof d===C)for(var E in d)if(d.hasOwnProperty(E)){var y=z?encodeURIComponent(E):E,b=z?encodeURIComponent(d[E]):d[E];typeof m.flashvars!=T?m.flashvars+="&"+y+"="+b:m.flashvars=y+"="+b}if(A(a)){var D=h(e,m,i);e.id==v&&S(v,!0),f.success=!0,f.ref=D,f.id=D.id}else{if(l&&r())return e.data=l,void o(e,m,i,p);S(v,!0)}p&&p(f)})):p&&p(f)},switchOffAutoHideShow:function(){Y=!1},enableUriEncoding:function(t){z=typeof t===T||t},ua:$,getFlashPlayerVersion:function(){return{major:$.pv[0],minor:$.pv[1],release:$.pv[2]}},hasFlashPlayerVersion:A,createSWF:function(t,e,i){return $.w3?h(t,e,i):void 0},showExpressInstall:function(t,e,i,s){$.w3&&r()&&o(t,e,i,s)},removeSWF:function(t){$.w3&&p(t)},createCSS:function(t,e,i,s){$.w3&&y(t,e,i,s)},addDomLoadEvent:e,addLoadEvent:i,getQueryParamValue:function(t){var e=L.location.search||L.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return b(e);for(var i=e.split("&"),s=0;s<i.length;s++)if(i[s].substring(0,i[s].indexOf("="))==t)return b(i[s].substring(i[s].indexOf("=")+1))}return""},expressInstallCallback:function(){if(K){var t=f(P);t&&F&&(t.parentNode.replaceChild(F,t),G&&(S(G,!0),$.ie&&(F.style.display="block")),V&&V(x)),K=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.containers=t.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=t.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=t.p2pClient,this.multiCdnClient=t.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(t.rco,t.cviMgr,t.vidContId)},initialize:function(t,i,s){var n;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",t),this.rco=t,this.vidContId=s,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",n=this.cviModel.contentVideoState,n.sendResumeEvent=!1,n.startTime=0,n.elapsedTime=0,n.showPreroll=!0,n.playedChapterTime=0,n.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({defaults:this.cviModel.contentVideoStateDefaults,eventsManager:this.eventsMgr}),e.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var t=this.eventsMgr;this._removeTimers(),t.addTimedEventCallback(t.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),t.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(t){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(t)},_removeTimers:function(){var t=this.eventsMgr;t.removeTimedEventCallback(t.TENTH_SECOND,this.internalNS),t.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var t=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(t)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),e.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),e.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),e.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=t,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(t){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,
debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,t)})):this.finishLoadVideoAndBeginPlayback(t),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(t,e,i){var s=uvpjs.ErrorInfo,n;if(i)return n=new s({errorCode:s.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:n},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,t),2)},handleCdnDecision:function(t,e){this.setNewAssetUrlAndCdn(e),this.doFlashCheck(t)},shouldUseFlash:function(){var t=this.mc.systemInfo,e=this.cviModel.getSessionOption("preventFlashPlayback"),i=t.supportsNativeHls||t.isHlsjsEligible,s=!e&&t.isDesktop&&uvpjs.UvpSwfService.hasFlash(),n=this.mc.isHlsUrl(this._getAssetUrl()),a=uvpjs.Configuration.env;return!("local"!==a&&"dev"!==a&&"stage"!==a||!window.forceFlash||!s)||n&&!i&&s},prepForCaptionEvents:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY],i=e.length;i--;)this.eventsMgr.addEventListener(e[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY],i=e.length;i--;)this.eventsMgr.removeEventListener(e[i]+this.internalNS)},hCaptionEventForUvp:function(t){var e=this.eventsMgr.eventTypes;if(this._hasFacade()&&t.target===this.vidContId)switch(t.type){case e.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case e.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions();break;case e.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions()}},finishLoadVideoAndBeginPlayback:function(t){var e=this.cviModel,i;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),e.incrementMedNum(),this.createFacade(),i=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(i),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),i===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(t){var e=t&&t.providers||null,i=e&&e[0]?e[0]:null,s=i&&i.host||null,n=i&&i.provider||null,a,r,o;s&&(a=this._getAssetUrl(),r=uvpjs.util.parseUrl(a),s!==r.host&&(o=r.protocol+"//"+s+r.pathname+r.search,this.cviModel.contentVideoState.assetURL=o)),n&&this.setContentVideoStateCdn(n)},setContentVideoStateCdn:function(t){this.cviModel.contentVideoState.cdn=t,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:t},this.vidContId)},getContentVideoStateCdn:function(t){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var t=function(t){var e=i.getSessionOption(t);return"boolean"==typeof e?e:void 0!==i.getVideoPlaybackCDOProperty(t)&&i.getVideoPlaybackCDOProperty(t)},e=function(t){var e=i.getSessionOption(t);return"number"==typeof e&&e>=0?e:void 0!==i.getVideoPlaybackCDOProperty(t)?Number(i.getVideoPlaybackCDOProperty(t)):-1},i=this.cviModel,s=e(i.START_BITRATE),n=e(i.MIN_BITRATE),a=e(i.MAX_BITRATE),r=e(i.LIVE_SYNC_DURATION_COUNT),o=t(i.CAP_LEVEL_TO_PLAYER_SIZE),l=t(i.DASHJS_FAST_SWITCH_ABR),d=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),h=Number(this.rco.startBitrate)||-1,c=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,v=Number(this.rco.liveSyncDurationCount)||-1,g=this.rco.capLevelToPlayerSize,f=this.rco.enableDashJSFastSwitchABR,m=this.rco.useDynamicSwitching,m=this.rco.useDynamicSwitching,_=this.rco.errorRecovery;h>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",h),i.setStartBitrate(h)):i.setStartBitrate(s),c>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",c),i.setMinBitrate(c)):i.setMinBitrate(n),p>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(a),v>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",v),i.setLiveSyncDurationCount(v)):i.setLiveSyncDurationCount(r),"boolean"==typeof g?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",g),i.setCapLevelToPlayerSize(g)):i.setCapLevelToPlayerSize(o),"boolean"==typeof f?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",f),i.setDashJSFastSwitchABR(f)):i.setDashJSFastSwitchABR(l),"boolean"==typeof m?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",m),i.setUseDynamicSwitching(m)):i.setUseDynamicSwitching(d),"object"==typeof _?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",_),i.setErrorRecovery(_)):i.setErrorRecovery(u)},createId3Parser:function(t){this.id3EventQueue=[];var e={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(t){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(e);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(e);break;case this.mc.FLASH_HLS:e.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(e)}},handleId3Metadata:function(t){this.id3EventQueue&&this.id3EventQueue.push(t)},checkId3Events:function(t){for(var e=this.id3EventQueue,i=e&&e.length||0,s;i--;)s=e[i],t>=s.pts&&(this.dispatchCuepointEvent(s),this.id3EventQueue.splice(i,1))},dispatchCuepointEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,t,this.vidContId)},createFacade:function(){var t=this.cviModel,e=t.getContentVideoState(),i=this._getAssetUrl(),s={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:t.isMuted,resourceProvider:this,startTime:e.startTime,startBitrate:t.startBitrate,maxBitrate:t.maxBitrate,minBitrate:t.minBitrate,useDynamicSwitching:t.useDynamicSwitching,liveSyncDurationCount:t.liveSyncDurationCount,volume:t.volume,capLevelToPlayerSize:t.capLevelToPlayerSize,enableDashJSFastSwitchABR:t.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:t.errorRecovery,drm:e.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",s),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(s.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(s.swfService=this.uvpSwfService);var n=this.facade.initialize(s);!n||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:n,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(t.nativeControls)},destroyFacade:function(){var t=this._hasFacade()&&"function"==typeof this.facade.destroy;if(this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up."));this.facade.destroy(),this.facade={}},muteContentForAdPlay:function(t){var e=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==t?i.muteVideo():e.isMuted||i.unMuteVideo())},getModule:function(t){return this.cviModel.getModule(t)},getModuleParam:function(t,e){return this.cviModel.getModuleParam(t,e)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:t},this.vidContId)},dispatchContentEnd:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:t},this.vidContId)},dispatchSeekDone:function(){var t=this.eventsMgr;t.dispatchEvent(t.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var t=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,e=t?"Fatal ERROR encountered":"";this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+e),!t&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId)},dispatchVideoStateChange:function(t){isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:t,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+t,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(t){t&&t.abrInfo&&this.cviModel.setAbrInfo(t.abrInfo)},facadeProgress:function(t){!uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.currentTime&&t.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:t.currentTime}),this.setModelDuration(parseInt(t.duration)))},facadeDurationChanged:function(t){uvpjs.util.isEmpty(t)||"object"!=typeof t||t.duration},setModelDuration:function(t){t>0&&this.cviModel.contentVideoState.duration!==t&&(this.cviModel.setContentVideoStateItems({duration:t}),this.cviModel.setContentPlaybackStateItems({duration:t}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",t),!this._seekFromTime)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE."));this._seekToTime=t.seekToTime,this.dispatchSeekDone()},facadeError:function(t){var e=uvpjs.util,i=this.RPM&&this.RPM.currRP,s=this.eventsMgr,n=this.cviModel,a=!e.isEmpty(n),r=t.isFatal,o,l,d,u;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+t.message),a&&r&&(o=this.cviModel.getContentVideoState(),l=o.playbackStarted,d=e.isDefinedString(o.overrideAssetURL),!l&&d&&!this._overrideAssetUrlFailure))return void this._handleOverrideAssetURLError(t);if(a||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),e.isEmpty(s)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(u=t.eventType||s.eventTypes.VIDEO_PLAYBACK_ERROR,t.eventType=u,s.dispatchEvent(u,{errorInfo:t},this.vidContId)),r){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),a&&(n.contentPlaybackState.fatalError=!0),i&&i.rco&&i.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void i.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+t),this.dispatchVideoStateChange(t)},facadeVideoLevelLoaded:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:t},this.vidContId)},facadeVideoTransitionStart:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:t,mode:i},this.vidContId)},facadeVideoTransitionComplete:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:t,mode:i},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeId3Data:function(t){this.id3Parser&&this.id3Parser.parse(t)},facadeMinimumBitrateAllowedChanged:function(t){this.cviModel.setMinBitrate(t)},facadeMaximumBitrateAllowedChanged:function(t){this.cviModel.setMaxBitrate(t)},getFacade:function(t){var e=this.mc.STREAMING,t=t||this._getAssetUrl(),i=this.mc.isHlsUrl(t),s=this.mc.isDashUrl(t),n=this.cviModel.contentVideoState.isFlash,a;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(n||i||s)&&this._setDeliveryType(e),!n&&i)this.mc.canPlayHLSJS()&&(a=new uvpjs.VPF_HLSJS);else if(!n&&s)if(uvpjs.VPF_DASHJS)a=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));a=new uvpjs.VPF_SHAKA}else n&&(a=new uvpjs.VPF_Flash);return a||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",s),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,t.addEventListener(e.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),t.addEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),t.addEventListener(e.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),t.addEventListener(e.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),t.addEventListener(e.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),t.addEventListener(e.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),t.addEventListener(e.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),t.addEventListener(e.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),t.addEventListener(e.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),t.addEventListener(e.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),t.addEventListener(e.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),t.addEventListener(e.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),t.addEventListener(e.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)))},_removeUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",s),t.removeEventListener(e.CONTROL_SEEK+i),t.removeEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i),t.removeEventListener(e.CONTROL_PAUSE+i),t.removeEventListener(e.CONTROL_PLAY+i),t.removeEventListener(e.CONTROL_MUTE+i),t.removeEventListener(e.CONTROL_UNMUTE+i),t.removeEventListener(e.CONTROL_VOLUME_SET+i),t.removeEventListener(e.SWITCH_REQUEST+i),t.removeEventListener(e.USE_DYNAMIC_SWITCHING+i),t.removeEventListener(e.MAXIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.MINIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CAPTIONS_READY+i),t.removeEventListener(e.CONTAINER_RESIZE+i)},_getAssetUrl:function(t){var e=uvpjs.util,i=t||this.cviModel.getContentVideoState(),s=i.overrideAssetURL,n=e.isDefinedString(s)&&!this._overrideAssetUrlFailure,a=n?s:i.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+n+")",a),a},_setDeliveryType:function(t){this.cviModel.setContentVideoStateItems({deliveryType:t})},_handleOverrideAssetURLError:function(t){var e=uvpjs.ErrorInfo,i=this.eventsMgr,s=i.eventTypes.VIDEO_START_ERROR,n=e.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,n+" Error using overrideAssetURL; will use assetURL."),t.eventType=s,t.message=n,t.isFatal=!1,t.errorCode=e.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(s,{errorInfo:t},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.bitrate,n=this.cviModel,a=this.facade;if(e===this.vidContId&&s&&this._hasFacade())switch(typeof s){case"string":if("up"===s)n.setUseDynamicSwitching(!1),a.switchUp();else if("down"===s)n.setUseDynamicSwitching(!1),a.switchDown();else{if(s=Number(s),isNaN(s))return;n.setUseDynamicSwitching(!1),a.switchToBitrate(s)}break;case"number":n.setUseDynamicSwitching(!1),a.switchToBitrate(s);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",s)}},onUseDynamicSwitching:function(t){if(t&&t.target===this.vidContId&&t.payload){var e=t.payload.data;this.cviModel.setUseDynamicSwitching(e),this._hasFacade()&&(this.facade.useDynamicSwitching(e),e&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",e)}},onMinimumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,s=this.facade;if(t.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMinBitrate(i),this._hasFacade()&&s.setMinBitrateAllowed(i)}},onMaximumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,s=this.facade;if(t.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMaxBitrate(i),this._hasFacade()&&s.setMaxBitrateAllowed(i)}},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.cviModel.contentVideoState.duration,a=this.cviModel.contentPlaybackState.currentTime,r=this.facade;if("number"==typeof s&&e===this.vidContId){if(s<0||s>n)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||a,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&r.seekTo(s)}},onVideoSeekToLive:function(){var t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&t.seekToLive()},facadeVolumeChange:function(t){!e.isNaN(t)&&e.isNumber(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:t},this.vidContId)},facadeLoading:function(t){var e={data:t};t&&(t.bufferLength||t.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,e,this.vidContId)},facadeTimeUpdate:function(t){this.cviModel.setContentPlaybackStateItems({currentTime:t})},onFullscreen:function(t){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(t.payload.isFs)},onPauseVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.pauseVideo()},onPlayVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.playVideo()},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),a=this.cviModel.isMuted,r=this.facade;e===this.vidContId&&n&&!a&&this._hasFacade()&&r.setVolume(s)},onMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.muteVideo()},onUnMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var t={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),t=this.cviModel.getContentVideoState(),!e.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:t},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var i=this.getVideoProgressPayload();this.setModelDuration(i.duration),this.id3HandlingEnabled&&this.checkId3Events(i.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,i,this.vidContId)}},checkBuffering:function(t){var e=this.cviModel?this.cviModel.contentPlaybackState:null,i;e&&e.playbackStarted&&e.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(i=t||e.currentTime||0,!this.bufferingDetected&&i<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&i>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=i)},getVideoProgressPayload:function(){var t=this.cviModel.getCurrentVideoState(),e=this.facade.getDuration(),i={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:e,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(i),i},setFacadeStateOnProgressPayload:function(t){var e=this.facade,i=this._hasFacade()&&e.getFacadeState();if(!i)return t;t.facadeState=i,t.averageDroppedFPS=e.getAverageDroppedFPS(),t.bufferLength=e.getBuffered()||0,t.currentTime=e.getCurrentTime()||0,t.currentBandwidth=e.getCurrentBandwidth(),t.currentMaxBandwidth=e.getCurrentMaxBandwidth(),t.droppedFrames=e.getDroppedFramesCount(),t.playbackFramerate=e.getPlaybackFramerate(),t.playbackState=e.getPlaybackState(),t.streamType=e.getStreamType(),t.isHDStreamLive=e.isHDStreamLive(),t.isPlayingLive=e.isPlayingLive(),t.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var t=this.cviModel.contentVideoState,e=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,s=localStorage.getItem("UVPJS.resumeEpochTime")||null,n=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(e&&(t.resumePid=e),i&&(t.resumeContentTime=i),s&&(t.resumeEpochTime=s),n&&(t.resumeSessionId=n))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var t=this.cviModel;t&&(t.resetAdVideoState(),t.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(t){var e=t._,i={DOUBLECLICK_IMA:"pubads.g.doubleclick.net",DOUBLECLICK:"ad.doubleclick.net",PHP:"request.php",JSP:"Request.jsp"};t.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(t){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=t||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.opts.defaults&&this.populateDefaults(this.opts.defaults),this.eventsMgr=this.opts.eventsManager,delete this.opts.defaults,this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(t){var e;for(e in t)this.opts[e]=t[e]},getModel:function(){return this.mdl},getProperty:function(t){return this.mdl[t]},setProperty:function(t,e){this.mdl[t]=e},loadData:function(t,e){var i="callback=uvpHandleJsonpResult",s=e||this.opts.queryParams,n=!1,a=!uvpjs.util.isEmpty(s),r;if(this.opts.url=t,this.opts.queryParams=e,a){t+=t.indexOf("?")<0?"?":"&";for(r in s)t+=(n?"&":"")+r+"="+s[r],n=!0}t.indexOf(i)<0&&(t+=(t.indexOf("?")<0?"?":"&")+i),this.selectorCall=t,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var t=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),t.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(t){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(t)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(t){var e=t.getElementsByTagName("ref"),i=null,s=e[0],n=!1,a=this.mdl,r=s&&this.checkForPlatformError(s),o,l,d,u,h,c,p,v,g;if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",t),r&&r.error)return r;if(o=t.getElementsByTagName("switch"),l=o[0]?o[0].getElementsByTagName("video"):t.getElementsByTagName("video"),null===l[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(a.chapterTimesString="",s)for(d=0,u=e.length;d<u;d++)h=e[d],p=h.attributes.src.nodeValue,this.isAdCallURL(p)?(!n&&(a.imaAdCall=p),n=!0):i||(i=h,a.assetURL=i.getAttribute("src"),v=h.getElementsByTagName("param")),null!==h.getAttribute("clipEnd")&&(a.chapterTimesString+=h.getAttribute("clipEnd")+",");for(d=0,u=l.length;d<u&&(c=l[d],p=c.attributes.src.nodeValue,i||(i=c,a.assetURL=i.getAttribute("src"),v=c.getElementsByTagName("param"),null!==c.getAttribute("clipEnd")));d++)null!==c.getAttribute("clipEnd")&&(a.chapterTimesString+=c.getAttribute("clipEnd")+",");return g=v&&this.extractParams(v)||{},this.populateModelFromContentNodeAndParams(i,g),{error:!1}},populateModelFromContentNodeAndParams:function(t,e){var i=this.mdl,s=uvpjs.mediaCapabilities,n={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},a={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},r="true",o,l;for(q in n)i[q]=t.getAttribute(n[q])||"";for(q in a)i[q]=e[a[q]]||"";i.mediaId=this.getMediaId(e),i.duration=this.getDuration(t),i.sourceOwner=this.getSourceOwner(e),i.cmsRefGuid=t.getAttribute("guid")||t.getAttribute("vid")||"",i.isEmbedable=e.Embeddable===r,i.isLive=e.IsLive===r,i.episodeFlag=e.EpisodeFlag===r,i.useWatermark=e.WatermarkPlayback===r,i.chapterTimesString.length>0?(o=i.chapterTimesString,l=o.length-1,o.lastIndexOf(",")===l&&(i.chapterTimesString=o.substring(0,l)),i.chapterStartTimes=this.convertChapterTimesToSeconds(i.chapterTimesString)):i.chapterStartTimes=[],i.assetURL.indexOf(s.M3U)>-1?(i.cdn="",i.fileType=s.M3U):i.assetURL.indexOf(s.MP3)>-1?i.fileType=s.MP3:i.fileType=s.MP4},handleData:function(t){var e=t.responseText,i=uvpjs.util,s=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),n=this.isValidJsonStr(s)&&JSON.parse(s)||null,a=i.isEmpty(n)?null:n.metafile,r=a&&new DOMParser,o=r&&r.parseFromString(a,"application/xml"),l=o&&this.parseSmilXML(o);if(this.callAttempts=0,l){if(l.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+l.errorInfo.message),void this.signalError(l.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(t){return"string"==typeof t&&("{"===t.charAt(0)&&"}"===t.charAt(t.length-1)||"["===t.charAt(0)&&"]"===t.charAt(t.length-1))},handleError:function(t){var e="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(t.status),i;this.debug&&uvpjs.error(this.DEBUG_ID,e,this.selectorCall),this.shouldRetryCall(t)?(i=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+i,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),i)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:e+" URL: "+this.selectorCall,isFatal:!0,serverCode:t.status})))},shouldRetryCall:function(t){var e=t.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==e&&404!==e&&403!==e&&0!==e},defineProperties:function(){},checkForPlatformError:function(t){var e=t&&this.parseSmilRefNodeForException(t);return e?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(e),serverCode:e.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(t){var e=t.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",s=this.opts&&this.opts.cmsRefGuid+"; "||"",n=t.abstract?t.abstract+" ":"";return"Platform Error; code: "+e+i+s+(t.exception||"Resource Unavailable.")+" "+n},
populateDefaults:function(t){!uvpjs.util.isEmpty(t)&&e.assign(this.mdl,t)},parseSmilRefNodeForException:function(t){var e=t.getElementsByTagName("param"),i={},s;if(e&&e.length){for(s=e.length;s--;)i[e[s].getAttribute("name")]=e[s].getAttribute("value");if("true"===i.isException)return i.abstract=t.getAttribute("abstract")||"",i}return null},extractParams:function(t){var e={},i,s,n,a;if(uvpjs.util.isEmpty(t))return e;for(a=t.length;a--;)i=t[a],s=i.getAttribute("name"),n=i.getAttribute("value"),s&&n&&(e[s]=n);return e},isAdCallURL:function(t){return t.indexOf(i.DOUBLECLICK)>-1||t.indexOf(i.DOUBLECLICK_IMA)>-1||t.indexOf(i.PHP)>-1||t.indexOf(i.JSP)>-1},getMediaId:function(t){var e="",i=t.trackingData,s,n,a;if(uvpjs.util.isEmpty(i))return"";for(s=i.split("|"),n=0,a=s.length;n<a;n++)s[n].indexOf("cid=")>-1&&(e=s[n].split("=")[1]);return e},getSourceOwner:function(t){var e=t.Source;return uvpjs.util.isEmpty(e)&&"true"===t.WatermarkPlayback?"Entertainment":e||""},getDuration:function(t){var e=parseInt(t.getAttribute("dur"))||0;return e>0?.001*e:e},convertChapterTimesToSeconds:function(t){for(var e=[],i=t.split(","),s=i.length,n=function(t){var e=parseInt,n;switch(t=i[s].split(":"),n=t.length){case 1:return e(t[0]);case 2:return 60*e(t[0])+e(t[1]);case 3:return 3600*e(t[0])+60*e(t[1])+e(t[2])}};s--;)e.unshift(n(i[s]));return e}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(t,e,i){this._super(t,e,i)},loadData:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),!e.isFunction(t)||!e.isFunction(i))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS);this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(t)}})}(uvpjs.register("uvpjs")),function(t){t.RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(t,e){var i=this.getSelectorCall(),s=i.url||null,n=null;if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof e&&e(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,uvpjs.util.isDefinedString(this.rco.sig)&&(n={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:e}),this.contentDataProxy.loadData(s,n)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(t)},getSelectorCall:function(){var t=this.rco,e=t.has("selectorCall")&&t.selectorCall||null,i,s,n,a,r,o,l,d,u;if(!e){if(e=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"),a=e&&e.indexOf("$PID$")>-1,r=e&&e.indexOf("$GUID$")>-1,i=t.has("pid")&&t.pid||null,s=t.has("cmsRefGuid")&&t.cmsRefGuid||null,o=!a&&!r,n=!i&&!s,o||n)return d="Config error: "+(o?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(a?"pid":"cmsRefGuid")),{error:!0,message:d};l=a?i:s,u=a?/\$PID\$/g:/\$GUID\$/g,e=e.replace(u,l),e=e.replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:e}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var t=uvpjs.util;t.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),t.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var t=this.cviModel.contentVideoState,e=this.contentDataProxy,i=this.rco,s=function(){var t=e.getProperty("duration");return!uvpjs.util.isEmpty(i.globalResumeTime)&&i.globalResumeTime>0&&t>0&&t-i.globalResumeTime>20},n,a,r,o,l,d,u,h;this.populateContentVideoStateFromLocalStorage(),a=Date.now()-+t.resumeEpochTime,e.setProperty("resumePid",t.resumePid),e.setProperty("resumeEpochTime",+t.resumeEpochTime),e.setProperty("resumeSessionId",t.resumeSessionId),e.setProperty("resumeContentTime",+t.resumeContentTime),e.setProperty("playedChapterTime",+t.playedChapterTime),e.setProperty("showPreroll",t.showPreroll),e.setProperty("sendResumeEvent",!1),e.getProperty("episodeFlag")&&!0!==t.isLive&&(r=s(),l=!r&&i.pid===t.resumePid,r||l?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),o=r?i.globalResumeTime:+t.resumeContentTime||0,n=r?0:a||0,h=!r&&a>this.ONE_HOUR_MS,u=r?this.cviModel.sessionId:"",d=this.getPlayedChapterTimeForContentResume(o),e.setProperty("sendResumeEvent",!0),e.setProperty("startTime",o),e.setProperty("elapsedTime",n),e.setProperty("showPreroll",h),e.setProperty("playedChapterTime",d),e.setProperty("previousSessionId",u),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(l?"local":"global")+"Resume"]},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(t){var e=0,i=this.contentDataProxy.getProperty("chapterStartTimes"),s=i.length||0,n;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",i),s)for(;s--;)if(n=i[s],t>=n){t-n>=4?e=n:(this.contentDataProxy.setProperty("startTime",t-4),s>0&&(e=i[s-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",e),e}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(t,e,i)},loadData:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),!e.isFunction(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS);this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(t){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(t,e,i){var s,n;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",t),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=t,this.isContentScenario=!1,this._super(t,e,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(s=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(s.eventType,{errorInfo:s},i)):(n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=n.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(t,e){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:t();break;case this.PLATFORM:this._super(t,e);break;case this.CONTENT_AND_AD_CALL:t()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=uvpjs.util.isDefinedString(e.adCall)?e.adCall:null,n=this.imaScenario===this.PLATFORM,a=s||(n?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(a)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,a)):this.doFlashCheck(a))},finishLoadVideoAndBeginPlayback:function(t){var e="",i=uvpjs.adUtil,s=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,s.incrementMedNum(),this.isContentScenario=!0),t?(e=i.populateImaAdCallValues(t,s,this.isContentScenario),this.viewGuid=i.getDwViewGuid(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",e)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(e)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(t){e.isString(t)&&!e.isEmpty(t)?this._requestAdsManager(t):this._onContentResumeRequested()},setImaAdUrl:function(){var t=this.checkForAdCallOverride();t?(this.contentDataProxy.setProperty("imaAdCall",t),this.imaAdCall=t):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var t=this.cviModel.getModule(this.AD_SETTINGS),i=null!=t&&1==t.enabled,s=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),n=null;return i&&!e.isUndefined(s)&&(n=s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(n||"null")),n},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var t="",e=this.contentDataProxy,i=e.getProperty("chapterStartTimes"),s;return e.getProperty("showPreroll")||(t="1"),i.length>0&&(s=i.indexOf(e.getProperty("playedChapterTime")))>=0&&(s+=2,t=t.length>0?t+","+String(s):String(s)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",t),t},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(t){var e=t&&t.id,i=this.trueXInteractionIds;switch(e){case i.CLOSED_BEFORE_CREDIT:case i.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case i.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case i.OPT_OUT:case i.TIME_OUT:this.resetTrueXStatus();break;case i.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(t){var e=this.getAdPodInfo(t),i=e.podIndex,s=0===i?"pre":-1===i?"post":"mid_"+i;if(this.currAdPod=this.APM.getAdPodById(s),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var n=this.currAdPod;return n.adCount=e.totalAds,n.podDuration=e.maxDuration,n.isBumper=e.isBumper,n.imaPodIndex=e.podIndex,n.timeOffset=e.timeOffset,n.totalAds=e.totalAds,n.imaAdPostion=e.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(t,e){var i=t.getAdPodInfo(),s=e||{};return s.adPosition=i.getAdPosition(),s.isBumper=i.getIsBumper(),s.maxDuration=i.getMaxDuration(),s.podIndex=i.getPodIndex(),s.timeOffset=i.getTimeOffset(),s.totalAds=i.getTotalAds(),s},assembleAdInfo:function(t){return{adId:t.getAdId(),adPodInfo:this.getAdPodInfo(t),adSystem:t.getAdSystem(),advertiserName:t.getAdvertiserName(),apiFramework:t.getApiFramework(),contentType:t.getContentType(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId(),dealId:t.getDealId(),description:t.getDescription(),duration:t.getDuration(),height:t.getHeight(),mediaUrl:t.getMediaUrl(),minSuggestedDuration:t.getMinSuggestedDuration(),skipTimeOffset:t.getSkipTimeOffset(),surveyUrl:t.getSurveyUrl(),title:t.getTitle(),traffickingParams:t.getTraffickingParameters(),traffickingParametersString:t.getTraffickingParametersString(),uiElements:t.getUiElements(),universalAdIdRegistry:t.getUniversalAdIdRegistry(),universalAdIdValue:t.getUniversalAdIdValue(),vastMediaHeight:t.getVastMediaHeight(),vastMediaWidth:t.getVastMediaWidth(),vastMediaBitrate:t.getVastMediaBitrate(),width:t.getWidth(),wrapperAdIds:t.getWrapperAdIds(),wrapperAdSystems:t.getWrapperAdSystems(),wrapperCreativeIds:t.getWrapperCreativeIds(),isLinear:t.isLinear()}},onAdEvent:function(t){var i=t.getAdData(),s=t.getAd(),n=google.ima.AdEvent.Type,a,r,o;if(t.type===n.INTERACTION)return void this.processInteractionEvent(i);if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(t.type),t.type){case n.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",s),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(t)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(s))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(s,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this._dispatchAdLoaded(this.assembleAdInfo(s));break;case n.STARTED:var l=s.getContentType(),d,u;this.ad=s,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=s.getDuration(),this._populateAdVideoState(s,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this.cviModel.mergeCDOData(),"application/javascript"!==l&&"application/x-shockwave-flash"!==l||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===l&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(s),this.trackAdEvent(n.STARTED),d=s.getAdPodInfo(),d&&(u=d.getTotalAds()),this._dispatchAdStart(u),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case n.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case n.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case n.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case n.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case n.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||e.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case n.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),a=this.cviModel.getAdVideoState(),a.paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:a},this.vidContId);break;case n.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case n.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case n.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case n.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,a=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:a,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case n.LOG:var h=i&&i.adError,c=uvpjs.ErrorInfo,p=null===s,v=this.eventsMgr.eventTypes.AD_ERROR,g="Unknown error - IMA.AdEvent.Type.LOG ",f;!h&&p?(f=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof f&&f()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(h,s,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),p&&!h&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",n))}},_populateAdVideoState:function(t,i){var s,n;if(!e.isObject(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN"));if(n=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.IMA),i)for(s in i)n[s]=i[s];this.cviModel.setAdVideoState(n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())},_requestAdsManager:function(t){var e=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",t),this.adStartEventReceived=!1,this.adCallUrl=t,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new google.ima.AdsRequest;i.adTagUrl=t,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(e.isAutoplay),i.setAdWillPlayMuted(e.isMuteAtPlayStart&&!e.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(t){var i=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,s=this.cviModel.contentPlaybackState.facadeState.currentBitrate,n=uvpjs.util,a,r,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",t),this._dispatchAdResponse(),n.isEmpty(this.RPM)||n.isEmpty(this.RPM.currRP)||n.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var l=this.renderSettings;l.bitrate=s>0&&s/1e3||900,l.restoreCustomPlaybackStateOnAdBreakComplete=!1,l.enablePreloading=!1,l.loadVideoTimeout=this._returnIMATimeout(),a=this.adsManager=t.getAdsManager(i,l),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",a.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",a.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",a.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(r=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",r)),this.imaCuePoints=this.adsManager.getCuePoints(),e.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,r,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",r),this.APM.initialize(this.vidContId,r,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),o=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,o),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},startAds:function(){var t=null,e=null,i,s;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(n){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),s=uvpjs.ErrorInfo,i=s.messages.NO_AD_CONTENT,n&&"function"==typeof n.getMessage&&(i+=": "+n.getMessage(),t=n.getErrorCode(),e=n.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new s({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:s.errorCodes.IMA_AD_ERROR,message:i,imaErrorCode:t,imaVastErrorCode:e,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var t=!1,i;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),e.isEmpty(this.facade)||(t=this.cviModel.contentVideoState.isLive,i=this.imaUsesContentVideoTag(),!i&&this.facade.hideVideo(),t&&!i?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),i&&(this.savedSeekToTime=t?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!e.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),!e.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN"));if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),e.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!e.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}},facadePlaybackStateChange:function(t){this.seekPending&&t===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(t)},_updateIMAPlaybackState:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",t),t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(t){var e=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:t||1,adData:e,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(t){var e;this.uvpjsAdStartOpened&&(e=this.cviModel.getAdVideoState(),e.skipped=!0===t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(t){var e="function"==typeof t.getAdData?t.getAdData():{},i="function"==typeof t.getAd?t.getAd():{};return("function"==typeof i.getMediaUrl?i.getMediaUrl():e.mediaUrl)||null},_dispatchAdLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:t},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){
this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(t,e){var i,s,n;t&&(this.containerWidth=t),e&&(this.containerHeight=e),this.mc.isChromecast()||(i=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),s=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),i===this.containerWidth&&s===this.containerHeight||(this.containerWidth=i,this.containerHeight=s,this.adsManager&&(n=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,n))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var t=this.adsManager.getRemainingTime();this._checkForStuckAd(t),this.currImaAdTime=Math.floor(this.duration-t),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime})}},_checkForStuckAd:function(t){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=t,!1;var e=this.previousRemainingTime-t;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+e),0===e?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var i="Ad playback stuck for "+this.stuckIntervals+" intervals.",s=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,i,s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:s,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=t,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(t){var e=t&&t.getAd&&t.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(t.getError(),e),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(t){this.dispatchAdErrorEvent(t.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(t,e,i){var s=null,n=null,a=null,r="Unknown",o=uvpjs.ErrorInfo,l=uvpjs.util,d=l.isFunction,u="n/a",h=" Unspecified IMA ad error.",c,p,v;t&&d(t.getMessage)&&(s=t.getMessage(),n=t.getErrorCode()||"n/a",a=t.getVastErrorCode()||"n/a",r=" imaErrorCode: "+n+"; vastErrorCode: "+a,s+=r),t&&d(t.getInnerError)&&(c=t.getInnerError())&&(!s&&(s=""),p=d(c.getMessage)?c.getMessage():c.message||u,v=d(c.getErrorCode)?c.getErrorCode():u,s+=" Inner error: "+p+"; inner error code: "+v),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+s),i&&(s=i+" "+s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new o({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:o.errorCodes.IMA_AD_ERROR,message:o.messages.IMA_AD_ERROR_EVENT_RECEIVED+(s||h),isFatal:!1,imaErrorCode:n,imaVastErrorCode:a,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),e.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var t=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(t)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(t){var e;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",t),null!==this.adsManager)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call"));this.dynamicMidRollPodCount++,e=uvpjs.adUtil.populateImaAdCallValues(t,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=e,this._requestAdsManager(e)},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(t)))},onPlayVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(t)))},onVideoSeekTo:function(t){var i=this.cviModel.contentPlaybackState.currentTime,s,n,a;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",t),t.target!==this.vidContId||e.isEmpty(this.facade)||!this.canSeek(t&&t.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):e.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(t)):(s=t.payload.seekTime,this._seekFromTime=i,n=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(s):s,a=this.APM.returnPrecedingUnplayedAdPod(n),void(e.isEmpty(a)||a.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(t)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",a.startTime),this.savedSeekToTime=n,a.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=a.startTime)))},canSeek:function(t){return void 0!==t.seekTime&&null!==t.seekTime&&t.seekTime>=0&&t.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(t){return t},onChangeVideoVolume:function(t){e.has(t,"target")&&t.target===this.vidContId&&!this.cviModel.isMuted&&t.payload.vol>=0&&t.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(t.payload.vol):this._super(t))},onMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},onUnMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var t=this.adsManager,e=google.ima.AdEvent.Type,i;this._createBoundAdEventHandlers(),i=this.onAdEvent,t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),t.addEventListener(e.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),t.addEventListener(e.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),t.addEventListener(e.LOADED,i),t.addEventListener(e.STARTED,i),t.addEventListener(e.FIRST_QUARTILE,i),t.addEventListener(e.MIDPOINT,i),t.addEventListener(e.THIRD_QUARTILE,i),t.addEventListener(e.COMPLETE,i),t.addEventListener(e.ALL_ADS_COMPLETED,i),t.addEventListener(e.CLICK,i),t.addEventListener(e.PAUSED,i),t.addEventListener(e.RESUMED,i),t.addEventListener(e.USER_CLOSE,i),t.addEventListener(e.SKIPPED,i),t.addEventListener(e.LOG,i),t.addEventListener(e.VOLUME_CHANGED,i),t.addEventListener(e.VOLUME_MUTED,i),t.addEventListener(e.INTERACTION,i)},_removeAdsManagerEventListeners:function(){var t=this.onAdEvent,e=this.adsManager,i=google.ima.AdEvent.Type;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),e.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.removeEventListener(i.LOADED,t),e.removeEventListener(i.STARTED,t),e.removeEventListener(i.FIRST_QUARTILE,t),e.removeEventListener(i.MIDPOINT,t),e.removeEventListener(i.THIRD_QUARTILE,t),e.removeEventListener(i.COMPLETE,t),e.removeEventListener(i.ALL_ADS_COMPLETED,t),e.removeEventListener(i.CLICK,t),e.removeEventListener(i.PAUSED,t),e.removeEventListener(i.RESUMED,t),e.removeEventListener(i.USER_CLOSE,t),e.removeEventListener(i.SKIPPED,t),e.removeEventListener(i.LOG,t),e.removeEventListener(i.VOLUME_CHANGED,t),e.removeEventListener(i.VOLUME_MUTED,t))},onUVPJSTimerTick:function(){var t=uvpjs.util,e=this.cviModel.contentPlaybackState.facadeState.currentBitrate,i=!t.isEmpty(e)&&e>0,s=e/1e3!==this.renderSettings.bitrate,n=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,a=!t.isEmpty(this.adsManager),r=!t.isEmpty(this.facade),o,l,d,u,h;if(a&&i&&s&&(this.renderSettings.bitrate=e/1e3,this.adsManager.updateAdsRenderingSettings(this.renderSettings)),n&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:r?(o=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=o):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return u=a&&n&&(this.cviModel.sessionOptions.adBlockerCallback||null),l=u&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),h=u&&(d=(new Date).getTime())&&(this.lastAdBlockCheckTime<d||l),h&&(this.lastAdBlockCheckTime=d+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&r&&this.checkId3Events(o),this.playbackState===this.mc.PLAYING){var c=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,c,this.vidContId)}},_checkForCloseToMidrollPod:function(t){var e=this.APM.getMidRollPods(),i,s,n;if(t<=0)return!1;for(i=e.length;i--;)if(n=e[i],(s=n.startTime-t)>0&&s<1&&!n.hasPlayed&&!n.hasBeenChecked)return n.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(t){var e=uvpjs.util,i=this._getAssetUrl(t),s=e.isDefinedString(t.pid),n=e.isDefinedString(t.cmsRefGuid),a=e.isDefinedString(t.selectorCall),r=e.isDefinedString(t.assetURL);return s||n&&!r||a?this.PLATFORM:e.isDefinedString(i)?this.CONTENT_AND_AD_CALL:e.isDefinedString(t.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var t=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),t},_checkForContentPreload:function(){var t=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,e=this.adsManager.isCustomPlaybackUsed(),i=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!e;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&t&&this.duration>5&&i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var t=-1,e=this.cviModel.getModule(this.AD_SETTINGS),i=e&&e.enabled,s=i&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return s&&(t=parseInt(s),t=t>0?1e3*t:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+t),t},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._,i=["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"],s=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"],n;t.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(t){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){var s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),a=s.getElementsByTagName("video")[0];!n&&(n=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new n.StreamManager(a),this.adClickElement=this.createAdClickElement(a),this.streamManager.setClickElement(this.adClickElement),this._super(t,e,i),this.resetAdStates(),this.contentVideoDiv=s,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(t,e){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(t,e):(this.dataLoadedCB=t,this.onDataProxyComplete())},onDataProxyComplete:function(){var t=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(t)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(t),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=this.contentDataProxy.getModel(),n;if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),i.setNonDefaultContentVideoStateItems(s),i.setContentVideoStateItems(e),i.mergeCDOData(),this.killDataProxy(),!(n=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.requestStream(n)},requestStream:function(t){var e=this.cviModel.contentVideoState.isLive,i=e?n.LiveStreamRequest:n.VODStreamRequest,s=new i,a=t||testRsrcDef;s.apiKey=a.apiKey||null,s.adTagParameters=a.adTagParameters,e?(s.assetKey=a.assetKey,s.attemptPreroll=!0,this.id3HandlingEnabled=!0):(s.contentSourceId=a.contentSourceId,s.videoId=a.videoId),this.streamManager.requestStream(s)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(t){var e=t.getStreamData().url;if(!uvpjs.util.isDefinedString(e))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=e,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(t){this.daiStreamId=t.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(t){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(t){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null},hCuePointsChanged:function(t){this.currAdPod=this.getNewPod(t.getStreamData().cuepoints)},hAdStarted:function(t){var e=t.getAd();this.resetAdStates(),this.updateAdModel(e),this.currAd=e,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.currAdPod?(this.trackAdEvent(t.type),this.dispatchAdPodStart()):this.dispatchError(this.eventsMgr.eventTypes.AD_ERROR,uvpjs.ErrorInfo.messages.DAI_ADPOD_ERROR,uvpjs.ErrorInfo.errorCodes.DAI_AD_ERROR)),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(t){var e=t.type,i=n.StreamEvent.Type,s=null,a,r,o;switch(e){case i.FIRST_QUARTILE:s=25;break;case i.MIDPOINT:s=50;break;case i.THIRD_QUARTILE:s=75;break;case i.AD_PROGRESS:a=t.getStreamData(),r=a&&a.adProgressData,(o=r&&this.createAdProgressPayload(r))&&this.dispatchVideoProgress(o)}s&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=s,this.dispatchAdQuartile(s))},hStreamError:function(t){var e=t.getStreamData(),i=e&&e.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+i,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,i||"Uknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(t){},hStreamEvent:function(t){this.isAdPlaying()&&this.trackAdEvent(t.type),this[this.hMap[t.type]](t)},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,a=this._hasFacade(),r=n.getDuration(),o=this.facade.getCurrentTime();if("number"==typeof s&&e===this.vidContId){if((s=this.streamManager.streamTimeForContentTime(s))<0||s>r)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||o,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),a&&n.seekTo(s)}},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===s,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(t){var e=null,i=t&&t.length,s,n;for(i&&!this.adPods&&this.createAdPods(t);i--;)s=t[i],n=this.adPods["t_"+s.start],e||n.hasPlayed===s.played||(e=n),n.hasPlayed=s.played;return e},createAdPods:function(t){var e=function(t){return t===n-1?"post":0===t?"pre":"mid"},i=0,s=[],n=t.length,a,r,o,l;for(this.adPods={},r=0;r<n;r++)a=t[r],o=e(r),l=a.start,s.push(l),this.adPods["t_"+l]={startTime:l,hasPlayed:!1,adPodId:o+("mid"===o?"_"+i++:"_0"),adCount:0,podDuration:a.end-l};this.cviModel.contentVideoState.chapterStartTimes=s},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(t){var e=t.getAdPodInfo();this.populateAdVideoState(t),e&&this.currAdPod&&(this.currAdPod.adCount=e.getTotalAds(),this.currAdPod.podDuration=e.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(t){var e=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.DAI);this.cviModel.setAdVideoState(e)},createAdProgressPayload:function(t){var e=this.getVideoProgressPayload(),i=t.currentTime;return e.isAd=!0,e.duration=t.duration,e.currentTime=i,e.absoluteStreamTime=this.facade.getCurrentTime(),e.lastSecondCompleted=Math.floor(i),e.lastPercentageCompleted=this.currAdPercentComplete,e},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&t!=n.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var t=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying(),e,i,s;t&&(i=this.facade.getCurrentTime(),this.checkForAdBlocker(i,!1),e=this.streamManager.contentTimeForStreamTime(i),!this.contentStartOpen&&e>0&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(e),s=this.createVideoProgressPayload(e,i),this.dispatchVideoProgress(s))},createVideoProgressPayload:function(t,e){var i=this.getVideoProgressPayload();return i.currentTime=t,i.absoluteStreamTime=e,i.duration=this.contentDuration||-1,i},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(t,e){var i=t-this.lastAdBlockCheckTime>this.adBlockCheckInterval,s=e||i,n=s&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return s&&(this.lastAdBlockCheckTime=t),n&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!n},assembleResourceDefinition:function(){var t=this.rco.getAdTagParameters(),e=this.rco.getVideoId(),i=this.rco.getContentSourceId();return t&&e&&i?{adTagParameters:t,videoId:e,contentSourceId:i}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(t){for(var e="add"===t?"addEventListener":"removeEventListener",a="addEventListener"===e,r=n.StreamEvent.Type,o=i.length,l=[],d;o--;)d=r[i[o]],l.push(d),a&&(this.hMap[d]=s[o]);this.streamManager[e](l,this.hStreamEvent,!1)},createAdClickElement:function(t){var e="uvpjsDaiContainer",i=t.nextSibling,s,n,a,r;if(i&&i.getAttribute("data-role")===e)return i;s=document.createElement("div"),s.setAttribute("data-role","uvpjsDaiContainer"),n={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},r=s.style;for(a in n)r[a]=n[a];return t.insertAdjacentElement("afterend",s),s},onPauseVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onPlayVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),a=this.cviModel.isMuted;e===this.vidContId&&n&&!a&&this._hasFacade()&&(this.facade.setVolume(s),this.isAdPlaying()&&this.trackAdEvent(t.type))},onMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onUnMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},facadeId3Data:function(t){var e,i,s;for(e=t.length,s=0;s<e;s++)i=t[s],this.streamManager.processMetadata("ID3",i.data,i.pts)},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.contentDuration=this.streamManager.contentTimeForStreamTime(t.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(t){this.adClickElement&&(this.adClickElement.style.display=!1!==t?"block":"none")},log:function(t,e,i){var s=i||"log";uvpjs[s](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};t.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){this._super(t,e,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],
this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(t){t()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s;if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.killDataProxy(),this.contentDuration=i.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),!(s=this.assembleAssetUrl(e)))return void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=s,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(e.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()},assembleAssetUrl:function(t){var e=t.assetURL,i=uvpjs.util,s,n;return i.isEmpty(e)?null:e.indexOf("?")>-1?e:(n=t.getAdTagParameters(),s=n?i.queryStrFromObj(n):null,i.isEmpty(s)?e:e+"?"+s)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(t){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(t),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(t){var e=this.getPrerollPod(t);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:e})},dispatchAdPodEnd:function(){var t=this.getPrerollPod();t.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:t})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e,isFatal:!0===s,adInfo:null})})},getPrerollPod:function(t){return this.adPod||(this.adPod={startTime:t,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var t=uvpjs.adUtil.getAdStateBlank();t.adServerName="dai_ssb",t.duration=this.getPrerollAdDuration(),t.adClipID="pre_0",t.adPosition=1,t.adType="pre",this.cviModel.setAdVideoState(t)},getPrerollAdDuration:function(){var t=this.getAbsoluteDuration();return t>0&&this.contentDuration>0?t-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=this.getPrerollAdDuration(),s=Math.floor(e/i*100),n,a;switch(s){case 25:n=this.quartiles[25],a=25;break;case 50:n=this.quartiles[50],a=50;break;case 75:n=this.quartiles[75],a=75}return a&&!n&&this.dispatchAdQuartile(a),a&&(this.quartiles[String(a)]=1),t.isAd=!0,t.duration=i,t.currentTime=e,t.absoluteStreamTime=this.facade.getCurrentTime(),t.lastSecondCompleted=Math.floor(e),t.lastPercentageCompleted=s,t},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var t=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,e=this.isAdPlaying(),i=this.contentStartOpen,s=t&&this.facade.getCurrentTime(),n;t&&(n=e?this.createAdProgressPayload():i?this.createVideoProgressPayload():null,s>1&&!i&&!e&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+s),this.contentStartTime=s,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(s),n&&this.dispatchVideoProgress(n))},createVideoProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=e-this.contentStartTime;return t.currentTime=i,t.absoluteStreamTime=e,t.duration=this.contentDuration||-1,t},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,a=this._hasFacade(),r=a&&(this.absoluteDuration||n.getDuration()),o=this.getPrerollAdDuration(),l=this.facade.getCurrentTime();if("number"==typeof s&&e===this.vidContId&&r){if((s+=o>0?o:0)<0||s>r)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||l,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),a&&n.seekTo(s)}},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){!this.absoluteDuration&&(this.absoluteDuration=t.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){this.vidEl.textTracks.removeEventListener("addtrack",this.hAddTextTrack,!1)},hAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(t.track.addEventListener("cuechange",this.hCueChange.bind(this),!1),t.track.mode="hidden")},hCueChange:function(t){t.target&&t.target.activeCues&&1==t.target.activeCues.length&&this.handleId3Cue(t.target.activeCues[0])},handleId3Cue:function(t){var i=t.value,s=i.key,n,a;"TXXX"===s&&(n=""!==i.info?i.info:i.data,(a=e[n])&&this[a](t.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(t,e,i){var s=i||"log";uvpjs[s](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e=2e3;t.P2pClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var t=uvpjs.P2pClient.clientMap[this.clientName];return t&&t.getHlsjsLoader&&(t.getHlsjsLoader()||null)}}),t.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,t.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(t,e){var i;this.getHlsjsLoader()?t():e.apiKey?(i=this.loadHlsLoader.bind(this,t),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+e.apiKey,i,2e3)):t(!0)},loadHlsLoader:function(t,e){if(e)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",e),void t(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,t,2e3)}}}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=2e3;t.MultiCdnClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(t){var e;this.inFlight||(this.inFlight=!0,this.decisionCallback=t,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),e=new uvpjs.CodeLoader,e.loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(t){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(t.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),t.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(t){return t&&t.customerId&&t.appId?this.decisionUrl.replace("{customerId}",t.customerId).replace("{appId}",t.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(t){t()}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t,e){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=e,this.callback=t,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var t=null,e=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(t,e))},handleMcdnReady:function(t){var e=this.multiCdnClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,e.clientName)||(e.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+e.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var t=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,t.clientName,this.handleMcdnReady.bind(this),t.requiredParams)},handleP2pReady:function(t,e){var i=this.p2pClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var t=this.p2pClientOptions,e=this.multiCdnClientOptions,i=e.canUse;t.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,t.clientName,this.handleP2pReady.bind(this,i),t.requiredParams):i?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(t,e,i,s){var n=this.getClientObject(t,e);n||i(!0),n.loadScripts(i,s)},validateScriptLoad:function(t,e){var i=this.getClientObject(t,e);return i&&i.validateScriptLoad()||!1},createClient:function(t,e){return new t(e)},getClientOptions:function(t){var e=this.model,i=this.getSupportedClients(t),s={canUse:!1,clientName:null},n,a,r,o,l,d,u,h,c;if(t===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return s;for(n in i)if(a=n,r=i[a],(h=r&&r.uvpcModuleName)&&e.isModuleEnabled(h)){for(o=r.requiredParams,l=o&&o.length||0,u={},c=!0;l--;){if(d=e.getModuleParam(h,o[l]),uvpjs.util.isEmpty(d)){c=!1;break}u[o[l]]=d}return{canUse:c,clientName:a,requiredParams:u}}return s},getSupportedClients:function(t){var e={},i=t.clientMap,s,n;if(!i)return e;for(s in i)n=i[s],e[s]={uvpcModuleName:n.uvpcModuleName,requiredParams:n.requires};return e},getClientObject:function(t,e){return t.clientMap[e]||null}});var e=t.VideoDeliveryPluginService;e.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},e.load=function(t,e,i){(new uvpjs.CodeLoader).loadScript(t,e,i)}}(uvpjs.register("uvpjs")),function(t){var e="loadedmetadata";t.FullscreenManager=uvpjs.Class.subClass({init:function(t){var e=uvpjs.util,i=t||{},s=uvpjs.mediaCapabilities;if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,!i.videoElement||!i.container)return void uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.");this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=e.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=e.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=s.getEnterFullscreenMethodName(),this.exitMethod=s.getExitFullscreenMethodName(),this.fsElementName=s.getFullScreenElementName(),this.isFullscreenProperty=s.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(t){var e=this.isFullscreen();t.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(e)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var t=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return t&&uvpjs.util.isFunction(t[this.exitMethod])?t:null},validateEntryAndExitMethods:function(){var t=this.fsElement&&this.fsElement[this.enterMethod],e=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(t),this.hasValidExitMethod=i.isFunction(e)},initialize:function(){var t=uvpjs.mediaCapabilities,e,i,s,n;if(this.hasFsApiSupport=t.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(n=t.getFullscreenEventName(),e=t.isFirefox()||t.isIE()?document:this.container,e.addEventListener(n,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,i=t.getFullscreenEnterEventName(),s=t.getFullscreenExitEventName(),this.fsElement.addEventListener(i,this.hFullScreenEvent,!1),this.fsElement.addEventListener(s,this.hFullScreenEvent,!1),this.enterEvt=i,this.exitEvt=s),this.validateEntryAndExitMethods(),!this.hasValidEntryMethod)return void(this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo()));this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())}}),t.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i,s,n,a=t._;t.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=t.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=t.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(t.skinConfig)},destroy:function(){var t=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=t,this._replayCB=t,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(t){var e=uvpjs.util,i=uvpjs.Configuration.path,s=this._containerId,n=t.customCSS;this._namespace="."+s+".skin",this._autoPlay=t.isMutedAutoplay||t.isUnmutedAutoplay,this._isMutedAutoplay=t.isMutedAutoplay,this._previewImage=t.previewImage,this._enableReplay=t.enableReplay,this._themeName=t.themeName,this._controls=t.controls,this._template=t.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=e.isDefinedString(n)&&n||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(t)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(t){this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),a.includes(this._disabledButtons,t)||this._disabledButtons.push(t),this._disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),a.pull(this._disabledButtons,t),this._enableButton(t)},_handleFullscreenMgrReady:function(t){t&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(t){var e=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),t?(this.vci.fullscreen(!0),e&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),e&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",t),this._disable(t),e&&e.setAttribute("disabled","disabled")},_enableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",t),a.includes(this._disabledButtons,t)||(this._enable(t),e&&e.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t.addEventListener(i.AD_START+e,this._onAdStart.bind(this)),t.addEventListener(i.AD_END+e,this._onAdEnd.bind(this)),!this._isIOS&&t.addEventListener(i.CAPTIONS_READY+e,this._onCaptionsReady.bind(this)),t.addEventListener(i.CONTENT_START+e,this._onContentStart.bind(this)),t.addEventListener(i.CONTENT_END+e,this._onContentEnd.bind(this)),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_LOADING+e,this._onVideoLoading.bind(this)),t.addEventListener(i.CONTROL_MUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.CONTROL_UNMUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.RESOURCE_START+e,this._onResourceStart.bind(this)),t.addEventListener(i.RESOURCE_END+e,this._onResourceEnd.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onUVPJSResize.bind(this)),t.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+e,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t&&t instanceof uvpjs.VideoControlInterface&&(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.AD_END+e),!this._isIOS&&t.removeEventListener(i.CAPTIONS_READY+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_LOADING+e),t.removeEventListener(i.CONTROL_MUTE+e),t.removeEventListener(i.CONTROL_UNMUTE+e),t.removeEventListener(i.RESOURCE_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e))},_addUIEventListeners:function(){for(var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this.css,s=this.shouldTrapTaps(),n=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],a=n.length;a--;)"_onClosedCaptionBtnClick"===n[a]&&this._isIOS||(this[n[a]]=this[n[a]].bind(this));var r=this._onUVPJSGestureEvent,o=this._hNonTap,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),e.addEventListener("mouseenter",r,!0),e.addEventListener("mouseleave",r,!0),e.addEventListener("mousemove",r,!0),e.addEventListener("mousedown",r,!1),e.addEventListener("mouseup",r,!1),e.addEventListener("click",r,!1),e.addEventListener("touchstart",r,!0),e.addEventListener("touchend",r,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(t,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(t,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),!s&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),!s&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),!s&&this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),!s&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),!s&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){
var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this._hNonTap,s=this._onUVPJSGestureEvent,n=this._onProgressSliderEvent,a=this._onVolumeSliderEvent,r=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),e.removeEventListener("mouseenter",s,!0),e.removeEventListener("mouseleave",s,!0),e.removeEventListener("mousemove",s,!0),e.removeEventListener("mousedown",s,!1),e.removeEventListener("mouseup",s,!1),e.removeEventListener("click",s,!1),e.removeEventListener("touchstart",s,!0),e.removeEventListener("touchend",s,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(t,n,!1),this._progressSlider.removeEventListener("mousedown",n,!1),this._progressSlider.removeEventListener("mouseup",n,!1),this._progressSlider.removeEventListener("touchstart",n,!0),this._progressSlider.removeEventListener("touchend",n,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(t,a,!1),this._volumeSlider.removeEventListener("mouseover",a,!1),this._volumeSlider.removeEventListener("mouseout",a,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",r,!1),this._volumeBtn.removeEventListener("mouseover",r,!1),this._volumeBtn.removeEventListener("mouseout",r,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var t=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(t,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var t=!0;for(var e in this._controlList)this._checkControlOnDOM(this._controlList[e])||(t=!1);return t},_waitForControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");var e=setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void t.call(this):void this._waitForControls(t)}.bind(this),50)},_clearMouseMoveInterval:function(t){var e=this._getClassName(t,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[e]&&(clearInterval(this._intervals[e]),this._intervals[e]=-1)},_clearIntervals:function(){var t=this._intervals,e;for(e in t)-1!==t[e]&&(clearInterval(t[e]),t[e]=-1)},_setupDom:function(){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),e(this._containerEl,this.PRIMARY_BLOCK),e(this._contentEl,this._getClassName(t.CONTENT)),e(this._controlsEl,this._getClassName(t.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&e(this._adEl,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(t){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t]=t},_setupControlsContainer:function(){var t=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(t)},_generateSettingsMenu:function(t,e){function i(t){var e=t.value,i=t.property,s=i&&o[i];return!((s&&s.toLowerCase())!==(e&&e.toLowerCase()))}function s(t,e){var s={};if(!1!==t.enabled)return void 0===t.value?(s.el="SETTINGS_MENU_ITEM",s.type="button",s.label=t.label,s.target=e):(s.el="SETTINGS_MENU_INPUT",s.type="menu",s.label=t.label||t.value,s.value=t.value,s.property=e&&a.last(e.split(":")),s.selected=i(s)),s}var n=this._queryByElementName(this.css.SETTINGS_MENU),r=this._getClassName(this.css.SETTINGS_MENU_ITEM),o=a.assign({},this._menuSelections,this._getCaptionsStyle()),l=document.createRange(),d=uvpjs.util,u=[],h=this.shouldTrapTaps(),c,p,v,g,f,m,_,E,A;for(A=t&&t.length,E=0;E<A;E++)m=t[E],f=m.name,g=e,f&&(g=d.isDefinedString(e)&&[e,f].join(":")||f),u.push(s(m,g));for(e&&(v=this._findMenuItem(e),g=e.split(":").slice(0,-1).join(":"),_=s(v,g),_.cls=r+"--back",u.unshift(_)),l.selectNodeContents(n),l.deleteContents(),n.insertAdjacentHTML("beforeend",this._templateToHTML(u)),c=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),p=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),E=c&&c.length;E--;)!h&&c[E].addEventListener("click",this._onSettingsMenuBtnClick);for(E=p&&p.length;E--;)!h&&p[E].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var t=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),e=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),i;for(i=t&&t.length;i--;)t[i].removeEventListener("click",this._onSettingsMenuBtnClick);for(i=e&&e.length;i--;)e[i].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(t){var e={items:this.settingsMenu};if(a.isEmpty(t))return e;var i=this,s=t.split(":");return a(s).each(function(t){i.debug&&uvpjs.log(i.DEBUG_ID,"_findMenuItem key",t),e=a.find(e.items,function(e){return e.name===t})}),e},_createAdLearnMoreButton:function(){},_setupPreview:function(){var t=uvpjs.util,e=this.css.PREVIEW_BTN,i=this._previewImage,s=this._queryByElementName(e);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),t.isDefinedString(i)&&(s.style.backgroundImage="url('"+i+"')"),this._show(e)},_setupReplay:function(){var t=uvpjs.util,e=this.css,i=e.REPLAY_BTN,s=this._previewImage,n=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),t.isDefinedString(s)&&(n.style.backgroundImage="url('"+s+"')"),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.BUFFERING_FRAME),this._show(e.CONTROLS),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var t=this._getClassName(this.css.BUFFERING_FRAME),e={lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:t,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(e).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(t){var e=this.css;this._containerId===t.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(t.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._disableButton(e.SETTINGS_BTN),this._disableButton(e.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._hasActive(e.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),t.payload.adData.isCustomClickTrackingUsed||this._disable(e.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(t){return this.vci.getContentVideoData().isLive&&!!t},_onAdEnd:function(t){this._containerId===t.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,t.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(t){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",t),this._captionsLoaded=!0,this._enableCaptions(),this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",t),this._isIOS||this._disableCaptions()},_onContentStart:function(t){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",t),this._containerId===t.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._captionsLoaded&&this._enableButton(e.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(e.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(e.PROGRESS)):this._isStreaming()&&this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._isIOS&&this._hasActive(e.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===t.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(t){var e="controlMute"===t.type;this._containerId===t.target&&this._updateVolumeUI(this._volumeSlider.value,e)},_onDiagCloseButton:function(t){this._containerId===t.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",t),this._menuSelections.debug=null)},_onResourceStart:function(t){(t&&t.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(t){var e=t.target,i=t.payload,s=0===i.playlistLength;this._containerId===e&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",t),this._hide(this.css.CONTROLS),this._enableReplay&&s?this._setupReplay():this._captionsLoaded=!1,this._resetProgressSlider())},_onVideoProgress:function(t){var e=t.payload,i=e.playbackState,s=this.vci.getVolume(),n=this.css.TIME_DURATION,a=this.css.TIME_CURRENT,r=!1,o,l;this._containerId===t.target&&(s!==Number(this._volumeSlider.value)&&this._updateVolumeUI(s),i!==this._playbackState&&(this._playbackState=i,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(e),i!==this.mc.PLAYING||this._isSliding||e.duration!==1/0&&(o=this._queryByElementName(n),l=this._queryByElementName(a),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&e.duration>=3600&&(this.durationChecked=r=!0):(this.durationChecked=!0,e.duration>=3600&&(r=!0)),r&&(l.parentNode.style.width="100px"),o.innerHTML=this._formatTimestampByType(n,e.duration),l.innerHTML=this._formatTimestampByType(a,e.currentTime),this._updateProgressUI(e)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(t){a.has(t,"target")&&this._containerId===t.target&&a.isObject(t)&&a.has(t,"payload.data")&&this._updateProgressLoad(t.payload.data)},_onVideoStateChange:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",t),a.isObject(t)&&this._containerId===t.target&&a.isObject(t.payload)&&a.isNumber(parseInt(t.payload.newState))&&(!this.ignoreVideoStateChange||e===this.mc.PAUSED||e===this.mc.PLAYING)){var e=t.payload.newState;e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),e===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(t,e,i){null!==t&&(this.isMonitoringMuting=t),e&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var t=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&t!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=t,t?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(t){var e=!1;switch(t.type){case"mouseenter":this._onUVPJSMouseEnter(t);break;case"mouseleave":this._onUVPJSMouseLeave(t);break;case"mousemove":this._onUVPJSMouseMove(t);break;case"mousedown":this._onUVPJSMouseDown(t);break;case"mouseup":this._onUVPJSMouseUp(t);break;case"click":this._showControlBar(t),e=!0;break;case"touchstart":this._onUVPJSTouchStart(t);break;case"touchend":this._onUVPJSTouchEnd(t),e=!0}!this._hasFirstTouch&&e&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(t)))},_getTargetInfo:function(t){var e=t.target;return{isVolumeButton:-1!==e.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==e.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(t){switch(t.type){case"input":case"change":this._onProgressSliderChange(t);break;case"touchstart":case"mousedown":this._onProgressSliderStart(t);break;case"touchend":case"mouseup":this._onProgressSliderEnd(t)}},_onVolumeSliderEvent:function(t){switch(t.type){case"input":case"change":this._onVolumeSliderChange(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onVolumeBtnEvent:function(t){switch(t.type){case"click":case"touchend":this._onVolumeBtnClick(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onUVPJSMouseEnter:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._showControlBar(t))},_onUVPJSMouseDown:function(t){t.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(this._touchStartTime=t.timeStamp,!this._previewCallbackDone)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet."));if(!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),t.target===this._progressSlider)){var s=t.target.getBoundingClientRect(),n=(t.pageX||t.targetTouches[0].pageX)-s.left;i=1-(t.target.clientWidth-n)/t.target.clientWidth,this._onProgressSliderChange(t,i)}},_onUVPJSTouchEnd:function(t){function e(){this._hasPaused()||(o=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}var i=this.css,s=this._isTap(t.timeStamp),n=[i.CLOSED_CAPTION_BTN,i.VOLUME_BTN,i.PLAYSTATE_BTN,i.SETTINGS_BTN,i.SETTINGS_MENU,i.SETTINGS_MENU_ITEM,i.SETTINGS_MENU_INPUT,i.LARGE_PLAY_BTN,i.FULLSCREEN_BTN],a=n.length,r=t.target.className,o,l,d,u;if(t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(!this._hasDisabled(i.CONTROLS)){for(;a--&&!(l=l||r.indexOf(n[a])>-1););if(this.shouldTrapTaps()&&l&&a<n.length-1)return t.stopPropagation(),t.preventDefault(),void this.handleTap(n[a],t);d=!(l||this._isTouchActive&&s),d&&t.preventDefault(),d&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),u=o||d?this.HIDE_DELAY:0,o&&clearTimeout(o),o=setTimeout(e.bind(this),u)}},handleTap:function(t,e){var i=this.css;if(!this._queryByElementName(t).hasAttribute("disabled"))switch(t){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(e);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(e);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(e);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(e);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(e);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(e)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(t){t.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(t){var e=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[e]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[e]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(t){this._isMouseActive||(this._clearMouseMoveInterval(t),this._removeModifier(t,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(t){t.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var t=this._containerEl.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(t){var e=this.vci,i=e.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(i?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(t){var e=parseFloat(t.target.value),i=this.vci.getPlayerMuted();i&&e>0&&this.vci.unMute(),this.vci.setVolume(e),this._updateVolumeUI(e,i)},_onFullscreenBtnClick:function(t){t.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),t.stopPropagation(),t.preventDefault(),this.ignoreVideoStateChange&&this._isLive())return void(this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()));var e=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",e),e===this.mc.PAUSED||e===this.mc.EMPTY||e===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();e!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())},_onPreviewBtn:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),this._isTouch&&!this._isTap(t.timeStamp))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback."));t.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),t.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),t.stopPropagation();var e=this.css.CLOSED_CAPTION_BTN;if(this._hasActive(e))return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),t.stopPropagation();var e=this.css.SETTINGS_MENU,i=this._hasHidden(e);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i)return this._addModifier(e,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(e);this._removeModifier(e,this.ACTIVE_MODIFIER),this._hide(e)},_onSettingsMenuBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",t);var e=t.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",e),t.target.parentNode.setAttribute("data-target",e);var i=this._findMenuItem(e);this._generateSettingsMenu(i.items,e)},_onSettingsMenuInputClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",t);var e=t.target,i=e.parentNode,s=i.getAttribute("data-target");switch(s&&s.split(":")[0]){case"cc":this._onSettingsCaptionsChange(t);break;case"controls":this._onSettingsControlsChange(t);break;case"debug":this._onSettingsDiagWindowChange(t)}},_onSettingsCaptionsChange:function(t){var e=t.target,i=e.parentNode,s=e.getAttribute("data-property"),n=e.getAttribute("data-value").toLowerCase();if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",s,n),a(i.children).each(function(t){t.setAttribute("data-selected","false")}.bind(this)),e.setAttribute("data-selected","true"),"text-position"===s)return void this._setCCPosition(n);this.vci.setCaptionsStyleProperty(s,n)},_onSettingsControlsChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",t);var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value").toLowerCase(),n="#"+this._containerId+" ";if("background-opacity"===i){i="background-color";var a=this._queryByElementName(this.css.CONTROL_BAR),r=getComputedStyle(a).getPropertyValue(i);if(-1===r.indexOf("rgba"))return;s=r.split(",").slice(0,-1).join(",")+", "+s+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",s),n+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(n,i,s)},_onSettingsDiagWindowChange:function(t){var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value"),n="true"===e.getAttribute("data-selected"),a=!n;this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",t),this._menuSelections[i]=s,e.setAttribute("data-selected",a),a?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",t),this.vci.setCaptionsStyle(t))},_setCaptionsStyleProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",t,e),this.vci.setCaptionsStyleProperty(t,e))},_setCueProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",t,e),this.vci.setCaptionsCueProperty(t,e))},_setCCPosition:function(t){var e="text-position";!this._isIOS&&this._captionsLoaded&&(t=t||this._getCaptionsStyle()[e],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",e,t),this.vci.setCaptionsStyleProperty(e,t))},_showControlBar:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(a.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(t){this._hasHidden(this.css.SETTINGS_MENU)||t.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(t){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=a.debounce(function(){if(this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch)return void this._hideControlBar.hide.cancel();this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS)},t||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(t){var e=this.css,i;this._hasDisabled(e.VOLUME_BTN)||this._hasDisabled(e.CONTROLS)||(this._hasActive(e.SETTINGS_MENU)&&this._hide(e.SETTINGS_MENU),this._setDataAttribute(this._containerEl,e.VOLUME_SLIDER,!0),this._addModifier(e.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(e.VOLUME_SLIDER))},_hideVolumeSlider:function(t){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._hasModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER)&&this.vci.showCaptions())},_disableCaptions:function(){this._isIOS||(this._disableButton(this.css.SETTINGS_BTN),this._disableButton(this.css.CLOSED_CAPTION_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),a.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(t,e){var i=uvpjs.util,s=this._containerEl,n=this.vci.getPlayerMuted(),a;!0===n?a="mute":t>.85?a="full":i.inRange(t,.5,.85)?a="high":i.inRange(t,.15,.5)?a="medium":i.inRange(t,0,.15)&&(a="low"),this._volumeSlider.value=t||this._videoEl.volume,this._setDataAttribute(s,"volume-level",a),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,t)},_onProgressSliderChange:function(t,e){var i=this.vci.getContentVideoData(),s=this.vci.getCurrentPlaybackState(),n=this.css.TIME_CURRENT,a=this._queryByElementName(n),r=e||this._progressSlider.value,o,l;r=r>1?1:r<0?0:r,o=Math.ceil(r*i.duration*1e4)/1e4,l=Math.abs((s.currentTime-o)/o),this._updateProgressSlider(r),a.innerHTML=this._formatTimestampByType(n,o),this._hasActive(this.css.PROGRESS_SLIDER)||l<=.02||this.vci.seekTo(o)},_onProgressMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(t){var e=this.css;if(this._hasAd()||this._hasDisabled(e.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._addModifier(e.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(t){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(t)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(t){var e,i;this._isLive()||(e=Math.ceil(t.bufferLength/t.duration*1e4)/1e4,a.isNaN(e)||e===1/0||e<=0||(this._downloaded=e,this._hasAd()||(i=this._queryByElementName(this.css.PROGRESS_LOADED),i.value=this._downloaded)))},_updatePlaybackStateUI:function(t){var e=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",t),t){case this.mc.PLAYING:this._show(e.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(e.PROGRESS);break;case this.mc.PAUSED:this._show(e.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(e.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(e.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(e.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(e.CONTROLS),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.LARGE_PLAY_BTN),this._show(e.BUFFERING_FRAME)}},_updateProgressUI:function(t){var e=Math.ceil(t.currentTime/t.duration*1e4)/1e4;this._updateProgressSlider(e)},_updateSliderUI:function(t,e,i){var s=this,n={};if(!a.isUndefined(this._vendorPrefix)&&!a.isUndefined(t)){if(n.id="#"+this._containerId,n.cls=s._getClass(e),n.pseudo={moz:"::-moz-range-track",
webkit:"::-webkit-slider-runnable-track"}[s._vendorPrefix],this._isMSEdge&&(n.pseudo=""),n.add=function(t,e,i){if(!a.isUndefined(this.pseudo)){var n=this.id+(e||"")+" "+this.cls+(i||"")+this.pseudo;s._addCSSRule(n,"background-size",100*t+"% 100%")}},n.before=function(t,e){var i=s._getClass(s.PRIMARY_BLOCK);e&&(i+=s._getClass(s.PRIMARY_BLOCK,e)),this.add(t,i,null)},n.after=function(t,e){this.add(t,null,e)},e===s.css.VOLUME_SLIDER)return void n.add(i);var r=i*t.offsetWidth,o=(.5-i)*t.offsetHeight,l=r/t.offsetWidth,d=(r+o)/t.offsetWidth;t.value=i;var u=s._hasAd();n.before(l,u?s.AD_MODIFIER:null),this._isTouch&&n.before(d,s.TOUCH_MODIFIER)}},_checkControlOnDOM:function(t){var e=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t;return!!this._controlCache[e]},_getClassName:function(t,e){var i=this.PRIMARY_BLOCK;return t!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+t),e&&(i+=this.ELEMENT_MODIFIER_DELIMITER+e),i},_getClass:function(t,e){return this.CLASS_SELECTOR_PREFIX+this._getClassName(t,e)},_queryByClassName:function(t){var e,i;if(this._containerId)return e=this.ID_SELECTOR_PREFIX+this._containerId,t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),i=this._controlCache[e]||document.querySelector(e),i&&(this._controlCache[e]=i),i},_queryAllByClassName:function(t){var e=this.ID_SELECTOR_PREFIX+this._containerId;return t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),document.querySelectorAll(e)},_queryByElementName:function(t){return this._queryByClassName(this._getClassName(t))},_queryAllByElementName:function(t){return this._queryAllByClassName(this._getClassName(t))},_show:function(t){if(t===this.css.PROGRESS&&!this._isLive()){var e=this._queryByElementName(t),i=e.querySelector("input"),s=e.querySelector("progress");e&&(e.style.display="block"),i&&(i.style.display="block"),s&&(s.style.display="block")}this._removeModifier(t,this.HIDDEN_MODIFIER)},_hide:function(t){if(t===this.css.PROGRESS){var e=this._queryByElementName(t),i=e.querySelector("input"),s=e.querySelector("progress");e&&(e.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="none")}this._addModifier(t,this.HIDDEN_MODIFIER)},_enable:function(t){this._removeModifier(t,this.DISABLED_MODIFIER)},_disable:function(t){this._addModifier(t,this.DISABLED_MODIFIER)},_enableMenuItem:function(t){var e;t&&(e=this._findMenuItem(t))&&(e.enabled=!0)},_hasHidden:function(t){return this._hasModifier(t,this.HIDDEN_MODIFIER)},_hasActive:function(t){return this._hasModifier(t,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(t){return this._hasModifier(t,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.PLAYING},_isStreaming:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.STREAMING},_hasModifier:function(t,e){a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var s=this._getClassName(t,e),n=this._queryByElementName(t);return!!n&&i(n,s)},_addModifier:function(t,i){a.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var s=this._getClassName(t,i),n=this._queryByElementName(t);n&&e(n,s)},_removeModifier:function(t,e){var i=this._queryByElementName(t),n;a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER)),n=this._getClassName(t,e),i&&s(i,n)},_toggleModifier:function(t,e){a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var i=this._getClassName(t,e),s=this._queryByElementName(t);s&&n(s,i)},_setDataAttribute:function(t,e,i){t.setAttribute("data-"+e,i)},_removeDataAttribute:function(t,e){t.removeAttribute("data-"+e)},_formatTimestamp:function(t){var e,i;return uvpjs.util.isEmpty(t)||t===1/0?this.NULL_TIME:(isNaN(t)&&(t=0),e=new Date(null),e.setSeconds(Math.round(t)),i=e.toISOString(),t>=3600?i.substr(11,8):i.substr(14,5))},_formatTimestampByType:function(t,e){if(void 0===e||e<0){if(t===this.css.TIME_DURATION)return this.NULL_TIME;if(t===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(e)},_addCSSRule:function(t,e,i){var s=this._styleEl.sheet,n=s.cssRules.length,r=this._cssRules[t];if(!a.isUndefined(r)){var o=s.rules||s.cssRules;if(o.length>0&&o[r])return void(o[r].style[e]=i)}this._cssRules[t]=n,uvpjs.util.addCSSRule(this._styleEl,t,e,i)},_setStyleSheet:function(t){var e=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(i){this._styleEl=i,e||"function"!=typeof t||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),e=!0,t())}.bind(this))},_templateToHTML:function(t){function e(t){var n="";return a(t).each(function(t){t&&("CLOSED_CAPTION_BTN"!==t.el&&"SETTINGS_BTN"!==t.el||!r)&&(t.cls=a.isUndefined(t.cls)?i(t.el):[t.cls,i(t.el)].join(" "),t.children&&(t.children=e(t.children)),n+=a.template(s[t.type],{variable:"o"})(t))}),n}if(a.isArray(t)&&!a.isEmpty(t)){var i=function(t){return this._getClassName(this.css[t]||t)}.bind(this),s=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},n=this,r=this._isIOS;return e(t)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(t){return!!this._touchStartTime&&t-this._touchStartTime<this.TAP_THRESHOLD}}),i=function(t,e){return!a.isNull(t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)")))},e=function(t,e){i(t,e)||(t.className=(t.className+=" "+e).trim())},s=function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},n=function(t,n){if(i(t,n))return void s(t,n);e(t,n)}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(t,i,s,n){if(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",s)),!e.isArray(i))return void(this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN"));this.vidContId=t,this._generateAdPods(i,s,n)},_generateAdPods:function(t,e,i){var s=e.length,n,a,r,o=function(t,e,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:t,adCount:0,podDuration:0,adCallURL:e}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",e)),this.adPods={},s>0&&(e.indexOf(0)>-1&&(this.adPods[this.PRE]=o(this.PRE+"_0",i)),e.indexOf(-1)>-1&&(this.adPods[this.POST]=o(this.POST+"_0",i))),n=0;n<s;n++)a=0===e[0]?n:n+1,r=e[n],isNaN(r)||0===r||-1===r||(this.adPods[this.MID_+a]=o(this.MID_+a,i,r));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",t),e.isString(t)){var i=this.adPods[t];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var t=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",t),t},getMidRollPods:function(){var t=[],e;if(!this.midRollPods){t=[];for(e in this.adPods)e.indexOf(this.MID)>=0&&t.push(this.adPods[e]);this.midRollPods=t}return this.midRollPods},isPreRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.MID)>-1},isPostRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var t in this.adPods)if(t.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(t){var e=null,i="No eligible ad pod found.",s,n,a;for(a in this.adPods)this.adPods.hasOwnProperty(a)&&(s=this.adPods[a],this.isPreRoll(s)||this.isPostRoll(s)||s.startTime<=t&&(e?t-s.startTime<t-e.startTime&&(e=s):e=s));return e&&(n=e.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",i="Found Ad pod; adPodId = "+e.adPodId+"; "+n),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+t+";  "+i),e}})}(uvpjs.register("uvpjs")),function(t){var e=t._,s;t.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",SEGMENT_MODULE_NAME:"Segment",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,t&&this.initialize(t.vidContId,t.cviMgr)},destroy:function(){for(var t=this.agents.length,e;t--;)this.agents[t]&&"function"==typeof this.agents[t].destroy&&this.agents[t].destroy(),this.agents.splice(t,1);for(e in this.eventCBs)this.eventsMgr.removeEventListener(e+this.internalNS+".agent"),delete this.eventsMgr[e];for(e in this.progressEvents)delete this.progressEvents[e];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),e.isString(t)&&e.isObject(i)&&(this.vidContId=t,this.eventsMgr=i.getEventsMgr(),this.cviModel=i.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._createAgentsArray(),this._addTrackingEventListeners(),this._initializeAgents())},hasTrackingConfigOverrides:function(t){return null!==t&&t.hasOwnProperty("trackingConfigOverrides")&&null!==t.trackingConfigOverrides},getAgentConfig:function(t,e){for(var i=null,s=t.length;s-- >0;){var n=t[s];if(n.name===e){i=n;break}}return i},doTrackingConfigOverrides:function(t){if(!this.hasTrackingConfigOverrides(t))return void(this.agentConfigs=t.getModules().slice(0));for(var e=t.getModules().slice(0),i=e.length;i-- >0;){var s=e[i],n=this.getAgentConfig(t.trackingConfigOverrides,s.name);null!==n&&(e[i]=n)}this.agentConfigs=e},isTrackingAgentEnabled:function(t){var e=this.getAgentConfig(this.agentConfigs,t),i=this.mc.systemInfo.trackingAvailability,s=!1,n;for(n in uvpjs.tracking)if(uvpjs.tracking[n]===t&&i[n]){s=!0;break}return this.debug&&e&&e.enabled&&!s&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",e,i),null!==e&&e.enabled&&s},_createAgentsArray:function(t){var e,i,s,n,a,r,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=t||this.cviModel,this.doTrackingConfigOverrides(i),this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),n=i.isModuleEnabled.bind(i),a=i.isModuleSet.bind(i),s={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr},o=this.getPlayerName(),this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),s.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,s.playerName=o,e=new uvpjs.AdobeHeartbeatAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),s.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,e=new uvpjs.AkamaiAnalyticsAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),s.moduleName=this.COMSCORE_SS_MODULE_NAME,s.playerName=this.getPlayerName("|","_"),e=new uvpjs.ComScoreAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),s.moduleName=this.CONVIVA_MODULE_NAME,s.playerName=o,e=new uvpjs.ConvivaAgent(s),this.agents.push(e)),r=n(this.DW_MODULE_NAME),(r||n(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),s.moduleName=r?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,s.playerName=this.getPlayerName(";"),e=new uvpjs.DWAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),s.moduleName=this.NIELSEN_MODULE_NAME,s.playerName=o,e=new uvpjs.NielsenAgent(s),this.agents.push(e)),a(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var l=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);s.moduleName=this.MUX_MODULE_NAME,s.playerName=this.PLAYER_NAME_ONLY,s.playerVersion=this.PLAYER_VERSION_ONLY,s.useDefaultProperty=!l("propertyKey"),e=new uvpjs.MuxAgent(s),this.agents.push(e)}var d=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(d&&d.params&&d.params.length>0)for(var u=d.params.length;u-- >0;)this.beaconEndPoint[d.params[u].name]=d.params[u].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(s.moduleName=this.OZTAM_MODULE_NAME,s.playerName=o,s.playerVersion=this.PLAYER_VERSION_ONLY,e=new uvpjs.OzTamAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.SEGMENT_MODULE_NAME)&&(s.moduleName=this.SEGMENT_MODULE_NAME,s.playerName=o,s.playerVersion=this.PLAYER_VERSION_ONLY,e=new uvpjs.SegmentAgent(s),this.agents.push(e))},_addTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.RESOURCE_START+i,this._onResourceStart.bind(this)),t.addEventListener(e.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_QUARTILE+i),t.removeEventListener(e.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),e.isEmpty(this.agents))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."));for(var t=this.agents.length;t--;)this.agents[t].initialize();this._addAgentEventListeners()},fireTrackingPixel:function(t){var e=document.createElement("img");e.setAttribute("src",t),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("border","0"),e.style.position="absolute",e.style.bottom="0",e.style.right="0",this._beaconElement.appendChild(e)},registerEventCallbacks:function(t){if(e.isPlainObject(t)&&!e.isEmpty(t))for(var i in t)this.eventCBs[i]=this.eventCBs[i]||[],this.eventCBs[i].push(t[i])},registerProgressEvents:function(t){if(e.isPlainObject(t)&&!e.isEmpty(t))for(var i in t)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",i),this.progressEvents[i]=this.progressEvents[i]||[],this.progressEvents[i].push(t[i])},getContentPlayhead:function(){var t=this.cviModel.contentPlaybackState.currentTime;return parseInt(t)},getPlayerName:function(t,i){var s=this.PLAYER_NAME;return e.isEmpty(s)?"UVPJS":(t&&(s=s.replace("_",t)),i&&(s=s.replace(/\./g,i)),s)},getAdLength:function(){return this._adLength=s(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=s(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var t in this.eventCBs)this.eventsMgr.addEventListener(t+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(t){if(t.target===this.vidContId){var i=this.eventCBs[t.type],s;if(!e.isEmpty(i)){s=i.length;for(var n=0;n<s;n++)i[n](t)}}},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(t){var s=this.progressEvents[t],n;if(!e.isEmpty(s))for(n=s.length,i=0;i<n;i++)s[i]()},_onPlaybackDurationResume:function(e){var i=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),s=this.cviModel.getContentVideoState(),n={ts:Math.floor(Date.now()/1e3),contentid:s.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:i("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:s.isPaidContent,affiliate:s.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},a=(new t.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(n).devMode(this.debug).buildUrl();this.fireTrackingPixel(a)},_onVideoProgress:function(t){var i=t.payload,s=Math.floor(i.currentTime),n=i.duration,a;if(s&&n&&!i.isAd&&!(this._lastContentSecondCompleted>=s)){if(this._lastContentSecondCompleted=s,s%15==0&&s<=60||s%60==0){if(this._contentTimeFired[s])return;this._contentTimeFired[s]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",s),this._onProgressEvent(this.progressEvents.TIMED)}i.isPlayingLive||n<=10||(a=Math.floor(s/n*100),a!==this.percentDone&&(this.percentDone=a),e.inRange(a,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),e.inRange(a,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),a>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),s=function(t,e){var i=1e3,s=e>0?Math.floor(1e3*e):0;return uvpjs.util.inRange(t,s-1e3,s+1e3)?t:s}}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i,s,n,a,r;r=t._,t.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata={},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),r.isUndefined(this._visitorData.marketingCloudOrgId))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."));this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(t,e){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),!r.isFunction(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!"));i=e?e.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),this._usesTealium=i.usesTealium;var s=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),s=r.without(s,this.scriptPaths.APP_MEASUREMENT)),n()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(s,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var t=this._qosObject;return e.createQoSObject(t.bitrate,t.startupTime,t.fps,t.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),e=t(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=t(this.TRACKING_SERVER_PARAM_NAME);this.mc.isSecure()&&(r.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),r.isString(e)&&(e=e.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:t(this.ACCOUNT_PARAM_NAME),charSet:t(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:t(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:e},this._visitorData={marketingCloudOrgId:t(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var t=this.cviModel.sessionOptions;this._usesTealium=t.usesTealium;var e={ftag:"ftag",netwk:"Network"};r.each(e,function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",e,i);var s=t[i];r.isNull(s)||r.isUndefined(s)||r.isEmpty(s)||(this._sessionMetadata[e]=s)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_POD_END]=this._onAdPodEnd.bind(this),e[t.AD_CLICK]=this._onAdClick.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),e[t.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),e[t.PLAYER_LOADED]=this._updateVideoInfo.bind(this),e[t.RESOURCE_START]=this._updateVideoInfo.bind(this),e[t.VIDEO_RESUME]=this._updateVideoInfo.bind(this),e[t.VIDEO_DONE]=this._updateVideoInfo.bind(this),this._contextMetadataCBSetup||(e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(e)},_setupContextMetadataEventCallback:function(){var t={};t[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function t(t){this._agent=t}var o,l,d,u,h;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),n())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded."));if(this._mediaHeartbeat)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used."));if(e=ADB.va.MediaHeartbeat,i=ADB.va.MediaHeartbeatConfig,s=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!a(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)l=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(o=this._appMeasurementData.account,r.isString(o)&&r.isEmpty(o))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));h=new Visitor(this._visitorData.marketingCloudOrgId),h.trackingServer=this._visitorData.trackingServer,h.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),l=new AppMeasurement(o),l.visitor=h,l.account=o,l.trackingServer=this._appMeasurementData.trackingServer,l.pageName=this._appMeasurementData.pageName,l.charSet=this._appMeasurementData.charSet,l.visitorID=this._appMeasurementData.visitorID}if(r.isNull(l))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."));d=new i,d.trackingServer=this._heartbeatData.trackingServer,d.playerName=this._playerName,d.channel=this._heartbeatData.channel,d.debugLogging=this._heartbeatDebug,d.appVersion=this.SDK_VERSION,d.ssl=this.mc.isSecure(),d.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",d),r.extend(t.prototype,s.prototype),t.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},t.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new e(new t(this),d,l),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad()},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),
a(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),r.has(window,"s")&&a(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(t,i){if(r.isNull(this._mediaHeartbeat))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined"));switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",t),t){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(e.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(e.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(e.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(e.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(e.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(e.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(i)}},_getContentVideoMetadata:function(){var t=this.cviModel.getContentVideoState(),e=this._contextMetadata,i=this._sessionMetadata,s={},n,a;for(n in e)e.hasOwnProperty(n)&&(s[n]=e[n]);for(n in i)i.hasOwnProperty(n)&&(s[n]=i[n]);if(t.contextMetadata){a=t.contextMetadata;for(n in a)a.hasOwnProperty(n)&&(s[n]=a[n])}return s.tl=t.videoTitle,s.mediaAutoPlay=this.cviModel.isAutoplay.toString(),s.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),s.mediaIsPaidContent=t.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",s),s},_onContextMetadata:function(t){var e=t.payload.contextMetadata,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",t),!r.isEmpty(e)&&(this._contextMetadata=e,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),r.isEmpty(e[this.PAGE_REPORT_SUITE_ID_KEY]),i=e[this.PAGE_SITE_ACCOUNT_KEY],!r.isEmpty(i))){var s=r.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=i,s&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+i),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(t){var i=t.chapterStartTimes,s=i&&i.length||0,n=parseInt(t.currentContentSegment),a,r,o,l,d;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",t),isNaN(n)&&(n=1),a=n<0?0:n-1,r=a<=0?0:i[a],o=a+1>s?t.duration:i[a+1],d=o-r,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",o,r),l={},l.name="",l.length=isNaN(d)?0:d,l.position=n,l.startTime=i[a],this._chapterObject=e.createChapterObject(l.name,l.position,l.length,l.startTime),this._chapterInfo=l,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(t){var i,s,n,a,o,l;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",t),l=t.payload.adData,o=l.adClipID.split("_"),a=o[0],"pre"===a?n=1:"mid"===a?n=parseInt(o[1])+1:"post"===a&&(n=this.cviModel.getNumberOfAdPods()),s={},s.name=r.isEmpty(l.adVideoTitle)?"na":l.adVideoTitle,s.position=n,s.playerName=this._playerName,s.startTime=this.getCurrentPlaybackTime(),i={},i.id=r.isEmpty(l.adVideoId)?r.isEmpty(l.adVatId)?"na":l.adVatId:l.adVideoId,i.name=s.name,i.length=l.duration,i.position=l.adPosition,this._adObject=e.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=e.createAdBreakObject(s.name,s.position,s.startTime),this._adInfo=i,this._adBreakInfo=s,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(t){var e=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(e)},_onAdClick:function(t){var e=!0===t.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),e&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(t){var e=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",e),this._contentStarted=!0,this._sendInitialPlay(),e.chapterStartTimes.length>0&&(this._setChapterInfo(e),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(t){var e=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",e),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&e.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(t){var e=this._videoInfo,i=this._contentStarted&&e&&Math.ceil(e.playhead)>=.95*e.length;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(t){var e=t.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",e),this._videoLoaded&&(this._isBuffering||e!==this.mc.BUFFERING?this._isBuffering&&e!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),e===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&e===this.mc.PAUSED&&this._onControlPause(t))},_updateVideoInfo:function(){var t=this.cviModel.getCurrentPlaybackState(),i=this.cviModel.getContentVideoState(),s=e.StreamType,n=i.duration,a=i.isLive,o=i.episodeFlag,l={},d;r.isEmpty(i.cmsRefGuid)?r.isEmpty(i.mediaId)?r.isEmpty(i.pid)?r.isEmpty(i.assetURL)?l.id="na":l.id=i.assetURL:l.id=i.pid:l.id=i.mediaId:l.id=i.cmsRefGuid,l.name=i.videoTitle,l.playerName=this._playerName,l.length=a?-1:isNaN(n)?0:n,l.playhead=t.currentTime,a?d=s.LIVE:(d=s.VOD,d+=":"+(o?this.FULL_EPISODES:this.CLIPS)),l.streamType=d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",e),this._mediaObject=e.createMediaObject(l.name,l.id,l.length,l.streamType),this._videoInfo=l,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(t){var e=t&&t.facadeState,i=this._qosObject;e&&i&&(i.bitrate=e.currentBitrate||0,i.droppedFrames=e.droppedFrames||0,i.fps=e.playbackFramerate||0)},_updatePlayhead:function(t){var e=t.payload;this._videoInfo&&e&&(e.isAd||(this._updateQosObj(e),this._videoInfo.playhead=e.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)}}),n=function(){return"undefined"==typeof ADB||"undefined"===r.get(ADB,"va.Heartbeat")},a=function(t){return r.isObject(t)&&!r.isEmpty(t)&&r.isFunction(t.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(t){var e=t._,i,s=function(t){return(t>0&&t<10?"0":"")+t.toString()},n="3005086",a="*null",r={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};t.ComScoreAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:t("c2")||"3005086",ns_st_pu:t("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.RESOURCE_START]=this._onResourceStart.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),e[t.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){if(i())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."));this._setupEventCallbacks()},_createStreamingTag:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",t),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(t)},_getContentMetadata:function(){var t=this.cviModel.getContentVideoState(),e=this.cviModel.getContentPlaybackState(),i=uvpjs.util,n=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),a=this.cviModel.getContentVideoState().isLive,o=parseInt(t.episodeNumber),l=parseInt(t.seasonNumber),d=t.seriesTitle,u=t.videoTitle,h=u&&u.split("-")[1],c=!isNaN(o),p=!isNaN(l),v=null!==t.contextMetadata&&t.contextMetadata.comscore_c4,g=u,f,m;return c&&p&&(f=s(o),m=s(l),g+="--"+m+f),{ns_st_ci:i.getDefinedString(t.cmsRefGuid,t.mediaId,"0"),ns_st_cl:a?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[r.publisherBrand],ns_st_pr:i.getDefinedString(t.seriesTitle,t.videoTitle),ns_st_ep:h,ns_st_sn:p&&m||"*null",ns_st_en:c&&f||"*null",ns_st_ge:t.category||"*null",ns_st_ia:a?1:0,ns_st_ddt:"*null",ns_st_tdt:"*null",ns_st_st:n("c4")||"*null",ns_st_ce:t.episodeFlag?1:0,c3:n("c3")||this._playerName,c4:v||n("c4")||"*null",c6:n("c6")||g}},_onAdStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",t),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",t),this._isAd=!1,this._trackStop()},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",t);var e=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?e.Live:e.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",t),this._trackStop()},_onControlPlay:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",t),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",t),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",t),this.streamingTag=null},_onLiveSegmentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",t),this._isLiveEvent(t)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=t.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",t),this._trackStop()},_onVideoProgress:function(t){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",t);var e=t.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(e===this._mc.PAUSED?this._onControlPause(t):e===this._mc.PLAYING&&this._onControlPlay(t))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=t.util.copyObjectWithKeyMap(r).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(t){return this.cviModel.getContentVideoState().isLive&&t.payload&&t.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof t.payload.liveSegmentData},_isSameLiveStation:function(t){return t.stationTitle===this._contentMetadata[r.stationTitle]},_getAdType:function(){var t=ns_.ReducedRequirementsStreamingAnalytics.AdType,e=this.cviModel.getAdVideoState().adClipID.split("_")[0],i;return i="pre"===e?t.LinearOnDemandPreRoll:"mid"===e?t.LinearOnDemandMidRoll:t.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(i=t.LinearLive),i}}),i=function(){return"undefined"==typeof ns_||e.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(t){"use strict";t.ConvivaAgent=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",t),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0===window.Conviva)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded."));var t=this.eventTypes,e=this.adEventHandlerMap={};e[t.AD_POD_START]=this.hPodStart.bind(this),e[t.AD_POD_END]=this.hPodEnd.bind(this),e[t.AD_LOADED]=this.hAdLoaded.bind(this),e[t.AD_START]=this.hAdStart.bind(this),e[t.AD_END]=this.hAdEnd.bind(this),e[t.AD_ERROR]=this.hAdError.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))},_getAdType:function(t){var e="string"==typeof t?t.toLowerCase():null,i=Conviva.Client.AdPosition,s=uvpjs.ConvivaAgent.adPositions;return e?e.indexOf(s.PRE)>=0?i.PREROLL:e.indexOf(s.MID)>=0?i.MIDROLL:e.indexOf(s.POST)>=0?i.POSTROLL:void 0:i.PREROLL},_getArgsForStartAd:function(t){var e=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,s="ima"==t.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(t.adType),stream:s?e.SEPARATE:e.CONTENT,player:s?i.SEPARATE:i.CONTENT}},_onAdEvent:function(t){var e=t.type;this.startEvents.content=0,this.hasConvivaSession||e===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[e](t.payload,t)},hPodStart:function(t,e){this.podCount++,this._onContentPaused(e),this.currAdPodInfo=this._buildAdPodInfo(t.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var i=this._getArgsForStartAd(t);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(i.key,i.stream,i.player,i.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",i),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(t,e){var i=this._buildAdInfo(t);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,i),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(t,e){this.adPodInProgress&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(t,e){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(t,e){var i=this.currAdPodInfo||{},s=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(s)||s===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(t,e){var i=t.errorInfo;this.hasConvivaAdSession?(this._sendError(i.message,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",i)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",i)},_onContentEvent:function(t){var e=!1;this.startEvents.ad=0,t.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),e=!0):t.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,e=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),e&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(t){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",t),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*t.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(t){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",t),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(t){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",t),this._onContentPlaying(t),this.isSeekDone=!1)},_onVideoEvent:function(t){var e=this.eventTypes;switch(t.type){case e.VIDEO_STATE_CHANGE:var i=t.payload.newState,s=this._getMediaCapabilities();this.hasConvivaAdSession?i===s.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(t):i===s.PAUSED&&this._onAdPaused(t):this.hasConvivaSession&&(i===s.PLAYING?this._onContentPlaying(t):i===s.PAUSED?this._onContentPaused(t):i===s.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(t));break;case e.VIDEO_TRANSITION_COMPLETE:case e.VIDEO_DONE:this._onVideoTransition(t);break;case e.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(t){var e=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(t.payload.cdn,""),this.convivaClient.updateContentMetadata(e,i)},_onError:function(t){var e=t.payload.errorInfo;e.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(e.message,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(e.message,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(t){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",t),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(t){var e=t.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(e>0&&(e*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",e),this.convivaPlayerStateManager.setBitrateKbps(e))},_createConvivaSession:function(){if(this.convivaClient){var t=this.cviModel,e=this._getMediaCapabilities(),i=Conviva.PlayerStateManager.PlayerState,s={userId:t.getSessionOption("userId"),userPPID:t.getSessionOption("userPPID"),userStatus:t.getSessionOption("userStatus")},n=new Conviva.ContentMetadata;this._setContentMetadata(n,s),this.convivaSessionKey=this.convivaClient.createSession(n),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(t,e){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",t,e),this.convivaClient&&this.convivaClient.sendCustomEvent(i,t,e)},_sendError:function(t,e,i){if(this.hasConvivaSession){var s="";!0===i?(s=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,t,e)):this.convivaPlayerStateManager.sendError(t,e),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+s+" ERROR: "+t)}},_setConvivaPlayerState:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",t),this.convivaPlayerStateManager.setPlayerState(t))},_setContentMetadata:function(t,e){var i=this.cviModel,s=Conviva.ContentMetadata.StreamType,n=i.contentVideoState,a=n.defaultBitrate;t.applicationName=this.playerName,t.assetName=this._validateStr(n.videoTitle,"N/A"),t.defaultBitrateKbps=a&&a>0?a:700,t.defaultResource=this._validateStr(n.cdn,""),t.duration=n.duration,t.streamType=n.isLive?s.LIVE:s.VOD,t.streamUrl=this._validateStr(n.assetURL,"N/A"),t.viewerId=this._validateStr(e.userId,"N/A"),t.custom={accessType:this._validateStr(e.userStatus,"anon"),contentId:this._validateStr(n.cmsRefGuid,"N/A"),contentType:n.isLive?"Live":"VOD",isEpisode:n.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(n.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._validateStr(n.episodeTitle,n.videoTitle),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:n.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(n.drm),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getWinDimension:function(){var t=this.cviModel.contentVideoState.sourceWidth,e=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(t=window.screen.width),window.screen.height&&(e=window.screen.height)),t+"x"+e},_createConvivaClient:function(){var t=this._getConvivaClientSettings();return t?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(t,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var t=this.moduleParams,e;return this._isValidStr(t.customerKey)&&this._isValidStr(t.serviceUrl)?(e=new Conviva.ClientSettings(t.customerKey),e.heartbeatInterval=t.heartbeatInterval||this.defaultHeartbeatInterval,e.gatewayUrl=t.serviceUrl,e):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(t){var e="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;t.allowUncaughtExceptions=e,t.logLevel=e?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var t=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),e=new Conviva.SystemSettings;return this._setConvivaSystemProps(e),new Conviva.SystemFactory(t,e)},_buildAdPodInfo:function(t){var e={},i=uvpjs.ConvivaAgent.adPositions,s,n,a,r,o,l;return t?(void 0!==t.podDuration&&(e.podDuration=String(t.podDuration)),t.adPodId?(s=t.adPodId.split("_"),n=s[0].toLowerCase(),a=n.charAt(0).toUpperCase()+n.slice(1),l=String(t.imaPodIndex+1),
e.podPosition=a+"-roll",e.podIndex=this.podCount,e.absoluteIndex=l,e):e):null},_buildAdInfo:function(t){var e=new Conviva.ContentMetadata,i=t.adData,s=t.imaAdData,n=this.cviModel.getSessionOption("partner");if(!t)return null;e.adTitle="("+i.adVideoId+")"+i.adVideoTitle,e.assetName=e.adTitle,e.adClipId=this._validateStr(i.adClipID,"N/A"),e.Partner_ID=this._validateStr(n,"N/A"),e.adServerName=this._validateStr(i.adServerName,"N/A"),e.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),e.duration=i.duration,e.streamType=Conviva.ContentMetadata.StreamType.VOD;var a=i.adType;return e.custom={"c3.ad.technology":"Client Side","c3.ad.id":s.adId,"c3.ad.system":s.adSystem,"c3.ad.position":a.charAt(0).toUpperCase()+a.substr(1)+"roll","c3.ad.mediaFileApiFramework":s.apiFramework,"c3.ad.sequence":s.adPodInfo.adPosition,"c3.ad.creativeId":s.creativeId,"c3.ad.advertiser":s.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",e),e},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_isDynamicStreaming:function(t){var e=t.split("?");return"mp4"===e[0].substr(e[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var t=this.cviModel,e=t.getModule(this.moduleName),i=e.params,s=i.length,n={},a;s--;)a=i[s],n[a.name]=a.value;this.moduleParams=n},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onAdEvent.bind(this),s=this._onContentEvent.bind(this),n=this._onVideoEvent.bind(this),a=this._onError.bind(this);e[t.AD_POD_START]=i,e[t.AD_LOADED]=i,e[t.AD_START]=i,e[t.AD_END]=i,e[t.AD_POD_END]=i,e[t.AD_ERROR]=i,e[t.CONTENT_DATA_LOADED]=s,e[t.CONTENT_START]=s,e[t.CONTENT_END]=s,e[t.VIDEO_STATE_CHANGE]=n,e[t.VIDEO_TRANSITION_COMPLETE]=n,e[t.VIDEO_DONE]=n,e[t.RESOURCE_END]=n,e[t.PLAYER_START_ERROR]=a,e[t.VIDEO_START_ERROR]=a,e[t.VIDEO_PLAYBACK_ERROR]=a,e[t.CDN_UPDATED]=this._onCdnUpdated.bind(this),e[t.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),t.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(t){"use strict";t.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",t),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var t=this.cviModel,e=this._metadata,i=t.sessionOptions.partner,s=t.getModule(this._moduleName),n=s.params,a=n.length,r={},o,l,d;for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");a--;)o=n[a],""!==o.value&&(r[o.name]=o.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:r[this.NIELSEN_SFCODE_PARAM_NAME],apid:r[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:r[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},i){case"chow":l="us-700144",d="c06";break;case"tvcom":l="us-200330",d="c03";break;case"cbs":case"can":l="us-700144",d="c01";break;case"cbssports":case"cbssports_test":l="us-201669",d="c02";break;case"news":l="us-700144",d="c03";break;case"gamespot":l="us-200330",d="c13";break;case"cnettv":l="us-200330",d="c05";break;default:l="us-700144",d="c01"}e.ci=r.clientid||l,e.c6=r.vcid||d,e.iag_sid=r.iag_sid,e.iag_tfid=r.iag_tfid,e.channelName=r.channelName,e.segB=r.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",r,e)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){if(e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."));this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams),this._setupEventCallbacks()},_notifySDK:function(t,e){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",t,e),this._gg.ggPM(t,e))},_onContentDataLoaded:function(t){var e=uvpjs.mediaCapabilities.isMobile(),i=this._metadata,s=t.payload,n,a,r,o,l,d,u,h;s&&(n=t.payload.vidState,r=n.chapterStartTimes.length>0?"lf":"sf",l=n.episodeNumber,d=n.seasonNumber,u=n.seriesTitle,h=n.videoTitle,a=n.duration,o=[h,d,l,r].join("|"),""===d&&(d="0"),""===l&&(l="0"),n.isAffiliateFeed&&(i.tv="true"),(n.isLive||-1===a)&&(a=this.NIELSEN_LIVE_VIDEO_DURATION),i.pc=i.ci+i.c6+i.cmsRefGuid,i.c10="plt,"+(e?"MBL":"DSK"),i.sd=a,i.dur=a,i.cg=u,i.tl=o,i.videotype="content",i.guid=n.cmsRefGuid,i.seriestitle=u,i.episodetitle=h,i.isfullepisode=n.episodeFlag?"y":"n",i.crossId1=n.mediaId,i.iag_pgm=h,i.iag_epi=o,i.iag_pd=location.hostname,i.iag_fp=r,i.iag_cte="na",i.iag_oad="na",i.iag_seg=1,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",i))},_onAdStart:function(t){var e=this.cviModel.getContentVideoState(),i=t.payload,s,n,a,r,o,l,d,u,h,c;i&&(this._metadata.hasAds=1,this._adDisplayed=!0,c=uvpjs._.clone(this._metadata),s=i.adData,n=s.adClipID.split("_"),r=n[0],u=this.cviModel.getNumberOfAdPods(),h="post"===r?u:++n[1],a=["dav0",e.videoTitle,e.seasonNumber,e.episodeNumber].join("-"),d=[u,h,this._numAdsInPod,n[2]].join("_"),o=s.adVatId,l=s.adVideoUrl,""!==o&&(l+="|"+o),c.videotype=r+"roll",c.iag_cte=l,c.iag_pod=d,c.iag_apt="na",c.tl=a,c.c3="st,a","pre"===r&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",c),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,c))},_onAdPodStart:function(t){var e=t.payload;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",e.adPod.adCount),this._numAdsInPod=e.adPod.adCount)},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(t){var e=t.payload,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),e){if(this._metadata.iag_seg&&this._metadata.iag_seg++,i=t.payload.contentData,i.duration>0&&Math.abs(i.duration-this._lastContentSecond)<=5)return void this._notifySDK(this.events.END,this._lastContentSecond);this._notifySDK(this.events.STOP,this._lastContentSecond)}},_onControlPlay:function(t){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(t){var e=t.payload,i;if(e&&!((i=Math.floor(e.currentTime))<0)){if(e.isAd){if(this._lastAdSecond===i)return;this._lastAdSecond=i}else{if(this._lastContentSecond===i)return;this._lastContentSecond=i}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,i)}},_onVideoCuepoint:function(t){var e=t.payload,i=e.data;e.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&i&&"string"==typeof i&&this._notifySDK(this.events.SEND_ID3,i)},_hasAds:function(){var t=this.cviModel.getNumberOfAdPods();return-1===t?2:0===t?0:1},_isDisabled:function(){var t=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===t||!0===t}});var e=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(t){var e=t._,i,s,n;t.DWAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.componentid=this.trackingMgr.componentid,t.device=this._getDevice(),t.mapp=this._playerName,t.part=this.cviModel.getSessionOption("partner"),t.playertime=0,t.siteid=this.trackingMgr.DEFAULT_SITEID,t.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var t=this.cviModel,e=t.getSessionOption("cms"),i=t.getContentVideoState(),s=t.getCurrentPlaybackState(),n=uvpjs.mediaCapabilities,a=this._tags.content,r=this._tags.ad,o=this.trackingMgr;r.adastid=e===o.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(a.medastid)||0===a.medastid||"0"===a.medastid)&&(i.isLive?i.isAffiliateFeed?a.medastid="cbsnews"===t.getSessionOption("playerId")?"601":"600":s.isHDStreamLive||n.isChromecast()?a.medastid="601":a.medastid="0":a.medastid=e===o.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",a.medastid,r.adastid))},_loadConfigParams:function(){for(var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),i=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],s=i.length,n,a,r;s--;)a=i[s],n=this._getTagType(a),r=t(a),e.isUndefined(n)||e.isEmpty(r)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",a,r),this._tags[n][a]=r);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var t=window.DW&&window.DW.pageParams||{},i,s,n;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams");for(i in t)t.hasOwnProperty(i)&&(n=t[i],e.isEmpty(n)||(this._pageParams[i]=n,s=this._getTagType(i),e.isUndefined(s)||(this._tags[s][i]=n)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_BLOCKED]=this._onAdBlocked.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.AD_ERROR]=this._onAdError.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.USER_GESTURE]=this._onUserGesture.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var t=this.trackingMgr.progressEvents,e={};e[t.FIRST_QUARTILE]=this._onProgressEvent.bind(this,t.FIRST_QUARTILE),e[t.MID_QUARTILE]=this._onProgressEvent.bind(this,t.MID_QUARTILE),e[t.THIRD_QUARTILE]=this._onProgressEvent.bind(this,t.THIRD_QUARTILE),e[t.TIMED]=this._onProgressEvent.bind(this,t.TIMED),this.trackingMgr.registerProgressEvents(e)},_sendDWEvent:function(t){var e=this._tags.content,i=e.event,a=i===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),e.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:n(this._gestval),i!==this.events.INIT&&(e.playertime=this._getPlayerTime()),e.ts=+new Date,a+=s(e),t&&(a+="&"+s(this._tags.ad)),this.trackingMgr.fireTrackingPixel(a),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",a),this._gestval={},e.gestval="",e.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var t=window.location,i=uvpjs.mediaCapabilities,s=i.isMobile()?"mobile%20web":"desktop%20web",n=this.cviModel.getSessionOption("userStatus"),a=this.cviModel.getSessionOption("userId"),r=this._tags.content,o=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,r.event=this.events.INIT,r.mso=this.trackingMgr.mso,r.pageurl=t.href,r.srchost=t.host,r.ursuid=a,r.v16=o.viewguid,r.v17=o.topic,r.v18=o.topicbrcrm,r.v19=o.pagetype,r.v20=o.assetguid,r.v21=i.isChromecast()?"chromecast":s,r.v23=o.rsid,r.v25=e.isEmpty(n)?"anon":n,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(t){var e=this.trackingMgr.progressEvents,i=this._tags.content,s=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",t),t)switch(t){case e.FIRST_QUARTILE:s.pct=25;break;case e.MID_QUARTILE:s.pct=50;break;case e.THIRD_QUARTILE:s.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete s.pct}},_onAdBlocked:function(t){var e=this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(t){var i=this._tags.ad,s=t.payload.adData,n=s.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),i.adid=e.isEmpty(s.adVideoId)?"999":s.adVideoId,i.adnum=this.cviModel.adNum,i.adtime=0,i.adtitle=s.adVideoTitle,i.adtype=s.isLinear?1:2,i.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),i.adbreak="",i.adpos=n[0],i.adpod=n[1],i.adpodpos=n[2],this._sendDWEvent(!0)},_onAdQuartile:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",t),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(t){var e=t.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",t),this._tags.content.event=this.events.END,this._tags.ad.adtime=e.duration,this._sendDWEvent(!0)},_onAdError:function(t){var e=t.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",t),e===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(t){var i=this.cviModel,s=i.getContentVideoState(),n=this._tags.content,a=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",t),n.event=this.events.START,n.codec=s.fileType,n.distntwrk=i.getSessionOption("netwk"),n.playersz=this._getPlayerSize(),n.sdlvrytype=this._getStreamType(),n.v22=s.cmsRefGuid,n.medid=s.mediaId,n.medlength=this.trackingMgr.getContentLength()/1e3,n.mednum=i.medNum,n.medrls=s.pid,n.medtitle=s.videoTitle,n.contsessid=s.previousSessionId,e.isEmpty(s.contPlayState)||(a.autoplay=s.contPlayState),a.paywall=s.isPaidContent?"1":"0",a.caption_available=s.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",t),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(t),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(t.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),t.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(t){var e=t&&t.payload,i=e&&e.seekFromTime,s=e&&e.seekToTime,n=s-i,a=this._tags.content;a.eventdur=Math.floor(Math.abs(n)),a.event=n>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:s,seekDuration:n,event:a.event,eventdur:a.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(t){var i=this._tags.content,s=this._gestval,n=t.payload.gestureInfo,a=this.cviModel.contentVideoState,r=a.elapsedTime,o="",l=uvpjs.Type.Gesture,d,u,h,c,p,v,g;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",t),"string"==typeof n&&-1===n.indexOf("event="))return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.");if(e.isArray(n)){if(n.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");o=n[0]}if(a=this.cviModel.contentVideoState,"string"==typeof n)c=/event=([^&]*)(?:&gestval=(.*))?/,p=c.exec(n),v=p[1],g=p[2],i.event=v,i.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===g?"":g;else if(o===l.GLOBAL_RESUME||o===l.LOCAL_RESUME)s.prevcomponentid=a.previousSessionId,s.eventdur=r>0?Math.round(r/1e3):0,s.paywall=a.isPaidContent?"1":"0",i.event=this.events.RESUME,i.medtime=a.resumeContentTime;else if(o===l.CONT_CANCEL)s.action=this.events.PROMPT;else switch(i.medtime=this.cviModel.contentPlaybackState.currentTime,o){case l.RELATED_OVERLAY:i.event=l.RELATED_OVERLAY;break;case l.RELATED_CLICK_GESTURE:n.length>=2&&(s.related_pid=n[1]),i.event=l.RELATED_CLICK_GESTURE;break;case l.SHARE_OVERLAY:i.event=l.SHARE_OVERLAY;break;case l.SHARE_NETWORK_GESTURE:n.length>=2&&(s.network=n[1]),i.event=l.SHARE_NETWORK_GESTURE;break;case l.SEND_GESTURE:n.length>=2&&(d=n[1].split(","),u=d.shift(),h=d.join(","),s.sender=u,s.recipient=h),i.event=l.SEND_GESTURE;break;case l.EMBED_GESTURE:i.event=l.EMBED_GESTURE;break;case l.LINK_GESTURE:i.event=l.LINK_GESTURE;break;case l.REPLAY_GESTURE:i.event=l.REPLAY_GESTURE;break;case l.END_CARD_OVERLAY:i.event=l.END_CARD_OVERLAY;break;case l.ERROR_OVERLAY:i.event=l.ERROR_OVERLAY;break;case l.RECOMMEND_NOW:n.length>=3?(s.mediaid=n[1],s.pid=n[2]):(s.mediaid="",s.pid=""),i.event=l.RECOMMEND_NOW;break;case l.RECOMMEND_NEXT:n.length>=3?(s.mediaid=n[1],s.pid=n[2]):(s.mediaid="",s.pid=""),i.event=l.RECOMMEND_NEXT;break;case l.RECOMMEND_CLOSE:i.event=l.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",o)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",i),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",s)),this._sendDWEvent()},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(t){return e.has(this._tags.ad,t)?"ad":e.has(this._tags.content,t)?"content":void 0},_getStreamType:function(){var t=this.cviModel.getContentVideoState(),e=uvpjs.mediaCapabilities,i=t.deliveryType,s=t.isLive;return i===e.STREAMING?s?5:4:i===e.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var t=this._agentStartTime,i=e.isDate(t)&&parseInt((new Date-t)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",i),i},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var t=uvpjs.mediaCapabilities,e=window.screen,i={type:(t.getDevice()||"").toLowerCase(),os:(t.getOS()||"").toLowerCase(),ver:t.getOSVersion(),screensz:[e.width,e.height].join("x")};return n(i)},_getPlayerSize:function(){var t=this.cviModel.getContentVideoState();return[t.sourceWidth,t.sourceHeight].join("x")}}),i=function(t,i,s){var n=[],a,r;for(a in t)t.hasOwnProperty(a)&&(r=e.isUndefined(t[a])?"":encodeURIComponent(t[a]),n.push([a,r].join(i)));return n.join(s)},s=function(t){return i(t,"=","&")},n=function(t){return i(t,":",";")}}(uvpjs.register("uvpjs")),function(t){var e,i;i=t._,t.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){var t={};if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."));t.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,t.streamHeadPosition=this.getStreamHeadPosition.bind(this),t.streamLength=this.getStreamLength.bind(this),t.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(t),this._setupEventCallbacks()},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var t=this.cviModel.adVideoState,e={};e.adTitle=t.adVideoTitle,e.adDuration=t.duration,e.id=t.adVideoId,e.adPartnerId=this.cviModel.sessionOptions.partner,e.adServer=t.adServerName,this.akamaiPlugin.handleAdLoaded(e)},setContentMetaData:function(){var t=this.cviModel,e=t.sessionOptions,i=this.akamaiPlugin,s=t.getContentVideoState(),n=t.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",t.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",e.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",e.host),i.setData("Referrer",e.referrer),i.setData("title",s.title),i.setData("category",s.category),i.setData("subCategory",s.sourceOwner),i.setData("show",s.title),i.setData("contentLength",1e3*n.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",t),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",t.payload),this.akamaiPlugin&&t.payload)switch(t.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",t),this.akamaiPlugin){var e=t.payload.newState;e!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),e===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",t),this.akamaiPlugin&&this.akamaiPlugin.handlePlayEnd("Play.End.Detected")},_onQosMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",t);var e,i;if(this.akamaiPlugin&&-1!==t.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI)){i=t.payload.paramsObj;for(e in i)this.akamaiPlugin.setData(e,i[e])}}}),e=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(t){this.cviModel=t.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",t),this.trackingMgr=t.trackingMgr,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.playerVersion=t.playerVersion,this.useDefaultProperty=t.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,
this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var t=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!t&&!0===t[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){if(console.log("[MUX] _initializePlugin"),void 0===window.mux)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded."));this.cviModel&&this._setupEventCallbacks()},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var t=this.cviModel,i=this.moduleParams,s=e.assign({page_type:"",viewer_user_id:t.getSessionOption("userId"),experiment_name:i&&!uvpjs.util.isEmpty(i.experimentName)?i.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(i.subPropertyId)?t.getSessionOption("partner"):i.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:t.initTime},this._getMuxVideoData());return this.useDefaultProperty?s.property_key=this.MUX_DEFAULT_PROPERTY_KEY:s.property_key=i.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:s}),this.videoElement.mux},_getMuxVideoData:function(){var t=this.cviModel.contentVideoState;return{video_id:this._validateStr(t.cmsRefGuid,""),video_title:this._validateStr(t.videoTitle,""),video_series:this._validateStr(t.seriesTitle,""),video_producer:"",video_content_type:t.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:t.duration,video_stream_type:t.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(t.cdn,""),video_source_url:this._validateStr(t.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_onContentEvent:function(t){t.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(t){if(this.muxMonitor)switch(t.payload.facadeType){case this.mc.HLSJS:break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:t.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(t){var e=t.payload.errorInfo;e&&e.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:e.errorCode,player_error_message:e.message}))},_gatherModuleParams:function(t){var e=this.cviModel,i=e.getModule(t),s=i.params,n={},a;if(!s)return null;for(var r=s.length;r--;)a=s[r],n[a.name]=a.value;return n},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onContentEvent.bind(this),s=this._onPlaybackLibraryLoaded.bind(this),n=this._onError.bind(this),a=this._onAdEvent.bind(this);e[t.CONTENT_DATA_LOADED]=i,e[t.PLAYBACK_LIBRARY_LOADED]=s,e[t.PLAYER_START_ERROR]=n,e[t.VIDEO_START_ERROR]=n,e[t.VIDEO_PLAYBACK_ERROR]=n,e[t.AD_ERROR]=n,e[t.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=a,e[t.AD_PLUGIN_CONTENT_RESUME_REQUEST]=a,e[t.AD_LOADED]=a,e[t.AD_START]=a,e[t.VIDEO_STATE_CHANGE]=a,e[t.AD_SKIPPED]=a,e[t.AD_END]=a,e[t.AD_ERROR]=a,e[t.AD_REQUEST]=a,e[t.AD_RESPONSE]=a,e[t.AD_QUARTILE]=a,this.trackingMgr.registerEventCallbacks(e)},_getMuxAdData:function(t){var e=t.payload.adData?t.payload.adData.adAssetUrl:t.payload.adAssetUrl;return{ad_tag_url:t.payload.adCallUrl,ad_asset_url:e}},_dispatchMuxAdEvent:function(t,e){t&&(e||(e={ad_tag_url:"",ad_asset_url:""}),e.ad_tag_url||(e.ad_tag_url=""),e.ad_asset_url||(e.ad_asset_url=""),window.mux.emit(this.videoElement,t,e))},_dispatchMuxEvent:function(t){window.mux.emit(this.videoElement,t)},_onAdEvent:function(t){var e=this.eventTypes,i=this.MUX_AD_EVENTS,s=this.MUX_EVENTS;switch(t.type){case e.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(s.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case e.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(s.PLAY),this._dispatchMuxEvent(s.PLAYING));break;case e.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t));break;case e.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t));break;case e.VIDEO_STATE_CHANGE:if(!t.payload.isAd)return;var n=t.payload.newState,a=t.payload.currentState;n===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(t)):a==this.mc.PAUSED&&n===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t)));break;case e.AD_SKIPPED:case e.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(t));break;case e.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(t));break;case e.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(t));break;case e.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(t));break;case e.AD_QUARTILE:switch(t.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(t));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(t));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(t))}}}})}(uvpjs.register("uvpjs")),function(t){t.OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"production"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isPaused:!1,isBuffering:!1,init:function(t){this.options=t,this.ozTamVo=new uvpjs.OzTamVo(this);var e=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(e.publisherId,e.vendorVersion,e.productionMode,e.verboseLogging,e.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",e,this.ozTamService)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e=this.onVideoEvent.bind(this),i={};i[t.RESOURCE_START]=e,i[t.CONTENT_START]=e,i[t.CONTROL_SEEK]=e,i[t.SEEK_DONE]=e,i[t.CONTENT_END]=e,i[t.VIDEO_STATE_CHANGE]=e,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(t){var e=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out"));switch(t.type){case e.RESOURCE_START:this.onResourceStart(t);break;case e.CONTENT_START:this.onContentStart(t);break;case e.CONTROL_SEEK:this.onSeekStart(t);break;case e.SEEK_DONE:this.onSeekDone(t);break;case e.CONTENT_END:this.onContentEnd(t);break;case e.VIDEO_STATE_CHANGE:this.onVideoStateChange(t)}},onResourceStart:function(t){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(t){this.ozTamService.seekBegin()},onSeekDone:function(t){this.ozTamService.seekComplete()},onContentEnd:function(t){this.ozTamService.complete()},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.ozTamService.haltProgress());break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.ozTamService.haltProgress());break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.ozTamService.resumeProgress()),this.isBuffering&&(this.isBuffering=!1,this.ozTamService.resumeProgress())}},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}})}(uvpjs.register("uvpjs")),function(t){t.SegmentAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"production"!==uvpjs.Configuration.env,options:null,segmentVo:null,hasSegmentSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(t){this.options=t,this.initTime=new Date,this.segmentVo=new uvpjs.SegmentVo(this),this.segmentEvent=this.segmentVo.Event,window.analytics&&"function"==typeof window.analytics.load&&(analytics.load(this.segmentVo.getApiKey()),this.hasSegmentSdk="function"==typeof analytics.track),this.debug&&uvpjs.log(this.DEBUG_ID,"Segment Sdk",this.hasSegmentSdk)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e={};e[t.RESOURCE_START]=this.onResourceStart.bind(this),e[t.CONTENT_START]=this.onContentStart.bind(this),e[t.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),e[t.CONTROL_SEEK]=this.onSeekStart.bind(this),e[t.SEEK_DONE]=this.onSeekDone.bind(this),e[t.CONTENT_END]=this.onContentEnd.bind(this),e[t.RESOURCE_END]=this.onResourceEnd.bind(this),e[t.CONTEXT_METADATA]=this.onContextMetadata.bind(this),e[t.AD_POD_START]=this.onAdPodStart.bind(this),e[t.AD_POD_END]=this.onAdPodEnd.bind(this),e[t.AD_START]=this.onAdStart.bind(this),e[t.AD_CLICK]=this.onAdClick.bind(this),e[t.AD_END]=this.onAdEnd.bind(this),e[t.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),e[t.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),this.options.trackingMgr.registerEventCallbacks(e),t=this.options.trackingMgr.progressEvents,e={},e[t.FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.FIRST_QUARTILE),e[t.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.MID_QUARTILE),e[t.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(e)},onResourceStart:function(t){this.hasResourceStart||(this.sendTrackEvent(this.segmentEvent.SESSION_START,this.segmentVo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(t){this.hasContentStart=!0,this.trackContentStartEvent=!0},onQuartileProgress:function(t){this.sendTrackEvent(t,this.segmentVo.getQuartileInfo())},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.segmentEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.segmentEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.segmentEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.segmentEvent.BUFFER_COMPLETE))}},onSeekStart:function(t){this.sendTrackEvent(this.segmentEvent.SEEK_START,this.segmentVo.getSeekInfo())},onSeekDone:function(t){this.sendTrackEvent(this.segmentEvent.SEEK_COMPLETE,this.segmentVo.getSeekInfo())},onContentEnd:function(t){this.sendTrackEvent(this.segmentEvent.CONTENT_COMPLETE)},onResourceEnd:function(t){this.hasContentStart&&(this.sendTrackEvent(this.segmentEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},onAdPodStart:function(t){this.sendTrackEvent(this.segmentEvent.AD_BREAK_START,this.segmentVo.getAdBreakInfo())},onAdPodEnd:function(t){this.sendTrackEvent(this.segmentEvent.AD_BREAK_COMPLETE)},onAdStart:function(t){this.sendTrackEvent(this.segmentEvent.AD_START,this.segmentVo.getAdItemInfo())},onAdClick:function(t){this.sendTrackEvent(this.segmentEvent.AD_CLICK)},onAdEnd:function(t){this.sendTrackEvent(this.segmentEvent.AD_COMPLETE)},onVideoTransition:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Segment bitrate",t.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(t){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.segmentEvent.QOS,this.segmentVo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.sendTrackEvent(this.segmentEvent.CONTENT_START,this.segmentVo.getContentStartInfo()))},sendTrackEvent:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Segment Track",t,e||{}),this.hasSegmentSdk&&analytics.track(t,e||{})},destroy:function(){this.segmentVo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.segmentVo=null,this.contextMetadata=null}})}(uvpjs.register("uvpjs")),function(t){t.OzTamVo=uvpjs.Class.subClass({agent:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.agent.options.playerVersion,productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getMediaInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration;return{mediaId:e.ozTamMediaId||e.cmsRefGuid||e.mediaId,url:e.assetURL,mediaDuration:e.isLive?-1:isNaN(i)?0:i,mediaType:e.isLive?"live":"vod",mediaPositionFunction:function(){return t.getCurrentPlaybackState().currentTime}}},getPropertyDictionary:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=this.agent.ozTamService,s={};return e.ozTamMediaId&&(s[i.PROP_ALT_MEDIA_ID]=e.cmsRefGuid||e.mediaId),s},isOzTamOptOut:function(){var t=this.agent.options.cviModel.getContentVideoState();return t.hasOwnProperty("ozTamOptOut")&&t.ozTamOptOut},getValue:function(t){return t.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}})}(uvpjs.register("uvpjs")),function(t){t.SegmentVo=uvpjs.Class.subClass({Event:{SESSION_START:"Video Playback Started",CONTENT_START:"Video Content Start",CONTENT_COMPLETE:"Video Content Completed",PAUSE:"Video Playback Paused",STOP:"Video Playback Interrupted",BUFFER_START:"Video Playback Buffer Started",BUFFER_COMPLETE:"Video Playback Buffer Completed",SEEK_START:"Video Playback Seek Started",SEEK_COMPLETE:"Video Playback Seek Completed",PLAY_RESUME:"Video Playback Resumed",SESSION_END:"Video Playback Completed",AD_BREAK_START:"Video Ad Break Started",AD_BREAK_COMPLETE:"Video Ad Break Completed",AD_START:"Video Ad Started",AD_COMPLETE:"Video Ad Completed",AD_CLICK:"Video Ad Clicked",QOS:"Video Quality Updated",FIRST_QUARTILE:"Video Playback First Quartile",MID_QUARTILE:"Video Playback Mid Quartile",THIRD_QUARTILE:"Video Playback Third Quartile"},agent:null,channelName:null,apiKey:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.SEGMENT_MODULE_NAME),this.apiKey=this.getModuleParam("apiKey"),this.channelName=this.getModuleParam("channelName")},getApiKey:function(){return this.apiKey},getSessionStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:isNaN(i)?0:i;return{adAssetId:t.adVideoState.adClipID,adPodId:t.adVideoState.adVideoId||t.adVideoState.adVatId,adType:t.adVideoState.adType,allowConcurrentPlayback:t.sessionOptions.allowConcurrentPlayback,bitrate:s.currentBitrate,channel:this.channelName,cdn:e.cdn,cms:t.sessionOptions.cms,contentAssetId:e.cmsRefGuid||e.mediaId,currentIndex:1,"drm.dash.playreadyURL":e.drm.dash.playreadyURL,"drm.dash.widevineURL":e.drm.dash.widevineURL,"drm.enabled":e.drm.enabled,"drm.fairplay.appCertURL":e.drm.fairplay.appCertURL,"drm.ticket":e.drm.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(e.drm),enableMutedAutoplay:t.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:t.sessionOptions.enableNativeMobileAutoplay,enableReplay:t.sessionOptions.enableReplay,enableUnmutedAutoplay:t.sessionOptions.enableUnmutedAutoplay,framerate:s.playbackFramerate,fullScreen:t.isFullscreen,isAutoplay:t.isAutoplay,isMultiCDN:t.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:t.isMuteAtPlayStart,isMuted:e.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:n,livestream:e.isLive,liveSyncDurationCount:t.sessionOptions.liveSyncDurationCount,maxBitrate:t.maxBitrate,method:"",minBitrate:t.minBitrate,pageProvidesTealium:t.sessionOptions.usesTealium,pagetype:t.dwPageParams.pagetype,partner:t.sessionOptions.partner,pguid:t.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sessionId:t.sessionId,sound:t.volume,startTime:e.startTime,streamType:e.isLive?"Live":"VOD",title:e.videoTitle,totalLength:n,usesIMA:t.sessionOptions.usesIMA,userConnectionType:t.sessionOptions.userConnectionType,userCountry:t.sessionOptions.userCountry,userIsp:t.sessionOptions.userISP,userPpid:t.sessionOptions.userPPID,userStatus:t.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName,viewguid:t.dwPageParams.viewguid}},getContentStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:isNaN(i)?0:i;return{assetUrl:e.assetURL,assetId:e.cmsRefGuid||e.mediaId,contentAssetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,chapterStartTimes:e.chapterStartTimes.join(","),closedCaptionPath:e.closedCaptionPath,cms:t.sessionOptions.cms,cmsRefGuid:e.cmsRefGuid,contextMetadata:this.agent.contextMetadata,dfpMediaId:e.dfpMediaId,duration:n,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,excludeNielsenTracking:e.excludeNielsenTracking,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,is360:e.is360,isAffiliateFeed:e.isAffiliateFeed,isEmbedable:e.isEmbedable,isPaidContent:e.isPaidContent,mediaId:e.mediaId,overrideAssetURL:e.overrideAssetURL,program:e.videoTitle.split("-")[0],pguid:t.dwPageParams.pguid,playbackBitrate:s.currentBitrate,playheadTime:this.getPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:n}},getContentCompleteInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState;return{contentAssetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,mediaId:e.mediaId,playbackBitrate:s.currentBitrate,playheadTime:this.getPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:e.isLive?-1:isNaN(i)?0:i}},getQuartileInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState();return{contentAssetId:e.cmsRefGuid||e.mediaId,playheadTime:this.getPlayhead(),playerTime:this.getPlayerElapsedTime(),sessionId:t.sessionId}},getQosInfo:function(){var t=this.agent.options.cviModel,e=t.contentPlaybackState,i=t.contentPlaybackState.facadeState;return{averageDroppedFPS:e.averageDroppedFPS,bufferLength:e.bufferLength,currentContentSegment:e.currentContentSegment,currentMaxBandwidth:e.currentMaxBandwidth,currentTime:e.currentTime,currentBitrate:i.currentBitrate,droppedFPS:i.droppedFPS,droppedFrames:i.droppedFrames,playbackFramerate:i.playbackFramerate}},getAdBreakInfo:function(){var t=this.agent.options.cviModel,e=t.adVideoState,i=e.adClipID.split("_"),s=1;return"post"===e.adType?s=t.getNumberOfAdPods():"mid"===e.adType&&(s=parseInt(i[1])+1),{indexPosition:s,startTime:this.getPlayhead(),title:e.adVideoTitle}},getAdItemInfo:function(){var t=this.agent.options.cviModel.adVideoState;return{adCallUrl:t.assetURL||t.adAssetUrl||t.adVideoUrl,adParams:t.adParameters,assetId:t.adVideoId||t.adVatId,indexPosition:t.adPosition,isCustomClickTrackingUsed:t.isCustomClickTrackingUsed,title:t.adVideoTitle,totalLength:t.duration}},getSeekInfo:function(){return{seekPosition:this.getPlayhead()}},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}})}(uvpjs.register("uvpjs")),function(t){var e={concurrencyBeacon:{prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"}},i=!1,s=null,n=null,a=function(t){return t=t.replace(/\s/g,""),t.search(/^\/\//)>-1?t:"//"+t};t.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(t){return n=e.concurrencyBeacon,t&&t.prodUrl&&t.stageUrl&&(n.prodUrl=a(t.prodUrl),n.stageUrl=a(t.stageUrl)),this},queryParams:function(e){return s=t.util.queryStrFromObj(e,!1),this},devMode:function(t){return i=t,this},buildUrl:function(){return null===n?"Unable to build url.":(i?n.stageUrl:n.prodUrl)+n.path+(null===s?"":"?"+s)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=t.drm,this.videoTagRef=t.videoTagRef,this.eventTypes=t.eventTypes,this.errorCallback=t.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var t=this.getLicenseServerUrl(this.initData),e=this.getId(t);if(this.drmVendor=this.getDRMVendor(t),!e)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null);if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}if(!this.videoTagRef.webkitKeys)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null);var s=this.concatInitDataIdAndCertificate(this.initData,e,this.appCertData),n=this.videoTagRef.webkitKeys.createSession("video/mp4",s);if(!n)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null);n.contentId=e,n.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,t),!1),n.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),n.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)},loadAppCert:function(){e.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",t),this.appCertData=new Uint8Array(t.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(t){this.webKitNeedKeyCalled=!0,this.initData=t.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(t,e,i){"string"==typeof e&&(e=this.stringToArray(e));var s=0,n=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),a=new DataView(n);new Uint8Array(n,s,t.byteLength).set(t),s+=t.byteLength,a.setUint32(s,e.byteLength,!0),s+=4;var r=new Uint8Array(n,s,e.byteLength);return r.set(e),s+=r.byteLength,a.setUint32(s,i.byteLength,!0),s+=4,new Uint8Array(n,s,i.byteLength).set(i),new Uint8Array(n,0,n.byteLength)},onLicenseRequestReady:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+t,e);var i=new XMLHttpRequest;i.session=e.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",t,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");var s=encodeURIComponent(this.base64EncodeUint8Array(e.message)),n="spc="+s+"&"+i.session.contentId;i=this.setRequestHeaders(i),i.send(n)},onLicenseRequestLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",t);var i=t.target,s=i.session,n=null;e.inRange(i.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,t),this.drmVendor===this.DRM_VENDORS.DRMTODAY?n=this.base64DecodeUint8Array(i.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(n=new Uint8Array(i.response)),s.update(n)},onError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t,e),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,t)},onKeyAdded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",t)},getLicenseServerUrl:function(t){var i=null;return i=e.isEmpty(this.drm.fairplay.licenseURL)?"https://"+String.fromCharCode.apply(null,new Uint16Array(t.buffer)).split("://")[1]:this.drm.fairplay.licenseURL,this.appendDRMQueryParams(i)},appendDRMQueryParams:function(t){var e=-1===t.indexOf("?")?"?":"&";return this.drm.sessionId&&(t+=e+"SessionId="+this.drm.sessionId),this.drm.ticket&&(t+="&Ticket="+this.drm.ticket),t},getDRMVendor:function(t){var e=null;return-1!==t.indexOf(this.DRM_VENDORS.DRMTODAY)?e=this.DRM_VENDORS.DRMTODAY:-1!==t.indexOf(this.DRM_VENDORS.IRDETO)&&(e=this.DRM_VENDORS.IRDETO),e},setRequestHeaders:function(t){if(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!e.isEmpty(this.drm.fairplay.header)){var i=this.drm.fairplay.header;for(var s in i){var n=encodeURIComponent(i[s]);t.setRequestHeader(s,n)}}return t},getId:function(t){var e=uvpjs.util.objFromQueryStr(t);return e.ContentId||e.contentId||e.assetId||null},base64EncodeUint8Array:function(t){var e=String.fromCharCode.apply(null,t);return btoa(e)},base64DecodeUint8Array:function(t){var e=window.atob(t),s=e.length,n=new Uint8Array(new ArrayBuffer(s));for(i=0;i<s;i++)n[i]=e.charCodeAt(i);return n},stringToArray:function(t){for(var e=new ArrayBuffer(2*t.length),i=new Uint16Array(e),s=0,n=t.length;s<n;s++)i[s]=t.charCodeAt(s);return i}})}(uvpjs.register("uvpjs"))}(),define("libs/cbsi-player/uvpjs-2.9.52",function(){}),function(t){function e(t,e,i){var s=t.children(),a=!1;t.empty();for(var r=0,o=s.length;r<o;r++){var l=s.eq(r);if(t.append(l),i&&t.append(i),n(t,e)){l.remove(),a=!0;break}i&&i.detach()}return a}function i(e,a,r,o,l){var d=e.contents(),u=!1;e.empty();for(var h="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",c=0,p=d.length;c<p&&!u;c++){var v=d[c],g=t(v);void 0!==v&&(e.append(g),l&&e[e.is(h)?"after":"append"](l),3==v.nodeType?n(r,o)&&(u=s(g,a,r,o,l)):u=i(g,a,r,o,l),u||l&&l.detach())}return u}function s(t,e,i,r,d){var u=!1,h=t[0];if(void 0===h)return!1;for(var c=l(h),p=-1!==c.indexOf(" ")?" ":"　",v="letter"==r.wrap?"":p,g=c.split(v),f=-1,m=-1,_=0,E=g.length-1;_<=E&&(0!=_||0!=E);){var A=Math.floor((_+E)/2);if(A==m)break;m=A,o(h,g.slice(0,m+1).join(v)+r.ellipsis),n(i,r)?E=m:(f=m,_=m),E==_&&0==E&&r.fallbackToLetter&&(v="",g=g[0].split(v),f=-1,m=-1,_=0,E=g.length-1)}if(-1==f||1==g.length&&0==g[0].length){var y=t.parent();t.remove();var S=d?d.length:0;if(y.contents().size()>S)u=s(y.contents().eq(-1-S),e,i,r,d);else{var b=y.prev(),h=b.contents().eq(-1)[0];if(void 0!==h){var c=a(l(h),r);o(h,c),d&&b.append(d),y.remove(),u=!0}}}else c=a(g.slice(0,f+1).join(v),r),u=!0,o(h,c);return u}function n(t,e){return t.innerHeight()>e.maxHeight}function a(e,i){for(;t.inArray(e.slice(-1),i.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),i.lastCharacter.noEllipsis)<0&&(e+=i.ellipsis),e}function r(t){return{width:t.innerWidth(),height:t.innerHeight()}}function o(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function l(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function d(e,i){return void 0!==e&&!!e&&("string"==typeof e?(e=t(e,i),!!e.length&&e):"object"==typeof e&&void 0!==e.jquery&&e)}function u(t){for(var e=t.innerHeight(),i=["paddingTop","paddingBottom"],s=0,n=i.length;s<n;s++){var a=parseInt(t.css(i[s]),10);isNaN(a)&&(a=0),e-=a}return e}function h(t,e){return!!t&&(e="string"==typeof e?"dotdotdot: "+e:["dotdotdot:",e],void 0!==window.console&&void 0!==window.console.log&&window.console.log(e),!1)}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(s){if(0==this.length)return s&&!1===s.debug||h(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(s)});var a=this;a.data("dotdotdot")&&a.trigger("destroy.dot"),a.data("dotdotdot-style",a.attr("style")),a.css("word-wrap","break-word"),"nowrap"===a.css("white-space")&&a.css("white-space","normal"),a.bind_events=function(){return a.bind("update.dot",function(s,r){s.preventDefault(),s.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:u(a),l.maxHeight+=l.tolerance,void 0!==r&&(("string"==typeof r||r instanceof HTMLElement)&&(r=t("<div />").append(r).contents()),r instanceof t&&(o=r)),f=a.wrapInner('<div class="dotdotdot" />').children(),f.empty().append(o.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var d=!1,h=!1;return p.afterElement&&(d=p.afterElement.clone(!0),p.afterElement.remove()),n(f,l)&&(h="children"==l.wrap?e(f,l,d):i(f,a,f,l,d)),f.replaceWith(f.contents()),f=null,t.isFunction(l.callback)&&l.callback.call(a[0],h,o),p.isTruncated=h,h}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(a[0],p.isTruncated),p.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(a[0],o),o}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),a.unwatch().unbind_events().empty().append(o).attr("style",a.data("dotdotdot-style")).data("dotdotdot",!1)}),a},a.unbind_events=function(){return a.unbind(".dot"),a},a.watch=function(){if(a.unwatch(),"window"==l.watch){var e=t(window),i=e.width(),s=e.height();e.bind("resize.dot"+p.dotId,function(){i==e.width()&&s==e.height()&&l.windowResizeFix||(i=e.width(),s=e.height(),g&&clearInterval(g),g=setTimeout(function(){a.trigger("update.dot")
},10))})}else v=r(a),g=setInterval(function(){var t=r(a);v.width==t.width&&v.height==t.height||(a.trigger("update.dot"),v=r(a))},100);return a},a.unwatch=function(){return t(window).unbind("resize.dot"+p.dotId),g&&clearInterval(g),a};var o=a.contents(),l=t.extend(!0,{},t.fn.dotdotdot.defaults,s),p={},v={},g=null,f=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),p.afterElement=d(l.after,a),p.isTruncated=!1,p.dotId=c++,a.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&a.watch(),a},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}};var c=1,p=t.fn.html;t.fn.html=function(t){return void 0!==t?this.data("dotdotdot")&&"function"!=typeof t?this.trigger("update",[t]):p.call(this,t):p.call(this)};var v=t.fn.text;t.fn.text=function(e){if(void 0!==e){if(this.data("dotdotdot")){var i=t("<div />");return i.text(e),e=i.html(),i.remove(),this.trigger("update",[e])}return v.call(this,e)}return v.call(this)}}}(jQuery),define("libs/jquery/dotdotdot-1.6.1",function(){}),define("quantum/videoPlayer",["jquery","version!fly/managers/debug","managers/client-storage","translations/video","version!fly/managers/components","utils/cookie","managers/device","managers/edition","managers/events","version!fly/managers/history","managers/page-vars","managers/global-functions","managers/tealium","managers/mpulse","version!fly/utils/url-helper","managers/waypoints","version!fly/components/base","version!libs/cbsi-player/uvpjs","version!libs/waypoints/inview","version!libs/jquery/dotdotdot"],function(t,e,i,s,n,a,r,o,l,d,u,h,c,p,v,g){var f="videoPlayer";e=e.init(f),g.init();var m={cnetvideocreate:0,playerloaded:0,showplayoverlay:0,adstart:0,adend:0,contentstart:0},_=0,E=new window.uvpjs.VideoManager;t.widget("cnet.videoPlayer",t.fly.base,{options:{apeList:!1,autoplay:!1,classActive:"active",classCaptions:"captions",classCaptionsMissing:"captionsMissing",classDisabled:"disabled",classHidden:"hidden",classNoAutoplay:"pausedAtStartup",classPlaybackStarted:"playbackStarted",classPlaying:"playing",config:null,contentType:"vod-curated",customCSS:null,enableHistoryUpdates:!1,eventChannels:null,eventSubscriptions:null,getPlaylistSelector:null,getRelatedPlaylist:!1,getShortcodeVideo:!1,idPrefix:"videoPlayer",loaderSelector:"#related-area",loop:!0,mainPlayer:!1,mutedVideoCountThreshold:10,playlist:[],resizePlayer:!0,selectorScrollingAutoplayDisabled:".inviewElement.exited",showAsModal:!1,showPreviewMetadata:!1,suppressAds:!1,tagTopicPlaylistRoute:"",titleTagPostText:"",upNextTriggerTime:30,uvpPartner:"cnet",videoShortcodeSelector:".video.shortcode"},adPodStartTimestamp:0,autoplayState:null,blurredVideoCountThreshold:null,chapters:null,contentStartTimeStamp:null,contentVideoState:-2,errorDetails:{MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError"},haveFirstGesture:!1,id:null,initialized:!1,interrupted:!1,isAd:!1,isPlaying:!1,history:null,mutedAutoplayEnabled:!1,mutedAutoplayTest:!1,closePlayerRequested:!1,player:null,playlist:[],playlistPaused:!1,scrollingAutoplayWaypoint:null,startingNewPlaylist:!1,timelineRequests:null,suppressAds:!1,systemInfoObject:{},testGroup:null,testName:null,testVideoUrl:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",userAutoplayEnabled:!0,uvpPayload:{},video:null,watchedVideoCount:0,windowHasFocus:!0,uvpEvents:{adError:function(t){this._trackEvent("logError","trackVideoAdError",t),this.suppressAds?e.error("UVPJS encountered a potentially fatal ad creative exception:",t):e.info("Ad failed to load because ads are being suppressed.",t)},controlMute:function(t){this._trackEvent("trackClick","mute",{})},controlUnmute:function(t){(this.mutedAutoplayTest||this.mutedAutoplayEnabled)&&(this.$element.find("[data-overlay=mute]").addClass("hide"),this.$element.removeClass(this.options.classCaptions+" "+this.options.classCaptionsMissing),setTimeout(function(){this.$element.find("[data-overlay=mute]").removeClass("visible")}.bind(this),2e3)),this.mutedAutoplayTest=!1,this.mutedAutoplayEnabled=!1,this._trackEvent("trackClick","unmute",{})},firstGesture:function(t){if(!this.haveFirstGesture){this.haveFirstGesture=!0;var i=this,s=this.$element.find("#content_"+this.id+" video")[0];if(this.playlistPaused&&s){s.src=i.testVideoUrl;var n=s.play();n?n.then(function(){e.log("Promise fulfilled..."),i.player.getPlayerMuted()&&i.unmute(),i._resumePlaylist()}).catch(function(t){e.error("Promise not met...",t)}):e.log("no Promise")}else i.player.getPlayerMuted()&&(i.unmute(),i.$element.removeClass(i.options.classCaptions+" "+i.options.classCaptionsMissing))}},onAdBlocked:function(t){this._trackEvent("logError","trackVideoAdBlocked",t),this.suppressAds?e.error("UVPJS encountered a potentially fatal ad creative blockage:",t):e.info("Ad failed to load because ads are being suppressed.",t)},onAdEnd:function(t){this.isAd=!1,this._trackPerformanceEvent("adend")},onAdPodStart:function(t){this.adPodStartTimestamp=Date.now(),this.mutedAutoplayTest&&(this.$element.find("[data-overlay=mute]").addClass("visible").addClass("muted"),this.mute())},onAdStart:function(t){this.isAd=!0,this.options.eventChannels&&l.publish(this.options.eventChannels,"onAdStart"),setTimeout(function(){this.options.eventChannels&&l.publish(this.options.eventChannels,"onDelayedAdStart")}.bind(this),250),this._trackPerformanceEvent("adstart");var e=Date.now()-this.adPodStartTimestamp;e=e<1001?"0 - 1000 ms":e<1501?"1001 - 1500 ms":e<2001?"1501 - 2000 ms":e<2501?"2001 - 2500 ms":e<3001?"2501 - 3000 ms":"3001 and more",this._setAspectRatio(!0)},onCaptionsReady:function(t){this.$element.find("[data-control=captions]").removeClass(this.options.classDisabled)},onCaptionsUnavailable:function(t){e.warn("Unable to fetch captions."),this._trackEvent("logError","trackVideoCaptionsUnavailable",t)},onContentEnd:function(t){this._trackPerformanceEvent("contentend"),this.watchedVideoCount++,this.$element.find(".chapters").empty(),this.$element.find("[data-control=captions]").addClass(this.options.classDisabled)},onContentStart:function(t){var i=this;this.options.eventChannels&&l.publish(this.options.eventChannels,"onContentStart"),this.contentStartTimeStamp=(new Date).getTime(),this._trackPerformanceEvent("contentstart"),this.mutedAutoplayTest&&(this.$element.find("[data-overlay=mute]").addClass("visible").addClass("muted"),this.mute()),this.player.getPlayerMuted()&&this.mutedAutoplayEnabled&&r.isMobile()&&(this.video.closedCaptionPath?setTimeout(function(){try{this.player.showCaptions()}catch(t){e.log("UVP had trouble showing captions.",t)}this.$element.addClass(this.options.classCaptions).removeClass(this.options.classCaptionsMissing)}.bind(this),500):this.$element.addClass(this.options.classCaptionsMissing).removeClass(this.options.classCaptions)),this._showChapterStarts(),this._setAspectRatio()},onResourceEnd:function(t){if("video_recs"===this.testName&&"iris"===this.testGroup&&this.$element.addClass("irisTransition"),this.windowHasFocus||this.watchedVideoCount%this.blurredVideoCountThreshold!=0||this.player.getPlayerMuted()){if(this.mutedAutoplayEnabled&&this.player.getPlayerMuted()&&!this.haveFirstGesture)this.watchedVideoCount===this.options.mutedVideoCountThreshold&&this._pausePlaylist();else if(0===t.payload.playlistLength&&this.options.loop&&!this.startingNewPlaylist){var i=this.playlist[this.playlist.length-1];t.payload.rco&&t.payload.rco.cmsRefGuid===i.id&&(this.playlist=this.options.playlist,this._setPlaylist(this.playlist))}}else e.log("onResourceEnd: paused out of focus playlist after "+this.blurredVideoCountThreshold+" videos"),this._pausePlaylist()},onResourceStart:function(e){if("video_recs"===this.testName&&"iris"===this.testGroup&&this.$element.removeClass("irisTransition"),this.uvpPayload=e.payload,this.$element.find("[data-video-still]").addClass(this.options.classHidden),this.startingNewPlaylist=!1,this.video=this._getVideoFromPlaylist(e.payload.rco.index)||e.payload.rco,this.options.getRelatedPlaylist&&this._getRelatedPlaylist(),this._setPageContextMetadata(),this.player.getPlayerMuted()&&this.$element.find("[data-overlay=mute]").addClass("visible").addClass("muted"),this.chapters={},this.video.chapters&&this.video.chapters.data)for(var i=0;i<this.video.chapters.data.length;i++)this.chapters["time"+this.video.chapters.data[i].time]=t.extend(!0,{hasSeen:!1},this.video.chapters.data[i]);if(this.options.apeList){var s=a.read("apeList"),n=s?s.split(","):[];n.indexOf(this.video.id)<0&&(n.unshift(this.video.id),a.write("apeList",n.slice(0,10),{expires:1}))}this._showVideoInfo(),this._showCloseButton(),this.options.enableHistoryUpdates&&(this.updateHistory(),-1===document.title.indexOf(this.video.title)&&""!==this.options.titleTagPostText&&(document.title=this.video.title+this.options.titleTagPostText))},onStateChange:function(t){switch(this.contentVideoState=t.payload.isAd?-2:t.payload.newState,t.payload.newState){case 0:e.info("onStateChange: stop"),this.isPlaying=!1,this.$element.removeClass(this.options.classPlaying),this._setEmbeddedVideoState(!1);break;case 1:e.info("onStateChange: play"),this.isPlaying=!0,this.$element.addClass(this.options.classPlaying),this.$element.addClass(this.options.classPlaybackStarted),this._setEmbeddedVideoState(!0),this.closePlayerRequested&&(this.pause(),this._closePlayerComplete()),"none"===this.$element.css("display")&&this.pause(),this.options.eventChannels&&l.publish(this.options.eventChannels,"playVideo");break;case 2:e.info("onStateChange: pause"),this.closePlayerRequested&&this._closePlayerComplete(),this.isPlaying=!1,this.$element.removeClass(this.options.classPlaying),this._setEmbeddedVideoState(!1)}},onVideoProgress:function(e){var i=this;if(!e.payload.isAd){i.uvpPayload=e.payload;var n=e.payload.currentTime,a=e.payload.duration,o="time"+Math.round(n);if(this.chapters[o]&&!this.chapters[o].hasSeen){this.chapters[o].hasSeen=!0;var l=this.$element.find("#"+o);l.addClass("highlight"),setTimeout(function(){l.removeClass("highlight")}.bind(this),3e3),this.$element.trigger("timelineEvent",this.chapters[o])}var d=i.$element.parent().find("[data-video-info=upnext]");if(Math.floor(a-n)<=i.options.upNextTriggerTime&&d.hasClass(i.options.classHidden)&&!d.hasClass(i.options.classDisabled)&&r.isDesktopUserAgent()){var u=this._getNextVideo(this.video.id);u.title&&this.playlist.length>1&&(d.html("<div class='slate'><div><b>"+s.upnext+":</b> "+u.title+"</div><button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button></div>"),d.off("click."+f),d.on("click."+f,".slate",function(e){t(this).addClass(i.options.classHidden),i._trackEvent("trackClick","video-nudge-click",e),"video_recs"===i.testName&&"iris"===i.testGroup&&window.IrisEngine&&window.IrisEngine.emit("SKIP_FORWARD"),i.player.advancePlayList()}),d.on("click."+f,"[data-item=closeButton]",function(t){t.stopPropagation(),d.addClass(i.options.classHidden),d.addClass(i.options.classDisabled)}),setTimeout(function(){d.removeClass(i.options.classHidden),d.dotdotdot({watch:"window"}),d.css("background-image","url("+u.thumbnail+")")},100))}}},playerStartError:function(t){e.error("UVPJS encountered a fatal exception starting the player: ",t),this._trackEvent("logError","trackPlayerStartError",t)},videoPlaybackError:function(i){if(e.error("UVPJS encountered a fatal exception while playing the video: ",i),i.payload&&i.payload.errorInfo){(i.payload.errorInfo.message||"").indexOf(this.errorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR)>-1&&(t("[data-video-info]").empty(),this.player.destroyPlaylist())}this._trackEvent("logError","trackVideoPlaybackError",i)},videoStartError:function(t){t&&t.payload&&t.payload.errorInfo&&1001===t.payload.errorInfo.errorCode&&!this.suppressAds?(e.warn("IMA failed to load; attempting to play video without ads due to UVPJS exception:",t),this._trackEvent("logError","trackVideoStartImaError",t)):(e.error("UVPJS encountered a fatal error starting the video: ",t),this._trackEvent("logError","trackVideoStartError",t))}},_create:function(){var i=this;h.gdprConsentCallback("video_player",function(){require(["comscore-video","optional!"+(window.CnetPageVars.services.googleima&&window.CnetPageVars.services.googleima.enabled?"google-ima":"feature-disabled")],function(){i._setup();var n=window.uvpjs.mediaCapabilities;if(!(n.canPlayType("video/mp4")||n.canPlayNativeHLS()||n.canPlayHLSJS()))return e.error("This device is unable to play supported video types."),i.$element.addClass(i.options.classPlaybackStarted),void i._showCloseButton();if(i.testGroup=u.tracking.data.testGroup,i.testName=u.tracking.data.testName,i.options.eventSubscriptions&&l.subscribe(i,i.options.eventSubscriptions),_++,i.id=i.options.idPrefix+_,i.$element.attr("id",i.id),i.options.apeList&&i._setupApeList(),"video_recs"===i.testName&&"control"!=i.testGroup&&(i.options.getRelatedPlaylist=!1),i.options.getShortcodeVideo){var a=[];t(i.options.videoShortcodeSelector).each(function(){a.push(t(this).data("videoPlaylist")[0])});var r=[];t.each(i.options.playlist,function(e){var s=!0;t.each(a,function(){i.options.playlist[e].id===this.id&&(s=!1)}),s&&r.push(i.options.playlist[e])}),"video_recs"===i.testName&&t.inArray(i.testGroup,["cnet","iris"])>-1?(i.playlist=i.options.playlist,i.options.playlist=a):i.options.playlist=a.concat(r),i.options.getRelatedPlaylist&&(i.playlist=i.options.playlist,i._getRelatedPlaylist())}t.each(i.options.playlist,function(t){i.options.playlist[t].index=t}),("video_recs"===i.testName&&!i.options.getShortcodeVideo||"iris"===i.testGroup)&&(i.options.playlist=[i.options.playlist[0]]),i.options.getPlaylistSelector&&i._getExternalPlaylist(),t(window).on("appendPlaylist",function(t,e){i.appendPlaylist(e.data)}),E.initialize(i._getUvpConfigs(),function(n){i.systemInfoObject=n,i.options.showAsModal&&i.$element.addClass(i.options.classHidden),E.addEventListener(uvpjs.EventType.PLAYER_INIT+"."+i.id,function(n){if(i.id===n.target){if(i.player=n.payload.player,i.$element.trigger("onVideoPlayerReady",i.video),e.log("onVideoPlayerReady"),i.options.showPreviewMetadata&&i.options.playlist.length>0){i.$element.find("[data-video-info=previewDuration]").html('<svg class=" video"><use aria-hidden="false" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#video"></use></svg>'+i._formatTime(i.options.playlist[0].duration)),i.$element.find("[data-video-info=previewTitle]").text(i.options.playlist[0].title?i.options.playlist[0].title:"");var a=i.options.playlist[0].author;a&&a.firstName.length>0&&i.$element.find("[data-video-info=previewAuthor]").html('<div><span class="by">'+s.by+"</span> "+a.firstName+" "+a.lastName+"</div>")}t("[data-video-info]").dotdotdot({watch:"window"})}}),i._setupData(),i.options.showAsModal&&i.$element.addClass(i.options.classHidden),i._setupExternalEvents(),"scroll"===i.autoplayState?i._setupScrollingAutoplay():"video_recs"===i.testName&&"cnet"===i.testGroup?i._getRecommendedVideos():i._setupPlayer()}),i._trackPerformanceEvent("cnetvideocreate")})})},_destroy:function(){this.$document.off("."+f),this.$element.off("."+f),this.$element.find("[data-control=autoplay]").off("."+f),this.$element.find("[data-control=share]").off("."+f),this.$element.find("[data-control=playlist]").off("."+f),E.destroyVideoPlayer(this.id),this.$element.removeAttr("id").html(""),t("[data-load-video]").removeClass(this.options.classPlaying)},_closeOverlays:function(t,e){t.find("[data-item=close]").off("."+f),t.removeClass(this.options.classActive).html(""),e&&(this.interrupted=!1,this.play())},closePlayer:function(){var t=this.player.getCurrentPlaybackState().playbackState,e=window.uvpjs.mediaCapabilities;t!==e.PAUSED&&(this.closePlayerRequested=!0,this.mute()),t!==e.EMPTY&&this.pause(),this.$element.closest('[data-video-player="container"]').length>0?this.$element.closest('[data-video-player="container"]').addClass(this.options.classHidden):this.$element.addClass(this.options.classHidden),this.$window.trigger("closePlayer")},_closePlayerComplete:function(){this.closePlayerRequested=!1,setTimeout(function(){this.unmute()}.bind(this),500)},_formatTime:function(t){t=isNaN(parseInt(t))?0:t;var e=new Date(null);return e.setSeconds(t),e.toISOString().substr(14,5)},_getRecommendedVideos:function(){var i=this,s=this.options.playlist[0].mpxRefId,n="/videos/video-recs/"+s+"/xhr/";e.log("video recs request",n),t.ajax({dataType:"json",type:"GET",url:n}).done(function(s){s&&s.length>0?(e.log("video recs response",s),i.options.getShortcodeVideo?(t.each(i.options.playlist,function(e){t.each(s,function(t){i.options.playlist[e].id===this.id&&s.splice(t,1)})}),i.playlist=i.options.playlist.concat(s)):i.playlist=s,t.each(i.playlist,function(t){i.playlist[t].index=t}),e.log("video recs new playlist",i.playlist),i.options.playlist=i.playlist,i.$element.on("onVideoPlayerReady",function(){i.$element.find('[data-video-info="title"]').text(i.playlist[0].title)})):(e.log("video recs - none available",s),i.playlist=i.options.playlist,i.options.getShortcodeVideo&&(i.options.getRelatedPlaylist=!0))}).fail(function(t,i,s){e.log("video recs failed to load",t,i,s)}).always(function(){e.log("video recs complete"),i._setupPlayer()})},_getRecommendedIrisVideos:function(i){var s=this,n=u.tracking.data.articleId,a="/videos/video-recs/iris/xhr/?ids="+i.platform_id;e.log("video recs iris request",a),t.ajax({dataType:"json",type:"GET",url:a}).done(function(t){t?(s.startingNewPlaylist=!0,e.log("video recs iris response",t),s._setPlaylist(t)):e.log("video recs iris: none available",t)}).fail(function(t,i,s){e.log("video recs failed to load",t,i,s)}).always(function(){e.log("video recs iris: complete"),s._setupPlayer()})},_getAdUrl:function(e,i){var s=u.ads.data.gpt,n=s.targeting,a="sz={param:sz}&iu=/8264/{param:region}-cnet/{param:device}/{param:partner}&ciu_szs={param:ciu_szs}&impl=s&gdfp_req=1&env=vp&output={param:output}&unviewed_position_start=1&url={param:referrer_url}&description_url={param:referrer_url}&correlator={param:timestamp}&cmsid=2289&vid={param:mpxRefId}&pp={param:pp}&cust_params=",o="vid={param:mpxRefId}&ptype={param:ptype}&vguid={param:vguid}&session={param:session}&subses={param:sub_session}&microsite={param:microsite}&campaign={param:campaign}&cid={param:cid}&collection={param:collection}&mfr={param:mfr}&carrier={param:carrier}&section={param:section}&userGroup={param:userGroup}&tag={param:tag}&edition={param:edition}&test={param:test}&score={param:score}&subcollection={param:subcollection}&topic={param:topic}&sectopic={param:sectopic}&pid={param:pid}&pv={param:pv}&akb={param:akb}",l={au:"vau",uk:"vuk"},d=r.isMobileUserAgent()||r.isIPhone()||r.isIPad(),h="cnet";"es"===u.tracking.data.siteEdition?h="es-cnet":"roadshow"===u.tracking.data.brand&&(h="roadshow"),d&&(h+="_mobile");var c={sz:this.mutedAutoplayEnabled&&0===i?"640x483":"640x480",device:d?"mobile_web":"desktop",partner:h,ciu_szs:"300x60",output:r.isDesktopUserAgent()?"xml_vmap1":"xml_vast2",microsite:"string"==typeof n.microsite?n.microsite:"",campaign:"",referrer_url:location.protocol+"//"+location.host+location.pathname,timestamp:(new Date).getTime(),ptype:u.tracking.data.pageType,vguid:u.guid,session:n.session,sub_session:n.subses,cid:n.cid,collection:n.collection,subcollection:n.subcollection,mfr:n.mfr,carrier:n.carrier,section:n.section,userGroup:n.userGroup,tag:n.tag,edition:n.edition,region:l[s.region]||"vaw",test:n.test,score:n.score,topic:n.topic&&n.topic.constructor===Array?n.topic.join():n.topic,sectopic:n.sectopic&&n.sectopic.constructor===Array?n.sectopic.join():n.sectopic,mpxRefId:e.mpxRefId,pp:"vpaid_js",pid:n.pid,pv:n.pv,akb:"string"==typeof t.cookie("bm_cnet")?t.cookie("bm_cnet").replace("-",","):null};return t.each(v.getAllParams(),function(t,e){var i=t.match(/adTargeting_(.+)/);i&&i[1]?c[i[1]]=e:"adNetwork"===t&&(c.network=e)}),t.each(c,function(t,e){var i=new RegExp("{param:"+t+"}","g"),s=e&&"||"!==e?e:"";a=a.replace(i,s),o=o.replace(i,s)}),a+encodeURIComponent(o)},_getExternalPlaylist:function(){var e=t(this.options.getPlaylistSelector).data("videoPlaylist");e&&this.appendPlaylist(e)},_getMediaUrl:function(t){var e=window.uvpjs.mediaCapabilities,i=!(e.isAndroid()&&parseInt(e.getOSVersion())<7)&&(window.MediaSource||window.WebKitMediaSource||!0===e.canPlayNativeHLS()),s=t.mp4;if(i&&t.m3u8){var n="ott";r.isMobileUserAgent()||r.isIPhone()?n="mobile":(r.isIPad()||window.uvpjs.mediaCapabilities.isChromeOS())&&(n="tablet"),s=t.m3u8,s+=-1==s.indexOf("?")?"?":"&",s+="device="+n,s+="&change-to-host=cnetmedia-a.akamaihd.net"}return s},_getPlaylistConfigs:function(t,i){var s=this,n={};return n=t.map(function(t,e){return{cmsRefGuid:t.id,duration:t.duration,index:t.index,adCall:"//pubads.g.doubleclick.net/gampad/ads?"+s._getAdUrl(t,e),assetURL:s._getMediaUrl(t),seriesTitle:"CNET Video",type:s.suppressAds||s.mutedAutoplayEnabled&&r.isMobile()&&0===e&&i?window.uvpjs.mediaCapabilities.RP_URL:window.uvpjs.mediaCapabilities.RP_IMA,vidContId:s.id,videoTitle:t.title,closedCaptionPath:t.closedCaptionPath}}),e.log("playlistConfigs",n),n},_getRelatedPlaylist:function(){var i=this,s=null;s=i.playlist[i.playlist.length-1].slug;var n=o.getEdition(),a=("us"===n?"":"/"+n)+"/videos/related-playlist/"+s+"/xhr/";s&&t.ajax({dataType:"json",type:"GET",url:a}).done(function(s){s&&s.length>0&&(i.playlist=i.playlist.concat(s),t.each(i.playlist,function(t){i.playlist[t].index=t}),i.options.playlist=i.playlist,i.player&&i.userAutoplayEnabled&&i.player.addResourcesToPlaylist(i._getPlaylistConfigs(s,!1)),i.options.getRelatedPlaylist=!1,e.log("_getRelatedPlaylist new playlist",i.playlist))}).fail(function(t,i,s){e.log("_getRelatedPlaylist failed to load",t,i,s)})},_getUvpConfigs:function(){var e=document.location.search.indexOf(f)>0,i=u.tracking.data.siteSection,s=t.inArray(i,["home","how_to","news","reviews","videos"])?i:"id",n=this.options.config&&this.options.config.tracking?escape(this.options.config.tracking["comscore_sense_"+s]):"",a={news:"P50B755CF-7443-484D-80EB-15D0499ACEB9",reviews:"P051D033D-BD8F-4F2B-93B7-A1F9F1402AB1",videos:"PB2485A3C-22F7-433C-B50B-332EF2270710"},r=a[u.tracking.data.siteSection]||"P0EA7CD2E-455C-4925-95F9-FC8A7E69BB99";return{allowConcurrentPlayback:!1,capLevelToPlayerSize:!0,cms:"platform",controls:[{el:"PREVIEW_BTN",type:"buttonContainer",label:"Start video",children:[{el:"duration",type:"previewTitle",name:"title"},{el:"title",type:"previewDuration",name:"duration"}]},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"title",type:"videoInfo",videoInfo:"title"},{el:"PLAYSTATE_BTN",type:"svgToggle",label:"Play pause",svgOn:"pause",svgOff:"play"},{el:"VOLUME_BTN",type:"svgToggle",label:"Volume",svgOn:"speaker-on",svgOff:"speaker-off"},{el:"autoplay",type:"toggle",text:"Autoplay",textOn:"On",textOff:"Off",control:"autoplay"},{el:"TIME_CURRENT",type:"span",text:"00:00"},{el:"TIME_DURATION",type:"span",text:this.options.playlist[0]&&this.options.playlist[0].duration?this._formatTime(this.options.playlist[0].duration):0},{el:"btn-share",type:"svg",label:"Share",svg:"share",control:"share"},{el:"CLOSED_CAPTION_BTN",type:"svg",control:"captions",label:"Closed captions",svg:"captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"FULLSCREEN_BTN",type:"svg",label:"Fullscreen",svg:"fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",label:"Progress",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]},{el:"overlays",type:"wrapper",name:"overlays",children:[{el:"share",type:"overlay",name:"share"},{el:"mute",type:"overlay",name:"mute"}]}],customCSS:this.options.customCSS,netwk:"cnet",partner:this.options.uvpPartner,playsInline:!0,preventFlashPlayback:!0,skin:!0,template:{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',buttonContainer:'<button class="${ o.cls }" aria-label="${ o.label }">${ o.children }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',overlay:'<div class="overlay ${ o.name }" data-overlay="${ o.name }"></div>\n',previewDuration:'<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div></div>',previewTitle:'<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div><div data-video-info="previewAuthor" class="previewAuthor"></div></div>',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }"  aria-label="${ o.label }" />\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',svg:'<button class="${ o.cls }" data-control="${ o.control }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svg }"><use xlink:href="#${ o.svg }"/></svg></button>\n',svgToggle:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svgOn }"><use xlink:href="#${ o.svgOn }"/></svg><svg class="${ o.svgOff }"><use xlink:href="#${ o.svgOff }"/></svg></button>\n',toggle:'<span class="${ o.cls }" data-control="${ o.control }">${ o.text }<button class="on" aria-label="${ o.text } ${ o.textOff }">${ o.textOn }</button><button class="off" aria-label="${ o.text } ${ o.textOn }">${ o.textOff }</button></span>\n',videoInfo:'<span class="${ o.cls }" data-video-info="${ o.videoInfo }">'+(this.options.playlist.length>0&&this.options.playlist[0].title?this.options.playlist[0].title:"")+"</span>\n",wrapper:'<div class="${ o.name }">${ o.children }</div>\n'},usesIMA:!0,uvpc:{modules:[{name:"UVPJSDebug",category:"internal",enabled:e,params:[{name:"showAll",value:!0}]},{name:"ComScore_ss",category:"tracking",enabled:!0,params:[{name:"partnerID",value:"cnet"},{name:"c1",value:"19"},{name:"c2",value:"3005086"},{name:"publishersSecret",value:"2cb08ca4d095dd734a374dff8422c2e5"},{name:"c3",value:""},{name:"c4",value:n}]},{category:"qos",enabled:!0,name:"MuxQOSPluginJS",params:[{name:"propertyKey",value:"prod"===u.environment?"f13b9be8b7851594e8da77ea2":"930577dfc824ba10a4d593063"},{name:"experimentName",value:"||"===u.ads.data.gpt.targeting.test?"":u.ads.data.gpt.targeting.test}]},{name:"SiteCatalyst",category:"qos",enabled:!0,params:[{name:"account",value:""},{name:"brand",value:"cnet"},{name:"edition",value:"us"},{name:"charSet",value:"UTF-8"},{name:"currencyCode",value:"USD"},{name:"visitorNamespace",value:"cbsinteractive"},{name:"TrackLiveStreams",value:"y"},{name:"trackingServer",value:"saa.cbsi.com"},{name:"heartbeatTrackingServer",value:"cbsinteractive.hb.omtrdc.net"},{name:"heartbeatAdobePublisherId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatVisitorMarketingCloudOrgId",value:"10D31225525FF5790A490D4D@AdobeOrg"}]},{category:"tracking",name:"NielsenTracking_SDK",enabled:!0,params:[{name:"apid",value:r},{name:"clientid",value:"us-200330"},{name:"sfcode",value:"prod"===u.environment?"us":"dcr-cert"},{name:"vcid",value:"c07"},{name:"channelInfo",value:""},{name:"iag_sid",value:"1000011"},{name:"iag_tfid",value:"902"},{name:"channelName",value:"cbs"},{name:"segB",value:"CNET.com"},{name:"nol_devDebug",value:e?"console":""}]}]}}},_getNextVideo:function(e){var i=this,s={};return t.each(this.playlist,function(t){if(e===this.id)return s=i.playlist[t+1]||i.playlist[0],!1}),s},getVideo:function(){if(!this.video||!this.video.id)return null;var e="MANUAL";("load"===this.autoplayState||"first"===this.autoplayState&&this.$element.is(t("[data-component*=videoPlayer]").first()))&&this.userAutoplayEnabled&&(this.playlist.length>1||this.options.getRelatedPlaylist?e="CONTINUOUS":this.autoplayState&&(e="AUTOPLAY"));var i;switch(this.contentVideoState){case-2:i="UNPLAYED";break;case-1:case 1:case 2:i="PLAYED";break;case 0:i="STOPPED";break;default:i="COMPLETED"}return t.extend(!0,{},this.video,{apeList:this.options.apeList,autoplayType:e,currentPlaybackState:this.player.getCurrentPlaybackState(),contentStartTimeStamp:this.contentStartTimeStamp,mediaUrl:this._getMediaUrl(this.video).split("?")[0],videoState:i})},_getVideoFromPlaylist:function(t){return this.playlist.filter(function(e){return e.index===t})[0]||null},_isFilteredShowPage:function(){try{return 1===t(window.location.hash).length}catch(t){return!1}},_initializeIrisService:function(){var t=this;e.log("iris: initialize"),require(["iris"],function(){var i={settings:{number:9,platform:"cbsuvp",client_token:"RUGGU41MBLBDXN4",ssl:!0,
player_id:"video_"+t.id,platform_id:t.options.playlist[0].mpxRefId},debug:document.location.search.indexOf(f)>0,global:"iris"},s=function(e){var i=null,s=t.player.getCurrentPlaybackState();return s.playbackStarted&&1===s.playbackState&&!t.isAdPlaying()&&(i=s.currentTime),i},n=function(e){var i=null,s=t.player.getCurrentPlaybackState();return s.playbackStarted&&1===s.playbackState&&!t.isAdPlaying()&&(i=s.duration),i},a=function(i){e.log("iris: play",i),t._getRecommendedIrisVideos(i)};window.IrisEngine=initializeIrisPlugin(i),window.IrisEngine.registerFunction("currentTime",s),window.IrisEngine.registerFunction("currentDuration",n),window.IrisEngine.registerFunction("play",a),e.log("iris: complete",window.IrisEngine)})},isAdPlaying:function(){return this.isAd},_loadChapter:function(e){var i=this;this.timelineRequests=this.timelineRequests||[],e.slug&&this.timelineRequests.push(t.ajax({dataType:"html",type:"POST",url:"/videos/video-timeline/"+e.slug+"/",data:{id:e.objectId,image:e.image?e.image:null,link:e.link,rating:e.metaData&&e.metaData.starRating?e.metaData.starRating:null,slug:e.slug,text:e.text,title:e.title,typeLabel:e.typeLabel,typeName:e.typeName},success:function(s){var n=100*e.time/i.video.duration,a=t('<div class="chapterDot" style="left:'+n+'%" id="time'+e.time+'"></div>'),r=t(s);r.on("click",function(t){i.pause()}),a.append(r),i.$element.find(".chapters").append(a)}}))},mute:function(){this.player&&this.player.mute()},_openOverlay:function(t,e){var i=this;this.isPlaying&&(this.pause(),this.interrupted=!0),this._closeOverlays(this.$element.find("[data-overlay]"),!1),t.addClass(this.options.classActive).html(e),n.process(t),t.find("[data-item=close]").on("click."+f,function(e){i._closeOverlays(t,i.interrupted)})},pause:function(){this.player&&this.player.pauseVideo()},_pausePlaylist:function(){if(this.player.pausePlaylist(),this.playlistPaused=!0,this.$element.find("[data-overlay=mute]").removeClass("visible"),this.$element.find(".uvpjs__controlbar").css("pointer-events","none"),r.isDesktop())if(this.haveFirstGesture){var t=this;this.$element.find("button.uvpjs__btn-large-play").one("click",function(e){e.stopPropagation(),t._resumePlaylist()})}else this.$element.find("button.uvpjs__btn-large-play").addClass(this.options.classDisabled),this.$element.find(".uvpjs__controls").addClass(this.options.classActive);try{this.$element.find("button.uvpjs__btn-large-play").css("background-image","url("+this.playlist[this.watchedVideoCount].image.path+")"),this.$element.find('[data-video-info="title"]').text(this.playlist[this.watchedVideoCount].title)}catch(t){}this.$element.siblings("[data-video-info=upnext]").addClass(this.options.classHidden).removeClass(this.options.classDisabled)},play:function(){this.player?this.player.playVideo():this.$element.find(".uvpjs__btn-preview").trigger("click")},playVideoClip:function(t,e){t&&(e&&e.type&&e.type===window.uvpjs.EventType.RESOURCE_END&&this.playlist.length>1?this.play():(this.unmute(),this._setPlaylist(t)))},_processEvent:function(t){if(t&&t.target===this.id){["onVideoProgress"].indexOf(t.type)<0&&e.log(t.type,t),this.uvpEvents[t.type].call(this,t),this.$element.trigger(t.type,this.video)}},_resumePlaylist:function(){this.player.resumePlaylist(),this.playlistPaused=!1,this.$element.find(".uvpjs__controlbar").css("pointer-events",""),this.$element.find("button.uvpjs__btn-large-play").css("background-image",""),r.isDesktop()&&(this.$element.find("button.uvpjs__btn-large-play").removeClass(this.options.classDisabled),this.$element.find(".uvpjs__controls").removeClass(this.options.classActive))},_setAspectRatio:function(e){if(this.options.resizePlayer)if(!0===e)this.$element.css("height","");else if(this.video.isVertical){var i=t(window).height()-this.$element.find(".uvpjs__controlbar").height();this.$element.css("height",i+"px")}},_setEmbeddedVideoState:function(e){var i=this;t("[data-load-video]").each(function(){var s=t(this).closest("[data-video-playlist]").data("videoPlaylist"),n=t(this).data("loadVideo"),a=!1;s&&s[n]&&s[n].id==i.video.id?a=!0:t(this).data("videoId")==i.video.id&&(a=!0),a?t(this).addClass(i.options.classActive):t(this).removeClass(i.options.classActive),a&&e?t(this).addClass(i.options.classPlaying):t(this).removeClass(i.options.classPlaying)})},_setPageContextMetadata:function(){var e=null!=this.video.primaryCollection?this.video.primaryCollection.id:"",i=this.video.datePublished?this.video.datePublished.slice(0,10):"";this.player.setPageContextMetadata(t.extend(!0,{},c.getHbParams(),{collectionId:e,contentType:this.options.contentType,"a.media.originator":[null!=this.video.author?this.video.author.firstName+" "+this.video.author.lastName:null],"a.media.airDate":i}))},_setPlaylist:function(t){t.length>0?(this.startingNewPlaylist=!0,this.playlist=t,this.player.destroyPlaylist(),this.player.addResourcesToPlaylist(this._getPlaylistConfigs(t,!0)),this.$element.addClass(this.options.classPlaying)):e.error("No videos found in the playlist.")},_setupApeList:function(){u.video.prepend&&!a.read("viewedPrepend")&&(this.options.playlist.unshift(u.video.prepend),a.write("viewedPrepend","1",{expires:1}));var t=a.read("apeList");if(t)for(var e=0,i=t.split(",");e<this.options.playlist.length&&i.indexOf(this.options.playlist[0].id)>=0;)this.options.playlist.push(this.options.playlist.shift()),e++},_setupData:function(){this.video=this.options.playlist.length>0?this.options.playlist[0]:{};var e=v.getParam("adSuppress")||a.read("adSuppress")||"";this.suppressAds=this.options.suppressAds||"all"===e||e.split(",").indexOf(f)>=0||u.services.googleima&&!u.services.googleima.enabled,this.history=d.init(),!this.systemInfoObject.supportsMutedAutoplay&&!this.systemInfoObject.supportsUnmutedAutoplay||this.video.ratingVChip&&"TV-MA"==this.video.ratingVChip||this._isFilteredShowPage()?this.autoplayState=!1:this.autoplayState=this.options.autoplay,this.userAutoplayEnabled="off"!==v.getParam("autoplayEnabled")&&"off"!==i.read("autoplayEnabled")||"disable_wnr"===u.tracking.data.testName&"test"===u.tracking.data.testGroup,this.mutedAutoplayEnabled=(t.inArray(this.autoplayState,["load","scroll"])>-1||"first"===this.autoplayState&&this.$element.is(t("[data-component*=videoPlayer]").first()))&&this.userAutoplayEnabled&&this.systemInfoObject.supportsMutedAutoplay&&!this.systemInfoObject.supportsUnmutedAutoplay,this.mutedAutoplayTest=this.userAutoplayEnabled&&"bucket_1"===this.testGroup&&"mute_article"===this.testName},_setupExternalEvents:function(){var e=this;this.$document.on("keyup."+e.id,"[data-load-video]",function(t){13===t.which&&e._videoExternalInteractionEvent(t,this)}),this.$document.on("click."+e.id,"[data-load-video]",function(t){e._videoExternalInteractionEvent(t,this)}),this.$document.on("click","[data-replace-video-playlist]:not([data-active-video-playlist])",function(i){var s=i.target.getAttribute("data-replace-video-playlist"),a=i.target.getAttribute("data-video-tag-type"),r=e.options.tagTopicPlaylistRoute.replace("replace-me",s),o=t("[data-tag-playlist-container]").first();r+="?currentVideo="+e.video.id,e.loader=t.cnet.loading({disabled:!1}),e.loader.$element.appendTo(t(e.options.loaderSelector)),e.loader.add(),e._trackEvent("trackClick","video-playlist|"+a+"|"+s,{}),o.hasClass("loaded")&&(o.removeClass("loaded fullLoad"),o.addClass("reset"),setTimeout(function(){t("[data-tag-playlist]").first().empty()},500)),t.ajax({dataType:"json",type:"GET",url:r}).done(function(s){s&&void 0!==s.template&&void 0!==s.playlist&&(e.playlist=s.playlist,e.loader.remove(),e._setPlaylist(e.playlist),t("[data-tag-playlist]").first().append(s.template),o.addClass("loaded"),o.removeClass("reset"),t("[data-replace-video-playlist]").removeAttr("data-active-video-playlist"),t(i.target).attr("data-active-video-playlist","true"),setTimeout(function(){o.addClass("fullLoad")},500),n.process(o))})}),this.$document.on("click","[data-active-video-playlist]",function(i){var s=t("[data-tag-playlist-container]").first();s.removeClass("loaded fullLoad"),s.addClass("reset"),t(i.target).removeAttr("data-active-video-playlist"),e.playlist=e.options.playlist,e._setPlaylist(e.playlist),setTimeout(function(){t("[data-tag-playlist]").first().empty()},500)}),"video_focus"===e.testName&&t.inArray(e.testGroup,["a","b","c"])>-1&&("a"===e.testGroup?e.blurredVideoCountThreshold=5:"b"===e.testGroup?e.blurredVideoCountThreshold=10:"c"===e.testGroup&&(e.blurredVideoCountThreshold=20),this.$window.on("blur."+this.id,function(t){e.windowHasFocus=!1}),this.$window.on("focus."+this.id,function(t){e.windowHasFocus=!0,e.playlistPaused&&e._resumePlaylist()})),this.$element.on("onVideoPlayerReady",function(){t("body").addClass("videoPlayerReady")})},_setupInternalEvents:function(){var e=this;t.each(this.uvpEvents,function(t){e.player.addEventListener(t+"."+e.id,e._processEvent.bind(e))});var n=this.$element.find("[data-control=autoplay]");if(this.userAutoplayEnabled&&(n.addClass(this.options.classActive),t('[data-load-playlist^="[{"id":"'+this.options.playlist[0].id+'"]').addClass(this.options.classPlaying)),n.on("click."+f,function(t){e.userAutoplayEnabled=!e.userAutoplayEnabled,i.write("autoplayEnabled",e.userAutoplayEnabled?"on":"off"),e.userAutoplayEnabled?(n.addClass(e.options.classActive),e._trackEvent("trackClick","autoplay|on",t)):(n.removeClass(e.options.classActive),e.pause(),e._trackEvent("trackClick","autoplay|off",t))}),this.$element.find("[data-control=share]").on("click."+f,function(i){var s=e.$element.find("[data-overlay=share]");if(s.hasClass(e.options.classActive))e._closeOverlays(s,e.interrupted);else{var n=o.getEdition();t.ajax({url:("us"===n?"":"/"+n)+"/videos/video-share-xhr/"+e.video.slug+"/"}).done(function(t){e._openOverlay(s,t)})}}),this.$element.on("click."+f,function(t){if(!e.$element.hasClass(e.options.classActive)){var i=function(t){e.$element.removeClass(e.options.classActive),e.$document.off("tap",i)};e.$element.addClass(e.options.classActive),e.$document.on("tap."+f,i)}}),this.$element.find(".uvpjs__progress").append('<div class="chapters"></div>'),this.options.enableHistoryUpdates&&this.history.stateChange(function(e){var i=-1;if(t.each(this.playlist,function(t){if(e.data.id===this.id)return i=t,!1}),i>-1){var s=this.playlist.slice(i),n=this.playlist.slice(0,i);this.playlist=s.concat(n)}else this.playlist=[e.data].concat(this.playlist);this._setPlaylist(this.playlist)}.bind(this)),this.mutedAutoplayTest||this.mutedAutoplayEnabled){var a="click";t.inArray(this.testGroup,["c","d"])>-1&&(a+=" mouseover");var r=this.$element.find("[data-overlay=mute]");r.html('<div class="speaker-off"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#speaker-on"></use></svg><span class="label">'+s.playSound+"</span></div>"),r.one(a,function(i){t(this).removeClass("muted"),e.unmute(),e.$element.removeClass(e.options.classCaptions+" "+e.options.classCaptionsMissing)})}},_videoExternalInteractionEvent:function(i,s){i.preventDefault();var n=this,a=t(s),r=a.data("loadVideo")||0,o=a.closest("[data-video-playlist]"),l=o.data("videoPlaylist");if(a.data("videoId")){var d=null;t.each(n.options.playlist,function(t,e){if(e.id===a.data("videoId"))return d=t,!1}),null!=d&&(r=d,l=n.options.playlist)}var u=l.slice(r),h=l.slice(0,r);l=u.concat(h);var c=l&&l.length>0?l[0].id:null,p=a.hasClass(n.options.classPlaying),v=parseInt(n.id.replace(n.options.idPrefix,""))===a.closest("[data-playlist-target]").data("playlistTarget"),g=t(s).is(n.options.videoShortcodeSelector);if(n.options.mainPlayer||v)if(n.options.showAsModal&&(n.$element.removeClass(n.options.classHidden),n._showCloseButton()),p)n.pause(),g&&n._trackEvent("trackClick","inbody|videopause",i),a.data("trackPlaylist")&&n._trackEvent("trackClick","playlist_pause",i);else{if(n.$element.closest('[data-video-player="container"]').removeClass(n.options.classHidden),t(window).trigger("playerShowing"),n.unmute(),l&&l.length>0&&(!n.video||n.video&&n.video.id!=c))n.player.getCurrentPlaybackState().playbackStarted?n._setPlaylist(l):(n.options.playlist=l,n.player.overrideUserGesture(!0));else if(n.player.getCurrentPlaybackState().playbackStarted)if(n.player.getCurrentPlaybackState().playbackStarted)n.play();else{var f=n.$element.find("#content_"+n.id+" video")[0];if(f){f.src=n.testVideoUrl;var m=f.play();m?m.then(function(){e.log("Promise fulfilled..."),t(".uvpjs__btn-preview").trigger("click")}).catch(function(t){e.error("Promise not met...",t)}):e.error("no Promise")}}else n.player.overrideUserGesture(!0);a.data("scrollToTop")&&t("html, body").animate({scrollTop:n.$element.offset().top},1e3),t("[data-load-video]").removeClass(n.options.classActive),t("[data-load-video]").removeClass(n.options.classPlaying),a.addClass(n.options.classActive),a.addClass(n.options.classPlaying),g&&n._trackEvent("trackClick","inbody|videoplay",i),a.data("trackPlaylist")&&n._trackEvent("trackClick","playlist_play",i),a.data("trackPlaylistRedesign")&&n._trackEvent("trackClick","video-playlist|playlist-item|"+a.data("trackPlaylistRedesign"),i)}},_setupPlayer:function(){var e=this;this.initialized||(this.initialized=!0,this.autoplayState&&this.userAutoplayEnabled||(this.$element.addClass(this.options.classNoAutoplay),this.$window.trigger(this.options.classNoAutoplay),this._showCloseButton()),E.createVideoPlayer(e.id,function(t){e.player=t,e._setPageContextMetadata(),e._trackPerformanceEvent("playerloaded"),e._setupInternalEvents(),e._setPlaylist(e.options.playlist),(window._cbv||(window._cbv=[])).push(e.player.DOMMgr.dom.video.el),"video_recs"===e.testName&&"iris"===e.testGroup&&(e.options.loop=!1,e._initializeIrisService()),e.$element.trigger("onVideoPlayerReady",e.video)},{enableMutedAutoplay:this.mutedAutoplayEnabled,enableUnmutedAutoplay:(t.inArray(e.autoplayState,["load","scroll"])>-1||"first"===e.autoplayState&&e.$element.is(t("[data-component*=videoPlayer]").first()))&&e.userAutoplayEnabled&&e.systemInfoObject.supportsUnmutedAutoplay,previewImage:e.options.playlist.length>0&&e.options.playlist[0].image&&e.options.playlist[0].image.path?e.options.playlist[0].image.path:""}))},_showCloseButton:function(){if(0==this.$element.find("[data-item=closeButton]").length){this.$element.prepend("<button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button>");var t=this;this.$element.find("[data-item=closeButton]").click(function(e){e.stopPropagation(),t.closePlayer(),t._trackEvent("trackClick","close-scroll-video",e)})}},_showVideoInfo:function(){var e=this;t("[data-video-info]").each(function(){var i=t(this),s=i.data("videoInfo"),n=e.video[s]||"";0===e.watchedVideoCount&&"title"===s&&e.video.primaryCollection&&"0d8f9ac8-61cb-4e36-9263-552d5468e04b"===e.video.primaryCollection.id?n=e.video.primaryCollection.title||"":"author"===s&&e.video.author?n=(e.video.author.firstName||"")+" "+(e.video.author.lastName||""):"collection"===s&&e.video.primaryCollection?n=e.video.primaryCollection.title||"":"upnext"===s&&(n="",i.addClass(e.options.classHidden).removeClass(e.options.classDisabled)),i.text(n)}),setTimeout(function(){t("[data-video-info]").dotdotdot({watch:"window"})},100)},_setupScrollingAutoplay:function(){var t=this,e=function(e){t.player?t.play():t._setupPlayer()},i=function(e){if(t.player&&0===t.$element.closest(t.options.selectorScrollingAutoplayDisabled).length){t.player.getCurrentPlaybackState().playbackStarted&&t.pause()}};this.scrollingAutoplayWaypoint=new Waypoint.Inview({element:this.$element,entered:e,enter:e,exited:i})},_showChapterStarts:function(){if(this.timelineRequests)for(var t=0;t<this.timelineRequests.length;t++)this.timelineRequests[t].abort();if(this.$element.find(".chapters").empty(),this.video&&this.video.chapters)for(var e in this.video.chapters.data)this._loadChapter(this.video.chapters.data[e])},supportsAutoplay:function(){var t=this.systemInfoObject;return t.supportsUnmutedAutoplay||t.supportsMutedAutoplay},_trackEvent:function(e,i,s,n){if("logError"!==e){n=n||{};var a="";if(s.errorInfo){var r=s.errorInfo.errorCode||"null",o=s.errorInfo.serverCode||"null";if(3005===r&&"string"==typeof s.errorInfo.message){var l=s.errorInfo.message.split(" ");o+="_"+l[l.length-1]}a=r+"_"+o}var d=-1<a.indexOf("3005_null_buffer"),h=-1<a.indexOf("3005_null_levelLoad");!(d||h)&&this.video&&c.trackCustomEvent(e,t.extend(!0,{articleAuthorId:this.video.author?[this.video.author.id]:null,articleAuthorName:this.video.author?[this.video.author.firstName+" "+this.video.author.lastName]:null,articleId:u.tracking.data.articleId,articleTitle:u.tracking.data.articleTitle,articleType:u.tracking.data.articleType,brand:u.tracking.data.brand,channel:"video",clickGenericText:i,collectionId:this.video.primaryCollection?[this.video.primaryCollection.id]:null,deviceType:u.tracking.data.deviceType,error:a,pageType:u.tracking.data.pageType,siteEdition:u.tracking.data.siteEdition,siteHier:u.tracking.data.siteHier,siteSection:u.tracking.data.siteSection,siteType:u.tracking.data.siteType,videoAdIds:s.adData?s.adData.adVideoId:null,videoAdTitle:s.adData?s.adData.adVideoTitle:null,videoContentType:"video",videoId:this.video.id,videoTitle:this.video.title||this.video.headline,_pageChannelType:u.tracking.data._pageChannelType,_pageTitle:u.tracking.data._pageTitle,_pageViewGuid:u.tracking.data._pageViewGuid},n))}},_trackPerformanceEvent:function(i){e.info("Firing event: cnet_video."+i),u.video=u.video||{},u.video.performance=u.video.performance||{},u.video.performance[i]=!0;try{t(window).trigger("cnet_video."+i)}catch(t){e.error("Unable to trigger event cnet_video."+i)}try{void 0===performance.getEntriesByName(i)[0]&&performance.mark("cnet_video_"+i)}catch(t){e.error("Unable to set performance mark cnet_video_"+i)}try{var s=void 0===m[i]||0===m[i],n=["video_page","article","product_main"].indexOf(u.tracking.data.pageType)>-1;if(s&&n){m[i]=performance.now();var a={cnetvideocreate:["create"],playerloaded:["ploaded","cnetvideocreate"],adstart:["adStart","playerloaded"],showplayoverlay:["showoverl","playerloaded"]},r=m[i],o=a[i];if(t.isArray(o)){var l=m[o[1]]||0;r=m[i+"_from_"+o[1]]=m[i]-l}var d=t.isArray(o)?o[0]:"";-1===["adstart","cnetvideocreate"].indexOf(i)&&d&&p.sendBeacon("video_"+d,r),"adstart"===i&&p.sendBeacon("video_adStart_c",m[i])}}catch(t){e.error("mpulse error tracking "+i+": "+t)}},unmute:function(){this.player&&this.player.getPlayerMuted()&&(this.player.unMute(),this.player.hideCaptions())},updateHistory:function(){-1===document.location.pathname.indexOf(this.video.urlPath)&&this.video.urlPath&&(this.history.navigate({title:this.video.title,data:this.video},{replace:!1,url:this.video.urlPath}),t(window).trigger("historystatechange"))},appendPlaylist:function(i){var s=this;i.length>0?this.playlist.length>0?(this.options.playlist=this.options.playlist.concat(i),t.each(s.options.playlist,function(t){s.options.playlist[t].index=t}),this.playlist=this.options.playlist,this.player&&this.player.addResourcesToPlaylist(this._getPlaylistConfigs(i))):(this.options.playlist=this.options.playlist.concat(i),t.each(s.options.playlist,function(t){s.options.playlist[t].index=t})):e.error("No videos found in the playlist."),e.log("appendPlaylist: new videos",i),e.log("appendPlaylist: new playlist",this.options.playlist)}})}),define("pages/desktop/front_door",["main.desktop","components/form-trim","components/form-validate","components/global-modal","components/lazyload-images","components/touch-menu-hover","version!libs/jquery/lazyload","version!libs/waypoints/inview","version!libs/waypoints/jquery.waypoints","managers/waypoints","utils/function-natives","components/image-gallery-modal","components/load-more","components/selfish-scroll","translations/load-more","version!fly/managers/history","version!fly/components/load-more-scroll","version!fly/components/load-more","managers/edition-notifications","components/iframe-ad-tracker","version!libs/jquery/iframetracker","components/leads-tracker","components/module-asset-tracker","components/track-download","components/social-tracking","quantum/videoPlayer"],function(){});