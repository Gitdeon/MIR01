define("Purch/Omniture/Tracking",["jquery"],function(a){"use strict";var b=function(b){this.w=window,this.options=a.extend({selector:".omniture-tracking",event:"click",init:!0,callback:function(){},gtmDataLayer:!1,gtmEvent:"purch.omniture.tracking"},b||{}),this.TRACKING_NS="omniture-tracking",!0===this.options.init&&this.init()};return b.prototype={init:function(){this.startListener()},startListener:function(){var b=this,c=b.options.selector?b.options.selector:"."+b.TRACKING_NS;a(document).off(b.options.event+".omniture",c),a(document).on(b.options.event+".omniture",c,a.proxy(b.doTracking,b,this.options.callback))},whiteListOmnitureProperties:function(a){var b=a.linkTrackVars?[a.linkTrackVars]:[];for(var c in a)a.hasOwnProperty(c)&&(c.match(/prop[0-9]+/)||"pageName"===c||"channel"===c?delete a[c]:c.match(/^(prop|eVar|contentID)/)&&-1===a.linkTrackVars.indexOf(c)&&b.push(c));return a.linkTrackVars=b.join(","),a},getStoredData:function(a){return a.data(this.TRACKING_NS)},updateOmnitureProperties:function(a){var b=Purch.Omniture.s;a.event&&(b.events="event"+a.event,b.linkTrackEvents="event"+a.event);var c=b.linkTrackVars?[b.linkTrackVars,"events"]:["events"];if(a.evars&&"object"==typeof a.evars)for(var d in a.evars)a.evars.hasOwnProperty(d)&&(b[d]=a.evars[d],c.push(d));return b.linkTrackVars=c.join(","),b=this.whiteListOmnitureProperties(b)},doTracking:function(b,c){var d=this;if("Omniture"in window.Purch!=!0)throw new Error("omniture API not loaded");var e=a(c.currentTarget),f=d.getStoredData(e);if(!f)throw new Error("No omniture tracking data");this.w.Purch&&this.w.Purch.Omniture&&this.w.Purch.Omniture.s&&this.w.Purch.Omniture.s.contentID&&f.evars&&(f.evars.contentID=this.w.Purch.Omniture.params.contentID),f.linkName&&f.linkName,d.updateOmnitureProperties(f);var g=e.attr("href"),h="_blank"===e.attr("target");g&&!h?(c.preventDefault(),d.options.gtmDataLayer&&"object"==typeof window.top[d.options.gtmDataLayer]&&d.pushToGtmDataLayer(f),window.setTimeout(function(){document.location=g},700)):d.options.gtmDataLayer&&"object"==typeof window.top[d.options.gtmDataLayer]&&d.pushToGtmDataLayer(f)},pushToGtmDataLayer:function(a){var b=this,c=b.options.gtmEvent,d={event:c};d[c+".datas"]=a,window.top[b.options.gtmDataLayer].push(d)}},b.initModule=function(a){return new b(a)},b});